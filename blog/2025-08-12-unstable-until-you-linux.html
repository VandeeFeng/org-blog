<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="description" content="Both stable and unstable until you linux.Linux 好玩是好玩，就是不太稳定，会遇到很多小问题。Linux 的图形界面和显示器协议的混乱和前端有的一拼。我的 Fcitx 输入法框架在 Emacs 和系统之间反复横跳，就像薛定谔的猫一样。有时候是 Emacs 里可以用，系统不能用，有时候又刚好反过来。">
    <link rel="alternate"
          type="application/rss+xml"
          href="https://www.vandee.art/blog/rss.xml"
          title="RSS feed for https://www.vandee.art/blog/">
    <title>薛定谔的 Linux</title>
    <meta property="og:title" content="薛定谔的 Linux">
    <meta property="og:type" content="article" />
    <meta property="og:description" content="Both stable and unstable until you linux.Linux 好玩是好玩，就是不太稳定，会遇到很多小问题。Linux 的图形界面和显示器协议的混乱和前端有的一拼。我的 Fcitx 输入法框架在 Emacs 和系统之间反复横跳，就像薛定谔的猫一样。有时候是 Emacs 里可以用，系统不能用，有时候又刚好反过来。">
    <meta property="og:url" content="https://www.vandee.art/blog/2025-08-12-unstable-until-you-linux.html">
    <meta name="author" content="Vandee">
    <meta name="referrer" content="origin-when-cross-origin">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="assets/css/blog-style.css" type="text/css"/>
    <link rel="stylesheet"
          href="https://lf26-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css"/>
    <link rel="stylesheet"
          href="https://testingcf.jsdelivr.net/npm/@fancyapps/ui@4.0.12/dist/fancybox.css"/>
    <link rel="icon" type="image/x-icon" href="/favicon.ico"/>

    <script src="https://testingcf.jsdelivr.net/npm/@fancyapps/ui@4.0.12/dist/fancybox.umd.js" defer></script>
    <script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/pangu/4.0.7/pangu.min.js" defer></script>
    <script defer>
      document.addEventListener("DOMContentLoaded", function () {
        pangu.spacingPage();
      });
    </script>

    <script src="assets/js/app.js" defer></script>
    <script src="assets/js/copyCode.js" defer></script>
    <script src="assets/js/shiba.js" defer></script>
    <script src="assets/js/search.js" defer></script></head>
  <body>
    <div id="preamble" class="status">
      <header>
        <h1><a href="https://www.vandee.art/blog/">Vandee's Blog</a></h1>
        <img class="shiba" width="100px" src="assets/shiba_gif/shiba_idle_8fps.gif">
        <nav>
          <a href="https://www.vandee.art/blog/">Home</a>
          <a href="https://x404.xyz/wiki">Wiki</a>
          <a href="https://x404.xyz/photo">Photo</a>
          <a href="archive.html">Archive</a>
          <a href="tags.html">Tags</a>
          <div id="search-container">
            <input type="text" id="search-input" placeholder="e.g. Emacs PKM...">
            <i class="fas fa-search search-icon"></i>
          </div>
        </nav>
    </header></div>
    <div id="content">
      <div class="post-date">12 Aug 2025</div><h1 class="post-title"><a href="https://www.vandee.art/blog/2025-08-12-unstable-until-you-linux.html">薛定谔的 Linux</a></h1>
      <nav id="table-of-contents" role="doc-toc">
        <h2>Table of Contents</h2>
        <div id="text-table-of-contents" role="doc-toc">
          <ul>
            <li><a href="#org5983664">TL;DR</a></li>
            <li><a href="#orgc852887">折腾记录</a>
              <ul>
                <li><a href="#orgdb700ad">Arch Linux 初始安装</a></li>
                <li><a href="#orgf6f3300">i3-X11</a>
                  <ul>
                    <li><a href="#orgb8f2457">安装：</a></li>
                    <li><a href="#org7b9d980">配置</a></li>
                    <li><a href="#orgfe2f6dc">其他设定</a></li>
                  </ul>
                </li>
                <li><a href="#orgf05cf81">Sway-Wayland</a></li>
              </ul>
            </li>
            <li><a href="#orgb4d23c7">冤家 Fcitx 和 Emacs</a></li>
            <li><a href="#orgce08e96">小结</a></li>
          </ul>
        </div>
      </nav>
      <div id="outline-container-org5983664" class="outline-2">
        <h2 id="org5983664">TL;DR</h2>
        <div class="outline-text-2" id="text-org5983664">
          <p>
            Both stable and unstable until you linux.
          </p>

          <p>
            Linux 好玩是好玩，就是不太稳定，会遇到很多小问题。Linux 的图形界面和显示器协议的混乱和前端有的一拼。
          </p>

          <p>
            我的 Fcitx 输入法框架在 Emacs 和系统之间反复横跳，就像薛定谔的猫一样。有时候是 Emacs 里可以用，系统不能用，有时候又刚好反过来。
          </p>
        </div>
      </div>
      <div id="outline-container-orgc852887" class="outline-2">
        <h2 id="orgc852887">折腾记录</h2>
        <div class="outline-text-2" id="text-orgc852887">
          <p>
            近道都是远路，尝试过几个大佬自己封装好的 Arch Linux，附带了桌面环境的安装和配置。是挺方便的，但是遇到一些小问题的时候，由于不知道他具体是怎么实现的一些功能，又要去看文档和源码。我这个电脑又比较老了，很多问题都没有现成的答案和别人的复现。
          </p>

          <p>
            也尝试了 DHH 的 <a href="https://omarchy.org/">Omarchy</a> ，桌面环境是 hyprland + Wayland，可能是我的电脑比较老了，运行起来有点卡顿。内置的 theme 我又不太喜欢，体验了 2 天之后，感觉不是很顺手。
          </p>

          <p>
            最后决定使用 i3 和 X11，运行起来一点不卡，所有应用都是秒开。
          </p>


          <figure id="orga933ad2">
            <img src="https://pic.vandee.art/images/2025-08-12_16-18.png" class="img" width="70%" height="70%">

          </figure>
        </div>
        <div id="outline-container-orgdb700ad" class="outline-3">
          <h3 id="orgdb700ad">Arch Linux 初始安装</h3>
          <div class="outline-text-3" id="text-orgdb700ad">
            <p>
              <a href="https://archlinux.org/download/">Arch Linux - Downloads</a> 页面下载最新的 ISO 文件，有很多国内镜像可以选。写入 U 盘之后，进入 BIOS 启动 U 盘引导。
            </p>

            <p>
              <a href="https://wiki.archlinux.org/title/Archinstall">archinstall</a> 是 Arch Linux 的官方安装脚本，挺方便的，命令行输入 <code>archinstall</code> 启动安装脚本。
            </p>

            <ul class="org-ul">
              <li>选择仓库镜像为 China</li>
              <li>设置硬盘和分区：由于我的老电脑一个硬盘是小固态，一个是机械硬盘。在 <code>manually partition</code> 里手动设置把 arch 的系统（挂载 EFI Root）安装在固态，home 挂在在机械硬盘。设置完之后，设定 disk encryption 硬盘加密。</li>
              <li>设定 root 密码并添加用户</li>
              <li>设定 audio 为 pipewire，不在这里设定就播放不了音频，之后要单独安装。</li>
            </ul>

            <p>
              Arch Linux 的镜像对国内环境太友好了，差不多 10 分钟就安装好了。
            </p>

            <p>
              接下来就是大坑桌面环境。
            </p>
          </div>
        </div>
        <div id="outline-container-orgf6f3300" class="outline-3">
          <h3 id="orgf6f3300">i3-X11</h3>
          <div class="outline-text-3" id="text-orgf6f3300">
            <p>
              <a href="https://github.com/i3/i3">i3</a> 的简洁实在太爱了。
            </p>
          </div>
          <div id="outline-container-orgb8f2457" class="outline-4">
            <h4 id="orgb8f2457">安装：</h4>
            <div class="outline-text-4" id="text-orgb8f2457">
              <div class="org-src-container">
                <pre class="src src-bash">sudo pacman -S i3 xorg xorg-xinit
                  echo "exec i3" > ~/.xinitrc</pre>
              </div>

              <p>
                输入 startx 进入桌面环境。i3 会有一个引导界面，可以初始化生成配置文件到 <code>/home/user/.config/i3/config</code> 。
              </p>
            </div>
          </div>
          <div id="outline-container-org7b9d980" class="outline-4">
            <h4 id="org7b9d980">配置</h4>
            <div class="outline-text-4" id="text-org7b9d980">
              <ul class="org-ul">
                <li><p>
                    设置鼠标滚轮翻转
                  </p>

                  <p>
                    编辑 /usr/share/X11/xorg.conf.d/40-libinput.conf 文件:
                  </p>

                  <div class="org-src-container">
                    <pre class="src src-bash">  Section "InputClass"
                      Identifier "libinput pointer catchall"
                      MatchIsPointer "on"
                      MatchDevicePath "/dev/input/event*"
                      Driver "libinput"
                      Option "NaturalScrolling" "True"
                      EndSection</pre>
                </div></li>

                <li><p>
                    我的自定义设置
                  </p>

                  <div class="org-src-container">
                    <pre class="src src-bash">exec --no-startup-id opensnitch-ui
                      exec --no-startup-id copyq
                      exec --no-startup-id feh --bg-fill /home/vandee/Pictures/create.jpg
                      bindsym $mod+period exec ghostty
                      bindsym $mod+b exec librewolf --new--windows
                      bindsym $mod+e exec emacsclient -c -a ""
                      bindsym $mod+f exec thunar
                      bindsym $mod+q kill
                      # bindsym $mod+Mod1+v exec --no-startup-id copyq show
                      # Gaps
                      gaps inner 5
                      smart_gaps on
                      # hide tiling window title bar
                      for_window [tiling] border pixel 1
                      smart_borders on
                      exec --no-startup-id fcitx5</pre>
                </div></li>
              </ul>
            </div>
          </div>
          <div id="outline-container-orgfe2f6dc" class="outline-4">
            <h4 id="orgfe2f6dc">其他设定</h4>
          </div>
        </div>
        <div id="outline-container-orgf05cf81" class="outline-3">
          <h3 id="orgf05cf81">Sway-Wayland</h3>
          <div class="outline-text-3" id="text-orgf05cf81">
            <p>
              2025-09-01 added
            </p>

            <p>
              在查找 X11 相关资料的时候了解到它有许多安全隐患，一些老旧的 issue 也很难再解决，我这个 Linux 菜鸟还是先用 Wayland 吧，Wayland 现在的势头和生态还是挺不错。
            </p>

            <p>
              所以窗口管理器换成了 Sway。Sway 可以直接使用 i3 的配置文件，图形界面也和 i3 一样。用了 i3 一段时间之后就觉得 hyprland 有点臃肿。
            </p>

            <p>
              dmenu 换成了 fuzzel，也很轻量。
            </p>

            <p>
              安装： <code>sudo pacman -S sway swaybg swaylock</code> ,status bar 没有用 waybar，还是用的 i3 的配置文件。
            </p>

            <p>
              保险起见，再装上 <code>xdg-desktop-portal</code> 。
            </p>

            <ul class="org-ul">
              <li><p>
                  设置鼠标滚轮翻转
                  直接在 <code>.config/sway/config</code> 里加上：
                </p>

                <div class="org-src-container">
                  <pre class="src src-nil">   input * {
                    natural_scroll enabled
                    }</pre>
              </div></li>
            </ul>
          </div>
        </div>
      </div>
      <div id="outline-container-orgb4d23c7" class="outline-2">
        <h2 id="orgb4d23c7">冤家 Fcitx 和 Emacs</h2>
        <div class="outline-text-2" id="text-orgb4d23c7">
          <p>
            <code>~/.xprofile</code>
          </p>

          <div class="org-src-container">
            <pre class="src src-bash">export GTK_IM_MODULE=fcitx
              export QT_IM_MODULE=fcitx
              export XMODIFIERS=@im=fcitx</pre>
          </div>

          <p>
            <code>/etc/environment.d/90-fcitx5.conf</code>
          </p>

          <div class="org-src-container">
            <pre class="src src-bash">XMODIFIERS=@im=fcitx
              GTK_IM_MODULE=fcitx
              QT_IM_MODULE=fcitx</pre>
          </div>

          <p>
            还有其他网上能查到的地方我都设置了。
          </p>

          <p>
            现在他们两个的情况就是：有时候是 Emacs 里可以用，系统不能用，有时候又刚好反过来，还有的时候 Emacs 桌面不能用，但是 Emacsclient 可以，大多数时候在终端里 <code>emacs -nw</code> 可以，极少数情况都可以用。
          </p>

          <p>
            这篇博客就是趁它们刚好都可以同时运行的时候抓紧时间写的！
          </p>

          <p>
            用 Emacs rime 可以解决现在这个问题，但我更想弄明白到底是哪里出了问题。
          </p>

          <p>
            我猜测可能的原因是因为 Emacsclient 在设置为系统的 service 之后，启动需要加载的环境和 i3 之间有顺序要求。有时候加载的顺序对了，环境就应用上了。
          </p>

          <p>
            之前的猜测错了，是因为我用 systemd 启动了 Emacs daemon，而 i3 启动的 Fcitx5 获取的是 i3 session 的环境变量。之前就算我在 Emacs 里使用 <code>getenv</code> 指令获取到了 <code>XMODIFIERS=@im=fcitx</code> ，输入法框架还是出不来。由于某种原因，systemd 里启动的 Emacs 和 i3 的环境变量没有统一。找到一个最简单的方法，直接用 tmux 后台 <code>Emacs --daemon</code> 。
          </p>
        </div>
      </div>
      <div id="outline-container-orgce08e96" class="outline-2">
        <h2 id="orgce08e96">小结</h2>
        <div class="outline-text-2" id="text-orgce08e96">
          <p>
            这可能就是 Linux 一直不是流行的桌面环境的原因，它的桌面环境和 win、mac 比起来不那么稳定，不同的硬件配置和环境遇到的问题都不一样，得自己看文档解决。但这同时也是 hacker、nerd 和折腾仔（我）喜欢 Linux 的原因，它和 Emacs 一样，都是我的赛伯乐高。
          </p>

          <p>
            Linux 就是我会一直使用下去的操作系统, <a href="https://www.vandee.art/blog/2025-07-16-linux-is-awesome.html">Linux 太自由了</a> 。
          </p>
        </div>
      </div>
      <div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-linux.html">Linux</a> <a href="https://www.vandee.art/blog/tag-ramble.html">Ramble</a> </div></div>
    <div id="postamble" class="status"><div id="search-results"></div>
      <footer>
        <p>
          © 2022-<script>document.write(new Date().getFullYear())</script> Vandee. All rights reserved.
        </p>
        <div class="social-links"></div>
      </footer>

      <a href="#top" aria-label="go to top" title="Go to Top (Alt + G)"
         class="top-link" id="top-link" accesskey="g">
        <i class="fa-solid fa-angle-up fa-2xl"></i>
      </a>

      <script>
        var mybutton = document.getElementById('top-link');
        window.onscroll = function () {
          if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = 'visible';
            mybutton.style.opacity = '1';
          } else {
            mybutton.style.visibility = 'hidden';
            mybutton.style.opacity = '0';
          }
        };
    </script></div>
  </body>
</html>
