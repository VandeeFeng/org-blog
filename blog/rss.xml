<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
<title><![CDATA[Vandee's Blog]]></title>
<description><![CDATA[Vandee's Blog]]></description>
<link>https://www.vandee.art/blog/</link>
<lastBuildDate>Wed, 11 Feb 2026 13:04:10 +0800</lastBuildDate>
<item>
  <title><![CDATA[Learn Agents by Building One: The Minimal Agent pi]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgd9b64a1">Pi-mono</a></li>
<li><a href="#orgecadee4">Pi-mono Extension</a>
<ul>
<li><a href="#orgd6a062a">Command Rule</a></li>
<li><a href="#org316d5c1">Subagent</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<p>
这段时间小龙虾 OpenClaw 突然就病毒式的爆火了，它背后的 agent 框架就是 <a href="https://github.com/badlogic/pi-mono">pi-mono</a>.
</p>

<p>
<a href="https://mariozechner.at/posts/2025-11-30-pi-coding-agent/">What I learned building an opinionated and minimal coding agent</a> pi-mono 作者的这篇 blog 详细解释了他构建 pi-mono 的初衷和思路。
</p>

<p>
大道至简，这大概是 Scaling Law 之后，agent 领域现在的新铁律了。
</p>
<div id="outline-container-orgd9b64a1" class="outline-2">
<h2 id="orgd9b64a1">Pi-mono</h2>
<div class="outline-text-2" id="text-orgd9b64a1">
<p>
pi-mono 的 agent 设计的极为简洁：只有 read，bash，edit，write 四个基础工具，system prompt 也设计的非常简洁。AI agent ≈ Tools + loops.
</p>

<div class="org-src-container">
<pre class="src src-nil">You are an expert coding assistant. You help users with coding tasks by reading files, executing commands, editing code, and writing new files.

Available tools:
- read: Read file contents
- bash: Execute bash commands
- edit: Make surgical edits to files
- write: Create or overwrite files

Guidelines:
- Use bash for file operations like ls, grep, find
- Use read to examine files before editing
- Use edit for precise changes (old text must match exactly)
- Use write only for new files or complete rewrites
- When summarizing your actions, output plain text directly - do NOT use cat or bash to display what you did
- Be concise in your responses
- Show file paths clearly when working with files

Documentation:
- Your own documentation (including custom model setup and theme creation) is at: /path/to/README.md
- Read it when users ask about features, configuration, or setup, and especially if the user asks you to add a custom model or provider, or create a custom theme.
</pre>
</div>

<p>
在大语言模型的能力越来越强之后，简洁的 prompt 反而可以发挥更好的效果。以前模型能力不足，所以需要详细的 prompt 来指导 agent，现在反过来了，模型能力很强，只需要提供简洁的 guide rules，让 agent 能够自主发挥。我觉得这是 pi-mono 能够在现有模型基础上实现很好的执行效果，很重要的一个原因。
</p>

<p>
没想到，KISS原则（Keep It Simple, Stupid），Unix 系统的一切皆是文件的设计哲学现在也深深的影响了 agent 的能力。现阶段训练出来的模型，天然的就会对文件操作比较熟悉，LLM 更喜欢这些基础的 shell 指令，更喜欢和文件打交道。这也是为什么 Claude Code 放弃使用 Cursor 的 RAG 方案，而使用 grep 来让 agent 直接搜索和查找文件，这也是为什么 AGENTS.md 最终使用 md 这个格式文本来作为 agent 的指导文件。
</p>

<p>
<a href="https://lucumr.pocoo.org/2026/1/31/pi/">Pi: The Minimal Agent Within OpenClaw | Armin Ronacher's Thoughts and Writings</a> pi-mono 提供了非常方便的 extension 扩展系统，能够调用 API 实现高度自定义的功能，这实在是 awesome！
</p>

<p>
比起那些复杂的 agent 框架，各种概念、论文和复杂的抽象层，pi-mono 对新手来说是在太友好了，源码里还有大量的 example 和 docs。
</p>

<p>
从 Claude Code 到 OpenCode，再到 OpenClaw 和 pi-mono，我觉得，本地自部署模型+自定义 agent 一定是未来的趋势。人人都能够有一个自己自定义版本的 AI agent，最后变成一个 USB 即插即用。
</p>
</div>
</div>
<div id="outline-container-orgecadee4" class="outline-2">
<h2 id="orgecadee4">Pi-mono Extension</h2>
<div class="outline-text-2" id="text-orgecadee4">
<p>
前段时间刚开始深入一点折腾和看 OpenCode 的源码，想实现一些自定义的功能，但是这个项目已经做的太大了，pi-mono 更适合个人折腾。
</p>
</div>
<div id="outline-container-orgd6a062a" class="outline-3">
<h3 id="orgd6a062a">Command Rule</h3>
<div class="outline-text-3" id="text-orgd6a062a">
<p>
pi-mono 没有对 tool 调用的规则设定，参考 OpenCode 的实现 让 pi 生成了一个 extension 来禁止一些 shell 指令的调用，例如 rm，git push，git commit:
</p>

<div class="org-src-container">
<pre class="src src-typescript"><span style="color: #787878;">/**</span><span style="color: #787878;">
 * Command Permissions Extension
 *
 * Ported from opencode command permissions configuration.
 * Supports wildcard patterns and ask/allow/deny actions.
 *
 * Configuration in settings.json:
 * {
 *   "permission": {
 *     "YOLO": true,
 *     "nonInteractiveAsk": "deny",
 *     "read": { ".env": "deny", "*.md": "allow" },
 *     "bash": { "git push *": "ask", "rm -rf *": "deny" }
 *   }
 * }
 *
 * Config files (</span><span style="color: #f4f4ff;">merged</span><span style="color: #787878;">, project takes </span><span style="color: #f4f4ff;">precedence</span><span style="color: #787878;">):
 * - ~/.pi/agent/settings.</span><span style="color: #96a6c8;">json</span><span style="color: #787878;"> (global)
 * - &lt;cwd&gt;/.pi/settings.</span><span style="color: #96a6c8;">json</span><span style="color: #787878;"> (project-local)
 */</span>

<span style="color: #FFA657;">import</span> <span style="color: #8c8c8c;">{</span> existsSync, readFileSync <span style="color: #8c8c8c;">}</span> <span style="color: #FFA657;">from</span> <span style="color: #A1D08E;">"node:fs"</span>;
<span style="color: #FFA657;">import</span> <span style="color: #8c8c8c;">{</span> homedir <span style="color: #8c8c8c;">}</span> <span style="color: #FFA657;">from</span> <span style="color: #A1D08E;">"node:os"</span>;
<span style="color: #FFA657;">import</span> <span style="color: #8c8c8c;">{</span> join <span style="color: #8c8c8c;">}</span> <span style="color: #FFA657;">from</span> <span style="color: #A1D08E;">"node:path"</span>;
<span style="color: #FFA657;">import</span> <span style="color: #FFA657;">type</span> <span style="color: #8c8c8c;">{</span> ExtensionAPI <span style="color: #8c8c8c;">}</span> <span style="color: #FFA657;">from</span> <span style="color: #A1D08E;">"@mariozechner/pi-coding-agent"</span>;

<span style="color: #787878;">// </span><span style="color: #787878;">Simple glob-to-regex converter for command matching
</span><span style="color: #787878;">// </span><span style="color: #787878;">Matches opencode's wildcard implementation
</span><span style="color: #787878;">// </span><span style="color: #787878;">* matches any characters (including /)
</span><span style="color: #787878;">// </span><span style="color: #787878;">? matches any single character
</span><span style="color: #787878;">// </span><span style="color: #787878;">Pattern ending with " *" makes trailing part optional
</span><span style="color: #FFA657;">function</span> <span style="color: #96a6c8;">globToRegex</span><span style="color: #8c8c8c;">(</span><span style="color: #f4f4ff;">pattern</span>: <span style="color: #FFA657;">string</span><span style="color: #8c8c8c;">)</span>: <span style="color: #95a99f;">RegExp</span> <span style="color: #8c8c8c;">{</span>
    <span style="color: #FFA657;">let</span> <span style="color: #f4f4ff;">escaped</span> = pattern
        .<span style="color: #96a6c8;">replace</span><span style="color: #93a8c6;">(</span><span style="color: #A1D08E;">/[.+^${}()|[\]\\]/</span>g, <span style="color: #A1D08E;">'\\$&amp;'</span><span style="color: #93a8c6;">)</span> <span style="color: #787878;">// </span><span style="color: #787878;">escape special regex </span><span style="color: #f4f4ff;">chars</span><span style="color: #787878;">
</span>        .<span style="color: #96a6c8;">replace</span><span style="color: #93a8c6;">(</span><span style="color: #A1D08E;">/\*/</span>g, <span style="color: #A1D08E;">'.*'</span><span style="color: #93a8c6;">)</span> <span style="color: #787878;">// </span><span style="color: #787878;">* becomes .*
</span>        .<span style="color: #96a6c8;">replace</span><span style="color: #93a8c6;">(</span><span style="color: #A1D08E;">/\?/</span>g, <span style="color: #A1D08E;">'.'</span><span style="color: #93a8c6;">)</span>; <span style="color: #787878;">// </span><span style="color: #787878;">? becomes .
</span>
    <span style="color: #787878;">// </span><span style="color: #787878;">If pattern ends with " *" (space + wildcard), make the trailing part optional
</span>    <span style="color: #787878;">// </span><span style="color: #787878;">This allows "ls *" to match both "ls" and "ls -la"
</span>    <span style="color: #FFA657;">if</span> <span style="color: #93a8c6;">(</span>escaped.<span style="color: #96a6c8;">endsWith</span><span style="color: #b0b1a3;">(</span><span style="color: #A1D08E;">' .*'</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">{</span>
        escaped = escaped.<span style="color: #96a6c8;">slice</span><span style="color: #b0b1a3;">(</span>0, -3<span style="color: #b0b1a3;">)</span> + <span style="color: #A1D08E;">'( .*)?'</span>;
    <span style="color: #93a8c6;">}</span>

    <span style="color: #FFA657;">return</span> <span style="color: #FFA657;">new</span> <span style="color: #95a99f;">RegExp</span><span style="color: #93a8c6;">(</span><span style="color: #A1D08E;">`^</span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">escaped</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">$`</span>, <span style="color: #A1D08E;">'s'</span><span style="color: #93a8c6;">)</span>; <span style="color: #787878;">// </span><span style="color: #787878;">'s' </span><span style="color: #f4f4ff;">flag</span><span style="color: #787878;">: . matches </span><span style="color: #f4f4ff;">newlines</span><span style="color: #787878;">
</span><span style="color: #8c8c8c;">}</span>

<span style="color: #FFA657;">function</span> <span style="color: #96a6c8;">minimatch</span><span style="color: #8c8c8c;">(</span><span style="color: #f4f4ff;">str</span>: <span style="color: #FFA657;">string</span>, <span style="color: #f4f4ff;">pattern</span>: <span style="color: #FFA657;">string</span><span style="color: #8c8c8c;">)</span>: <span style="color: #FFA657;">boolean</span> <span style="color: #8c8c8c;">{</span>
    <span style="color: #FFA657;">return</span> <span style="color: #96a6c8;">globToRegex</span><span style="color: #93a8c6;">(</span>pattern<span style="color: #93a8c6;">)</span>.<span style="color: #96a6c8;">test</span><span style="color: #93a8c6;">(</span><span style="color: #f4f4ff;">str</span><span style="color: #93a8c6;">)</span>;
<span style="color: #8c8c8c;">}</span>

<span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">DEFAULT_YOLO</span> = <span style="color: #95a99f;">true</span>;
<span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">DEFAULT_NON_INTERACTIVE_ASK</span>: <span style="color: #A1D08E;">"allow"</span> | <span style="color: #A1D08E;">"deny"</span> = <span style="color: #A1D08E;">"deny"</span>;
<span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">VALID_ACTIONS</span> = <span style="color: #8c8c8c;">[</span><span style="color: #A1D08E;">"ask"</span>, <span style="color: #A1D08E;">"allow"</span>, <span style="color: #A1D08E;">"deny"</span><span style="color: #8c8c8c;">]</span> <span style="color: #FFA657;">as</span> <span style="color: #FFA657;">const</span>;
<span style="color: #FFA657;">type</span> <span style="color: #95a99f;">Action</span> = <span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">typeof</span> VALID_ACTIONS<span style="color: #8c8c8c;">)[</span><span style="color: #FFA657;">number</span><span style="color: #8c8c8c;">]</span>;

<span style="color: #FFA657;">interface</span> <span style="color: #95a99f;">PermissionRule</span> <span style="color: #8c8c8c;">{</span>
    pattern: <span style="color: #FFA657;">string</span>;
    action: <span style="color: #95a99f;">Action</span>;
    isWildcard: <span style="color: #FFA657;">boolean</span>;
<span style="color: #8c8c8c;">}</span>

<span style="color: #FFA657;">interface</span> <span style="color: #95a99f;">PermissionConfig</span> <span style="color: #8c8c8c;">{</span>
    permission?: <span style="color: #93a8c6;">{</span>
        YOLO?: <span style="color: #FFA657;">boolean</span>;
        nonInteractiveAsk?: <span style="color: #A1D08E;">"allow"</span> | <span style="color: #A1D08E;">"deny"</span>;
        read?: <span style="color: #95a99f;">Record</span>&lt;<span style="color: #FFA657;">string</span>, <span style="color: #FFA657;">string</span>&gt;;
        bash?: <span style="color: #95a99f;">Record</span>&lt;<span style="color: #FFA657;">string</span>, <span style="color: #FFA657;">string</span>&gt;;
        write?: <span style="color: #95a99f;">Record</span>&lt;<span style="color: #FFA657;">string</span>, <span style="color: #FFA657;">string</span>&gt;;
        edit?: <span style="color: #95a99f;">Record</span>&lt;<span style="color: #FFA657;">string</span>, <span style="color: #FFA657;">string</span>&gt; | <span style="color: #FFA657;">string</span>;
        grep?: <span style="color: #95a99f;">Record</span>&lt;<span style="color: #FFA657;">string</span>, <span style="color: #FFA657;">string</span>&gt; | <span style="color: #FFA657;">string</span>;
        find?: <span style="color: #95a99f;">Record</span>&lt;<span style="color: #FFA657;">string</span>, <span style="color: #FFA657;">string</span>&gt; | <span style="color: #FFA657;">string</span>;
        ls?: <span style="color: #95a99f;">Record</span>&lt;<span style="color: #FFA657;">string</span>, <span style="color: #FFA657;">string</span>&gt; | <span style="color: #FFA657;">string</span>;
        glob?: <span style="color: #95a99f;">Record</span>&lt;<span style="color: #FFA657;">string</span>, <span style="color: #FFA657;">string</span>&gt; | <span style="color: #FFA657;">string</span>;
        list?: <span style="color: #95a99f;">Record</span>&lt;<span style="color: #FFA657;">string</span>, <span style="color: #FFA657;">string</span>&gt; | <span style="color: #FFA657;">string</span>;
        <span style="color: #b0b1a3;">[</span>key: <span style="color: #FFA657;">string</span><span style="color: #b0b1a3;">]</span>: <span style="color: #95a99f;">Record</span>&lt;<span style="color: #FFA657;">string</span>, <span style="color: #FFA657;">string</span>&gt; | <span style="color: #FFA657;">string</span> | <span style="color: #FFA657;">boolean</span> | <span style="color: #95a99f;">undefined</span>;
    <span style="color: #93a8c6;">}</span>;
<span style="color: #8c8c8c;">}</span>

<span style="color: #787878;">// </span><span style="color: #787878;">Tool config mapping (handles aliases)
</span><span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">TOOL_CONFIGS</span>: <span style="color: #95a99f;">Array</span>&lt;<span style="color: #8c8c8c;">{</span>
    tools: <span style="color: #FFA657;">string</span><span style="color: #93a8c6;">[]</span>;
    aliases: <span style="color: #FFA657;">string</span><span style="color: #93a8c6;">[]</span>;
    getInput: <span style="color: #93a8c6;">(</span>input: <span style="color: #FFA657;">any</span><span style="color: #93a8c6;">)</span> <span style="color: #FFA657;">=&gt;</span> <span style="color: #FFA657;">string</span>;
<span style="color: #8c8c8c;">}</span>&gt; = <span style="color: #8c8c8c;">[</span>
    <span style="color: #93a8c6;">{</span> tools: <span style="color: #b0b1a3;">[</span><span style="color: #A1D08E;">"read"</span><span style="color: #b0b1a3;">]</span>, aliases: <span style="color: #b0b1a3;">[]</span>, getInput: <span style="color: #b0b1a3;">(</span>i<span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">=&gt;</span> i.path <span style="color: #93a8c6;">}</span>,
    <span style="color: #93a8c6;">{</span> tools: <span style="color: #b0b1a3;">[</span><span style="color: #A1D08E;">"bash"</span><span style="color: #b0b1a3;">]</span>, aliases: <span style="color: #b0b1a3;">[]</span>, getInput: <span style="color: #b0b1a3;">(</span>i<span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">=&gt;</span> i.command <span style="color: #93a8c6;">}</span>,
    <span style="color: #93a8c6;">{</span> tools: <span style="color: #b0b1a3;">[</span><span style="color: #A1D08E;">"write"</span><span style="color: #b0b1a3;">]</span>, aliases: <span style="color: #b0b1a3;">[]</span>, getInput: <span style="color: #b0b1a3;">(</span>i<span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">=&gt;</span> i.path <span style="color: #93a8c6;">}</span>,
    <span style="color: #93a8c6;">{</span> tools: <span style="color: #b0b1a3;">[</span><span style="color: #A1D08E;">"edit"</span><span style="color: #b0b1a3;">]</span>, aliases: <span style="color: #b0b1a3;">[]</span>, getInput: <span style="color: #b0b1a3;">(</span>i<span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">=&gt;</span> i.path <span style="color: #93a8c6;">}</span>,
    <span style="color: #93a8c6;">{</span> tools: <span style="color: #b0b1a3;">[</span><span style="color: #A1D08E;">"grep"</span><span style="color: #b0b1a3;">]</span>, aliases: <span style="color: #b0b1a3;">[</span><span style="color: #A1D08E;">"glob"</span><span style="color: #b0b1a3;">]</span>, getInput: <span style="color: #b0b1a3;">(</span>i<span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">=&gt;</span> i.pattern <span style="color: #93a8c6;">}</span>,
    <span style="color: #93a8c6;">{</span> tools: <span style="color: #b0b1a3;">[</span><span style="color: #A1D08E;">"find"</span><span style="color: #b0b1a3;">]</span>, aliases: <span style="color: #b0b1a3;">[]</span>, getInput: <span style="color: #b0b1a3;">(</span>i<span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">=&gt;</span> i.pattern <span style="color: #93a8c6;">}</span>,
    <span style="color: #93a8c6;">{</span> tools: <span style="color: #b0b1a3;">[</span><span style="color: #A1D08E;">"ls"</span><span style="color: #b0b1a3;">]</span>, aliases: <span style="color: #b0b1a3;">[</span><span style="color: #A1D08E;">"list"</span><span style="color: #b0b1a3;">]</span>, getInput: <span style="color: #b0b1a3;">(</span>i<span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">=&gt;</span> i.path || <span style="color: #A1D08E;">"."</span> <span style="color: #93a8c6;">}</span>,
<span style="color: #8c8c8c;">]</span>;

<span style="color: #FFA657;">function</span> <span style="color: #96a6c8;">loadSettings</span><span style="color: #8c8c8c;">(</span><span style="color: #f4f4ff;">cwd</span>: <span style="color: #FFA657;">string</span><span style="color: #8c8c8c;">)</span>: <span style="color: #95a99f;">PermissionConfig</span> <span style="color: #8c8c8c;">{</span>
    <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">loadFile</span> = <span style="color: #93a8c6;">(</span><span style="color: #f4f4ff;">path</span>: <span style="color: #FFA657;">string</span><span style="color: #93a8c6;">)</span> <span style="color: #FFA657;">=&gt;</span> <span style="color: #93a8c6;">{</span>
        <span style="color: #FFA657;">if</span> <span style="color: #b0b1a3;">(</span>!<span style="color: #96a6c8;">existsSync</span><span style="color: #97b098;">(</span>path<span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">return</span> <span style="color: #b0b1a3;">{}</span>;
        <span style="color: #FFA657;">try</span> <span style="color: #b0b1a3;">{</span>
            <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">content</span> = <span style="color: #96a6c8;">readFileSync</span><span style="color: #97b098;">(</span>path, <span style="color: #A1D08E;">"utf-8"</span><span style="color: #97b098;">)</span>;
            <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">parsed</span> = JSON.<span style="color: #96a6c8;">parse</span><span style="color: #97b098;">(</span>content<span style="color: #97b098;">)</span>;
            <span style="color: #FFA657;">return</span> parsed.permission || <span style="color: #97b098;">{}</span>;
        <span style="color: #b0b1a3;">}</span> <span style="color: #FFA657;">catch</span> <span style="color: #b0b1a3;">(</span>err<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
            <span style="color: #95a99f;">console</span>.<span style="color: #96a6c8;">error</span><span style="color: #97b098;">(</span><span style="color: #A1D08E;">`Failed to load permissions from </span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">path</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">: </span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">err</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">`</span><span style="color: #97b098;">)</span>;
            <span style="color: #FFA657;">return</span> <span style="color: #97b098;">{}</span>;
        <span style="color: #b0b1a3;">}</span>
    <span style="color: #93a8c6;">}</span>;

    <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">globalPerm</span> = <span style="color: #96a6c8;">loadFile</span><span style="color: #93a8c6;">(</span><span style="color: #96a6c8;">join</span><span style="color: #b0b1a3;">(</span><span style="color: #96a6c8;">homedir</span><span style="color: #97b098;">()</span>, <span style="color: #A1D08E;">".pi"</span>, <span style="color: #A1D08E;">"agent"</span>, <span style="color: #A1D08E;">"settings.json"</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>;
    <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">projectPerm</span> = <span style="color: #96a6c8;">loadFile</span><span style="color: #93a8c6;">(</span><span style="color: #96a6c8;">join</span><span style="color: #b0b1a3;">(</span>cwd, <span style="color: #A1D08E;">".pi"</span>, <span style="color: #A1D08E;">"settings.json"</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>;

    <span style="color: #FFA657;">return</span> <span style="color: #93a8c6;">{</span> permission: <span style="color: #b0b1a3;">{</span> ...globalPerm, ...projectPerm <span style="color: #b0b1a3;">}</span> <span style="color: #93a8c6;">}</span>;
<span style="color: #8c8c8c;">}</span>

<span style="color: #FFA657;">function</span> <span style="color: #96a6c8;">parseRules</span><span style="color: #8c8c8c;">(</span><span style="color: #f4f4ff;">config</span>: <span style="color: #95a99f;">Record</span>&lt;<span style="color: #FFA657;">string</span>, <span style="color: #FFA657;">string</span>&gt; | <span style="color: #FFA657;">string</span> | <span style="color: #95a99f;">undefined</span><span style="color: #8c8c8c;">)</span>: <span style="color: #95a99f;">PermissionRule</span><span style="color: #8c8c8c;">[]</span> <span style="color: #8c8c8c;">{</span>
    <span style="color: #FFA657;">if</span> <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">typeof</span> config === <span style="color: #A1D08E;">"string"</span><span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">{</span>
        <span style="color: #FFA657;">return</span> VALID_ACTIONS.<span style="color: #96a6c8;">includes</span><span style="color: #b0b1a3;">(</span>config <span style="color: #FFA657;">as</span> Action<span style="color: #b0b1a3;">)</span>
            ? <span style="color: #b0b1a3;">[</span><span style="color: #97b098;">{</span> pattern: <span style="color: #A1D08E;">"*"</span>, action: config <span style="color: #FFA657;">as</span> Action, isWildcard: <span style="color: #95a99f;">true</span> <span style="color: #97b098;">}</span><span style="color: #b0b1a3;">]</span>
            : <span style="color: #b0b1a3;">[]</span>;
    <span style="color: #93a8c6;">}</span>

    <span style="color: #FFA657;">if</span> <span style="color: #93a8c6;">(</span>!config || <span style="color: #FFA657;">typeof</span> config !== <span style="color: #A1D08E;">"object"</span><span style="color: #93a8c6;">)</span> <span style="color: #FFA657;">return</span> <span style="color: #93a8c6;">[]</span>;

    <span style="color: #FFA657;">return</span> Object.<span style="color: #96a6c8;">entries</span><span style="color: #93a8c6;">(</span>config<span style="color: #93a8c6;">)</span>
        .<span style="color: #96a6c8;">filter</span><span style="color: #93a8c6;">(</span><span style="color: #b0b1a3;">(</span><span style="color: #97b098;">[</span>, action<span style="color: #97b098;">]</span><span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">=&gt;</span> <span style="color: #95a99f;">VALID</span>_ACTIONS.<span style="color: #96a6c8;">includes</span><span style="color: #b0b1a3;">(</span>action <span style="color: #FFA657;">as</span> Action<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>
        .<span style="color: #96a6c8;">map</span><span style="color: #93a8c6;">(</span><span style="color: #b0b1a3;">(</span><span style="color: #97b098;">[</span>pattern, action<span style="color: #97b098;">]</span><span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">=&gt;</span> <span style="color: #b0b1a3;">(</span><span style="color: #97b098;">{</span>
            pattern,
            action: action <span style="color: #FFA657;">as</span> Action,
            isWildcard: pattern.<span style="color: #96a6c8;">includes</span><span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"*"</span><span style="color: #aebed8;">)</span> || pattern.<span style="color: #96a6c8;">includes</span><span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"?"</span><span style="color: #aebed8;">)</span>,
        <span style="color: #97b098;">}</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>;
<span style="color: #8c8c8c;">}</span>

<span style="color: #FFA657;">function</span> <span style="color: #96a6c8;">matchInput</span><span style="color: #8c8c8c;">(</span><span style="color: #f4f4ff;">input</span>: <span style="color: #FFA657;">string</span>, <span style="color: #f4f4ff;">rules</span>: <span style="color: #95a99f;">PermissionRule</span><span style="color: #93a8c6;">[]</span><span style="color: #8c8c8c;">)</span>: <span style="color: #95a99f;">PermissionRule</span> | <span style="color: #95a99f;">null</span> <span style="color: #8c8c8c;">{</span>
    <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">normalized</span> = input.<span style="color: #96a6c8;">trim</span><span style="color: #93a8c6;">()</span>.<span style="color: #96a6c8;">replace</span><span style="color: #93a8c6;">(</span><span style="color: #A1D08E;">/\s+/</span><span style="color: #f4f4ff;">g</span>, <span style="color: #A1D08E;">" "</span><span style="color: #93a8c6;">)</span>;

    <span style="color: #787878;">// </span><span style="color: #787878;">Find the LAST matching rule (later rules override earlier ones, like opencode)
</span>    <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">matchingRule</span> = <span style="color: #93a8c6;">[</span>...rules<span style="color: #93a8c6;">]</span>.<span style="color: #96a6c8;">reverse</span><span style="color: #93a8c6;">()</span>.<span style="color: #96a6c8;">find</span><span style="color: #93a8c6;">(</span><span style="color: #b0b1a3;">(</span><span style="color: #f4f4ff;">r</span><span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">=&gt;</span> <span style="color: #b0b1a3;">{</span>
        <span style="color: #FFA657;">if</span> <span style="color: #97b098;">(</span>!r.isWildcard<span style="color: #97b098;">)</span> <span style="color: #97b098;">{</span>
            <span style="color: #FFA657;">return</span> r.pattern === normalized;
        <span style="color: #97b098;">}</span>
        <span style="color: #FFA657;">return</span> <span style="color: #96a6c8;">minimatch</span><span style="color: #97b098;">(</span>normalized, r.pattern<span style="color: #97b098;">)</span>;
    <span style="color: #b0b1a3;">}</span><span style="color: #93a8c6;">)</span>;

    <span style="color: #FFA657;">return</span> matchingRule || <span style="color: #95a99f;">null</span>;
<span style="color: #8c8c8c;">}</span>

<span style="color: #FFA657;">function</span> <span style="color: #96a6c8;">splitCommands</span><span style="color: #8c8c8c;">(</span><span style="color: #f4f4ff;">command</span>: <span style="color: #FFA657;">string</span><span style="color: #8c8c8c;">)</span>: <span style="color: #FFA657;">string</span><span style="color: #8c8c8c;">[]</span> <span style="color: #8c8c8c;">{</span>
    <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">result</span>: <span style="color: #FFA657;">string</span><span style="color: #93a8c6;">[]</span> = <span style="color: #93a8c6;">[]</span>;
    <span style="color: #FFA657;">let</span> <span style="color: #f4f4ff;">current</span> = <span style="color: #A1D08E;">""</span>;
    <span style="color: #FFA657;">let</span> <span style="color: #f4f4ff;">inSingle</span> = <span style="color: #95a99f;">false</span>;
    <span style="color: #FFA657;">let</span> <span style="color: #f4f4ff;">inDouble</span> = <span style="color: #95a99f;">false</span>;
    <span style="color: #FFA657;">let</span> <span style="color: #f4f4ff;">escape</span> = <span style="color: #95a99f;">false</span>;

    <span style="color: #FFA657;">for</span> <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">let</span> <span style="color: #f4f4ff;">i</span> = 0; i &lt; <span style="color: #95a99f;">command</span>.<span style="color: #95a99f;">length</span>; <span style="color: #95a99f;">i</span>++<span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">{</span>
        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">char</span> = command<span style="color: #b0b1a3;">[</span>i<span style="color: #b0b1a3;">]</span>;
        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">next</span> = command<span style="color: #b0b1a3;">[</span>i + 1<span style="color: #b0b1a3;">]</span>;

        <span style="color: #FFA657;">if</span> <span style="color: #b0b1a3;">(</span>escape<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
            current += char;
            escape = <span style="color: #95a99f;">false</span>;
            <span style="color: #FFA657;">continue</span>;
        <span style="color: #b0b1a3;">}</span>

        <span style="color: #FFA657;">if</span> <span style="color: #b0b1a3;">(</span>char === <span style="color: #A1D08E;">"\\"</span><span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
            escape = <span style="color: #95a99f;">true</span>;
            current += char;
            <span style="color: #FFA657;">continue</span>;
        <span style="color: #b0b1a3;">}</span>

        <span style="color: #FFA657;">if</span> <span style="color: #b0b1a3;">(</span>char === <span style="color: #A1D08E;">"'"</span> &amp;&amp; !inDouble<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span> inSingle = !inSingle; current += char; <span style="color: #FFA657;">continue</span>; <span style="color: #b0b1a3;">}</span>
        <span style="color: #FFA657;">if</span> <span style="color: #b0b1a3;">(</span>char === <span style="color: #A1D08E;">'"'</span> &amp;&amp; !inSingle<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span> inDouble = !inDouble; current += char; <span style="color: #FFA657;">continue</span>; <span style="color: #b0b1a3;">}</span>

        <span style="color: #FFA657;">if</span> <span style="color: #b0b1a3;">(</span>!inSingle &amp;&amp; !inDouble<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
            <span style="color: #FFA657;">if</span> <span style="color: #97b098;">(</span><span style="color: #aebed8;">(</span><span style="color: #b0b0b3;">(</span>char === <span style="color: #A1D08E;">"&amp;"</span> || char === <span style="color: #A1D08E;">"|"</span><span style="color: #b0b0b3;">)</span> &amp;&amp; next === char<span style="color: #aebed8;">)</span> || char === <span style="color: #A1D08E;">";"</span> || char === <span style="color: #A1D08E;">"|"</span><span style="color: #97b098;">)</span> <span style="color: #97b098;">{</span>
                <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">trimmed</span> = current.<span style="color: #96a6c8;">trim</span><span style="color: #aebed8;">()</span>;
                <span style="color: #FFA657;">if</span> <span style="color: #aebed8;">(</span>trimmed<span style="color: #aebed8;">)</span> result.<span style="color: #96a6c8;">push</span><span style="color: #aebed8;">(</span><span style="color: #f4f4ff;">trimmed</span><span style="color: #aebed8;">)</span>;
                current = <span style="color: #A1D08E;">""</span>;
                <span style="color: #FFA657;">if</span> <span style="color: #aebed8;">(</span>next === char<span style="color: #aebed8;">)</span> i++;
                <span style="color: #FFA657;">continue</span>;
            <span style="color: #97b098;">}</span>
        <span style="color: #b0b1a3;">}</span>

        current += char;
    <span style="color: #93a8c6;">}</span>

    <span style="color: #FFA657;">if</span> <span style="color: #93a8c6;">(</span>current.<span style="color: #96a6c8;">trim</span><span style="color: #b0b1a3;">()</span><span style="color: #93a8c6;">)</span> result.<span style="color: #96a6c8;">push</span><span style="color: #93a8c6;">(</span>current.<span style="color: #96a6c8;">trim</span><span style="color: #b0b1a3;">()</span><span style="color: #93a8c6;">)</span>;
    <span style="color: #FFA657;">return</span> result;
<span style="color: #8c8c8c;">}</span>

<span style="color: #FFA657;">export</span> <span style="color: #FFA657;">default</span> <span style="color: #FFA657;">function</span> <span style="color: #8c8c8c;">(</span><span style="color: #f4f4ff;">pi</span>: <span style="color: #95a99f;">ExtensionAPI</span><span style="color: #8c8c8c;">)</span> <span style="color: #8c8c8c;">{</span>
    <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">rules</span> = <span style="color: #FFA657;">new</span> <span style="color: #95a99f;">Map</span>&lt;<span style="color: #FFA657;">string</span>, <span style="color: #95a99f;">PermissionRule</span><span style="color: #93a8c6;">[]</span>&gt;<span style="color: #93a8c6;">()</span>;
    <span style="color: #FFA657;">let</span> <span style="color: #f4f4ff;">yoloMode</span> = DEFAULT_YOLO;
    <span style="color: #FFA657;">let</span> <span style="color: #f4f4ff;">nonInteractiveAsk</span> = DEFAULT_NON_INTERACTIVE_ASK;

    <span style="color: #FFA657;">function</span> <span style="color: #96a6c8;">loadPermissions</span><span style="color: #93a8c6;">(</span><span style="color: #f4f4ff;">cwd</span>: <span style="color: #FFA657;">string</span><span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">{</span>
        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">config</span> = <span style="color: #96a6c8;">loadSettings</span><span style="color: #b0b1a3;">(</span>cwd<span style="color: #b0b1a3;">)</span>.permission || <span style="color: #b0b1a3;">{}</span>;
        yoloMode = config.YOLO ?? DEFAULT_YOLO;
        nonInteractiveAsk = config.nonInteractiveAsk ?? DEFAULT_NON_INTERACTIVE_ASK;

        TOOL_CONFIGS.<span style="color: #96a6c8;">forEach</span><span style="color: #b0b1a3;">(</span><span style="color: #97b098;">(</span><span style="color: #aebed8;">{</span> <span style="color: #f4f4ff;">tools</span>, aliases <span style="color: #aebed8;">}</span><span style="color: #97b098;">)</span> <span style="color: #FFA657;">=&gt;</span> <span style="color: #97b098;">{</span>
            <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">tool</span> = tools<span style="color: #aebed8;">[</span>0<span style="color: #aebed8;">]</span>;
            <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">toolConfig</span> = tools.<span style="color: #96a6c8;">concat</span><span style="color: #aebed8;">(</span>aliases<span style="color: #aebed8;">)</span>.<span style="color: #96a6c8;">reduce</span><span style="color: #aebed8;">(</span><span style="color: #b0b0b3;">(</span>acc, t<span style="color: #b0b0b3;">)</span> <span style="color: #FFA657;">=&gt;</span> <span style="color: #b0b0b3;">(</span><span style="color: #90a890;">{</span>
                ...acc,
                ...<span style="color: #a2b6da;">(</span>config<span style="color: #9cb6ad;">[</span>t <span style="color: #FFA657;">as</span> <span style="color: #FFA657;">keyof</span> <span style="color: #FFA657;">typeof</span> config<span style="color: #9cb6ad;">]</span> || <span style="color: #9cb6ad;">{}</span><span style="color: #a2b6da;">)</span>,
            <span style="color: #90a890;">}</span><span style="color: #b0b0b3;">)</span>, <span style="color: #b0b0b3;">{}</span><span style="color: #aebed8;">)</span>;

            rules.<span style="color: #96a6c8;">set</span><span style="color: #aebed8;">(</span>tool, <span style="color: #96a6c8;">parseRules</span><span style="color: #b0b0b3;">(</span>toolConfig <span style="color: #FFA657;">as</span> Record&lt;<span style="color: #FFA657;">string</span>, <span style="color: #FFA657;">string</span>&gt; | <span style="color: #FFA657;">string</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span>;
        <span style="color: #97b098;">}</span><span style="color: #b0b1a3;">)</span>;
    <span style="color: #93a8c6;">}</span>

    <span style="color: #FFA657;">async</span> <span style="color: #FFA657;">function</span> <span style="color: #96a6c8;">askPermission</span><span style="color: #93a8c6;">(</span><span style="color: #f4f4ff;">message</span>: <span style="color: #FFA657;">string</span>, <span style="color: #f4f4ff;">ctx</span>: <span style="color: #FFA657;">any</span><span style="color: #93a8c6;">)</span>: <span style="color: #95a99f;">Promise</span>&lt;<span style="color: #FFA657;">boolean</span>&gt; <span style="color: #93a8c6;">{</span>
        <span style="color: #FFA657;">if</span> <span style="color: #b0b1a3;">(</span>!ctx.hasUI<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
            <span style="color: #FFA657;">return</span> nonInteractiveAsk === <span style="color: #A1D08E;">"allow"</span>;
        <span style="color: #b0b1a3;">}</span>
        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">choice</span> = <span style="color: #FFA657;">await</span> ctx.ui.<span style="color: #96a6c8;">select</span><span style="color: #b0b1a3;">(</span>message, <span style="color: #97b098;">[</span><span style="color: #A1D08E;">"Yes"</span>, <span style="color: #A1D08E;">"No"</span><span style="color: #97b098;">]</span><span style="color: #b0b1a3;">)</span>;
        <span style="color: #FFA657;">return</span> choice === <span style="color: #A1D08E;">"Yes"</span>;
    <span style="color: #93a8c6;">}</span>

    <span style="color: #FFA657;">async</span> <span style="color: #FFA657;">function</span> <span style="color: #96a6c8;">checkPermission</span><span style="color: #93a8c6;">(</span>
        <span style="color: #f4f4ff;">toolName</span>: <span style="color: #FFA657;">string</span>,
        <span style="color: #f4f4ff;">input</span>: <span style="color: #FFA657;">string</span>,
        <span style="color: #f4f4ff;">toolRules</span>: <span style="color: #95a99f;">PermissionRule</span><span style="color: #b0b1a3;">[]</span>,
        <span style="color: #f4f4ff;">ctx</span>: <span style="color: #FFA657;">any</span>,
    <span style="color: #93a8c6;">)</span>: <span style="color: #95a99f;">Promise</span>&lt;<span style="color: #93a8c6;">{</span> block: <span style="color: #95a99f;">true</span>; reason: <span style="color: #FFA657;">string</span> <span style="color: #93a8c6;">}</span> | <span style="color: #95a99f;">undefined</span>&gt; <span style="color: #93a8c6;">{</span>
        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">rule</span> = <span style="color: #96a6c8;">matchInput</span><span style="color: #b0b1a3;">(</span>input, toolRules<span style="color: #b0b1a3;">)</span>;

        <span style="color: #FFA657;">if</span> <span style="color: #b0b1a3;">(</span>!rule<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
            <span style="color: #FFA657;">if</span> <span style="color: #97b098;">(</span>yoloMode<span style="color: #97b098;">)</span> <span style="color: #FFA657;">return</span> <span style="color: #95a99f;">undefined</span>;
            <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">allowed</span> = <span style="color: #FFA657;">await</span> <span style="color: #96a6c8;">askPermission</span><span style="color: #97b098;">(</span>
                <span style="color: #A1D08E;">`&#9888;&#65039; No permission rule </span><span style="color: #d1d5db; background-color: #1D1F21;">for</span><span style="color: #A1D08E;">:\n\n  </span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">toolName</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">: </span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">input</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">\n\nAllow?`</span>,
                ctx,
            <span style="color: #97b098;">)</span>;
            <span style="color: #FFA657;">return</span> allowed ? <span style="color: #95a99f;">undefined</span> : <span style="color: #97b098;">{</span> block: <span style="color: #95a99f;">true</span>, reason: <span style="color: #A1D08E;">"Blocked by user"</span> <span style="color: #97b098;">}</span>;
        <span style="color: #b0b1a3;">}</span>

        <span style="color: #FFA657;">if</span> <span style="color: #b0b1a3;">(</span>rule.action === <span style="color: #A1D08E;">"allow"</span><span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">return</span> <span style="color: #95a99f;">undefined</span>;
        <span style="color: #FFA657;">if</span> <span style="color: #b0b1a3;">(</span>rule.action === <span style="color: #A1D08E;">"deny"</span><span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">return</span> <span style="color: #b0b1a3;">{</span> <span style="color: #f4f4ff;">block</span>: <span style="color: #95a99f;">true</span>, <span style="color: #f4f4ff;">reason</span>: <span style="color: #A1D08E;">`Blocked by permission </span><span style="color: #f4f4ff;">rules</span><span style="color: #A1D08E;">: </span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">toolName</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">`</span> <span style="color: #b0b1a3;">}</span>;

        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">allowed</span> = <span style="color: #FFA657;">await</span> <span style="color: #96a6c8;">askPermission</span><span style="color: #b0b1a3;">(</span>
            <span style="color: #A1D08E;">`&#9888;&#65039; Permission required:\n\n  </span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">toolName</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">: </span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">input</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">\n\nAllow?`</span>,
            ctx,
        <span style="color: #b0b1a3;">)</span>;
        <span style="color: #FFA657;">return</span> allowed ? <span style="color: #95a99f;">undefined</span> : <span style="color: #b0b1a3;">{</span> block: <span style="color: #95a99f;">true</span>, reason: <span style="color: #A1D08E;">"Blocked by user"</span> <span style="color: #b0b1a3;">}</span>;
    <span style="color: #93a8c6;">}</span>

    pi.<span style="color: #96a6c8;">on</span><span style="color: #93a8c6;">(</span><span style="color: #A1D08E;">"session_start"</span>, <span style="color: #FFA657;">async</span> <span style="color: #b0b1a3;">(</span>_event, ctx<span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">=&gt;</span> <span style="color: #96a6c8;">loadPermissions</span><span style="color: #b0b1a3;">(</span>ctx.cwd<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>;

    pi.<span style="color: #96a6c8;">on</span><span style="color: #93a8c6;">(</span><span style="color: #A1D08E;">"tool_call"</span>, <span style="color: #FFA657;">async</span> <span style="color: #b0b1a3;">(</span><span style="color: #f4f4ff;">event</span>, <span style="color: #f4f4ff;">ctx</span><span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">=&gt;</span> <span style="color: #b0b1a3;">{</span>
        <span style="color: #FFA657;">const</span> <span style="color: #97b098;">{</span> toolName, input <span style="color: #97b098;">}</span> = event;

        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">toolConfig</span> = TOOL_CONFIGS.<span style="color: #96a6c8;">find</span><span style="color: #97b098;">(</span><span style="color: #aebed8;">(</span>t<span style="color: #aebed8;">)</span> <span style="color: #FFA657;">=&gt;</span> t.tools.<span style="color: #96a6c8;">includes</span><span style="color: #aebed8;">(</span>toolName<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>;
        <span style="color: #FFA657;">if</span> <span style="color: #97b098;">(</span>!toolConfig<span style="color: #97b098;">)</span> <span style="color: #FFA657;">return</span> <span style="color: #95a99f;">undefined</span>;

        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">toolRules</span> = rules.<span style="color: #96a6c8;">get</span><span style="color: #97b098;">(</span>toolName<span style="color: #97b098;">)</span> || <span style="color: #97b098;">[]</span>;
        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">inputStr</span> = toolConfig.<span style="color: #96a6c8;">getInput</span><span style="color: #97b098;">(</span>input<span style="color: #97b098;">)</span>;

        <span style="color: #787878;">// </span><span style="color: #787878;">Special handling for bash compound commands
</span>        <span style="color: #FFA657;">if</span> <span style="color: #97b098;">(</span>toolName === <span style="color: #A1D08E;">"bash"</span> &amp;&amp; toolRules.length &gt; 0<span style="color: #97b098;">)</span> <span style="color: #97b098;">{</span>
            <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">subCommands</span> = <span style="color: #96a6c8;">splitCommands</span><span style="color: #aebed8;">(</span>inputStr<span style="color: #aebed8;">)</span>;

            <span style="color: #FFA657;">for</span> <span style="color: #aebed8;">(</span><span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">subCmd</span> <span style="color: #FFA657;">of</span> subCommands<span style="color: #aebed8;">)</span> <span style="color: #aebed8;">{</span>
                <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">rule</span> = <span style="color: #96a6c8;">matchInput</span><span style="color: #b0b0b3;">(</span>subCmd, toolRules<span style="color: #b0b0b3;">)</span>;
                <span style="color: #FFA657;">if</span> <span style="color: #b0b0b3;">(</span>!rule || rule.action === <span style="color: #A1D08E;">"allow"</span><span style="color: #b0b0b3;">)</span> <span style="color: #FFA657;">continue</span>;

                <span style="color: #FFA657;">if</span> <span style="color: #b0b0b3;">(</span>rule.action === <span style="color: #A1D08E;">"deny"</span><span style="color: #b0b0b3;">)</span> <span style="color: #b0b0b3;">{</span>
                    <span style="color: #FFA657;">return</span> <span style="color: #90a890;">{</span> block: <span style="color: #95a99f;">true</span>, reason: <span style="color: #A1D08E;">`Blocked by permission rules: </span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">subCmd</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">`</span> <span style="color: #90a890;">}</span>;
                <span style="color: #b0b0b3;">}</span>

                <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">display</span> = subCommands.length &gt; 1
                    ? <span style="color: #A1D08E;">`</span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">subCmd</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">  (</span><span style="color: #d1d5db; background-color: #1D1F21;">in</span><span style="color: #A1D08E;">: "</span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">inputStr</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">")`</span>
                    : inputStr;

                <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">allowed</span> = <span style="color: #FFA657;">await</span> <span style="color: #96a6c8;">askPermission</span><span style="color: #b0b0b3;">(</span>
                    <span style="color: #A1D08E;">`&#9888;&#65039; Permission required:\n\n  bash: </span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">display</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">\n\nAllow?`</span>,
                    ctx,
                <span style="color: #b0b0b3;">)</span>;
                <span style="color: #FFA657;">if</span> <span style="color: #b0b0b3;">(</span>!allowed<span style="color: #b0b0b3;">)</span> <span style="color: #FFA657;">return</span> <span style="color: #b0b0b3;">{</span> block: <span style="color: #95a99f;">true</span>, reason: <span style="color: #A1D08E;">"Blocked by user"</span> <span style="color: #b0b0b3;">}</span>;
            <span style="color: #aebed8;">}</span>
            <span style="color: #FFA657;">return</span> <span style="color: #95a99f;">undefined</span>;
        <span style="color: #97b098;">}</span>

        <span style="color: #787878;">// </span><span style="color: #787878;">No rules configured
</span>        <span style="color: #FFA657;">if</span> <span style="color: #97b098;">(</span>toolRules.length === 0<span style="color: #97b098;">)</span> <span style="color: #97b098;">{</span>
            <span style="color: #FFA657;">if</span> <span style="color: #aebed8;">(</span>yoloMode<span style="color: #aebed8;">)</span> <span style="color: #FFA657;">return</span> <span style="color: #95a99f;">undefined</span>;
            <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">allowed</span> = <span style="color: #FFA657;">await</span> <span style="color: #96a6c8;">askPermission</span><span style="color: #aebed8;">(</span>
                <span style="color: #A1D08E;">`&#9888;&#65039; No permission rules for </span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">toolName</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">:\n\n  </span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">inputStr</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">\n\nAllow?`</span>,
                ctx,
            <span style="color: #aebed8;">)</span>;
            <span style="color: #FFA657;">return</span> allowed ? <span style="color: #95a99f;">undefined</span> : <span style="color: #aebed8;">{</span> block: <span style="color: #95a99f;">true</span>, reason: <span style="color: #A1D08E;">"Blocked by user"</span> <span style="color: #aebed8;">}</span>;
        <span style="color: #97b098;">}</span>

        <span style="color: #FFA657;">return</span> <span style="color: #96a6c8;">checkPermission</span><span style="color: #97b098;">(</span>toolName, inputStr, toolRules, ctx<span style="color: #97b098;">)</span>;
    <span style="color: #b0b1a3;">}</span><span style="color: #93a8c6;">)</span>;
<span style="color: #8c8c8c;">}</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org316d5c1" class="outline-3">
<h3 id="org316d5c1">Subagent</h3>
<div class="outline-text-3" id="text-org316d5c1">
<p>
pi 的原始设计理念里，没有 subagent，所以也就没有 @agent 这种快速调用 subagent 在独立上下文里运行再返回结果给主 agent 的设计。
</p>

<p>
<a href="https://github.com/nicobailon/pi-subagents">Nico’s subagent extension</a> , <a href="https://www.npmjs.com/package/pi-interactive-shell">interactive-shell</a> 这两个 pi 的插件实现了类似的功能，但是对我来说有些复杂。
</p>

<p>
现阶段我的方式就是新开一个 tmux 返回一个 tmux session 的 txt 文本记录完整的 LLM 输出。
</p>

<p>
在 pi 的 TUI 里，通过 `/agent` 来调用这些 subagent，并实现了两个模式：当前会话和 tmux 后台运行。
</p>

<p>
tmux 的运行状态会在 TUI 的 footer 部分持续显示。直接用 tmux 指令就可以和这个 subagent session 交互了。在 subagent session 完成之后会使用 pi 的 notify 通知显示 txt 文本的输出路径，主 agent 就可以阅读了。
</p>


<figure id="orgf3b539d">
<img src="https://pic.vandee.art/images/20260211_125004-agent1.png" class="img" width="60%" height="60%">

</figure>


<figure id="org1d1c0ff">
<img src="https://pic.vandee.art/images/20260211_125302-agent2.png" class="img" width="60%" height="60%">

</figure>


<figure id="orgeacea63">
<img src="https://pic.vandee.art/images/20260211_125325-agent3.png" class="img" width="60%" height="60%">

</figure>

<div class="org-src-container">
<pre class="src src-typescript"><span style="color: #787878;">/**</span><span style="color: #787878;">
 * Agents Select Extension
 *
 * Provides interactive agent selection and invocation via /agents command
 * and direct @agent-name invocation with task input.
 */</span>

<span style="color: #FFA657;">import</span> * <span style="color: #FFA657;">as</span> fs <span style="color: #FFA657;">from</span> <span style="color: #A1D08E;">"node:fs"</span>;
<span style="color: #FFA657;">import</span> * <span style="color: #FFA657;">as</span> os <span style="color: #FFA657;">from</span> <span style="color: #A1D08E;">"node:os"</span>;
<span style="color: #FFA657;">import</span> * <span style="color: #FFA657;">as</span> path <span style="color: #FFA657;">from</span> <span style="color: #A1D08E;">"node:path"</span>;
<span style="color: #FFA657;">import</span> <span style="color: #8c8c8c;">{</span> exec <span style="color: #8c8c8c;">}</span> <span style="color: #FFA657;">from</span> <span style="color: #A1D08E;">"node:child_process"</span>;
<span style="color: #FFA657;">import</span> <span style="color: #8c8c8c;">{</span> spawn <span style="color: #8c8c8c;">}</span> <span style="color: #FFA657;">from</span> <span style="color: #A1D08E;">"node:child_process"</span>;
<span style="color: #FFA657;">import</span> <span style="color: #8c8c8c;">{</span> promisify <span style="color: #8c8c8c;">}</span> <span style="color: #FFA657;">from</span> <span style="color: #A1D08E;">"node:util"</span>;
<span style="color: #FFA657;">import</span> <span style="color: #FFA657;">type</span> <span style="color: #8c8c8c;">{</span> ExtensionAPI <span style="color: #8c8c8c;">}</span> <span style="color: #FFA657;">from</span> <span style="color: #A1D08E;">"@mariozechner/pi-coding-agent"</span>;
<span style="color: #FFA657;">import</span> <span style="color: #8c8c8c;">{</span> parseFrontmatter, DynamicBorder <span style="color: #8c8c8c;">}</span> <span style="color: #FFA657;">from</span> <span style="color: #A1D08E;">"@mariozechner/pi-coding-agent"</span>;
<span style="color: #FFA657;">import</span> <span style="color: #8c8c8c;">{</span> Container, Editor, Input, SelectList, Text, Spacer, matchesKey, Key, CombinedAutocompleteProvider <span style="color: #8c8c8c;">}</span> <span style="color: #FFA657;">from</span> <span style="color: #A1D08E;">"@mariozechner/pi-tui"</span>;

<span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">execAsync</span> = <span style="color: #96a6c8;">promisify</span><span style="color: #8c8c8c;">(</span>exec<span style="color: #8c8c8c;">)</span>;

<span style="color: #FFA657;">interface</span> <span style="color: #95a99f;">AgentConfig</span> <span style="color: #8c8c8c;">{</span>
        name: <span style="color: #FFA657;">string</span>;
        description: <span style="color: #FFA657;">string</span>;
        source: <span style="color: #A1D08E;">"user"</span> | <span style="color: #A1D08E;">"project"</span>;
        filePath: <span style="color: #FFA657;">string</span>;
        systemPrompt: <span style="color: #FFA657;">string</span>;
<span style="color: #8c8c8c;">}</span>

<span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">USER_AGENTS_DIR</span> = path.<span style="color: #96a6c8;">join</span><span style="color: #8c8c8c;">(</span>os.<span style="color: #96a6c8;">homedir</span><span style="color: #93a8c6;">()</span>, <span style="color: #A1D08E;">".pi"</span>, <span style="color: #A1D08E;">"agent"</span>, <span style="color: #A1D08E;">"agents"</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">PROJECT_AGENTS_DIR_NAME</span> = path.<span style="color: #96a6c8;">join</span><span style="color: #8c8c8c;">(</span><span style="color: #A1D08E;">".pi"</span>, <span style="color: #A1D08E;">"agents"</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">AGENT_FILE_EXTENSION</span> = <span style="color: #A1D08E;">".md"</span>;
<span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">AGENT_NAME_PATTERN</span> = <span style="color: #A1D08E;">/^@([a-zA-Z0-9_-]+)\s+(.+)$/</span>s;
<span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">PROCESS_STARTUP_WAIT_MS</span> = 1500;
<span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">STOPWORDS</span> = <span style="color: #FFA657;">new</span> <span style="color: #95a99f;">Set</span><span style="color: #8c8c8c;">(</span><span style="color: #93a8c6;">[</span><span style="color: #A1D08E;">"the"</span>, <span style="color: #A1D08E;">"for"</span>, <span style="color: #A1D08E;">"with"</span>, <span style="color: #A1D08E;">"from"</span>, <span style="color: #A1D08E;">"into"</span><span style="color: #93a8c6;">]</span><span style="color: #8c8c8c;">)</span>;
<span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">MAX_KEYWORDS</span> = 3;
<span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">MIN_KEYWORD_LENGTH</span> = 3;

<span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">TMUX_PI_SCRIPT</span> = path.<span style="color: #96a6c8;">join</span><span style="color: #8c8c8c;">(</span>os.<span style="color: #96a6c8;">homedir</span><span style="color: #93a8c6;">()</span>, <span style="color: #A1D08E;">".pi/agent/skills/tmux-pi/scripts/run-pi-monitored.sh"</span><span style="color: #8c8c8c;">)</span>;

<span style="color: #FFA657;">function</span> <span style="color: #96a6c8;">generateSessionName</span><span style="color: #8c8c8c;">(</span><span style="color: #f4f4ff;">agentName</span>: <span style="color: #FFA657;">string</span>, <span style="color: #f4f4ff;">task</span>: <span style="color: #FFA657;">string</span><span style="color: #8c8c8c;">)</span>: <span style="color: #FFA657;">string</span> <span style="color: #8c8c8c;">{</span>
        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">cleanAgentName</span> = agentName.<span style="color: #96a6c8;">replace</span><span style="color: #93a8c6;">(</span><span style="color: #A1D08E;">/^@/</span>, <span style="color: #A1D08E;">""</span><span style="color: #93a8c6;">)</span>;
        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">words</span> = task
                .<span style="color: #96a6c8;">toLowerCase</span><span style="color: #93a8c6;">()</span>
                .<span style="color: #96a6c8;">replace</span><span style="color: #93a8c6;">(</span><span style="color: #A1D08E;">/[^\w\s]/</span>g, <span style="color: #A1D08E;">" "</span><span style="color: #93a8c6;">)</span>
                .<span style="color: #96a6c8;">split</span><span style="color: #93a8c6;">(</span><span style="color: #A1D08E;">/\s+/</span><span style="color: #93a8c6;">)</span>
                .<span style="color: #96a6c8;">filter</span><span style="color: #93a8c6;">(</span><span style="color: #b0b1a3;">(</span>w<span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">=&gt;</span> w.length &gt; MIN_KEYWORD_LENGTH &amp;&amp; !STOPWORDS.<span style="color: #96a6c8;">has</span><span style="color: #b0b1a3;">(</span>w<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>;
        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">keywordStr</span> = words.<span style="color: #96a6c8;">slice</span><span style="color: #93a8c6;">(</span>0, MAX_KEYWORDS<span style="color: #93a8c6;">)</span>.<span style="color: #96a6c8;">join</span><span style="color: #93a8c6;">(</span><span style="color: #A1D08E;">"-"</span><span style="color: #93a8c6;">)</span>;
        <span style="color: #FFA657;">return</span> <span style="color: #A1D08E;">`pi-</span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">cleanAgentName</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">-</span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">keywordStr</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">`</span>;
<span style="color: #8c8c8c;">}</span>

<span style="color: #FFA657;">async</span> <span style="color: #FFA657;">function</span> <span style="color: #96a6c8;">checkSessionExists</span><span style="color: #8c8c8c;">(</span><span style="color: #f4f4ff;">sessionName</span>: <span style="color: #FFA657;">string</span><span style="color: #8c8c8c;">)</span>: <span style="color: #95a99f;">Promise</span>&lt;<span style="color: #FFA657;">boolean</span>&gt; <span style="color: #8c8c8c;">{</span>
        <span style="color: #FFA657;">try</span> <span style="color: #93a8c6;">{</span>
                <span style="color: #FFA657;">await</span> <span style="color: #96a6c8;">execAsync</span><span style="color: #b0b1a3;">(</span><span style="color: #A1D08E;">`tmux list-sessions -F "#{session_name}" 2&gt;/dev/null | grep -q "^</span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">sessionName</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">$"`</span><span style="color: #b0b1a3;">)</span>;
                <span style="color: #FFA657;">return</span> <span style="color: #95a99f;">true</span>;
        <span style="color: #93a8c6;">}</span> <span style="color: #FFA657;">catch</span> <span style="color: #93a8c6;">{</span>
                <span style="color: #FFA657;">return</span> <span style="color: #95a99f;">false</span>;
        <span style="color: #93a8c6;">}</span>
<span style="color: #8c8c8c;">}</span>

<span style="color: #FFA657;">async</span> <span style="color: #FFA657;">function</span> <span style="color: #96a6c8;">runSubagentSession</span><span style="color: #8c8c8c;">(</span>
        <span style="color: #f4f4ff;">agentName</span>: <span style="color: #FFA657;">string</span>,
        <span style="color: #f4f4ff;">task</span>: <span style="color: #FFA657;">string</span>,
        <span style="color: #f4f4ff;">cwd</span>: <span style="color: #FFA657;">string</span>
<span style="color: #8c8c8c;">)</span>: <span style="color: #95a99f;">Promise</span>&lt;<span style="color: #8c8c8c;">{</span> sessionName: <span style="color: #FFA657;">string</span>; outputFile: <span style="color: #FFA657;">string</span> <span style="color: #8c8c8c;">}</span>&gt; <span style="color: #8c8c8c;">{</span>
        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">sessionName</span> = <span style="color: #96a6c8;">generateSessionName</span><span style="color: #93a8c6;">(</span>agentName, task<span style="color: #93a8c6;">)</span>;
        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">outputFile</span> = <span style="color: #A1D08E;">`/tmp/pi-conversation-</span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">sessionName</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">-</span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">Date.now()</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">.txt`</span>;
        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">command</span> = <span style="color: #A1D08E;">`@</span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">agentName</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;"> </span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">task</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">`</span>;

        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">proc</span> = <span style="color: #96a6c8;">spawn</span><span style="color: #93a8c6;">(</span>
                <span style="color: #A1D08E;">"bash"</span>,
                <span style="color: #b0b1a3;">[</span>TMUX_PI_SCRIPT, <span style="color: #A1D08E;">"-n"</span>, sessionName, <span style="color: #A1D08E;">"-d"</span>, cwd, <span style="color: #A1D08E;">"-c"</span>, command, <span style="color: #A1D08E;">"-o"</span>, outputFile, <span style="color: #A1D08E;">"-v"</span><span style="color: #b0b1a3;">]</span>,
                <span style="color: #b0b1a3;">{</span> detached: <span style="color: #95a99f;">true</span>, stdio: <span style="color: #97b098;">[</span><span style="color: #A1D08E;">"ignore"</span>, <span style="color: #A1D08E;">"pipe"</span>, <span style="color: #A1D08E;">"pipe"</span><span style="color: #97b098;">]</span> <span style="color: #b0b1a3;">}</span>
        <span style="color: #93a8c6;">)</span>;

        proc.<span style="color: #96a6c8;">unref</span><span style="color: #93a8c6;">()</span>;
        proc.stderr?.<span style="color: #96a6c8;">on</span><span style="color: #93a8c6;">(</span><span style="color: #A1D08E;">"data"</span>, <span style="color: #FFA657;">function</span> <span style="color: #b0b1a3;">()</span> <span style="color: #b0b1a3;">{}</span><span style="color: #93a8c6;">)</span>;

        <span style="color: #FFA657;">await</span> <span style="color: #FFA657;">new</span> <span style="color: #95a99f;">Promise</span><span style="color: #93a8c6;">(</span><span style="color: #FFA657;">function</span> <span style="color: #b0b1a3;">(</span><span style="color: #f4f4ff;">resolve</span><span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
                <span style="color: #96a6c8;">setTimeout</span><span style="color: #97b098;">(</span>resolve, PROCESS_STARTUP_WAIT_MS<span style="color: #97b098;">)</span>;
        <span style="color: #b0b1a3;">}</span><span style="color: #93a8c6;">)</span>;

        <span style="color: #FFA657;">try</span> <span style="color: #93a8c6;">{</span>
                process.<span style="color: #96a6c8;">kill</span><span style="color: #b0b1a3;">(</span>proc.pid <span style="color: #FFA657;">as</span> <span style="color: #FFA657;">number</span>, 0<span style="color: #b0b1a3;">)</span>;
                <span style="color: #FFA657;">return</span> <span style="color: #b0b1a3;">{</span> sessionName, outputFile <span style="color: #b0b1a3;">}</span>;
        <span style="color: #93a8c6;">}</span> <span style="color: #FFA657;">catch</span> <span style="color: #93a8c6;">{</span>
                <span style="color: #FFA657;">throw</span> <span style="color: #FFA657;">new</span> <span style="color: #95a99f;">Error</span><span style="color: #b0b1a3;">(</span><span style="color: #A1D08E;">`Process exited. Check /tmp/pi-startup-</span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">sessionName</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">.log`</span><span style="color: #b0b1a3;">)</span>;
        <span style="color: #93a8c6;">}</span>
<span style="color: #8c8c8c;">}</span>

<span style="color: #FFA657;">function</span> <span style="color: #96a6c8;">loadAgentsFromDir</span><span style="color: #8c8c8c;">(</span><span style="color: #f4f4ff;">dir</span>: <span style="color: #FFA657;">string</span>, <span style="color: #f4f4ff;">source</span>: <span style="color: #A1D08E;">"user"</span> | <span style="color: #A1D08E;">"project"</span><span style="color: #8c8c8c;">)</span>: <span style="color: #95a99f;">AgentConfig</span><span style="color: #8c8c8c;">[]</span> <span style="color: #8c8c8c;">{</span>
        <span style="color: #FFA657;">if</span> <span style="color: #93a8c6;">(</span>!fs.<span style="color: #96a6c8;">existsSync</span><span style="color: #b0b1a3;">(</span>dir<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">{</span>
                <span style="color: #FFA657;">return</span> <span style="color: #b0b1a3;">[]</span>;
        <span style="color: #93a8c6;">}</span>

        <span style="color: #FFA657;">return</span> fs.<span style="color: #96a6c8;">readdirSync</span><span style="color: #93a8c6;">(</span>dir, <span style="color: #b0b1a3;">{</span> withFileTypes: <span style="color: #95a99f;">true</span> <span style="color: #b0b1a3;">}</span><span style="color: #93a8c6;">)</span>
                .<span style="color: #96a6c8;">filter</span><span style="color: #93a8c6;">(</span><span style="color: #FFA657;">function</span> <span style="color: #b0b1a3;">(</span><span style="color: #f4f4ff;">entry</span><span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
                        <span style="color: #FFA657;">return</span> entry.name.<span style="color: #96a6c8;">endsWith</span><span style="color: #97b098;">(</span>AGENT_FILE_EXTENSION<span style="color: #97b098;">)</span> &amp;&amp; <span style="color: #97b098;">(</span>entry.<span style="color: #96a6c8;">isFile</span><span style="color: #aebed8;">()</span> || entry.<span style="color: #96a6c8;">isSymbolicLink</span><span style="color: #aebed8;">()</span><span style="color: #97b098;">)</span>;
                <span style="color: #b0b1a3;">}</span><span style="color: #93a8c6;">)</span>
                .<span style="color: #96a6c8;">map</span><span style="color: #93a8c6;">(</span><span style="color: #FFA657;">function</span> <span style="color: #b0b1a3;">(</span><span style="color: #f4f4ff;">entry</span><span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
                        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">filePath</span> = path.<span style="color: #96a6c8;">join</span><span style="color: #97b098;">(</span>dir, entry.name<span style="color: #97b098;">)</span>;
                        <span style="color: #FFA657;">const</span> <span style="color: #97b098;">{</span> frontmatter, body <span style="color: #97b098;">}</span> = <span style="color: #96a6c8;">parseFrontmatter</span>&lt;<span style="color: #95a99f;">Record</span>&lt;<span style="color: #FFA657;">string</span>, <span style="color: #FFA657;">unknown</span>&gt;&gt;<span style="color: #97b098;">(</span>fs.<span style="color: #96a6c8;">readFileSync</span><span style="color: #aebed8;">(</span>filePath, <span style="color: #A1D08E;">"utf-8"</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>;

                        <span style="color: #FFA657;">if</span> <span style="color: #97b098;">(</span>!frontmatter.name || !frontmatter.description<span style="color: #97b098;">)</span> <span style="color: #97b098;">{</span>
                                <span style="color: #FFA657;">return</span> <span style="color: #95a99f;">null</span>;
                        <span style="color: #97b098;">}</span>

                        <span style="color: #FFA657;">return</span> <span style="color: #97b098;">{</span>
                                name: <span style="color: #95a99f;">String</span><span style="color: #aebed8;">(</span>frontmatter.name<span style="color: #aebed8;">)</span>,
                                description: <span style="color: #95a99f;">String</span><span style="color: #aebed8;">(</span>frontmatter.description<span style="color: #aebed8;">)</span>,
                                source,
                                filePath,
                                systemPrompt: body.<span style="color: #96a6c8;">trim</span><span style="color: #aebed8;">()</span>,
                        <span style="color: #97b098;">}</span>;
                <span style="color: #b0b1a3;">}</span><span style="color: #93a8c6;">)</span>
                .<span style="color: #96a6c8;">filter</span><span style="color: #93a8c6;">(</span><span style="color: #b0b1a3;">(</span>config<span style="color: #b0b1a3;">)</span>: <span style="color: #f4f4ff;">config</span> <span style="color: #FFA657;">is</span> <span style="color: #95a99f;">AgentConfig</span> <span style="color: #FFA657;">=&gt;</span> config !== <span style="color: #95a99f;">null</span><span style="color: #93a8c6;">)</span>;
<span style="color: #8c8c8c;">}</span>

<span style="color: #FFA657;">function</span> <span style="color: #96a6c8;">findNearestProjectAgentsDir</span><span style="color: #8c8c8c;">(</span><span style="color: #f4f4ff;">cwd</span>: <span style="color: #FFA657;">string</span><span style="color: #8c8c8c;">)</span>: <span style="color: #FFA657;">string</span> | <span style="color: #95a99f;">null</span> <span style="color: #8c8c8c;">{</span>
        <span style="color: #FFA657;">let</span> <span style="color: #f4f4ff;">currentDir</span> = cwd;

        <span style="color: #FFA657;">while</span> <span style="color: #93a8c6;">(</span>currentDir !== path.<span style="color: #96a6c8;">dirname</span><span style="color: #b0b1a3;">(</span>currentDir<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">{</span>
                <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">candidate</span> = path.<span style="color: #96a6c8;">join</span><span style="color: #b0b1a3;">(</span>currentDir, PROJECT_AGENTS_DIR_NAME<span style="color: #b0b1a3;">)</span>;
                <span style="color: #FFA657;">if</span> <span style="color: #b0b1a3;">(</span>fs.<span style="color: #96a6c8;">existsSync</span><span style="color: #97b098;">(</span>candidate<span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
                        <span style="color: #FFA657;">return</span> candidate;
                <span style="color: #b0b1a3;">}</span>
                currentDir = path.<span style="color: #96a6c8;">dirname</span><span style="color: #b0b1a3;">(</span>currentDir<span style="color: #b0b1a3;">)</span>;
        <span style="color: #93a8c6;">}</span>

        <span style="color: #FFA657;">return</span> <span style="color: #95a99f;">null</span>;
<span style="color: #8c8c8c;">}</span>

<span style="color: #FFA657;">function</span> <span style="color: #96a6c8;">discoverAgents</span><span style="color: #8c8c8c;">(</span><span style="color: #f4f4ff;">cwd</span>: <span style="color: #FFA657;">string</span><span style="color: #8c8c8c;">)</span>: <span style="color: #95a99f;">AgentConfig</span><span style="color: #8c8c8c;">[]</span> <span style="color: #8c8c8c;">{</span>
        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">projectAgentsDir</span> = <span style="color: #96a6c8;">findNearestProjectAgentsDir</span><span style="color: #93a8c6;">(</span>cwd<span style="color: #93a8c6;">)</span>;
        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">userAgents</span> = <span style="color: #96a6c8;">loadAgentsFromDir</span><span style="color: #93a8c6;">(</span>USER_AGENTS_DIR, <span style="color: #A1D08E;">"user"</span><span style="color: #93a8c6;">)</span>;
        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">projectAgents</span> = projectAgentsDir ? <span style="color: #96a6c8;">loadAgentsFromDir</span><span style="color: #93a8c6;">(</span>projectAgentsDir, <span style="color: #A1D08E;">"project"</span><span style="color: #93a8c6;">)</span> : <span style="color: #93a8c6;">[]</span>;

        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">agentMap</span> = <span style="color: #FFA657;">new</span> <span style="color: #95a99f;">Map</span><span style="color: #93a8c6;">(</span>userAgents.<span style="color: #96a6c8;">map</span><span style="color: #b0b1a3;">(</span><span style="color: #97b098;">(</span>a<span style="color: #97b098;">)</span> <span style="color: #FFA657;">=&gt;</span> <span style="color: #97b098;">[</span>a.name, a<span style="color: #97b098;">]</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>;
        projectAgents.<span style="color: #96a6c8;">forEach</span><span style="color: #93a8c6;">(</span><span style="color: #b0b1a3;">(</span>a<span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">=&gt;</span> agentMap.<span style="color: #96a6c8;">set</span><span style="color: #b0b1a3;">(</span>a.name, a<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>;

        <span style="color: #FFA657;">return</span> Array.<span style="color: #96a6c8;">from</span><span style="color: #93a8c6;">(</span>agentMap.<span style="color: #96a6c8;">values</span><span style="color: #b0b1a3;">()</span><span style="color: #93a8c6;">)</span>;
<span style="color: #8c8c8c;">}</span>

<span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">NAVIGATION_KEYS</span> = <span style="color: #8c8c8c;">[</span>Key.up, Key.down, Key.enter, Key.escape<span style="color: #8c8c8c;">]</span>;

<span style="color: #FFA657;">export</span> <span style="color: #FFA657;">default</span> <span style="color: #FFA657;">function</span> <span style="color: #96a6c8;">agentAtDiscovery</span><span style="color: #8c8c8c;">(</span><span style="color: #f4f4ff;">pi</span>: <span style="color: #95a99f;">ExtensionAPI</span><span style="color: #8c8c8c;">)</span>: <span style="color: #FFA657;">void</span> <span style="color: #8c8c8c;">{</span>
        <span style="color: #FFA657;">let</span> <span style="color: #f4f4ff;">activeAgent</span>: <span style="color: #95a99f;">AgentConfig</span> | <span style="color: #95a99f;">null</span> = <span style="color: #95a99f;">null</span>;
        <span style="color: #FFA657;">let</span> <span style="color: #f4f4ff;">cachedAgents</span>: <span style="color: #95a99f;">AgentConfig</span><span style="color: #93a8c6;">[]</span> | <span style="color: #95a99f;">null</span> = <span style="color: #95a99f;">null</span>;
        <span style="color: #FFA657;">let</span> <span style="color: #f4f4ff;">subagentTasks</span>: <span style="color: #95a99f;">Array</span>&lt;<span style="color: #93a8c6;">{</span> agentName: <span style="color: #FFA657;">string</span>; sessionName: <span style="color: #FFA657;">string</span>; outputFile: <span style="color: #FFA657;">string</span>; task: <span style="color: #FFA657;">string</span>; startTime: <span style="color: #FFA657;">number</span>; ctx: <span style="color: #FFA657;">any</span> <span style="color: #93a8c6;">}</span>&gt; = <span style="color: #93a8c6;">[]</span>;

        <span style="color: #FFA657;">function</span> <span style="color: #96a6c8;">formatElapsed</span><span style="color: #93a8c6;">(</span><span style="color: #f4f4ff;">seconds</span>: <span style="color: #FFA657;">number</span><span style="color: #93a8c6;">)</span>: <span style="color: #FFA657;">string</span> <span style="color: #93a8c6;">{</span>
                <span style="color: #FFA657;">if</span> <span style="color: #b0b1a3;">(</span>seconds &lt; 60<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
                        <span style="color: #FFA657;">return</span> <span style="color: #A1D08E;">`</span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">seconds</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">s`</span>;
                <span style="color: #b0b1a3;">}</span>
                <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">minutes</span> = Math.<span style="color: #96a6c8;">floor</span><span style="color: #b0b1a3;">(</span>seconds / 60<span style="color: #b0b1a3;">)</span>;
                <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">remainingSeconds</span> = seconds % 60;
                <span style="color: #FFA657;">return</span> <span style="color: #A1D08E;">`</span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">minutes</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">m</span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">remainingSeconds</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">s`</span>;
        <span style="color: #93a8c6;">}</span>

        <span style="color: #FFA657;">function</span> <span style="color: #96a6c8;">updateSubagentStatus</span><span style="color: #93a8c6;">()</span>: <span style="color: #FFA657;">void</span> <span style="color: #93a8c6;">{</span>
                <span style="color: #FFA657;">if</span> <span style="color: #b0b1a3;">(</span>subagentTasks.length === 0<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
                        <span style="color: #FFA657;">return</span>;
                <span style="color: #b0b1a3;">}</span>

                <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">task</span> = subagentTasks<span style="color: #b0b1a3;">[</span>0<span style="color: #b0b1a3;">]</span>;
                <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">elapsed</span> = Math.<span style="color: #96a6c8;">floor</span><span style="color: #b0b1a3;">(</span><span style="color: #97b098;">(</span>Date.<span style="color: #96a6c8;">now</span><span style="color: #aebed8;">()</span> - task.startTime<span style="color: #97b098;">)</span> / 1000<span style="color: #b0b1a3;">)</span>;
                <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">theme</span> = task.ctx.ui.theme;
                <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">status</span> = theme.<span style="color: #96a6c8;">fg</span><span style="color: #b0b1a3;">(</span><span style="color: #A1D08E;">"dim"</span>, <span style="color: #A1D08E;">`@</span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">task.agentName</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;"> | tmux-session: </span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">task.sessionName</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;"> | &#9201;&#65039; </span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">formatElapsed(elapsed)</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">`</span><span style="color: #b0b1a3;">)</span>;
                task.ctx.ui.<span style="color: #96a6c8;">setWidget</span><span style="color: #b0b1a3;">(</span><span style="color: #A1D08E;">"subagent-status"</span>, <span style="color: #97b098;">[</span>status<span style="color: #97b098;">]</span>, <span style="color: #97b098;">{</span> placement: <span style="color: #A1D08E;">"belowEditor"</span> <span style="color: #97b098;">}</span><span style="color: #b0b1a3;">)</span>;
        <span style="color: #93a8c6;">}</span>

        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">STATUS_CHECK_INTERVAL_MS</span> = 5000;

        <span style="color: #FFA657;">async</span> <span style="color: #FFA657;">function</span> <span style="color: #96a6c8;">checkTaskStatus</span><span style="color: #93a8c6;">()</span>: <span style="color: #95a99f;">Promise</span>&lt;<span style="color: #FFA657;">void</span>&gt; <span style="color: #93a8c6;">{</span>
                <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">stillRunning</span>: <span style="color: #FFA657;">typeof</span> subagentTasks = <span style="color: #b0b1a3;">[]</span>;

                <span style="color: #FFA657;">for</span> <span style="color: #b0b1a3;">(</span><span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">task</span> <span style="color: #FFA657;">of</span> subagentTasks<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
                        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">sessionRunning</span> = <span style="color: #FFA657;">await</span> <span style="color: #96a6c8;">checkSessionExists</span><span style="color: #97b098;">(</span>task.sessionName<span style="color: #97b098;">)</span>;

                        <span style="color: #FFA657;">if</span> <span style="color: #97b098;">(</span>!sessionRunning &amp;&amp; fs.<span style="color: #96a6c8;">existsSync</span><span style="color: #aebed8;">(</span>task.outputFile<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span> <span style="color: #97b098;">{</span>
                                task.ctx.ui.<span style="color: #96a6c8;">notify</span><span style="color: #aebed8;">(</span><span style="color: #A1D08E;">`&#10003; Task completed: </span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">task.sessionName</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">`</span>, <span style="color: #A1D08E;">"success"</span><span style="color: #aebed8;">)</span>;
                                task.ctx.ui.<span style="color: #96a6c8;">notify</span><span style="color: #aebed8;">(</span><span style="color: #A1D08E;">`&#128196; Results: </span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">task.outputFile</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">`</span>, <span style="color: #A1D08E;">"info"</span><span style="color: #aebed8;">)</span>;
                                task.ctx.ui.<span style="color: #96a6c8;">setWidget</span><span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"subagent-status"</span>, <span style="color: #95a99f;">undefined</span><span style="color: #aebed8;">)</span>;
                                <span style="color: #FFA657;">continue</span>;
                        <span style="color: #97b098;">}</span>
                        stillRunning.<span style="color: #96a6c8;">push</span><span style="color: #97b098;">(</span>task<span style="color: #97b098;">)</span>;
                <span style="color: #b0b1a3;">}</span>

                subagentTasks = stillRunning;
                <span style="color: #96a6c8;">updateSubagentStatus</span><span style="color: #b0b1a3;">()</span>;

                <span style="color: #FFA657;">if</span> <span style="color: #b0b1a3;">(</span>subagentTasks.length &gt; 0<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
                        <span style="color: #96a6c8;">setTimeout</span><span style="color: #97b098;">(</span>checkTaskStatus, STATUS_CHECK_INTERVAL_MS<span style="color: #97b098;">)</span>;
                <span style="color: #b0b1a3;">}</span>
        <span style="color: #93a8c6;">}</span>

        pi.<span style="color: #96a6c8;">on</span><span style="color: #93a8c6;">(</span><span style="color: #A1D08E;">"session_start"</span>, <span style="color: #FFA657;">async</span> <span style="color: #FFA657;">function</span> <span style="color: #b0b1a3;">(</span><span style="color: #f4f4ff;">_event</span>, <span style="color: #f4f4ff;">ctx</span><span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
                cachedAgents = <span style="color: #96a6c8;">discoverAgents</span><span style="color: #97b098;">(</span>ctx.cwd<span style="color: #97b098;">)</span>;
                ctx.ui.<span style="color: #96a6c8;">notify</span><span style="color: #97b098;">(</span><span style="color: #A1D08E;">`Loaded </span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">cachedAgents.length</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;"> agents. Use /agents or @agent-name`</span>, <span style="color: #A1D08E;">"info"</span><span style="color: #97b098;">)</span>;
        <span style="color: #b0b1a3;">}</span><span style="color: #93a8c6;">)</span>;

        pi.<span style="color: #96a6c8;">on</span><span style="color: #93a8c6;">(</span><span style="color: #A1D08E;">"before_agent_start"</span>, <span style="color: #FFA657;">async</span> <span style="color: #FFA657;">function</span> <span style="color: #b0b1a3;">(</span><span style="color: #f4f4ff;">event</span><span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
                <span style="color: #FFA657;">if</span> <span style="color: #97b098;">(</span>!activeAgent<span style="color: #97b098;">)</span> <span style="color: #97b098;">{</span>
                        <span style="color: #FFA657;">return</span> <span style="color: #aebed8;">{}</span>;
                <span style="color: #97b098;">}</span>
                <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">fullPrompt</span> = event.systemPrompt + <span style="color: #A1D08E;">"\n\n"</span> + activeAgent.systemPrompt;
                <span style="color: #FFA657;">return</span> <span style="color: #97b098;">{</span> systemPrompt: fullPrompt <span style="color: #97b098;">}</span>;
        <span style="color: #b0b1a3;">}</span><span style="color: #93a8c6;">)</span>;

        pi.<span style="color: #96a6c8;">on</span><span style="color: #93a8c6;">(</span><span style="color: #A1D08E;">"agent_end"</span>, <span style="color: #FFA657;">async</span> <span style="color: #FFA657;">function</span> <span style="color: #b0b1a3;">()</span> <span style="color: #b0b1a3;">{</span>
                activeAgent = <span style="color: #95a99f;">null</span>;
        <span style="color: #b0b1a3;">}</span><span style="color: #93a8c6;">)</span>;

        pi.<span style="color: #96a6c8;">registerCommand</span><span style="color: #93a8c6;">(</span><span style="color: #A1D08E;">"agents"</span>, <span style="color: #b0b1a3;">{</span>
                description: <span style="color: #A1D08E;">"Select an agent and provide a task"</span>,
                handler: <span style="color: #FFA657;">async</span> <span style="color: #FFA657;">function</span> <span style="color: #97b098;">(</span><span style="color: #f4f4ff;">_args</span>, <span style="color: #f4f4ff;">ctx</span><span style="color: #97b098;">)</span> <span style="color: #97b098;">{</span>
                        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">agents</span> = cachedAgents ?? <span style="color: #96a6c8;">discoverAgents</span><span style="color: #aebed8;">(</span>ctx.cwd<span style="color: #aebed8;">)</span>;

                        <span style="color: #FFA657;">if</span> <span style="color: #aebed8;">(</span>agents.length === 0<span style="color: #aebed8;">)</span> <span style="color: #aebed8;">{</span>
                                ctx.ui.<span style="color: #96a6c8;">notify</span><span style="color: #b0b0b3;">(</span><span style="color: #A1D08E;">"No agents found. Create .md files in ~/.pi/agent/agents/ or .pi/agents/"</span>, <span style="color: #A1D08E;">"warning"</span><span style="color: #b0b0b3;">)</span>;
                                <span style="color: #FFA657;">return</span>;
                        <span style="color: #aebed8;">}</span>

                        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">result</span> = <span style="color: #FFA657;">await</span> ctx.ui.<span style="color: #96a6c8;">custom</span>&lt;<span style="color: #aebed8;">{</span> agentName: <span style="color: #FFA657;">string</span>; task: <span style="color: #FFA657;">string</span>; subagentMode?: <span style="color: #FFA657;">boolean</span> <span style="color: #aebed8;">}</span> | <span style="color: #95a99f;">null</span>&gt;<span style="color: #aebed8;">(</span>
                                <span style="color: #FFA657;">function</span> <span style="color: #b0b0b3;">(</span><span style="color: #f4f4ff;">tui</span>, <span style="color: #f4f4ff;">theme</span>, <span style="color: #f4f4ff;">_kb</span>, <span style="color: #f4f4ff;">done</span><span style="color: #b0b0b3;">)</span> <span style="color: #b0b0b3;">{</span>
                                        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">searchInput</span> = <span style="color: #FFA657;">new</span> <span style="color: #95a99f;">Input</span><span style="color: #90a890;">()</span>;
                                        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">accentBorder</span> = <span style="color: #90a890;">(</span>s: <span style="color: #FFA657;">string</span><span style="color: #90a890;">)</span> <span style="color: #FFA657;">=&gt;</span> theme.<span style="color: #96a6c8;">fg</span><span style="color: #90a890;">(</span><span style="color: #A1D08E;">"accent"</span>, s<span style="color: #90a890;">)</span>;

                                        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">selectListTheme</span> = <span style="color: #90a890;">{</span>
                                                selectedPrefix: accentBorder,
                                                selectedText: accentBorder,
                                                description: <span style="color: #a2b6da;">(</span>t: <span style="color: #FFA657;">string</span><span style="color: #a2b6da;">)</span> <span style="color: #FFA657;">=&gt;</span> theme.<span style="color: #96a6c8;">fg</span><span style="color: #a2b6da;">(</span><span style="color: #A1D08E;">"muted"</span>, t<span style="color: #a2b6da;">)</span>,
                                                scrollInfo: <span style="color: #a2b6da;">(</span>t: <span style="color: #FFA657;">string</span><span style="color: #a2b6da;">)</span> <span style="color: #FFA657;">=&gt;</span> theme.<span style="color: #96a6c8;">fg</span><span style="color: #a2b6da;">(</span><span style="color: #A1D08E;">"dim"</span>, t<span style="color: #a2b6da;">)</span>,
                                                noMatch: <span style="color: #a2b6da;">(</span>t: <span style="color: #FFA657;">string</span><span style="color: #a2b6da;">)</span> <span style="color: #FFA657;">=&gt;</span> theme.<span style="color: #96a6c8;">fg</span><span style="color: #a2b6da;">(</span><span style="color: #A1D08E;">"warning"</span>, t<span style="color: #a2b6da;">)</span>,
                                        <span style="color: #90a890;">}</span>;

                                        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">editorTheme</span> = <span style="color: #90a890;">{</span> borderColor: accentBorder, selectList: selectListTheme <span style="color: #90a890;">}</span>;

                                        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">taskInput</span> = <span style="color: #FFA657;">new</span> <span style="color: #95a99f;">Editor</span><span style="color: #90a890;">(</span>tui, editorTheme, <span style="color: #a2b6da;">{</span> paddingX: 1 <span style="color: #a2b6da;">}</span><span style="color: #90a890;">)</span>;
                                        taskInput.<span style="color: #96a6c8;">setAutocompleteProvider</span><span style="color: #90a890;">(</span><span style="color: #FFA657;">new</span> <span style="color: #95a99f;">CombinedAutocompleteProvider</span><span style="color: #a2b6da;">(</span><span style="color: #9cb6ad;">[]</span>, ctx.cwd, <span style="color: #A1D08E;">"fd"</span><span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>;

                                        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">selectList</span> = <span style="color: #FFA657;">new</span> <span style="color: #95a99f;">SelectList</span><span style="color: #90a890;">(</span>
                                                agents.<span style="color: #96a6c8;">map</span><span style="color: #a2b6da;">(</span><span style="color: #9cb6ad;">(</span>a<span style="color: #9cb6ad;">)</span> <span style="color: #FFA657;">=&gt;</span> <span style="color: #9cb6ad;">(</span><span style="color: #8c8c8c;">{</span> value: a.name, label: a.name, description: a.description <span style="color: #8c8c8c;">}</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>,
                                                Math.<span style="color: #96a6c8;">min</span><span style="color: #a2b6da;">(</span>agents.length, 10<span style="color: #a2b6da;">)</span>,
                                                selectListTheme
                                        <span style="color: #90a890;">)</span>;

                                        <span style="color: #FFA657;">let</span> <span style="color: #f4f4ff;">selectedAgent</span>: <span style="color: #FFA657;">string</span> | <span style="color: #95a99f;">null</span> = <span style="color: #95a99f;">null</span>;
                                        <span style="color: #FFA657;">let</span> <span style="color: #f4f4ff;">showTaskInput</span> = <span style="color: #95a99f;">false</span>;
                                        <span style="color: #FFA657;">let</span> <span style="color: #f4f4ff;">subagentMode</span> = <span style="color: #95a99f;">false</span>;

                                        selectList.onSelect = <span style="color: #FFA657;">function</span> <span style="color: #90a890;">(</span><span style="color: #f4f4ff;">item</span><span style="color: #90a890;">)</span> <span style="color: #90a890;">{</span>
                                                selectedAgent = item.value;
                                                searchInput.<span style="color: #96a6c8;">setValue</span><span style="color: #a2b6da;">(</span><span style="color: #A1D08E;">""</span><span style="color: #a2b6da;">)</span>;
                                                showTaskInput = <span style="color: #95a99f;">true</span>;
                                                tui.<span style="color: #96a6c8;">requestRender</span><span style="color: #a2b6da;">()</span>;
                                        <span style="color: #90a890;">}</span>;

                                        selectList.onCancel = <span style="color: #FFA657;">function</span> <span style="color: #90a890;">()</span> <span style="color: #90a890;">{</span>
                                                <span style="color: #96a6c8;">done</span><span style="color: #a2b6da;">(</span><span style="color: #95a99f;">null</span><span style="color: #a2b6da;">)</span>;
                                        <span style="color: #90a890;">}</span>;

                                        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">agentSelectionContainer</span> = <span style="color: #FFA657;">new</span> <span style="color: #95a99f;">Container</span><span style="color: #90a890;">()</span>;
                                        agentSelectionContainer.<span style="color: #96a6c8;">addChild</span><span style="color: #90a890;">(</span><span style="color: #FFA657;">new</span> <span style="color: #95a99f;">DynamicBorder</span><span style="color: #a2b6da;">(</span>accentBorder<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>;
                                        agentSelectionContainer.<span style="color: #96a6c8;">addChild</span><span style="color: #90a890;">(</span><span style="color: #FFA657;">new</span> <span style="color: #95a99f;">Text</span><span style="color: #a2b6da;">(</span>theme.<span style="color: #96a6c8;">fg</span><span style="color: #9cb6ad;">(</span><span style="color: #A1D08E;">"accent"</span>, theme.<span style="color: #96a6c8;">bold</span><span style="color: #8c8c8c;">(</span><span style="color: #A1D08E;">"Select Agent"</span><span style="color: #8c8c8c;">)</span><span style="color: #9cb6ad;">)</span>, 1, 0<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>;
                                        agentSelectionContainer.<span style="color: #96a6c8;">addChild</span><span style="color: #90a890;">(</span>searchInput<span style="color: #90a890;">)</span>;
                                        agentSelectionContainer.<span style="color: #96a6c8;">addChild</span><span style="color: #90a890;">(</span><span style="color: #FFA657;">new</span> <span style="color: #95a99f;">Spacer</span><span style="color: #a2b6da;">(</span>1<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>;
                                        agentSelectionContainer.<span style="color: #96a6c8;">addChild</span><span style="color: #90a890;">(</span>selectList<span style="color: #90a890;">)</span>;
                                        agentSelectionContainer.<span style="color: #96a6c8;">addChild</span><span style="color: #90a890;">(</span><span style="color: #FFA657;">new</span> <span style="color: #95a99f;">Spacer</span><span style="color: #a2b6da;">(</span>1<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>;
                                        agentSelectionContainer.<span style="color: #96a6c8;">addChild</span><span style="color: #90a890;">(</span><span style="color: #FFA657;">new</span> <span style="color: #95a99f;">Text</span><span style="color: #a2b6da;">(</span>theme.<span style="color: #96a6c8;">fg</span><span style="color: #9cb6ad;">(</span><span style="color: #A1D08E;">"dim"</span>, <span style="color: #A1D08E;">"type to filter &#8226; &#8593;&#8595; navigate &#8226; enter select &#8226; esc cancel"</span><span style="color: #9cb6ad;">)</span>, 1, 0<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>;
                                        agentSelectionContainer.<span style="color: #96a6c8;">addChild</span><span style="color: #90a890;">(</span><span style="color: #FFA657;">new</span> <span style="color: #95a99f;">DynamicBorder</span><span style="color: #a2b6da;">(</span>accentBorder<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>;

                                        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">taskContainer</span> = <span style="color: #FFA657;">new</span> <span style="color: #95a99f;">Container</span><span style="color: #90a890;">()</span>;
                                        taskContainer.<span style="color: #96a6c8;">addChild</span><span style="color: #90a890;">(</span><span style="color: #FFA657;">new</span> <span style="color: #95a99f;">DynamicBorder</span><span style="color: #a2b6da;">(</span>accentBorder<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>;
                                        taskContainer.<span style="color: #96a6c8;">addChild</span><span style="color: #90a890;">(</span><span style="color: #FFA657;">new</span> <span style="color: #95a99f;">Text</span><span style="color: #a2b6da;">(</span><span style="color: #A1D08E;">""</span>, 1, 0<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>;
                                        taskContainer.<span style="color: #96a6c8;">addChild</span><span style="color: #90a890;">(</span><span style="color: #FFA657;">new</span> <span style="color: #95a99f;">Spacer</span><span style="color: #a2b6da;">(</span>1<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>;
                                        taskContainer.<span style="color: #96a6c8;">addChild</span><span style="color: #90a890;">(</span>taskInput<span style="color: #90a890;">)</span>;
                                        taskContainer.<span style="color: #96a6c8;">addChild</span><span style="color: #90a890;">(</span><span style="color: #FFA657;">new</span> <span style="color: #95a99f;">Spacer</span><span style="color: #a2b6da;">(</span>1<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>;
                                        taskContainer.<span style="color: #96a6c8;">addChild</span><span style="color: #90a890;">(</span><span style="color: #FFA657;">new</span> <span style="color: #95a99f;">Text</span><span style="color: #a2b6da;">(</span>theme.<span style="color: #96a6c8;">fg</span><span style="color: #9cb6ad;">(</span><span style="color: #A1D08E;">"dim"</span>, <span style="color: #A1D08E;">"@file autocomplete &#8226; ctrl+up toggle subagent &#8226; enter confirm &#8226; esc cancel"</span><span style="color: #9cb6ad;">)</span>, 1, 0<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>;
                                        taskContainer.<span style="color: #96a6c8;">addChild</span><span style="color: #90a890;">(</span><span style="color: #FFA657;">new</span> <span style="color: #95a99f;">DynamicBorder</span><span style="color: #a2b6da;">(</span>accentBorder<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>;

                                        <span style="color: #FFA657;">function</span> <span style="color: #96a6c8;">updateTaskHeader</span><span style="color: #90a890;">()</span>: <span style="color: #FFA657;">void</span> <span style="color: #90a890;">{</span>
                                                <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">subagentState</span> = subagentMode ? <span style="color: #A1D08E;">"ON"</span> : <span style="color: #A1D08E;">"OFF"</span>;
                                                <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">subagentColor</span> = subagentMode ? <span style="color: #A1D08E;">"success"</span> : <span style="color: #A1D08E;">"dim"</span>;
                                                <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">header</span> =
                                                        theme.<span style="color: #96a6c8;">fg</span><span style="color: #a2b6da;">(</span><span style="color: #A1D08E;">"accent"</span>, theme.<span style="color: #96a6c8;">bold</span><span style="color: #9cb6ad;">(</span><span style="color: #A1D08E;">`Task for @</span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">selectedAgent</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">`</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span> +
                                                        <span style="color: #A1D08E;">" "</span> +
                                                        theme.<span style="color: #96a6c8;">fg</span><span style="color: #a2b6da;">(</span>subagentColor, theme.<span style="color: #96a6c8;">bold</span><span style="color: #9cb6ad;">(</span><span style="color: #A1D08E;">`[Subagent: </span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">subagentState</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">]`</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>;
                                                taskContainer.children<span style="color: #a2b6da;">[</span>1<span style="color: #a2b6da;">]</span> = <span style="color: #FFA657;">new</span> <span style="color: #95a99f;">Text</span><span style="color: #a2b6da;">(</span>header, 1, 0<span style="color: #a2b6da;">)</span>;
                                        <span style="color: #90a890;">}</span>

                                        <span style="color: #FFA657;">return</span> <span style="color: #90a890;">{</span>
                                                <span style="color: #96a6c8;">render</span><span style="color: #a2b6da;">(</span>width: <span style="color: #FFA657;">number</span><span style="color: #a2b6da;">)</span> <span style="color: #a2b6da;">{</span>
                                                        <span style="color: #FFA657;">if</span> <span style="color: #9cb6ad;">(</span>showTaskInput<span style="color: #9cb6ad;">)</span> <span style="color: #9cb6ad;">{</span>
                                                                <span style="color: #96a6c8;">updateTaskHeader</span><span style="color: #8c8c8c;">()</span>;
                                                                <span style="color: #FFA657;">return</span> taskContainer.<span style="color: #96a6c8;">render</span><span style="color: #8c8c8c;">(</span>width<span style="color: #8c8c8c;">)</span>;
                                                        <span style="color: #9cb6ad;">}</span>
                                                        <span style="color: #FFA657;">return</span> agentSelectionContainer.<span style="color: #96a6c8;">render</span><span style="color: #9cb6ad;">(</span>width<span style="color: #9cb6ad;">)</span>;
                                                <span style="color: #a2b6da;">}</span>,
                                                <span style="color: #96a6c8;">invalidate</span><span style="color: #a2b6da;">()</span> <span style="color: #a2b6da;">{</span>
                                                        agentSelectionContainer.<span style="color: #96a6c8;">invalidate</span><span style="color: #9cb6ad;">()</span>;
                                                        taskContainer.<span style="color: #96a6c8;">invalidate</span><span style="color: #9cb6ad;">()</span>;
                                                        searchInput.<span style="color: #96a6c8;">invalidate</span><span style="color: #9cb6ad;">()</span>;
                                                <span style="color: #a2b6da;">}</span>,
                                                <span style="color: #96a6c8;">handleInput</span><span style="color: #a2b6da;">(</span>data: <span style="color: #FFA657;">string</span><span style="color: #a2b6da;">)</span> <span style="color: #a2b6da;">{</span>
                                                        <span style="color: #FFA657;">if</span> <span style="color: #9cb6ad;">(</span>showTaskInput<span style="color: #9cb6ad;">)</span> <span style="color: #9cb6ad;">{</span>
                                                                <span style="color: #FFA657;">if</span> <span style="color: #8c8c8c;">(</span><span style="color: #96a6c8;">matchesKey</span><span style="color: #93a8c6;">(</span>data, Key.escape<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span> <span style="color: #8c8c8c;">{</span>
                                                                        showTaskInput = <span style="color: #95a99f;">false</span>;
                                                                        selectedAgent = <span style="color: #95a99f;">null</span>;
                                                                        taskInput.<span style="color: #96a6c8;">setText</span><span style="color: #93a8c6;">(</span><span style="color: #A1D08E;">""</span><span style="color: #93a8c6;">)</span>;
                                                                        subagentMode = <span style="color: #95a99f;">false</span>;
                                                                <span style="color: #8c8c8c;">}</span> <span style="color: #FFA657;">else</span> <span style="color: #FFA657;">if</span> <span style="color: #8c8c8c;">(</span><span style="color: #96a6c8;">matchesKey</span><span style="color: #93a8c6;">(</span>data, Key.<span style="color: #96a6c8;">ctrl</span><span style="color: #b0b1a3;">(</span><span style="color: #A1D08E;">"up"</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span> <span style="color: #8c8c8c;">{</span>
                                                                        subagentMode = !subagentMode;
                                                                <span style="color: #8c8c8c;">}</span> <span style="color: #FFA657;">else</span> <span style="color: #FFA657;">if</span> <span style="color: #8c8c8c;">(</span><span style="color: #96a6c8;">matchesKey</span><span style="color: #93a8c6;">(</span>data, Key.enter<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span> <span style="color: #8c8c8c;">{</span>
                                                                        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">task</span> = taskInput.<span style="color: #96a6c8;">getText</span><span style="color: #93a8c6;">()</span>;
                                                                        <span style="color: #FFA657;">if</span> <span style="color: #93a8c6;">(</span>task.<span style="color: #96a6c8;">trim</span><span style="color: #b0b1a3;">()</span><span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">{</span>
                                                                                <span style="color: #96a6c8;">done</span><span style="color: #b0b1a3;">(</span><span style="color: #97b098;">{</span> agentName: selectedAgent!, task: task.<span style="color: #96a6c8;">trim</span><span style="color: #aebed8;">()</span>, subagentMode <span style="color: #97b098;">}</span><span style="color: #b0b1a3;">)</span>;
                                                                                <span style="color: #FFA657;">return</span>;
                                                                        <span style="color: #93a8c6;">}</span>
                                                                <span style="color: #8c8c8c;">}</span> <span style="color: #FFA657;">else</span> <span style="color: #8c8c8c;">{</span>
                                                                        taskInput.<span style="color: #96a6c8;">handleInput</span><span style="color: #93a8c6;">(</span>data<span style="color: #93a8c6;">)</span>;
                                                                <span style="color: #8c8c8c;">}</span>
                                                        <span style="color: #9cb6ad;">}</span> <span style="color: #FFA657;">else</span> <span style="color: #9cb6ad;">{</span>
                                                                <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">isNavKey</span> = NAVIGATION_KEYS.<span style="color: #96a6c8;">some</span><span style="color: #8c8c8c;">(</span><span style="color: #93a8c6;">(</span>k<span style="color: #93a8c6;">)</span> <span style="color: #FFA657;">=&gt;</span> <span style="color: #96a6c8;">matchesKey</span><span style="color: #93a8c6;">(</span>data, k<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>;
                                                                <span style="color: #FFA657;">if</span> <span style="color: #8c8c8c;">(</span>isNavKey<span style="color: #8c8c8c;">)</span> <span style="color: #8c8c8c;">{</span>
                                                                        selectList.<span style="color: #96a6c8;">handleInput</span><span style="color: #93a8c6;">(</span>data<span style="color: #93a8c6;">)</span>;
                                                                <span style="color: #8c8c8c;">}</span> <span style="color: #FFA657;">else</span> <span style="color: #8c8c8c;">{</span>
                                                                        searchInput.<span style="color: #96a6c8;">handleInput</span><span style="color: #93a8c6;">(</span>data<span style="color: #93a8c6;">)</span>;
                                                                        selectList.<span style="color: #96a6c8;">setFilter</span><span style="color: #93a8c6;">(</span>searchInput.<span style="color: #96a6c8;">getValue</span><span style="color: #b0b1a3;">()</span><span style="color: #93a8c6;">)</span>;
                                                                <span style="color: #8c8c8c;">}</span>
                                                        <span style="color: #9cb6ad;">}</span>
                                                        tui.<span style="color: #96a6c8;">requestRender</span><span style="color: #9cb6ad;">()</span>;
                                                <span style="color: #a2b6da;">}</span>,
                                        <span style="color: #90a890;">}</span>;
                                <span style="color: #b0b0b3;">}</span>
                        <span style="color: #aebed8;">)</span>;

                        <span style="color: #FFA657;">if</span> <span style="color: #aebed8;">(</span>!result<span style="color: #aebed8;">)</span> <span style="color: #FFA657;">return</span>;

                        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">selectedAgentConfig</span> = agents.<span style="color: #96a6c8;">find</span><span style="color: #aebed8;">(</span><span style="color: #b0b0b3;">(</span>a<span style="color: #b0b0b3;">)</span> <span style="color: #FFA657;">=&gt;</span> a.name === result.agentName<span style="color: #aebed8;">)</span>;

                        <span style="color: #FFA657;">if</span> <span style="color: #aebed8;">(</span>!selectedAgentConfig<span style="color: #aebed8;">)</span> <span style="color: #aebed8;">{</span>
                                ctx.ui.<span style="color: #96a6c8;">notify</span><span style="color: #b0b0b3;">(</span><span style="color: #A1D08E;">`Agent "</span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">result.agentName</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">" not found`</span>, <span style="color: #A1D08E;">"error"</span><span style="color: #b0b0b3;">)</span>;
                                <span style="color: #FFA657;">return</span>;
                        <span style="color: #aebed8;">}</span>

                        <span style="color: #FFA657;">if</span> <span style="color: #aebed8;">(</span>result.subagentMode<span style="color: #aebed8;">)</span> <span style="color: #aebed8;">{</span>
                                <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">sessionName</span> = <span style="color: #96a6c8;">generateSessionName</span><span style="color: #b0b0b3;">(</span>selectedAgentConfig.name, result.task<span style="color: #b0b0b3;">)</span>;

                                <span style="color: #FFA657;">try</span> <span style="color: #b0b0b3;">{</span>
                                        <span style="color: #FFA657;">const</span> <span style="color: #90a890;">{</span> outputFile <span style="color: #90a890;">}</span> = <span style="color: #FFA657;">await</span> <span style="color: #96a6c8;">runSubagentSession</span><span style="color: #90a890;">(</span>selectedAgentConfig.name, result.task, ctx.cwd<span style="color: #90a890;">)</span>;
                                        subagentTasks.<span style="color: #96a6c8;">push</span><span style="color: #90a890;">(</span><span style="color: #a2b6da;">{</span>
                                                agentName: selectedAgentConfig.name,
                                                sessionName,
                                                outputFile,
                                                task: result.task,
                                                startTime: <span style="color: #95a99f;">Date</span>.<span style="color: #96a6c8;">now</span><span style="color: #9cb6ad;">()</span>,
                                                ctx,
                                        <span style="color: #a2b6da;">}</span><span style="color: #90a890;">)</span>;
                                        <span style="color: #96a6c8;">updateSubagentStatus</span><span style="color: #90a890;">()</span>;

                                        <span style="color: #FFA657;">if</span> <span style="color: #90a890;">(</span>subagentTasks.length === 1<span style="color: #90a890;">)</span> <span style="color: #90a890;">{</span>
                                                <span style="color: #96a6c8;">setTimeout</span><span style="color: #a2b6da;">(</span>checkTaskStatus, STATUS_CHECK_INTERVAL_MS<span style="color: #a2b6da;">)</span>;
                                        <span style="color: #90a890;">}</span>

                                        ctx.ui.<span style="color: #96a6c8;">notify</span><span style="color: #90a890;">(</span><span style="color: #A1D08E;">`&#129302; Start agent @</span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">selectedAgentConfig.name</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;"> for background task: </span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">sessionName</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">`</span>, <span style="color: #A1D08E;">"success"</span><span style="color: #90a890;">)</span>;
                                        <span style="color: #FFA657;">return</span>;
                                <span style="color: #b0b0b3;">}</span> <span style="color: #FFA657;">catch</span> <span style="color: #b0b0b3;">(</span>err: <span style="color: #FFA657;">unknown</span><span style="color: #b0b0b3;">)</span> <span style="color: #b0b0b3;">{</span>
                                        <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">message</span> = err <span style="color: #FFA657;">instanceof</span> <span style="color: #95a99f;">Error</span> ? err.message : <span style="color: #A1D08E;">"Unknown error"</span>;
                                        ctx.ui.<span style="color: #96a6c8;">notify</span><span style="color: #90a890;">(</span><span style="color: #A1D08E;">`&#10007; Failed: </span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">message</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">`</span>, <span style="color: #A1D08E;">"error"</span><span style="color: #90a890;">)</span>;
                                        <span style="color: #FFA657;">return</span>;
                                <span style="color: #b0b0b3;">}</span>
                        <span style="color: #aebed8;">}</span>

                        activeAgent = selectedAgentConfig;
                        ctx.ui.<span style="color: #96a6c8;">notify</span><span style="color: #aebed8;">(</span><span style="color: #A1D08E;">`&#129302; Start agent @</span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">selectedAgentConfig.name</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">`</span>, <span style="color: #A1D08E;">"info"</span><span style="color: #aebed8;">)</span>;
                        pi.<span style="color: #96a6c8;">sendUserMessage</span><span style="color: #aebed8;">(</span>result.task, <span style="color: #b0b0b3;">{</span> deliverAs: <span style="color: #A1D08E;">"steer"</span> <span style="color: #b0b0b3;">}</span><span style="color: #aebed8;">)</span>;
                <span style="color: #97b098;">}</span>,
        <span style="color: #b0b1a3;">}</span><span style="color: #93a8c6;">)</span>;

        pi.<span style="color: #96a6c8;">on</span><span style="color: #93a8c6;">(</span><span style="color: #A1D08E;">"input"</span>, <span style="color: #FFA657;">async</span> <span style="color: #FFA657;">function</span> <span style="color: #b0b1a3;">(</span><span style="color: #f4f4ff;">event</span>, <span style="color: #f4f4ff;">ctx</span><span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
                <span style="color: #FFA657;">if</span> <span style="color: #97b098;">(</span>event.source === <span style="color: #A1D08E;">"extension"</span><span style="color: #97b098;">)</span> <span style="color: #97b098;">{</span>
                        <span style="color: #FFA657;">return</span> <span style="color: #aebed8;">{</span> action: <span style="color: #A1D08E;">"continue"</span> <span style="color: #aebed8;">}</span>;
                <span style="color: #97b098;">}</span>

                <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">match</span> = event.text.<span style="color: #96a6c8;">trim</span><span style="color: #97b098;">()</span>.<span style="color: #96a6c8;">match</span><span style="color: #97b098;">(</span>AGENT_NAME_PATTERN<span style="color: #97b098;">)</span>;
                <span style="color: #FFA657;">if</span> <span style="color: #97b098;">(</span>!match<span style="color: #97b098;">)</span> <span style="color: #97b098;">{</span>
                        <span style="color: #FFA657;">return</span> <span style="color: #aebed8;">{</span> action: <span style="color: #A1D08E;">"continue"</span> <span style="color: #aebed8;">}</span>;
                <span style="color: #97b098;">}</span>

                <span style="color: #FFA657;">const</span> <span style="color: #97b098;">[</span>, <span style="color: #f4f4ff;">agentName</span>, <span style="color: #f4f4ff;">task</span><span style="color: #97b098;">]</span> = match;
                <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">agents</span> = cachedAgents ?? <span style="color: #96a6c8;">discoverAgents</span><span style="color: #97b098;">(</span>ctx.cwd<span style="color: #97b098;">)</span>;
                <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">agent</span> = agents.<span style="color: #96a6c8;">find</span><span style="color: #97b098;">(</span><span style="color: #aebed8;">(</span>a<span style="color: #aebed8;">)</span> <span style="color: #FFA657;">=&gt;</span> a.name === agentName<span style="color: #97b098;">)</span>;

                <span style="color: #FFA657;">if</span> <span style="color: #97b098;">(</span>!agent<span style="color: #97b098;">)</span> <span style="color: #97b098;">{</span>
                        ctx.ui.<span style="color: #96a6c8;">notify</span><span style="color: #aebed8;">(</span><span style="color: #A1D08E;">`Unknown agent "@</span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">agentName</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">". Use /agents to list available agents.`</span>, <span style="color: #A1D08E;">"error"</span><span style="color: #aebed8;">)</span>;
                        <span style="color: #FFA657;">return</span> <span style="color: #aebed8;">{</span> action: <span style="color: #A1D08E;">"handled"</span> <span style="color: #aebed8;">}</span>;
                <span style="color: #97b098;">}</span>

                activeAgent = agent;
                ctx.ui.<span style="color: #96a6c8;">notify</span><span style="color: #97b098;">(</span><span style="color: #A1D08E;">`Activating agent @</span><span style="color: #FFA657;">${</span><span style="color: #d1d5db; background-color: #1D1F21;">agentName</span><span style="color: #FFA657;">}</span><span style="color: #A1D08E;">...`</span>, <span style="color: #A1D08E;">"info"</span><span style="color: #97b098;">)</span>;

                <span style="color: #FFA657;">return</span> <span style="color: #97b098;">{</span> action: <span style="color: #A1D08E;">"transform"</span>, text: task <span style="color: #97b098;">}</span>;
        <span style="color: #b0b1a3;">}</span><span style="color: #93a8c6;">)</span>;
<span style="color: #8c8c8c;">}</span>
</pre>
</div>
</div>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-llm.html">LLM</a> </div>]]></description>
  <category><![CDATA[LLM]]></category>
  <link>https://www.vandee.art/blog/2026-02-11-learn-agents-by-building-one-the-minimal-agent-pi.html</link>
  <guid>https://www.vandee.art/blog/2026-02-11-learn-agents-by-building-one-the-minimal-agent-pi.html</guid>
  <pubDate>Wed, 11 Feb 2026 11:58:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[My Agent Practice with OpenCode in Emacs]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org0d4516a">TL;DR</a></li>
<li><a href="#org7fbce71">Agent Skills</a>
<ul>
<li><a href="#org94791e5">简介</a></li>
<li><a href="#org2e86610">SKILL 解决了什么问题</a></li>
<li><a href="#org24a34de">编写 SKILL 是在干什么</a></li>
</ul>
</li>
<li><a href="#orgf7f0acf">My Agent Conf</a>
<ul>
<li><a href="#org1704abb">Core Rules</a></li>
<li><a href="#orgcfdf07a">Maintain a hierarchical codebase map</a></li>
<li><a href="#org8d7dac4">Prepared with clear purpose</a></li>
<li><a href="#org5d9c24e">Just files and loops, no more complicated</a></li>
<li><a href="#org8171771">Handoff when stucked</a></li>
<li><a href="#orgef986f1">Maintain memory</a></li>
<li><a href="#orgd89f641">Maintain useful patterns</a></li>
<li><a href="#org255624f">Maintain code quality and style</a></li>
</ul>
</li>
<li><a href="#orgee8b6d7">OpenCode in Emacs</a></li>
<li><a href="#org545b89e">Bubblewrap Sandbox</a></li>
</ul>
</div>
</nav>
<div id="outline-container-org0d4516a" class="outline-2">
<h2 id="org0d4516a">TL;DR</h2>
<div class="outline-text-2" id="text-org0d4516a">
<p>
虽然我不喜欢 vibe coding，但是 SKILL 是很值得学习的。
</p>

<p>
一个好的 SKILL 里可以学到工程师的经验、逻辑，以及精炼的 prompt。
</p>

<p>
Tool 是 LLM 的基础工具，agent 框架是操作系统，MCP 是 USB 接口，SKILL 是专家技能文档。
</p>
</div>
</div>
<div id="outline-container-org7fbce71" class="outline-2">
<h2 id="org7fbce71">Agent Skills</h2>
<div class="outline-text-2" id="text-org7fbce71">
</div>
<div id="outline-container-org94791e5" class="outline-3">
<h3 id="org94791e5">简介</h3>
<div class="outline-text-3" id="text-org94791e5">
<p>
<a href="https://github.com/agentskills/agentskills">agentskills/agentskills</a> 是前段时间 <a href="https://www.linuxfoundation.org/press/linux-foundation-announces-the-formation-of-the-agentic-ai-foundation">Linux Foundation Announces the Formation of the Agentic AI Foundation (AAIF)</a> Claude 开源的。
</p>

<p>
在这之前 SKILL 就已经出现了。
</p>

<blockquote>
<p>
Agent Skills are a simple, open format for giving agents new capabilities and expertise.
</p>

<p>
Skills are folders of instructions, scripts, and resources that agents can discover and use to perform better at specific tasks. Write once, use everywhere.
</p>

<p>
via: <a href="https://github.com/agentskills/agentskills">https://github.com/agentskills/agentskills</a>
</p>
</blockquote>

<p>
SKILL 是一个本地文件夹，里面是 SKILL.md、scripts、references、templates，提供 agent 一个专业领域的专业技能。
</p>

<p>
这样说，听起来还是有点抽象。我也不想展开说明 SKILL 的概念，自己上手是理解它最好的方式。
</p>

<p>
<a href="https://www.vandee.art/blog/2025-11-04-minimal-C-reimplementation-of-claude-skills.html">用 C 极简复现 Claude Skills</a> 里是我之前用 C 实现的简化版的 SKILL 逻辑。
</p>

<p>
这两个网站里有很多 SKILL 可以探索学习：<a href="https://skillsmp.com/">https://skillsmp.com/</a>， <a href="https://skills.sh/">https://skills.sh/</a>
</p>
</div>
</div>
<div id="outline-container-org2e86610" class="outline-3">
<h3 id="org2e86610">SKILL 解决了什么问题</h3>
<div class="outline-text-3" id="text-org2e86610">
<p>
MCP 的工具信息会占用大量的 context 窗口，SKILL 很好的避免了这个问题。
</p>

<p>
在 <code>SKILL.md</code> YAML 部分的 description 是对这个 SKILL 的介绍。当 agent 运行的时候，只会预加载这部分内容，当 agent 判断需要使用到的时候，才会加载完整的 <code>SKILL.md</code> 。
</p>

<p>
如果说 MCP 是通用工具，那么 SKILL 就是可以高度自定义的 local tool。
</p>
</div>
</div>
<div id="outline-container-org24a34de" class="outline-3">
<h3 id="org24a34de">编写 SKILL 是在干什么</h3>
<div class="outline-text-3" id="text-org24a34de">
<p>
当遇到一种类型的问题时，把处理它们的方式规范性的固定下来，它就是一个 SKILL 了。
</p>

<p>
能够把这个问题以及解决问题的办法完整的抽象成一个 SKILL，也变相的说明了自己已经掌握了一种处理问题的方法。
</p>

<p>
所以，我虽然不喜欢 vibe coding，但是很喜欢看 SKILL。
</p>

<p>
一个好的 SKILL 里，可以看到优秀工程师对问题处理、抽象的能力。更不用说里面涵盖了 prompt 提示词工程发展到现在的经验和技巧，这么好的学习资源，在以往是付费都很难看到的。
</p>

<p>
大厂放出来的官方 SKILL 那都是门面啊，还是有很多干货的。
</p>
</div>
</div>
</div>
<div id="outline-container-orgf7f0acf" class="outline-2">
<h2 id="orgf7f0acf">My Agent Conf</h2>
<div class="outline-text-2" id="text-orgf7f0acf">
<p>
下面的每个标题就是我觉得在和 agent 合作的时候比较值得关注的地方，也是我现阶段理解到的一些实践原则。
</p>

<p>
从 Claude Code 转到 OpenCode，感觉一切良好。
</p>

<p>
我不是程序员，也不需要高质量的代码。我更喜欢 OpenCode 的一些设计理念，Claude Code 限制太多，也公开表示不让我们用，那就不用好了。
</p>

<p>
在 OpenCode 里 vibe 一些小玩意还是很够用的。
</p>

<p>
我虽然不喜欢 vibe，但是需要实现一些原型假设的时候，vibe 还是极好的。
</p>

<p>
再一个，不了解 vibe 又怎么能说自己不喜欢呢？
</p>
</div>
<div id="outline-container-org1704abb" class="outline-3">
<h3 id="org1704abb">Core Rules</h3>
<div class="outline-text-3" id="text-org1704abb">
<p>
Just files and loops!
</p>

<p>
Provide specific <code>Best Practices</code>, <code>Pros &amp; Cons</code>, <code>Red Flags</code>
</p>

<p>
Keep it simple!
</p>
</div>
</div>
<div id="outline-container-orgcfdf07a" class="outline-3">
<h3 id="orgcfdf07a">Maintain a hierarchical codebase map</h3>
<div class="outline-text-3" id="text-orgcfdf07a">
<blockquote>
<p>
Your best engineers don’t grep randomly. They have a mental map:
</p>
<ul class="org-ul">
<li>What each folder owns</li>
<li>What breaks if you touch it wrong</li>
<li>Where the real logic lives</li>
</ul>

<p>
via: <a href="https://www.railly.dev/blog/intent-layer/">https://www.railly.dev/blog/intent-layer/</a>
</p>
</blockquote>

<p>
SKILL: intent-layer <a href="https://github.com/crafter-station/skills">https://github.com/crafter-station/skills</a>
</p>

<p>
如果每次新的 session 都让 agent 探索一次项目代码，又不方便，又浪费时间。
</p>

<p>
给项目代码提供一个持续更新的 codebase map 还是很必要的。
</p>

<p>
这让 agent 在每次对话的时候在 context 里包含项目的基本信息和架构。
</p>

<p>
also: <a href="https://github.com/affaan-m/everything-claude-code/blob/main/commands/update-codemaps.md">https://github.com/affaan-m/everything-claude-code/blob/main/commands/update-codemaps.md</a>
</p>
</div>
</div>
<div id="outline-container-org8d7dac4" class="outline-3">
<h3 id="org8d7dac4">Prepared with clear purpose</h3>
<div class="outline-text-3" id="text-org8d7dac4">
<p>
SKILL: Onboard <a href="https://github.com/ChrisWiles/claude-code-showcase/blob/main/.claude/commands/onboard.md">https://github.com/ChrisWiles/claude-code-showcase/blob/main/.claude/commands/onboard.md</a>
</p>

<p>
在开始具体的任务之前，给予 agent 明确的目标以及要涉及到的具体文件。
</p>

<p>
明确清晰的描述自己的需求非常重要。DO and DONOT.
</p>

<p>
对于大部分模型，英文 prompt 效果比中文好。
</p>
</div>
</div>
<div id="outline-container-org5d9c24e" class="outline-3">
<h3 id="org5d9c24e">Just files and loops, no more complicated</h3>
<div class="outline-text-3" id="text-org5d9c24e">
<p>
SKILL: Planning with Files <a href="https://github.com/OthmanAdi/planning-with-files">https://github.com/OthmanAdi/planning-with-files</a>
</p>

<p>
在 agent 执行具体任务的时候，planning with files 这个框架的设计很值得学习。
</p>

<p>
它用三个文件记录和规划 agent 的 task plan，非常简洁，效果拔群。
</p>

<p>
结合我在 opencode 里的使用，我加上了 memory 部分：
</p>

<div class="org-src-container">
<pre class="src src-nil">1. Use the `session-info` tool to retrieve the current conversation's [session-title]
2. Run `date +%Y%m%d-%H%M%S` command to get the [YYYYMMDD-HHMMSS timestamp]
   Create the `session folder`: `mkdir -p $HOME/.MemoryMD/$(basename $(git rev-parse --show-toplevel))/[YYYYMMDD-HHMMSS timestamp]-[session-title]`
3. All generated markdown files should be created in that `session folder`.
</pre>
</div>

<p>
没有选择在项目根目录下创建是为了多个 session 和 git-worktree 并行场景下，方便共享。
</p>

<p>
session-info 是一个很简单的 tool，在 OpenCode 里用来获取当前 session 信息，生成上面提到的文件夹：
</p>

<p>
<code>tools/session-info.ts</code> :
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #FFA657;">import</span> <span style="color: #8c8c8c;">{</span> tool <span style="color: #8c8c8c;">}</span> from <span style="color: #A1D08E;">"@opencode-ai/plugin"</span>
<span style="color: #FFA657;">import</span> <span style="color: #8c8c8c;">{</span> execSync <span style="color: #8c8c8c;">}</span> from <span style="color: #A1D08E;">"child_process"</span>
<span style="color: #FFA657;">import</span> <span style="color: #8c8c8c;">{</span> homedir <span style="color: #8c8c8c;">}</span> from <span style="color: #A1D08E;">"os"</span>

<span style="color: #FFA657;">export</span> <span style="color: #FFA657;">default</span> tool<span style="color: #8c8c8c;">(</span><span style="color: #93a8c6;">{</span>
  description: <span style="color: #A1D08E;">"Get current session information including title"</span>,
  args: <span style="color: #b0b1a3;">{}</span>,
  <span style="color: #FFA657;">async</span> execute<span style="color: #b0b1a3;">(</span>args, context<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
    <span style="color: #FFA657;">const</span> <span style="color: #97b098;">{</span> sessionID, agent <span style="color: #97b098;">}</span> = context

    <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">sessionDir</span> = <span style="color: #A1D08E;">`${homedir()}/.local/share/opencode/storage/session`</span>

    <span style="color: #FFA657;">try</span> <span style="color: #97b098;">{</span>
      <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">result</span> = execSync<span style="color: #aebed8;">(</span><span style="color: #A1D08E;">`find ${sessionDir} -name "${sessionID}.json" 2&gt;/dev/null | head -1`</span>, <span style="color: #b0b0b3;">{</span> encoding: <span style="color: #A1D08E;">"utf-8"</span> <span style="color: #b0b0b3;">}</span><span style="color: #aebed8;">)</span>

      <span style="color: #FFA657;">if</span> <span style="color: #aebed8;">(</span>!result.trim<span style="color: #b0b0b3;">()</span><span style="color: #aebed8;">)</span> <span style="color: #aebed8;">{</span>
        <span style="color: #FFA657;">throw</span> <span style="color: #FFA657;">new</span> <span style="color: #95a99f;">Error</span><span style="color: #b0b0b3;">(</span><span style="color: #A1D08E;">"Session file not found"</span><span style="color: #b0b0b3;">)</span>
      <span style="color: #aebed8;">}</span>

      <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">sessionFile</span> = result.trim<span style="color: #aebed8;">()</span>
      <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">sessionData</span> = JSON.parse<span style="color: #aebed8;">(</span>require<span style="color: #b0b0b3;">(</span><span style="color: #A1D08E;">"fs"</span><span style="color: #b0b0b3;">)</span>.readFileSync<span style="color: #b0b0b3;">(</span>sessionFile, <span style="color: #A1D08E;">"utf-8"</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span>

      <span style="color: #FFA657;">return</span> JSON.stringify<span style="color: #aebed8;">(</span><span style="color: #b0b0b3;">{</span>
        sessionID,
        agent,
        title: sessionData.title || <span style="color: #95a99f;">null</span>,
        directory: sessionData.directory || <span style="color: #95a99f;">null</span>,
        time: sessionData.time || <span style="color: #95a99f;">null</span>,
      <span style="color: #b0b0b3;">}</span>, <span style="color: #95a99f;">null</span>, 2<span style="color: #aebed8;">)</span>
    <span style="color: #97b098;">}</span> <span style="color: #FFA657;">catch</span> <span style="color: #97b098;">(</span>error<span style="color: #97b098;">)</span> <span style="color: #97b098;">{</span>
      <span style="color: #FFA657;">return</span> JSON.stringify<span style="color: #aebed8;">(</span><span style="color: #b0b0b3;">{</span> error: error.message, sessionID, agent <span style="color: #b0b0b3;">}</span>, <span style="color: #95a99f;">null</span>, 2<span style="color: #aebed8;">)</span>
    <span style="color: #97b098;">}</span>
  <span style="color: #b0b1a3;">}</span>,
<span style="color: #93a8c6;">}</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org8171771" class="outline-3">
<h3 id="org8171771">Handoff when stucked</h3>
<div class="outline-text-3" id="text-org8171771">
<p>
SKILL: handoff <a href="https://github.com/mitsuhiko/agent-stuff/blob/main/commands/handoff.md">https://github.com/mitsuhiko/agent-stuff/blob/main/commands/handoff.md</a>
</p>

<p>
有时候 agent 会卡住，陷入死循环，果断 handoff 重开，不用浪费时间。
</p>
</div>
</div>
<div id="outline-container-orgef986f1" class="outline-3">
<h3 id="orgef986f1">Maintain memory</h3>
<div class="outline-text-3" id="text-orgef986f1">
<p>
我把 planning-with-files 的文档和 Handoff 的文档当作项目的 memory，设计了一个简单的 SKILL 来根据关键字搜索：
</p>

<p>
现在有许多针对 agent 的 memory 项目，但是我感觉这个概念本身也才刚出来，今年应该有更成熟的实现。
</p>

<p>
暂时就用这个简单方案过渡一下。
</p>

<div class="org-src-container">
<pre class="src src-nil">---
name: memory-md
description: Memory management system for storing and retrieving conversation history and context.When user ask anything about project's memory, automatically use this skill.
---

Memory management system for storing and retrieving conversation history and context.


## Parse guide

Parse [quest] as follows:

1. **List command**: If [quest] starts with `-l` or `--list`
   - List recent memory files

2. **Search command**: If [quest] starts with `-s` or `--search`
   - All remaining arguments are search keywords (comma-separated or space-separated)
   - Example: `-s apple,banana` or `-s apple banana` → keywords: ["apple", "banana"]

3. **Default search**: If no flags provided, treat entire [quest] as search keywords
   - Example: `authentication jwt` → keywords: ["authentication", "jwt"]

4. **No results**: If no keywords provided in [quest] after parsing
   - Ask user: "What keywords are you searching for?"

## Memory File Location

Memory files are stored in `$HOME/.MemoryMD/` with the following structure:

```
$HOME/.MemoryMD/
├── [project-name]/                     # Project folders
│   ├── YYYYMMDD-HHMMSS-[session-title]/  # Session folders
│   │   ├── task_plan.md                # Task planning document
│   │   ├── findings.md                 # Research findings
│   │   └── progress.md                 # Progress tracking
└── handoffs/                           # Handoff summaries
    └── YYYYMMDD-HHMMSS-[slug].md      # Session handoff files
```

Examples:
- `agent-conf/20250120-143025-implement-auth/` - Session folder
- `handoffs/20250120-143025-fix-issue-42.md` - Handoff file

## Commands

### --list or -l

List the 20 most recent memory folders/files, sorted by timestamp (newest first).

**Bash command:**
```bash
memory_dir="$HOME/.MemoryMD"

# List session folders grouped by project (sorted newest first)
find "$memory_dir" -maxdepth 2 -type d -name "????????-??????-*" | sort -r | head -20 | awk -F/ '{
    project = $(NF-1)
    foldername = $NF
    timestamp = substr(foldername, 1, 15)
    title = substr(foldername, 17)
    if (project != prev_project) {
        if (prev_project != "") print ""
        print "**" project "**"
        prev_project = project
    }
    print "  [" timestamp "] " title
}'

# List handoff files (sorted newest first)
echo ""
echo "Recent handoffs:"
find "$memory_dir/handoffs" -maxdepth 1 -type f -name "*.md" | sort -r | head -20 | while read file; do
    filename=$(basename "$file")
    title=${filename#*-}
    title=${title%.md}
    echo "$title - $filename"
done
```

**Output format:**
```
**agent-conf:**
  [20250120-143025] implement-auth
  [20250119-091530] fix-issue-42

**another-project:**
  [20250118-1530] api-handler

Recent handoffs:
  fix-issue-42 - 20250120-143025-fix-issue-42.md
  implement-auth - 20250119-091530-implement-auth.md
```

### --search or -s

Search memory files for keywords in both Chinese and English.

Use your Glob and Grep tools first.

First perform exact keyword search. If no results found, search for related similar keywords.

If still no results after all searches, ask user: "What keywords are you searching for?"

**Output Examples:**

```md
Search query: [keywords]

## Found in: agent-conf/20250120-143025-implement-auth/task_plan.md
[summary of your findings]

## Found in: agent-conf/20250120-143025-implement-auth/findings.md
[summary of your findings]
```

Bash commands below serve as auxiliary reference:

**Bash command:**
```bash
memory_dir="$HOME/.MemoryMD"

# Search for keywords in all markdown files
rg -i -t md "$keywords" "$memory_dir" --follow

# Alternative: Search with context (2 lines before and after matches)
rg -i -C 2 -t md "$keywords" "$memory_dir" --follow
```

**Options:**
- `-i`: Case-insensitive search
- `-C N`: Show N lines of context before and after matches
- `-t md`: Search only markdown files
- `--follow`: Follow symbolic links
</pre>
</div>
</div>
</div>
<div id="outline-container-orgd89f641" class="outline-3">
<h3 id="orgd89f641">Maintain useful patterns</h3>
<div class="outline-text-3" id="text-orgd89f641">
<p>
SKILL: <a href="https://github.com/affaan-m/everything-claude-code/blob/main/commands/learn.md">https://github.com/affaan-m/everything-claude-code/blob/main/commands/learn.md</a>
</p>

<p>
在解决实际的代码问题的时候，有许多方案是可以固定下来复用的。
</p>

<p>
根据这个 SKILL，我设计了一个 learned skill。这个 SKILL 实际上是一个索引，在 description 部分加上 learned 的描述信息。
</p>

<p>
learn skill 会根据当前会话的 session 固定下来有价值的 pattern，生成 skill，自动添加到 learned skill 的 description 部分，这样 agent 在加载的时候就可以知道有哪些 learned skill 了。
</p>

<p>
不选择把 learned skill 生成单独的 skill 文件夹是因为它们的普遍性不强，也经常要更新和修改，不能完全当作 SKILL 来设计。
</p>

<p>
Learn skill：
</p>

<div class="org-src-container">
<pre class="src src-nil">---
name: learn
description: &gt;
  Extract reusable patterns from sessions and create dynamic skills. Use when you need to save learned patterns, error resolutions, debugging techniques, or project-specific knowledge to ~/.config/opencode/skill/learned/.
  Trigger, User asks to extract learning, save patterns, or run /learn command.
  All learned skills in `~/.config/opencode/skill/learned/` are automatically discoverable
  `~/.config/opencode/skill/learned/SKILL.md` is the index off all learned skills
---

# Learn Skill

Dynamically extract and store reusable patterns as skills.

## Quick Start

When user wants to extract learning from current session:

1. Review session context for extractable patterns
2. Identify the most valuable/reusable insight,list them
3. Ask user for confirmation before creating skill file
4. Create `~/.config/opencode/skill/learned/[skill-name].md` - Use [templates/learned-skill-template.md](templates/learned-skill-template.md) as reference
5. Update `~/.config/opencode/skill/learned/SKILL.md` to include the new skill - Use  [templates/SKILL.md](templates/SKILL.md) as reference
6. Run `ls -1 ~/.config/opencode/skill/learned/*.md 2&gt;/dev/null | grep -v SKILL.md | wc -l`, update the total skills number.

## What to Extract

### 1. Error Resolution Patterns
- What error occurred?
- What was the root cause?
- What fixed it?
- Is this reusable for similar errors?

### 2. Debugging Techniques
- Non-obvious debugging steps
- Tool combinations that worked
- Diagnostic patterns

### 3. Workarounds
- Library quirks
- API limitations
- Version-specific fixes

### 4. Project-Specific Patterns
- Codebase conventions discovered
- Architecture decisions made
- Integration patterns

## Quality Guidelines

### DO Extract:
- Error patterns that occur more than once
- Non-obvious debugging techniques
- Workarounds for library quirks
- Architecture decisions and their rationale
- Integration patterns across services/tools

### DO NOT Extract:
- Trivial fixes (typos, simple syntax errors)
- One-time issues (specific API outages, temporary glitches)
- Obvious solutions (standard library usage without special context)
- Information already well-documented elsewhere

### Tips for Quality Skills
1. **Be Specific**: Narrow trigger conditions = better matching
2. **Include Examples**: Code snippets make patterns actionable
3. **Document Why**: Explain the problem, not just the solution
4. **Keep Focused**: One pattern per skill
5. **Use Descriptive Names**: Names should indicate what the skill solves


## Skill File Format

### Individual Skill Files

Use the template file [templates/learned-skill-template.md](templates/learned-skill-template.md) as the base for all learned skills.

Key sections:
- **Frontmatter**: name and description (critical for skill discovery)
- **Problem**: What specific issue this solves
- **Solution**: Actionable steps to implement
- **Example**: Code snippet if applicable
- **When to Use**: Trigger conditions for activation
- **Related Patterns**: Cross-references to other skills

### SKILL.md

Use the template file [templates/SKILL.md](templates/SKILL.md) as the base for maintaining the learned skills index.

Purpose:
- Provides a categorized listing of all learned skills
- Enables easy browsing and discovery of patterns
- Tracks skill count and update timestamp

Update SKILL.md whenever saving a new skill.

## Extraction Process

### Step 1: Review Session Context

Use `session-info` tool to get session details if needed.

Use `memory-md` skill to find relevant memories.

Look for:
- Repeated error fixes
- Non-obvious solutions
- Workarounds discovered
- Best practices learned

### Step 2: Identify Pattern

Ask yourself:
- Is this reusable? (Will save time in future sessions)
- Is this non-trivial? (Not typos or simple syntax errors)
- Is this generalizable? (Not one-time issues)

Prioritize patterns that:
- Solve common problems
- Apply across multiple projects
- Document non-obvious solutions

### Step 3: Draft Skill

Use the skill file format above.

**Naming Convention:**
- Use kebab-case for skill names
- Make names descriptive but concise
- Example: `async-error-handling-pattern`, `docker-volume-permission-fix`

**Frontmatter:**
```yaml
---
name: [skill-name]
description: Use when [trigger conditions]. Covers [specific problem/solution].
---
```

The description is critical - it's what helps the skill system know when to load this skill.

### Step 4: Validate

Before presenting to user:
- Check that the skill has clear trigger conditions
- Ensure the solution is actionable
- Verify code examples are correct
- Confirm the pattern is truly reusable

### Step 5: Present and Save

Show the user:
1. Pattern name
2. Brief description of what was extracted
3. Why it's valuable

Ask: "Save this pattern to learned skills? (y/n)"

If yes, save to `~/.config/opencode/skill/learned/[skill-name].md`

### Step 6: Update `learned/SKILL.md`

1. Update the description of the new learned skill.Append this part: [name of learned skill 1] - [description of learned skill 1]

example YAML of `learned/SKILL.md`:

```md
---
name: learned
description: &gt;
  learned skill is a collection of learned skill user create.It's a index of all learned skills.
  We have these learned skill below:
  [name of learned skill 1] - [description of learned skill 1]
  [name of learned skill 1] - [description of learned skill 2]
---
```

2. Update the new skill to the index section.

## Common Use Cases

### User runs /learn command
```
User: /learn
```
1. Review session for extractable patterns
2. Present candidate patterns to user
3. Ask which to save
4. Save selected patterns

### User asks to extract specific topic
```
User: Extract what we learned about async error handling
```
1. Search session context for async/error patterns
2. Compile findings
3. Generate skill file
4. Present and save

### User wants to capture architecture decision
```
User: Save the event sourcing pattern we used
```
1. Extract the pattern details
2. Document rationale and trade-offs
3. Create skill with example code
4. Present and save

## Integration with Other Skills

This skill works well with:
- **memory-md**: For accessing related patterns from past sessions
- **skill-creator**: For creating more complex, bundled skills
</pre>
</div>

<p>
Learnd skill：
</p>

<div class="org-src-container">
<pre class="src src-nil">---
name: learned
description: &gt;
  learned skill is a collection of learned skill user create.It's a index of all learned skills.
  We have these learned skill below:
  [name of learned skill 1] - [description of learned skill 1]
  [name of learned skill 1] - [description of learned skill 2]
---

# Learned Skills Index

You can read the skill file to load the skill you need.

Treat these skill file below as `learned skill`'s references.

## Error Patterns
- [skill-1.md](skill-1.md)
- [skill-2.md](skill-2.md)

## Debugging Techniques
- [skill-3.md](skill-3.md)

## Workarounds
- [skill-4.md](skill-4.md)

## Project-Specific
- [skill-5.md](skill-5.md)

# Statistics
Total skills: [count]
Last updated: [date]
</pre>
</div>
</div>
</div>
<div id="outline-container-org255624f" class="outline-3">
<h3 id="org255624f">Maintain code quality and style</h3>
<div class="outline-text-3" id="text-org255624f">
<p>
SKILL: code-simplifier: <a href="https://github.com/anthropics/claude-plugins-official/blob/main/plugins/code-simplifier/agents/code-simplifier.md">https://github.com/anthropics/claude-plugins-official/blob/main/plugins/code-simplifier/agents/code-simplifier.md</a>
</p>

<p>
LLM 在编写代码的时候，特别是大量代码，复杂代码的时候，很容易犯病，编写重复性的代码，这是因为上下文多了，准确性下降。
</p>

<p>
在每次 agent 写完代码之后进行代码审查和代码优化。
</p>

<p>
在 prompt 上，亲测加上：这是别人的代码，效果会更好🤣。LLM 拍马屁的概率大幅下降。
</p>
</div>
</div>
</div>
<div id="outline-container-orgee8b6d7" class="outline-2">
<h2 id="orgee8b6d7">OpenCode in Emacs</h2>
<div class="outline-text-2" id="text-orgee8b6d7">
<p>
在 Emacs 里现在和 OpenCode 交互最方便的就是 <a href="https://github.com/xenodium/agent-shell">agent-shell</a> 了。
</p>

<p>
在终端里用 OpenCode 最不方便的就是不能直接选择文本，agent-shell 解决了这个问题:
</p>

<p>
<code>agent-shell-send-dwim</code> 、 <code>agent-shell-send-file</code> 、 <code>agent-shell-send-region</code> 、 <code>agent-shell-insert-file</code> 这几个原生的指令配置好快捷键就 OK 了。
</p>

<p>
slash command 通过 Emacs 的自动补全，基本是无感切换。
</p>

<p>
不足的地方就是，agent-shell 不会列出 OpenCode 的 subagent。所以我加了一些补丁来显示 subagent。
</p>

<p>
由于 @ 在 agent-shell 里默认用来 @file，所以用 @@ 来 @ subagent，并支持了自动补全。Vim 的 normal 模式下按 @ 会选择 primary agent。
</p>

<p>
具体代码：
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">use-package</span> agent-shell
  <span style="color: #79C0FF;">:after</span> evil
  <span style="color: #79C0FF;">:config</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">setq</span> agent-shell-opencode-authentication
        <span style="color: #b0b1a3;">(</span>agent-shell-opencode-make-authentication <span style="color: #79C0FF;">:none</span> t<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>
  <span style="color: #787878;">;; </span><span style="color: #787878;">disable creating transcript file
</span>  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">setq</span> agent-shell-transcript-file-path-function nil<span style="color: #93a8c6;">)</span>

  <span style="color: #787878;">;; </span><span style="color: #787878;">Evil state-specific RET behavior: insert mode = newline, normal mode = send
</span>  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">evil-define-key</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">insert</span> agent-shell-mode-map <span style="color: #b0b1a3;">(</span>kbd <span style="color: #A1D08E;">"RET"</span><span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">#'</span><span style="color: #95a99f;">newline</span><span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">evil-define-key</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">normal</span> agent-shell-mode-map <span style="color: #b0b1a3;">(</span>kbd <span style="color: #A1D08E;">"RET"</span><span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">#'</span><span style="color: #95a99f;">comint-send-input</span><span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">evil-define-key</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">normal</span> agent-shell-mode-map <span style="color: #b0b1a3;">(</span>kbd <span style="color: #A1D08E;">"@"</span><span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">#'</span><span style="color: #95a99f;">agent-shell-set-session-mode</span><span style="color: #93a8c6;">)</span>

  <span style="color: #787878;">;; </span><span style="color: #787878;">Configure *agent-shell-diff* buffers to start in Emacs state
</span>  <span style="color: #93a8c6;">(</span>add-hook <span style="color: #FFA657;">'</span><span style="color: #95a99f;">diff-mode-hook</span>
            <span style="color: #b0b1a3;">(</span><span style="color: #FFA657;">lambda</span> <span style="color: #97b098;">()</span>
              <span style="color: #97b098;">(</span><span style="color: #FFA657;">when</span> <span style="color: #aebed8;">(</span>string-match-p <span style="color: #A1D08E;">"</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E;">*agent-shell-diff</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E;">*"</span> <span style="color: #b0b0b3;">(</span>buffer-name<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span>
                <span style="color: #aebed8;">(</span>evil-emacs-state<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #787878;">;;; </span><span style="color: #787878;">agent-shell OpenCode Subagent Support
</span><span style="color: #787878;">;;; </span><span style="color: #787878;">Shows available subagents and enables @@subagent invocation syntax
</span><span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">defvar</span> <span style="color: #f4f4ff;">agent-shell-opencode--subagents</span> nil
  <span style="color: #787878;">"Cached list of available subagents."</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">defun</span> <span style="color: #96a6c8;">agent-shell-opencode--get-subagent-description</span> <span style="color: #93a8c6;">(</span>agent-name<span style="color: #93a8c6;">)</span>
  <span style="color: #787878;">"Get description for subagent AGENT-NAME from its config file."</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">let*</span> <span style="color: #b0b1a3;">(</span><span style="color: #97b098;">(</span>config-file <span style="color: #aebed8;">(</span>expand-file-name <span style="color: #b0b0b3;">(</span>format <span style="color: #A1D08E;">"%s.md"</span> agent-name<span style="color: #b0b0b3;">)</span>
                                        <span style="color: #A1D08E;">"~/.config/opencode/agents/"</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
         <span style="color: #97b098;">(</span>description
          <span style="color: #aebed8;">(</span><span style="color: #FFA657;">when</span> <span style="color: #b0b0b3;">(</span>file-exists-p config-file<span style="color: #b0b0b3;">)</span>
            <span style="color: #b0b0b3;">(</span><span style="color: #FFA657;">with-temp-buffer</span>
              <span style="color: #90a890;">(</span>insert-file-contents config-file<span style="color: #90a890;">)</span>
              <span style="color: #90a890;">(</span>goto-char <span style="color: #a2b6da;">(</span>point-min<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>
              <span style="color: #90a890;">(</span><span style="color: #FFA657;">when</span> <span style="color: #a2b6da;">(</span>re-search-forward <span style="color: #A1D08E;">"^description: </span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">(</span><span style="color: #A1D08E;">.*</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">)</span><span style="color: #A1D08E;">$"</span> nil t<span style="color: #a2b6da;">)</span>
                <span style="color: #a2b6da;">(</span>match-string 1<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #FFA657;">or</span> description <span style="color: #A1D08E;">"Subagent"</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">defun</span> <span style="color: #96a6c8;">agent-shell-opencode--list-subagents</span> <span style="color: #93a8c6;">()</span>
  <span style="color: #787878;">"List all subagents using opencode agent list command.
Returns list of agent alists with :id, :name, :description."</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">let*</span> <span style="color: #b0b1a3;">(</span><span style="color: #97b098;">(</span>output <span style="color: #aebed8;">(</span>shell-command-to-string <span style="color: #A1D08E;">"opencode agent list"</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
         <span style="color: #97b098;">(</span>lines <span style="color: #aebed8;">(</span>split-string output <span style="color: #A1D08E;">"</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">n</span><span style="color: #A1D08E;">"</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
         agents<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #FFA657;">dolist</span> <span style="color: #97b098;">(</span>line lines<span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span><span style="color: #FFA657;">when</span> <span style="color: #aebed8;">(</span>string-match <span style="color: #A1D08E;">"^</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">(</span><span style="color: #A1D08E;">[</span><span style="color: #A1D08E;">^</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">s</span><span style="color: #A1D08E;">]+</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">)</span><span style="color: #A1D08E;"> (subagent)$"</span> line<span style="color: #aebed8;">)</span>
        <span style="color: #aebed8;">(</span><span style="color: #FFA657;">let*</span> <span style="color: #b0b0b3;">(</span><span style="color: #90a890;">(</span>name <span style="color: #a2b6da;">(</span>match-string 1 line<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>
               <span style="color: #90a890;">(</span>description <span style="color: #a2b6da;">(</span>agent-shell-opencode--get-subagent-description name<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span>
          <span style="color: #b0b0b3;">(</span><span style="color: #FFA657;">push</span> <span style="color: #FFA657;">`</span><span style="color: #90a890;">(</span><span style="color: #a2b6da;">(</span><span style="color: #79C0FF;">:id</span> . ,name<span style="color: #a2b6da;">)</span>
                  <span style="color: #a2b6da;">(</span><span style="color: #79C0FF;">:name</span> . ,name<span style="color: #a2b6da;">)</span>
                  <span style="color: #a2b6da;">(</span><span style="color: #79C0FF;">:description</span> . ,description<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>
                agents<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span>nreverse agents<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">defun</span> <span style="color: #96a6c8;">agent-shell-opencode--format-subagents</span> <span style="color: #93a8c6;">(</span>subagents<span style="color: #93a8c6;">)</span>
  <span style="color: #787878;">"Format SUBAGENTS list for display."</span>
  <span style="color: #93a8c6;">(</span>mapconcat
   <span style="color: #b0b1a3;">(</span><span style="color: #FFA657;">lambda</span> <span style="color: #97b098;">(</span>agent<span style="color: #97b098;">)</span>
     <span style="color: #97b098;">(</span><span style="color: #FFA657;">let</span> <span style="color: #aebed8;">(</span><span style="color: #b0b0b3;">(</span>name <span style="color: #90a890;">(</span>map-elt agent <span style="color: #79C0FF;">:name</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span>
           <span style="color: #b0b0b3;">(</span>desc <span style="color: #90a890;">(</span>map-elt agent <span style="color: #79C0FF;">:description</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span>
       <span style="color: #aebed8;">(</span>format <span style="color: #A1D08E;">"@@%s - %s"</span> <span style="color: #b0b0b3;">(</span>propertize name <span style="color: #FFA657;">'</span><span style="color: #95a99f;">font-lock-face</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">font-lock-keyword-face</span><span style="color: #b0b0b3;">)</span> desc<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
   subagents
   <span style="color: #A1D08E;">"</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">n</span><span style="color: #A1D08E;">"</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">defun</span> <span style="color: #96a6c8;">agent-shell-opencode--show-subagents-fragment</span> <span style="color: #93a8c6;">()</span>
  <span style="color: #787878;">"Add subagents UI fragment after available modes fragment."</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">when-let</span> <span style="color: #b0b1a3;">(</span><span style="color: #97b098;">(</span>subagents agent-shell-opencode--subagents<span style="color: #97b098;">)</span>
             <span style="color: #97b098;">(</span><span style="color: #aebed8;">(</span>&gt; <span style="color: #b0b0b3;">(</span>length subagents<span style="color: #b0b0b3;">)</span> 0<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
             <span style="color: #97b098;">(</span><span style="color: #aebed8;">(</span>fboundp <span style="color: #FFA657;">'</span><span style="color: #95a99f;">agent-shell--update-fragment</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
             <span style="color: #97b098;">(</span>state agent-shell--state<span style="color: #97b098;">)</span>
             <span style="color: #97b098;">(</span>request-count <span style="color: #aebed8;">(</span>map-elt state <span style="color: #79C0FF;">:request-count</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
             <span style="color: #97b098;">(</span>buffer <span style="color: #aebed8;">(</span>map-elt state <span style="color: #79C0FF;">:buffer</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #FFA657;">with-current-buffer</span> buffer
      <span style="color: #97b098;">(</span><span style="color: #FFA657;">save-excursion</span>
        <span style="color: #aebed8;">(</span>goto-char <span style="color: #b0b0b3;">(</span>point-max<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span>
        <span style="color: #aebed8;">(</span><span style="color: #FFA657;">when</span> <span style="color: #b0b0b3;">(</span>text-property-search-backward
               <span style="color: #FFA657;">'</span><span style="color: #95a99f;">agent-shell-ui-state</span> nil
               <span style="color: #90a890;">(</span><span style="color: #FFA657;">lambda</span> <span style="color: #a2b6da;">(</span>_ prop-state<span style="color: #a2b6da;">)</span>
                 <span style="color: #a2b6da;">(</span>equal <span style="color: #9cb6ad;">(</span>map-elt prop-state <span style="color: #79C0FF;">:qualified-id</span><span style="color: #9cb6ad;">)</span>
                        <span style="color: #9cb6ad;">(</span>format <span style="color: #A1D08E;">"%s-available_modes"</span> request-count<span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>
               t<span style="color: #b0b0b3;">)</span>
          <span style="color: #b0b0b3;">(</span><span style="color: #FFA657;">let*</span> <span style="color: #90a890;">(</span><span style="color: #a2b6da;">(</span>block-range <span style="color: #9cb6ad;">(</span>agent-shell-ui--block-range <span style="color: #79C0FF;">:position</span> <span style="color: #8c8c8c;">(</span>point<span style="color: #8c8c8c;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                 <span style="color: #a2b6da;">(</span>insert-pos <span style="color: #9cb6ad;">(</span>map-elt block-range <span style="color: #79C0FF;">:end</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>
            <span style="color: #90a890;">(</span>goto-char insert-pos<span style="color: #90a890;">)</span>
            <span style="color: #90a890;">(</span><span style="color: #FFA657;">let</span> <span style="color: #a2b6da;">(</span><span style="color: #9cb6ad;">(</span>inhibit-read-only t<span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
              <span style="color: #a2b6da;">(</span>insert <span style="color: #A1D08E;">"</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">n</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">n</span><span style="color: #A1D08E;">"</span><span style="color: #a2b6da;">)</span>
              <span style="color: #a2b6da;">(</span>agent-shell-ui--insert-fragment
               <span style="color: #9cb6ad;">(</span>agent-shell-ui-make-fragment-model
                <span style="color: #79C0FF;">:namespace-id</span> <span style="color: #8c8c8c;">(</span>number-to-string request-count<span style="color: #8c8c8c;">)</span>
                <span style="color: #79C0FF;">:block-id</span> <span style="color: #A1D08E;">"available_subagents"</span>
                <span style="color: #79C0FF;">:label-left</span> <span style="color: #8c8c8c;">(</span>propertize <span style="color: #A1D08E;">"Available subagents"</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">font-lock-face</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">font-lock-doc-markup-face</span><span style="color: #8c8c8c;">)</span>
                <span style="color: #79C0FF;">:body</span> <span style="color: #8c8c8c;">(</span>agent-shell-opencode--format-subagents subagents<span style="color: #8c8c8c;">)</span><span style="color: #9cb6ad;">)</span>
               <span style="color: #9cb6ad;">(</span>format <span style="color: #A1D08E;">"%s-available_subagents"</span> request-count<span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">defun</span> <span style="color: #96a6c8;">agent-shell-opencode--load-subagents-delayed</span> <span style="color: #93a8c6;">()</span>
  <span style="color: #787878;">"Load subagents and show them in UI after delay."</span>
  <span style="color: #93a8c6;">(</span>run-with-timer
   0.5 nil
   <span style="color: #b0b1a3;">(</span><span style="color: #FFA657;">lambda</span> <span style="color: #97b098;">()</span>
     <span style="color: #97b098;">(</span><span style="color: #FFA657;">when-let</span> <span style="color: #aebed8;">(</span><span style="color: #b0b0b3;">(</span>subagents <span style="color: #90a890;">(</span>agent-shell-opencode--list-subagents<span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span>
                <span style="color: #b0b0b3;">(</span><span style="color: #90a890;">(</span>&gt; <span style="color: #a2b6da;">(</span>length subagents<span style="color: #a2b6da;">)</span> 0<span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span>
       <span style="color: #aebed8;">(</span><span style="color: #FFA657;">setq</span> agent-shell-opencode--subagents subagents<span style="color: #aebed8;">)</span>
       <span style="color: #aebed8;">(</span>agent-shell-opencode--show-subagents-fragment<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">defun</span> <span style="color: #96a6c8;">agent-shell-opencode--around-initiate-session</span> <span style="color: #93a8c6;">(</span>orig-fun <span style="color: #95a99f;">&amp;rest</span> args<span style="color: #93a8c6;">)</span>
  <span style="color: #787878;">"Around advice for agent-shell--initiate-session."</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">let*</span> <span style="color: #b0b1a3;">(</span><span style="color: #97b098;">(</span>plist args<span style="color: #97b098;">)</span>
         <span style="color: #97b098;">(</span>on-session-init <span style="color: #aebed8;">(</span>plist-get plist <span style="color: #79C0FF;">:on-session-init</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
         <span style="color: #97b098;">(</span>new-on-session-init
          <span style="color: #aebed8;">(</span><span style="color: #FFA657;">lambda</span> <span style="color: #b0b0b3;">()</span>
            <span style="color: #b0b0b3;">(</span>funcall on-session-init<span style="color: #b0b0b3;">)</span>
            <span style="color: #b0b0b3;">(</span>agent-shell-opencode--load-subagents-delayed<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span>plist-put plist <span style="color: #79C0FF;">:on-session-init</span> new-on-session-init<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span>apply orig-fun plist<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span>advice-add <span style="color: #FFA657;">'</span><span style="color: #95a99f;">agent-shell--initiate-session</span> <span style="color: #79C0FF;">:around</span>
            <span style="color: #FFA657;">#'</span><span style="color: #95a99f;">agent-shell-opencode--around-initiate-session</span><span style="color: #8c8c8c;">)</span>

<span style="color: #787878;">;;; </span><span style="color: #787878;">Transform @@subagent syntax to @subagent before sending to OpenCode
</span><span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">defun</span> <span style="color: #96a6c8;">agent-shell-opencode--filter-send-command-args</span> <span style="color: #93a8c6;">(</span>args<span style="color: #93a8c6;">)</span>
  <span style="color: #787878;">"Transform @@subagent to @subagent in prompt before sending."</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">let</span> <span style="color: #b0b1a3;">(</span><span style="color: #97b098;">(</span>prompt <span style="color: #aebed8;">(</span>plist-get args <span style="color: #79C0FF;">:prompt</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #FFA657;">when</span> <span style="color: #97b098;">(</span><span style="color: #FFA657;">and</span> prompt <span style="color: #aebed8;">(</span>stringp prompt<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span>plist-put args <span style="color: #79C0FF;">:prompt</span> <span style="color: #aebed8;">(</span>replace-regexp-in-string <span style="color: #A1D08E;">"@@"</span> <span style="color: #A1D08E;">"@"</span> prompt<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>
  args<span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span>advice-add <span style="color: #FFA657;">'</span><span style="color: #95a99f;">agent-shell--send-command</span> <span style="color: #79C0FF;">:filter-args</span>
            <span style="color: #FFA657;">#'</span><span style="color: #95a99f;">agent-shell-opencode--filter-send-command-args</span><span style="color: #8c8c8c;">)</span>

<span style="color: #787878;">;;; </span><span style="color: #787878;">@@subagent completion support
</span><span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">defun</span> <span style="color: #96a6c8;">agent-shell-opencode--subagent-completion-at-point</span> <span style="color: #93a8c6;">()</span>
  <span style="color: #787878;">"Complete subagent names after @@ prefix."</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">when-let*</span> <span style="color: #b0b1a3;">(</span><span style="color: #97b098;">(</span>bounds <span style="color: #aebed8;">(</span>agent-shell--completion-bounds <span style="color: #A1D08E;">"[:alnum:]_-"</span> ?@<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
              <span style="color: #97b098;">(</span><span style="color: #aebed8;">(</span><span style="color: #FFA657;">save-excursion</span>
                 <span style="color: #b0b0b3;">(</span>goto-char <span style="color: #90a890;">(</span>map-elt bounds <span style="color: #79C0FF;">:start</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span>
                 <span style="color: #b0b0b3;">(</span>eq <span style="color: #90a890;">(</span>char-before<span style="color: #90a890;">)</span> ?@<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
              <span style="color: #97b098;">(</span>subagents agent-shell-opencode--subagents<span style="color: #97b098;">)</span>
              <span style="color: #97b098;">(</span>descriptions <span style="color: #aebed8;">(</span>mapcar <span style="color: #b0b0b3;">(</span><span style="color: #FFA657;">lambda</span> <span style="color: #90a890;">(</span>a<span style="color: #90a890;">)</span>
                                      <span style="color: #90a890;">(</span>cons <span style="color: #a2b6da;">(</span>map-elt a <span style="color: #79C0FF;">:name</span><span style="color: #a2b6da;">)</span>
                                            <span style="color: #a2b6da;">(</span>map-elt a <span style="color: #79C0FF;">:description</span><span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span>
                                    subagents<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span>list <span style="color: #97b098;">(</span>map-elt bounds <span style="color: #79C0FF;">:start</span><span style="color: #97b098;">)</span> <span style="color: #97b098;">(</span>map-elt bounds <span style="color: #79C0FF;">:end</span><span style="color: #97b098;">)</span>
          <span style="color: #97b098;">(</span>mapcar <span style="color: #FFA657;">#'</span><span style="color: #95a99f;">car</span> descriptions<span style="color: #97b098;">)</span>
          <span style="color: #79C0FF;">:exclusive</span> t
          <span style="color: #79C0FF;">:annotation-function</span>
          <span style="color: #97b098;">(</span><span style="color: #FFA657;">lambda</span> <span style="color: #aebed8;">(</span>name<span style="color: #aebed8;">)</span>
            <span style="color: #aebed8;">(</span><span style="color: #FFA657;">when-let*</span> <span style="color: #b0b0b3;">(</span><span style="color: #90a890;">(</span>desc <span style="color: #a2b6da;">(</span>map-elt descriptions name<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span>
              <span style="color: #b0b0b3;">(</span>concat <span style="color: #A1D08E;">"  "</span> desc<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
          <span style="color: #79C0FF;">:company-kind</span> <span style="color: #97b098;">(</span><span style="color: #FFA657;">lambda</span> <span style="color: #aebed8;">(</span>_<span style="color: #aebed8;">)</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">function</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">defun</span> <span style="color: #96a6c8;">agent-shell-opencode--setup-completion</span> <span style="color: #93a8c6;">()</span>
  <span style="color: #787878;">"Set up @@subagent completion in agent-shell."</span>
  <span style="color: #93a8c6;">(</span>add-hook <span style="color: #FFA657;">'</span><span style="color: #95a99f;">completion-at-point-functions</span>
            <span style="color: #FFA657;">#'</span><span style="color: #95a99f;">agent-shell-opencode--subagent-completion-at-point</span>
            nil t<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span>add-hook <span style="color: #FFA657;">'</span><span style="color: #95a99f;">agent-shell-mode-hook</span> <span style="color: #FFA657;">#'</span><span style="color: #95a99f;">agent-shell-opencode--setup-completion</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org545b89e" class="outline-2">
<h2 id="org545b89e">Bubblewrap Sandbox</h2>
<div class="outline-text-2" id="text-org545b89e">
<p>
Claude 官方在 Linux 里也是使用的 bubblewrap 作为 sandbox，并做了许多针对性的优化。
</p>

<p>
让 LLM 生成了一个 bash 脚本在 bubblewrap sandbox 里运行 OpenCode：
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #787878;">#</span><span style="color: #787878;">!/bin/</span><span style="color: #FFA657;">bash</span><span style="color: #787878;">
</span><span style="color: #787878;"># </span><span style="color: #787878;">opencode bubblewrap sandbox script
</span><span style="color: #787878;"># </span><span style="color: #787878;">https://patrickmccanna.net/a-better-way-to-limit-claude-code-and-other-coding-agents-access-to-secrets/
</span><span style="color: #787878;"># </span><span style="color: #787878;">https://www.luiscardoso.dev/blog/sandboxes-for-ai
</span>
<span style="color: #79C0FF;">set</span> -euo pipefail

<span style="color: #787878;"># </span><span style="color: #787878;">Configuration
</span><span style="color: #f4f4ff;">PROJECT_DIR</span>=<span style="color: #A1D08E;">"$(</span><span style="color: #ff4f58;">pwd</span><span style="color: #A1D08E;">)"</span>
<span style="color: #f4f4ff;">OPENCODE_BIN</span>=<span style="color: #A1D08E;">"$HOME/.npm-global/bin/opencode"</span>
<span style="color: #f4f4ff;">OPENCODE_CONFIG</span>=<span style="color: #A1D08E;">"$HOME/.config/opencode"</span>
<span style="color: #f4f4ff;">NPM_BIN</span>=<span style="color: #A1D08E;">"$HOME/.npm-global"</span>

<span style="color: #787878;"># </span><span style="color: #787878;">Validate paths
</span><span style="color: #FFA657;">if</span> <span style="color: #8c8c8c;">[</span> ! -x <span style="color: #A1D08E;">"$OPENCODE_BIN"</span> <span style="color: #8c8c8c;">]</span>; <span style="color: #FFA657;">then</span>
  <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Error: opencode binary not found or not executable: $OPENCODE_BIN"</span>
  <span style="color: #FFA657;">exit</span> 1
<span style="color: #FFA657;">fi</span>

<span style="color: #787878;"># </span><span style="color: #787878;">Check if we need to allow network access (default: yes for opencode's MCP servers)
</span><span style="color: #f4f4ff;">SHARE_NET</span>=<span style="color: #A1D08E;">"--share-net"</span>

<span style="color: #787878;"># </span><span style="color: #787878;">Run opencode in bubblewrap sandbox
</span>bwrap <span style="color: #A1D08E;">\</span>
  --ro-bind /usr /usr <span style="color: #A1D08E;">\</span>
  --ro-bind /lib /lib <span style="color: #A1D08E;">\</span>
  --ro-bind /bin /bin <span style="color: #A1D08E;">\</span>
  --ro-bind /etc/resolv.conf /etc/resolv.conf <span style="color: #A1D08E;">\</span>
  --ro-bind /etc/hosts /etc/hosts <span style="color: #A1D08E;">\</span>
  --ro-bind /etc/ssl /etc/ssl <span style="color: #A1D08E;">\</span>
  --ro-bind /etc/passwd /etc/passwd <span style="color: #A1D08E;">\</span>
  --ro-bind /etc/group /etc/group <span style="color: #A1D08E;">\</span>
  --ro-bind <span style="color: #A1D08E;">"$NPM_BIN"</span> <span style="color: #A1D08E;">"$NPM_BIN"</span> <span style="color: #A1D08E;">\</span>
  $<span style="color: #8c8c8c;">(</span><span style="color: #ff4f58;">for env_file in "$PROJECT_DIR"/.env*; do </span><span style="color: #93a8c6;">[</span><span style="color: #ff4f58;"> -e "$env_file" </span><span style="color: #93a8c6;">]</span><span style="color: #ff4f58;"> &amp;&amp; echo "--ro-bind /dev/null \"$env_file\""; done</span><span style="color: #8c8c8c;">)</span> <span style="color: #A1D08E;">\</span>
  --ro-bind /dev/null <span style="color: #A1D08E;">"$HOME/.aws"</span> <span style="color: #A1D08E;">\</span>
  --ro-bind /dev/null <span style="color: #A1D08E;">"$HOME/.ssh"</span> <span style="color: #A1D08E;">\</span>
  --ro-bind /dev/null <span style="color: #A1D08E;">"$HOME/.gnupg"</span> <span style="color: #A1D08E;">\</span>
  --ro-bind /dev/null <span style="color: #A1D08E;">"$HOME/.config/gcloud"</span> <span style="color: #A1D08E;">\</span>
  --bind <span style="color: #A1D08E;">"$OPENCODE_CONFIG"</span> <span style="color: #A1D08E;">"$OPENCODE_CONFIG"</span> <span style="color: #A1D08E;">\</span>
  --bind <span style="color: #A1D08E;">"$PROJECT_DIR"</span> <span style="color: #A1D08E;">"$PROJECT_DIR"</span> <span style="color: #A1D08E;">\</span>
  --bind <span style="color: #A1D08E;">"$HOME/.npm-global/"</span> <span style="color: #A1D08E;">"$HOME/.npm-global/"</span> <span style="color: #A1D08E;">\</span>
  --bind <span style="color: #A1D08E;">"$HOME/.local/share/opencode"</span> <span style="color: #A1D08E;">"$HOME/.local/share/opencode"</span> <span style="color: #A1D08E;">\</span>
  --bind <span style="color: #A1D08E;">"$HOME/.MemoryMD/"</span> <span style="color: #A1D08E;">"$HOME/.MemoryMD/"</span> <span style="color: #A1D08E;">\</span>
  --bind <span style="color: #A1D08E;">"$HOME/.cache/opencode/"</span> <span style="color: #A1D08E;">"$HOME/.cache/opencode/"</span> <span style="color: #A1D08E;">\</span>
  --tmpfs /tmp <span style="color: #A1D08E;">\</span>
  --proc /proc <span style="color: #A1D08E;">\</span>
  --dev /dev <span style="color: #A1D08E;">\</span>
  $<span style="color: #f4f4ff;">SHARE_NET</span> <span style="color: #A1D08E;">\</span>
  --unshare-pid <span style="color: #A1D08E;">\</span>
  --unshare-ipc <span style="color: #A1D08E;">\</span>
  --unshare-uts <span style="color: #A1D08E;">\</span>
  --die-with-parent <span style="color: #A1D08E;">\</span>
  --new-session <span style="color: #A1D08E;">\</span>
  --chdir <span style="color: #A1D08E;">"$PROJECT_DIR"</span> <span style="color: #A1D08E;">\</span>
  --setenv HOME <span style="color: #A1D08E;">"$HOME"</span> <span style="color: #A1D08E;">\</span>
  --setenv USER <span style="color: #A1D08E;">"$(</span><span style="color: #ff4f58;">whoami</span><span style="color: #A1D08E;">)"</span> <span style="color: #A1D08E;">\</span>
  <span style="color: #A1D08E;">"$OPENCODE_BIN"</span> <span style="color: #A1D08E;">"$@"</span>
</pre>
</div>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-coding.html">Coding</a> </div>]]></description>
  <category><![CDATA[Coding]]></category>
  <link>https://www.vandee.art/blog/2026-01-23-my-agent-practice-with-opencode-in-emacs.html</link>
  <guid>https://www.vandee.art/blog/2026-01-23-my-agent-practice-with-opencode-in-emacs.html</guid>
  <pubDate>Fri, 23 Jan 2026 11:11:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[Vibe Coding is kind of like borrowing]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org0aa96b1">TL;DR</a></li>
<li><a href="#orgfd94ed5">结果还是过程？</a></li>
<li><a href="#org52b9f2a">我不喜欢 LLM 代码生成</a></li>
<li><a href="#org739d736">不同的立场</a></li>
</ul>
</div>
</nav>
<div id="outline-container-org0aa96b1" class="outline-2">
<h2 id="org0aa96b1">TL;DR</h2>
<div class="outline-text-2" id="text-org0aa96b1">
<p>
Vibe Coding 就像贷款、花呗，只是没有标注还款额和期限。
</p>

<p>
选了 borrowing 这个单词是因为它既有贷款的含义，也有借用的含义。
</p>
</div>
</div>
<div id="outline-container-orgfd94ed5" class="outline-2">
<h2 id="orgfd94ed5">结果还是过程？</h2>
<div class="outline-text-2" id="text-orgfd94ed5">
<blockquote>
<p>
对于这样的现象，我先下一个结论：软件开发向来是为了解决问题（Problem Solving），重要的是解决问题的结果，而不是解决的方式。
</p>

<p>
大模型的出现让重复基础编码任务的意义快速贬值，但是开源协同的形态并没有因此发生巨变。对于个人而言，此时应该做的是尽快掌握大模型制导的编程能力，将自己从繁琐的重复编码任务里解脱出来，集中注意力投入到其他高价值目标上去。
</p>

<p>
否则，这就像十年前别人开发 Java 都用 JetBrains 自动生成模板，自动补齐代码，流畅 DEBUG，光速跳转定义；而你还在手敲每一个符号名，全局搜索文本找代码，不停吐槽为什么别人写的类名方法名都要全拼
</p>

<p>
via: <a href="https://tisonkun.org/2025/12/31/open-source-and-ai/">https://tisonkun.org/2025/12/31/open-source-and-ai/</a>
</p>
</blockquote>

<blockquote>
<p>
[Claude Code] has the potential to transform all of tech. I also think we’re going to see a real split in the tech industry (and everywhere code is written) between people who are <i>outcome-driven</i> and are excited to get to the part where they can test their work with users faster, and people who are <i>process-driven</i> and get their meaning from the engineering itself and are upset about having that taken away.
</p>

<p>
[Claude Code] 有潜力改变整个科技行业。我还认为，我们将在科技行业（以及所有编写代码的地方）看到一种真正的分化：一方面是那些以结果为导向、兴奋于更快地将工作交给用户测试的人；另一方面是那些以过程为导向、从工程本身中获取意义、并对这种被剥夺感到不安的人。
</p>

<p>
<a href="https://werd.io/2025-the-year-in-llms/">Ben Werdmuller</a>
</p>

<p>
via: <a href="https://simonwillison.net/2026/Jan/2/ben-werdmuller/">https://simonwillison.net/2026/Jan/2/ben-werdmuller/</a>
</p>
</blockquote>

<p>
我不排斥也不反感 AI 这个技术，过度批判技术变革带来的改变是弱者的借口，哪怕 AI 真的一无是处。以后完全杜绝 AI 就好像现在完全不使用智能手机和电子设备一样荒谬。工业革命、自动化会让许多人失去现在的岗位，但它同样也提供了更多岗位和需求。
</p>

<p>
我不是程序员，也不是相关行业的，编程只是一个爱好。
</p>

<p>
编程作为一个爱好、技能，和软件工程、软件开发，是完全不一样的心态。
</p>

<p>
对于工程实现，我觉得 AI 的参与完全没有问题。否定它未来的可能性就好像现在关闭所有工厂回到手工制作。让 LLM 来做一些总结、编排的杂活，并行 review 多个项目，这是传统自动化很难实现的。以前需要人力完成的，十分之一不到成本的 token 可能就可以做到。
</p>

<p>
软件开发，团队项目是靠产品说话的，这些更注重结果。就像现在的大语言模型和 Claude Code，产出让用户觉得好用的产品才是第一位的。至于这个大语言模型是如何训练出来的，Claude Code 是如何实现的，普通用户其实并不关心，比竞品好用用户就会选择。
</p>
</div>
</div>
<div id="outline-container-org52b9f2a" class="outline-2">
<h2 id="org52b9f2a">我不喜欢 LLM 代码生成</h2>
<div class="outline-text-2" id="text-org52b9f2a">
<p>
但对于 Vibe Coding 和 LLM 代码生成，我始终不太喜欢。
</p>

<blockquote>
<p>
I think the job of being paid money to type code into a computer will go the same way as punching punch cards [&#x2026;] in six years time, I do not think anyone will be paid to just to do the thing where you type the code. I think software engineering will still be an enormous career. I just think the software engineers won’t be spending multiple hours of their day in a text editor typing out syntax.
</p>

<p>
我认为，作为一份工作，拿钱在电脑上输入代码的工作将在六年后与打孔卡一样消失，我认为到那时不会有人仅仅为了输入代码而获得报酬。我认为软件工程仍将是一个巨大的职业。我只是认为软件工程师不会花费多小时在文本编辑器中输入语法。
</p>

<p>
via: <a href="https://simonwillison.net/2026/Jan/8/llm-predictions-for-2026/">https://simonwillison.net/2026/Jan/8/llm-predictions-for-2026/</a>
</p>
</blockquote>

<p>
对于工作，我赞同 Simon 大佬的这个言论，但我认为 LLM 代码生成绝对和打孔卡的取代不是一回事。手拿普通锯子（打孔卡），手拿电锯（现代编程语言），电锯自己动（LLM 生成），这之间的区别不是明摆着的么?
</p>

<p>
本质上，编程就是自动化，把需要实现的结果，用代码固定下来，编译好让机器自动化执行。AI（大语言模型）则通过神经网络，让自然语言成为了代码的“解释器”。
</p>

<p>
但AI 生成和 AI 自动化有本质上的区别，用 AI 生产内容和用 AI 来管理流程是两码事。
</p>

<p>
LLM 生成代码这个过程中，它始终是一个概率结果。传统自动化工具指向一个确定的结果，而 LLM 生成得到的始终是一个随机区间，即使这个随机区间对于简单的代码复制、修剪工作来说，很小，很稳定；即使通过高超的 prompt 技巧、炉火纯青的 AI 技术，得到非常准确的代码。概率性是 LLM 生成始终无法回避的问题。
</p>

<p>
编程现在对我而言，是一种自我表达，它有着艺术该有的所有特性。
</p>

<p>
把这些交给 AI 来生成给我一个结果，不是我想要的，也很不“自我”。啪啪啪，生成了一些质量也不错的代码，但这太不好玩了，带给不了我什么乐趣。我很享受敲代码的时候键盘敲击的声音，像弹吉他一样，思维和想象力的轨迹在指尖游走，具象化的表现出来。
</p>

<p>
编程语言本身也就是一种语言，为什么必须要用自然语言来和计算机对话？
</p>

<p>
这是一次进化，但也是退化。当一种语言被另一种语言同化，也就意味着它的消亡。(现代编程语言和汇编、机器码之间的关系和这个不一样)
</p>

<p>
为什么现在许多软件开发者，甚至是行业大佬，本身代码能力就很强，但还是会在 AI 代码生成上过于夸大其词，甚至是炫耀高超的 AI 生成技巧，好像是在追逐创造一种流行趋势和潮流。值得拿出来炫耀的不应是自己本身就有的编程能力么？
</p>

<p>
我觉得这才是真正的 SKILL，而不是变成了写 prompt、文档和各种 AGENTS.md 来安排 AI 的“架构师”。能用自然语言来编码绝对不是一个值得这么高兴的事情。
</p>

<p>
对于代码能力本身很强的人来说，AI 能解放双手，同一时间可以并行构建多个项目。确实现在还是如此，代码能力能纠正 LLM 生成的代码，没有 AI 也还是能写出高质量的代码。
</p>

<p>
当 AI 生成的代码比自己还要好的时候，当自己已经无法理解 AI 生成的可运行物件的时候，又该如何？还会觉得这些是在自己的思维主导下创造出来的么？自己不写代码了，还怎么去评判 AI 代码的质量和品味？
</p>

<p>
当 LLM 生成的代码质量像现在的工业制造一样，品质可控，误差降低到非常低，软件开发进入 AI 工业时代，现在声称的编程和代码品味还存在么？
</p>

<p>
所以，从 Vibe Coding 这个概念出现到现在一直的争论里，我觉得关键还是在于判断：AI 生成代码是否只是一种工具的使用。
</p>

<p>
我的答案是：显然不是。
</p>

<p>
一个很简单明了的逻辑判断：
</p>

<p>
如果 AI 的生成只是工具和智慧劳动的结合，那么离开了它，你还能实现这个结果么？换一个模型，还能生成同样质量的内容么？能找到另一个替代它来帮你完成这个工作的工具么？如果有，那么为什么必须要用 AI 生成？
</p>

<p>
用电子画笔画画，算法摄影，这些虽然都有科技技术的融合，但是他们和 AI 生成还是很不一样，这些带有思维创造比重较大的行为，在工具技术的加成下，还是人在主导，它们还是工具。
</p>

<p>
再强大的电子画笔，不会画画还是画不出来；再昂贵的相机，没有审美还是拍不出好照片。
</p>

<p>
我不会把 AI 生成完全当作是自己思维的创造，这些生成的内容依靠的是模型和神经网络完成的概率计算，它是概率结果，它无法复现，更不是一种技能。
</p>

<p>
它们就像贷款，让 AI 帮自己做的越多，将来要还的就越多。
</p>
</div>
</div>
<div id="outline-container-org739d736" class="outline-2">
<h2 id="org739d736">不同的立场</h2>
<div class="outline-text-2" id="text-org739d736">
<p>
<a href="https://antirez.com/news/158">Don't fall into the anti-AI hype - &lt;antirez&gt;</a>
</p>

<p>
antirez 的这篇写的挺中肯的，Simon 大佬也 quote 了: <a href="https://simonwillison.net/2026/Jan/11/dont-fall-into-the-anti-ai-hype/">Don't fall into the anti-AI hype</a>
</p>

<p>
正如文章标题一样，don't fall into，不要被炒作和舆论影响了自己的判断。无论是过度鼓吹 AI 还是过度反对 AI。
</p>

<p>
只是大家有不同的立场，有不同的利益相关，有不同的喜好。
</p>

<p>
现在 AI 编程、AI 软件开发确实很像工业革命初期，之所以要强调初期是因为工业革命是一个持续了一个世纪的漫长过程。
</p>

<p>
每次谈到这些都会让我想到当时的反工业革命的一些艺术运动，例如 <a href="https://zh.wikipedia.org/zh-cn/%E8%89%BA%E6%9C%AF%E4%B8%8E%E5%B7%A5%E8%89%BA%E8%BF%90%E5%8A%A8">艺术与工艺运动</a> (Arts and Crafts Movement)。
</p>

<p>
不是工业革命和科学技术发展也不会催生出前拉斐尔派，也就不会有印象派。正是这些在时代中发生的激荡，它激起了巨浪，也激起了人们的思考。
</p>

<p>
世界和宇宙本就是无序的（chaos），平常的有序也只是无序呈现的一种方式，无序的微观分子运动宏观上呈现出稳定态。
</p>

<p>
我想表达的是，我们本来就无时无刻不处在变化之中，保持自己的品味，坚持自己的喜好就好，自然会随着浪潮到达自己会抵达的地方。
</p>

<p>
对我来说，编程是我探究艺术的一个 branch 分支，很幸运它不是我的工作，我也就不用有什么立场。
</p>

<p>
即使现在的数码摄影如此发达了，胶片仍然有它独特的味道和价值。
</p>

<p>
我相信编程里这些无法被替代的东西会有人继续坚持下去，当狂潮退去，能让内心继续跟随的只有热爱。
</p>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-thinking.html">Thinking</a> <a href="https://www.vandee.art/blog/tag-llm.html">LLM</a> </div>]]></description>
  <category><![CDATA[Thinking]]></category>
  <category><![CDATA[LLM]]></category>
  <link>https://www.vandee.art/blog/2026-01-05-vibe-coding-is-kind-of-like-borrowing.html</link>
  <guid>https://www.vandee.art/blog/2026-01-05-vibe-coding-is-kind-of-like-borrowing.html</guid>
  <pubDate>Mon, 05 Jan 2026 13:26:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[2025 - 益]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgd75c091">益</a></li>
<li><a href="#orgf44e859">黑客帝国</a></li>
<li><a href="#org0f6ad74">2025 回顾</a></li>
</ul>
</div>
</nav>
<div id="outline-container-orgd75c091" class="outline-2">
<h2 id="orgd75c091">益</h2>
<div class="outline-text-2" id="text-orgd75c091">
<p>
今年我给自己的周易卦象是益，风雷益 ䷩，上巽（风）下震（雷），卦辞：“益：利有攸往，利涉大川。”
</p>

<p>
从去年开始我决定每年的总结使用周易里的卦象来描述，去年我给自己的关键词是 “<a href="https://www.vandee.art/blog/2024-12-12-the-summary-of-2024.html">需</a>” 。
</p>

<p>
我自己对益这个卦象的理解是，风动积雨成雷。今年积累的东西还是比较杂，风代表动态的流动的变化，雷则是风动这个因的一个果。积累的东西如果没有汇聚起来，那么还是不成气候。
</p>

<p>
这个理解和周易里普遍的解释完全不同。我斗胆这么认为，易经最开始本是周文王在被囚禁之时，自己偶然突发奇想创造出来的，它有很大的历史局限性。之所以地位这么高，是因为这些甲骨重现了当时的历史，而占卜又满足了人们的奇思妙想。但其实占卜这个功能在易经里不那么重要，它的历史价值才是，我们从周文王占卜的这些内容里能了解到那个时代的样貌。
</p>

<p>
要说周文王是不是真的像易经里记载的那么想的，我想连他自己也说不清楚。也就是某天起来，周文王心里有很多困惑和苦闷，自己又是一个人，无法排解，于是就想，我来用龟壳算一卦吧。起初这些龟壳最基本的用途还是记录，可以简单理解为是周文王的日记本，里面大部分的内容都是今天谁谁谁干了什么，周文王觉得怎么怎么样，许多内容都很日常。换在今天，可能就是，今天起床太阳好大，风也很大，不知道楼下买烧饼的会不会出摊早点呢？
</p>

<p>
所以我觉得，对个人而言，周易里更有价值的是它构建的这个爻辞卦象体系，是周文王在当时处境里的心境与思考，是他解构当时客观世界的这种方式。用自然元素作为符号的映射，阴阳作为基础的构建单位，如此排列组合八八六四挂就可反应世间百态，有着万千变化。正所谓一生二，二生三，三生万物。三也可以理解成二的三次方，也就是八了。所以说，二进制还是牛的。
</p>

<p>
那些爻辞解析，我粗略的看过许多版本之后，就完全丢在一旁了。有这 64 个卦象就足够了。
</p>

<p>
2025-12-16 added:
</p>

<p>
2025 年度词汇：Slop - 由人工智能以大量方式生产的大量低质量数字内容。
</p>

<p>
via: <a href="https://www.merriam-webster.com/wordplay/word-of-the-year">https://www.merriam-webster.com/wordplay/word-of-the-year</a>
</p>

<blockquote>
<p>
Merriam-Webster’s human editors have chosen <i>slop</i> as the 2025 Word of the Year. We define <a href="https://www.merriam-webster.com/dictionary/slop">slop</a> as “digital content of low quality that is produced usually in quantity by means of artificial intelligence.” All that stuff dumped on our screens, captured in just four letters: the English language came through again.
</p>
</blockquote>
</div>
</div>
<div id="outline-container-orgf44e859" class="outline-2">
<h2 id="orgf44e859">黑客帝国</h2>
<div class="outline-text-2" id="text-orgf44e859">
<p>
不知道从什么时候开始，每年都会在不确定的时间看至少一次《黑客帝国》，从结果来看，这个现象勉强可以被描述为习惯。
</p>

<p>
对于这个电影作品我有多喜欢就不用说了，在 <a href="https://www.vandee.art/blog/2023-02-23-blue-or-red.html">蓝色药丸还是红色药丸？</a> ，<a href="https://www.vandee.art/blog/2023-08-22-a-castle-in-the-air.html">镜花水月</a> ，<a href="https://www.vandee.art/blog/2024-07-30-the-imitation-game-of-art.html">艺术的模仿游戏</a> 里我都提到了它。
</p>

<p>
今年不出意外的我又看了 2 遍。最近的一遍是在昨天，没有缘由，就是又突然想看一遍。
</p>

<p>
结合今年我给自己的关键词 “益”，黑客帝国里可以聊的还是有很多。
</p>

<p>
我们这个现实世界的生存法则就像电影里的 Matrix 一样，很多事情虽然很难，但是它的弱点和限制恰恰就是这个规则本身。
</p>

<p>
Agent 斯密斯的能力强于普通 matrix 里的一般人。它有 matrix 赋予它的高程序权限，例如躲子弹、随意附身到 matrix 里的一般人上，速度和力量都高于普通人，在这个规则里，无论如何普通人这个程序设定都是不可能战胜 agent 斯密斯这个程序的。
</p>

<p>
墨菲斯带 Neo 去见了先知，先知说很遗憾你还不是救世主（the one），先知还提到，Neo 会遇到一个抉择，牺牲自己还是墨菲斯。
</p>

<blockquote>
<p>
Neo：
</p>

<p>
Neo 有两层意思，neo 是希腊语里的 "new"，他将带领我们开启新的篇章。另外 Neo 其实还是一个 anagram，即变位词，由颠倒字母顺序而构成的词。Neo 是 one 的变位词。Neo is the One。Neo 就是那个唯一，那个救世主。
</p>

<p>
Neo 本名 Thomas A・Anderson，从希腊语角度考虑的话，Thomas 有 "twin" 和 "leader" 的意思。
</p>

<p>
Morpheus:
人物原型出自尼尔・盖曼大神的《Sandman》同名人物。Morpheus 这个词表示 The God of dreams, 是希腊神话里掌管梦的神。
</p>
</blockquote>

<p>
当墨菲斯被抓了之后，Neo 决定还是要再进入 matrix 去救他，崔妮蒂极力阻止，Neo 当时是这么说的：墨菲斯有自己的信念，他相信我是救世主，但很遗憾我不是。但是我也有我自己相信的东西，我相信我能把他就出来。正是因为没人试过所以才会成功。
</p>

<p>
这个时候 Neo 还是没有真正的觉醒变成 the one，但是他意识到了，他不必是 the one，他只需要做他自己。正是因为没人试过所以才会成功，这句话就表示 Neo 意识到了，matrix 里的设计完全只是一种程序设定，当他做出设定之外的事情，程序就会出 bug。
</p>

<p>
在营救墨菲斯的过程中，虽然 Neo 的能力小幅度觉醒了，可以躲子弹了，但是在和 agent 斯密斯的第二次交战中，还是中枪挂掉了。随后，导演可能恶搞了王子吻公主这个梗，反过来，让 Neo 被崔妮蒂一个爱的吻直接复活了。
</p>

<p>
这次死而复生让 Neo 彻底觉醒成了救世主。这个时候 Neo 在 matrix 里看到的都是源代码，直接空手停子弹，钻入斯密斯的身体，把他秒了。
</p>

<p>
Neo 的觉醒和复活。我是这么理解的：
</p>

<p>
Neo 在救出墨菲斯的时候，能力突破了一次，这是因为他开始相信，开始理解 matrix 只是一个虚拟的程序世界，真实的人可以无视这个世界里的很多规则，这些规则是 matrix 映射到被插管了的普通人的意识当中的。但这个时候 Neo 还没有突破这个规则本身，他只是相信自己，成为了自己。在面对先知给它应验的预言的时候，Neo 做出了遵循与自己本心的选择。
</p>

<p>
在黑客帝国的第二部里，我们就能了解到，其实还有很多 Neo，他们都是为了平衡 matrix 而被设定的一个变量，目的就是为了平衡 matrix 和人类这整个系统。电影里的锡安城，其实被摧毁重建了很多次。Matrix 的设计师，创造了许多版本，仅靠 matrix 都不能创造永久稳定的系统，无论怎么设计，程序都会出 bug，因此它设计了一个平衡，并引入了爱这个人类情绪变量。
</p>

<p>
先知其实也是一个程序，它和 Neo 一样都是为了平衡 matrix 和人类这整个系统。在系统初始化的时候就会生成一个先知程序，和一个 Neo 变量，先知告诉锡安城后续的故事走向（这象征着神话和传说），剧本也写好了，墨菲斯找到 Neo，拯救锡安城。
</p>

<p>
这些分析，在黑客帝国第三部的结尾反映的很明显。如果说 Matrix 的设计师是 matrix 之父，那么先知就是 matrix 之母，可能象征阴阳平衡吧。第三步结尾里，设计师和先知一起坐在椅子上，看着重新启动的 matrix 说到，这次又能持续多久呢？意思就是后面又会是第一部到第三部的循环。这太讽刺了不是么，当一个凡人突破了种种限制，牺牲了自己换来了和平，最后却还是在更大的设计之中。我想导演可能想表达的是，宇宙这个终极的物理法则，人类要尊重自然，尊重法则，找到人类的平衡之道。
</p>

<p>
回到前面说的第一部里 Neo 变成救世主这段剧情。Neo 选择救出墨菲斯牺牲自己这个选择就是 matrix 无法准确计算的那个情形。因为在 matrix 的构建中，它不设计不出人类的自我，它模拟不了人性，它无法用参数计算出这次的 Neo 去救出墨菲斯的概率有多大，也不是每一次的崔妮蒂都能让 Neo 爱上自己。
</p>

<p>
Neo 的复活是一个剧情设计。从电影剧本的逻辑上，不能解释为什么他能够复活并拥有了救世主的能力。这里更多的我觉得就是一种象征，象征着浴火重生，也表现了人类爱这种情感的力量。
</p>

<p>
非要解释的话，我觉得就是 Neo 的意识在 matrix 里中枪之后还没有完全消失，这个时候崔妮蒂象征的爱这种力量通过吻在现实世界强化了 Neo 的潜意识，让他意识到自己还没有死（电影设定里，人在 matrix 里会死是因为大脑因为 matrix 的映射以为这些是真的），再加上 Neo 自己之前强烈的信念，所以他这次彻底觉醒了(从第二部才能知道 Neo 本身就是这么设计的，它就是系统另外一个变量)，爱这个变量让 Neo 这个变量拥有了 matrix 里极高的程序权限。
</p>

<p>
回到今年我给自己的卦象“益”：
</p>

<ul class="org-ul">
<li>规则都是人定的，没有遇到的情况，规则的制定者它也没有先例，它也不知道应该怎么办。无论如何设计规则，都会有漏洞和 bug。</li>

<li>不存在绝对的平衡与完美，能够平衡恰恰也就是因为它的不完美。黑客帝国里许多设计元素都反映了阴阳的平衡。</li>

<li><p>
Neo 觉醒成为 the one 是两个觉醒。
</p>

<p>
当 Neo 进入了这个规则，意识到这一切都只是幻象，他是 Human，它可以无视这些规则，这是摆脱了 matrix 之后人类意识的觉醒。
</p>

<p>
第二个觉醒是，它是一个 matrix 里的高级程序，它相信自己有能力能救出墨菲斯之后，在 matrix 里做出的一般程序做不了事情就是 Neo 这个高级程序的能力。在相信之后才会开启这些能力。
</p>

<p>
先知的预言就是 Neo 这个程序在 matrix 里被设计的目的和剧本。这个觉醒的条件恰恰就是 Neo 认清自己的时候（导演在先知和 Neo 见面的时候还特别强调了让 Neo 看头上的牌匾，写的就是认清自己），真正成为自己而不是程序给他设定的剧本。不得不说 matrix 设计师的这个设计很巧妙。
</p></li>

<li><p>
先知只是告诉你会发生的事，就算是既定的事情，就算是命中注定，自己对它不一样的理解，就会有不一样的因果。墨菲斯在电影里重复了很多次：先知只是告诉你会发生的事，它只是告诉你你应该知道的事情，仅此而已，我也不需要知道。
</p>

<p>
Just believe ，and believe in yourself！
</p>

<p>
宿命论是黑客帝国贯穿全篇想讨论的，这些设定也表达了导演对于宿命论的一些看法。
</p></li>

<li>Neo 成为的是它自己，所以才成为了 the one，他只是做出了自己作为人类本心的选择：救出墨菲斯。这和功夫熊猫里想表达的是类似的。神龙秘籍就是空白，映射的是自己的本心。</li>
</ul>
</div>
</div>
<div id="outline-container-org0f6ad74" class="outline-2">
<h2 id="org0f6ad74">2025 回顾</h2>
<div class="outline-text-2" id="text-org0f6ad74">
<p>
今年在 <a href="https://www.vandee.art/blog/2025-12-09-native-linux-on-apple-silicon-mac.html">MacBook 上安装了 Linux</a> ，Linux 成了我日常主要使用的操作系统。
</p>

<p>
<a href="https://wiki.vandee.art/#%E3%80%8AJust%20For%20Fun%E3%80%8B">Just For Fun</a> 是今年我收获最大的一本书，就是 Linus 的自传。
</p>

<p>
今年构建了 <a href="https://www.vandee.art/blog/2025-06-10-nonotes-auto-completion.html">NoNotes</a> ，它是我把 AI 和知识库结合起来使用的一点思考，在慢慢构建成 AI agent 的 memory layer。不管 LLM 怎么发展，它都可以作为一个数据接口，持续发挥作用。Context engineering 是今年大模型领域的一个热门，给 LLM 一个可以随着自己数据变化的 memory layer，AI 助手就能更了解自己的需求，从而生成和自己更相关的内容。
</p>

<p>
这是一个很大的市场，想象一下，现在的个人网盘变成个人 AI 记忆库，LLM 可以根据这些内容分析出你的个人画像，这才是更懂你的 AI 。我觉得大厂很快就会实现这些，这样能让用户把数据放在自己这里，这些数据才是最值钱的。与其现在明争暗斗到处搞别家的数据，各种算法跟踪用户习惯，不如透明直白一点，直接向用户要，提供这些数据储存的服务。Context 研究突破之后把 token 的成本降下来，Google 把 Google Drive 集成到自家模型服务我觉得就不是什么难事。
</p>

<p>
边学习 C 和 Rust，边搞了一些小玩意（在 Claude 的协助下）：
</p>
<ul class="org-ul">
<li><a href="https://github.com/VandeeFeng/GitNano">VandeeFeng/GitNano: GitNano is a mini, experiment implementation of Git.</a></li>
<li><a href="https://github.com/VandeeFeng/bili-tui">VandeeFeng/bili-tui: A tiny bilibili TUI client without AD and algorithm</a></li>
<li><a href="https://github.com/VandeeFeng/promptheus">VandeeFeng/promptheus</a></li>
<li><a href="https://github.com/VandeeFeng/smart-cmd">VandeeFeng/smart-cmd: command with AI suggestion in bash</a></li>
<li><a href="https://github.com/VandeeFeng/org-hover">VandeeFeng/org-hover: provides hover preview functionality for org links.</a></li>
<li><a href="https://github.com/VandeeFeng/Emacs-Hoarder">VandeeFeng/Emacs-Hoarder: Sync Hoarder bookmarks to local Org-mode or Markdown files</a></li>
<li><a href="https://github.com/VandeeFeng/RSS-CLI">VandeeFeng/RSS-CLI</a></li>
</ul>

<p>
今年玩 Linux 和写代码玩的挺开心，二进制很美妙。
</p>

<p>
简单来说，艺术是关于抽象和重构的一种表达，用 0 和 1 来描述这个世界，表达自我是件挺 cool 的事情。和周易八卦类似，编程也是用极简单的基础元素，将眼中的世界解构，进而重构和抽象表达自我。
</p>

<p>
这是今年我在探究艺术道路上最大的发现。
</p>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-ramble.html">Ramble</a> </div>]]></description>
  <category><![CDATA[Ramble]]></category>
  <link>https://www.vandee.art/blog/2025-12-10-the-summary-of-2025.html</link>
  <guid>https://www.vandee.art/blog/2025-12-10-the-summary-of-2025.html</guid>
  <pubDate>Wed, 10 Dec 2025 12:24:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[Native Linux on Apple Silicon Mac]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org8a710ec">TL;DR</a></li>
<li><a href="#org05018bb">Why Linux</a></li>
<li><a href="#org10290eb">Asahi Alarm</a>
<ul>
<li><a href="#org697e615">初始化安装</a></li>
<li><a href="#org6da2549">WM &amp; DM</a></li>
<li><a href="#org636cd0c">App launcher</a></li>
<li><a href="#org9539bd2">Theme</a></li>
<li><a href="#orgb545cae">Bluetooth &amp;&amp; Wi-Fi</a></li>
<li><a href="#org87dff15">Fcitx &amp;&amp; Rime 输入法</a></li>
<li><a href="#org15b4b12">Obs Studio</a></li>
</ul>
</li>
<li><a href="#org82ec638">Settings</a>
<ul>
<li><a href="#org14e4562">Sway</a></li>
<li><a href="#orgd47b8e9">充电提示音</a></li>
<li><a href="#orgee6598d">Others</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<div id="outline-container-org8a710ec" class="outline-2">
<h2 id="org8a710ec">TL;DR</h2>
<div class="outline-text-2" id="text-org8a710ec">
<p>
几个月之前我在 MacBook M1 Pro 上安装了 Linux (不是虚拟机)，处理照片的时候切换到 macOS，平常就 Linux，使用下来挺稳定的。
</p>

<p>
这几个月 Windows 持续的一些负面新闻，让 Linux 有一波小热度。整理了一下我在 Mac 上安装 Linux 的过程，分享给想入坑 Linux 的轻度玩家。
</p>

<p>
大佬请直接关闭页面。
</p>
</div>
</div>
<div id="outline-container-org05018bb" class="outline-2">
<h2 id="org05018bb">Why Linux</h2>
<div class="outline-text-2" id="text-org05018bb">
<p>
买这个 MacBook 的初衷主要是处理摄影照片，M1 系列出来的时候一直垂涎它遥遥领先的性能。整体使用下来 Mac 的体验也挺舒适，Mac 在数码影像处理这个生态还是吊的。
</p>

<p>
使用 Mac 的普通用户大多数都是因为精致设计感的 UI，苹果的品牌效应，我也是如此。但是这几年苹果的发展实在是让我很没有期待，今年更是大便一坨。
</p>

<p>
苹果的品牌效应 90% 来自乔帮主的个人魅力，我觉得一点也不为过。如今苹果的老本快被吃完了，创新的东西有，但是灵魂我觉得早已不在。
</p>

<p>
之前都是在虚拟机上使用 Linux，最初也没有想完全入坑 Linux。转折点就是 Linus 的自传《Just For Fun》，我有太多想法和 Linus 不谋而合。在苹果没有了乔布斯的个人魅力之后，它能吸引我的越来越少，Linux 对我的吸引越来越大。
</p>

<p>
当个人电脑 PC 对我来说不再只是一个工具，而是一个伙伴的时候，Linux 就是现在最适合我的操作系统，<a href="https://www.vandee.art/blog/2025-07-16-linux-is-awesome.html">Linux 太自由了</a> 。
</p>
</div>
</div>
<div id="outline-container-org10290eb" class="outline-2">
<h2 id="org10290eb">Asahi Alarm</h2>
<div class="outline-text-2" id="text-org10290eb">

<figure id="org676efde">
<img src="https://pic.vandee.art/images/20251213_maclinux.png" class="img" width="70%" height="70%">

</figure>

<p>
最开始我尝试的是 Asahi Linux，按照这个视频很快就搞定了： <a href="https://www.youtube.com/watch?v=u_kcXg00R2g">「黑貓」Asahi Linux！M1 Mac 原生運行 Linux 雙系統，簡單流暢！ - YouTube</a>
</p>

<p>
Asahi Linux 预装的是 Fedora，初始化安装到进入图形界面都没问题，但是当我执行更新，安装了一些包之后，再重启，总是会遇到各种系统崩溃问题，尝试了数次之后，就没有再折腾了。
</p>

<p>
也是巧了，正在我发愁的时候：<a href="https://omarchy.org/">Omarchy — Beautiful, Modern &amp; Opinionated Linux by DHH</a> 出现了。
</p>

<p>
Omarchy 是 Ruby 的联合创始人 DHH 推的一个能在 Mac 上运行的 基于 Arch Linux 的 Linux 发行版。
</p>

<p>
但是我不太喜欢它默认的主题，默认快捷键设置也和我的习惯很不一样，还有许多我不需要的预安装。尝试了几天之后也否定了这个方案。
</p>

<p>
然后发现宝藏：<a href="https://asahi-alarm.org/">Asahi Alarm</a> , <a href="https://github.com/basecamp/omarchy/discussions/155">https://github.com/basecamp/omarchy/discussions/155</a>
</p>

<p>
完成度相当高啊！除了耗电量略高一点，和原生分辨率不太兼容，其他的相当完美了。
</p>
</div>
<div id="outline-container-org697e615" class="outline-3">
<h3 id="org697e615">初始化安装</h3>
<div class="outline-text-3" id="text-org697e615">
<p>
它就是一个裸的 Arch Linux。
</p>

<p>
在 Mac 上打开 terminal，运行 <code>curl https://asahi-alarm.org/installer-bootstrap.sh | sh</code> ，基本就全自动安装了，具体的安装过程和 Asahi Linux 是一样的。
</p>

<p>
需要科学上网。
</p>

<p>
安装完成之后，就可以进入到 Asahi Alarm 了，这个时候还没有图形界面，可以命令行安装一些基础的包。
</p>

<p>
Pacman 是 Arch Linux 默认的包管理器 ，<a href="https://github.com/Morganamilo/paru">Morganamilo/paru</a> 是 Rust 版本的 yay AUR 包管理器。
</p>
</div>
</div>
<div id="outline-container-org6da2549" class="outline-3">
<h3 id="org6da2549">WM &amp; DM</h3>
<div class="outline-text-3" id="text-org6da2549">
<p>
接下来就是安装显示器协议（display server protocol）和 WM（window managers），我选择的是 <a href="https://wiki.archlinux.org/title/Wayland">Wayland</a> + <a href="https://swaywm.org/">Sway</a> ，极简就完事了。Hyprland 也很不错，但是我目前对折腾 Linux 的界面没有太大兴趣，也不需要它多美观。
</p>

<p>
创建好 Linux 用户之后 <code>sudo pacman -S wayland sway</code> 安装。
</p>

<p>
输入 sway 就可以进入到图形界面了。想自动进入图形界面，Linux 里可以安装 DM（display managers）
</p>

<p>
DM 我选择的是 <a href="https://github.com/coastalwhite/lemurs">Lemurs</a> 也是因为它足够简单。
</p>
</div>
</div>
<div id="outline-container-org636cd0c" class="outline-3">
<h3 id="org636cd0c">App launcher</h3>
<div class="outline-text-3" id="text-org636cd0c">
<p>
<a href="https://codeberg.org/dnkl/fuzzel">dnkl/fuzzel</a>
</p>

<p>
因为之前在 i3 里使用 dmenu，fuzzel 也足够简洁，和 sway 的匹配度也很高。
</p>

<p>
Vicinae 也挺好用，和 raycast 挺像: <a href="https://github.com/vicinaehq/vicinae/">https://github.com/vicinaehq/vicinae/</a>
</p>

<p>
还有 Rofi：<a href="https://github.com/davatorium/rofi">https://github.com/davatorium/rofi</a>
</p>
</div>
</div>
<div id="outline-container-org9539bd2" class="outline-3">
<h3 id="org9539bd2">Theme</h3>
<div class="outline-text-3" id="text-org9539bd2">
<p>
<a href="https://github.com/vinceliuice/Qogir-theme">vinceliuice/Qogir-theme: Qogir is a flat Design theme for GTK</a>
</p>

<p>
theme 文件可以在 ~/.themes/, 或者 /usr/share/themes
</p>

<ul class="org-ul">
<li>统一 gtk 和 qt 主题：sudo pacman -S &#x2013;noconfirm lxappearance qt5ct qt6ct kvantum</li>

<li><p>
lxappearance 来配置主题，可能需要安装：sudo pacman -S gtk-engine-murrine gnome-themes-extra gtk-engines
</p>

<p>
wayland 里用 nwg-look
</p></li>
</ul>
</div>
</div>
<div id="outline-container-orgb545cae" class="outline-3">
<h3 id="orgb545cae">Bluetooth &amp;&amp; Wi-Fi</h3>
<div class="outline-text-3" id="text-orgb545cae">
<ul class="org-ul">
<li><p>
impala: 🛜 TUI for managing wifi on Linux
</p>

<p>
<a href="https://github.com/pythops/impala">https://github.com/pythops/impala</a>
</p></li>

<li><p>
bluetui: 🛜 TUI for managing bluetooth on Linux
</p>

<p>
<a href="https://github.com/pythops/bluetui">https://github.com/pythops/bluetui</a>
</p></li>
</ul>
</div>
</div>
<div id="outline-container-org87dff15" class="outline-3">
<h3 id="org87dff15">Fcitx &amp;&amp; Rime 输入法</h3>
<div class="outline-text-3" id="text-org87dff15">
<p>
参考：<a href="https://manateelazycat.github.io/2025/08/31/fcitx-best-config/">Fcitx 最佳配置实践 2025-08-31</a>
</p>

<p>
Rime + 双拼实在是太巴适了。
</p>

<p>
Rime 推荐使用：<a href="https://github.com/rime/plum">rime/plum: 東風破 </a> 安装。
</p>

<p>
输入法：<a href="https://github.com/iDvel/rime-ice">iDvel/rime-ice: Rime 配置：雾凇拼音 | 长期维护的简体词库</a>
</p>
</div>
</div>
<div id="outline-container-org15b4b12" class="outline-3">
<h3 id="org15b4b12">Obs Studio</h3>
<div class="outline-text-3" id="text-org15b4b12">
<p>
Asahi Alarm 里， <code>sudo pacman -S obs-studio</code> 显示没有这个包。
</p>

<p>
安装 CMake 自己手动编译:
</p>

<p>
下载源代码：
</p>

<p>
<code>git clone --depth 1 --recurse --shallow-submodules https://github.com/obsproject/obs-studio.git</code>
</p>

<p>
我在编译的时候提示缺少头文件，因此:
</p>

<p>
<code>sudo pacman -S qt6-xcb-private-headers</code>
</p>

<p>
然后成功编译：
</p>

<p>
<code>cmake -DCMAKE_INSTALL_PREFIX=/usr -DENABLE_BROWSER=OFF -DENABLE_VLC=ON -DENABLE_AJA=OFF..</code>
</p>

<p>
如果 PipeWire 选项缺失: wlrobs 是一个 OBS 插件，专为 Wayland 提供屏幕捕获支持，尤其在 Hyprland 或 River 等合成器下有效。paru -S wlrobs-hg。
</p>
</div>
</div>
</div>
<div id="outline-container-org82ec638" class="outline-2">
<h2 id="org82ec638">Settings</h2>
<div class="outline-text-2" id="text-org82ec638">
<p>
其他的初始化安装，我让 LLM 写了一个简单的小脚本来安装一些我需要的软件，字体，rime 输入法等。
</p>

<p>
下面列举的是一些困扰过我的地方，其他细小的设置 Claude CLI 基本都可以解决。
</p>
</div>
<div id="outline-container-org14e4562" class="outline-3">
<h3 id="org14e4562">Sway</h3>
<div class="outline-text-3" id="text-org14e4562">
<p>
Sway 会初始化一个配置文件在 <code>~/.config/sway/config</code> ，在配置文件里修改就好了。
</p>

<p>
分辨率设置：如果不放大，字就跟蚂蚁一样小
</p>

<p>
Asahi Alarm 由于苹果硬件的限制，只能缩放，更改不了分辨率，也可能是我没有找对方法。常规设置分辨率的方法不管用。
</p>

<p>
<code>exec --no-startup-id xrandr --output eDP-1 --scale 1.5x1.5</code>
</p>

<p>
截图:
</p>

<p>
使用 grim + swappy ,由于之前缩放的原因，flameshot 在截图的时候调用 grim 截图也是放大的，而且有兼容性问题。
</p>

<p>
<code>bindsym $mod+s exec --no-startup-id sh -c 'grim -g "$(slurp)" -s 1 - | swappy -f -'</code>
</p>

<p>
加上了 -s 1 参数，就可以解决截图放大的问题了。
</p>

<p>
OCR: 需要安装 <a href="https://github.com/tesseract-ocr/tesseract">tesseract-ocr/tesseract</a> 并下载相应语言的包
</p>

<p>
<code>bindsym $mod+Shift+s exec --no-startup-id ~/MyScripts/screenshot_ocr.sh</code>
</p>

<p>
这个脚本就是一个很简单的创建 tmp 截图文件，用 tesseract 识别保存到系统剪贴板。
</p>

<p>
设置系统音量：我耳朵被炸了好几次。。。
</p>

<p>
<code>exec --no-startup-id pactl set-sink-volume \@DEFAULT_SINK@ 55%</code>
</p>

<p>
设置系统显示器亮度：
</p>

<p>
<code>exec --no-startup-id brightnessctl set 20%</code>
</p>

<p>
和音量一样，如果不设置它会有一个默认的值，每次重启就需要重新设置。
</p>

<p>
设置壁纸：
</p>

<p>
<code>output * bg /home/vandee/Pictures/create.jpg fill</code>
</p>

<p>
剪贴板：
<code>exec wl-paste --watch cliphist store</code>
</p>
</div>
</div>
<div id="outline-container-orgd47b8e9" class="outline-3">
<h3 id="orgd47b8e9">充电提示音</h3>
<div class="outline-text-3" id="text-orgd47b8e9">
<p>
Asahi Linux 判断电池是通过 <code>/sys/class/power_supply/macsmc-ac</code>
</p>

<p>
udev 的方式在我的电脑上不管用，所以用了一个笨办法。
</p>

<p>
用 systemd 监控它的状态，处于充电状态的时候播放提示音，把这个 script 设置为 systemd service：
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #787878;">#</span><span style="color: #787878;">!/bin/</span><span style="color: #FFA657;">bash</span><span style="color: #787878;">
</span>
<span style="color: #787878;"># </span><span style="color: #787878;">Charger plug/unplug sound effect script
</span><span style="color: #787878;"># </span><span style="color: #787878;">Monitors /sys/class/power_supply/macsmc-ac/online and plays appropriate sounds
</span>
<span style="color: #f4f4ff;">POWER_SUPPLY_PATH</span>=<span style="color: #A1D08E;">"/sys/class/power_supply/macsmc-ac/online"</span>
<span style="color: #f4f4ff;">POWER_PLUG_SOUND</span>=<span style="color: #A1D08E;">"/usr/share/sounds/freedesktop/stereo/power-plug.oga"</span>
<span style="color: #f4f4ff;">POWER_UNPLUG_SOUND</span>=<span style="color: #A1D08E;">"/usr/share/sounds/freedesktop/stereo/power-unplug.oga"</span>

<span style="color: #787878;"># </span><span style="color: #787878;">Check if required files exist
</span><span style="color: #FFA657;">if</span> <span style="color: #8c8c8c;">[</span><span style="color: #93a8c6;">[</span> ! -f <span style="color: #A1D08E;">"$POWER_SUPPLY_PATH"</span> <span style="color: #93a8c6;">]</span><span style="color: #8c8c8c;">]</span>; <span style="color: #FFA657;">then</span>
    <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Error: Power supply path not found: $POWER_SUPPLY_PATH"</span>
    <span style="color: #FFA657;">exit</span> 1
<span style="color: #FFA657;">fi</span>

<span style="color: #FFA657;">if</span> <span style="color: #8c8c8c;">[</span><span style="color: #93a8c6;">[</span> ! -f <span style="color: #A1D08E;">"$POWER_PLUG_SOUND"</span> <span style="color: #93a8c6;">]</span><span style="color: #8c8c8c;">]</span> || <span style="color: #8c8c8c;">[</span><span style="color: #93a8c6;">[</span> ! -f <span style="color: #A1D08E;">"$POWER_UNPLUG_SOUND"</span> <span style="color: #93a8c6;">]</span><span style="color: #8c8c8c;">]</span>; <span style="color: #FFA657;">then</span>
    <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Error: Sound files not found"</span>
    <span style="color: #FFA657;">exit</span> 1
<span style="color: #FFA657;">fi</span>

<span style="color: #787878;"># </span><span style="color: #787878;">Function to play sound
</span><span style="color: #96a6c8;">play_sound</span><span style="color: #8c8c8c;">()</span> <span style="color: #8c8c8c;">{</span>
    <span style="color: #79C0FF;">local</span> <span style="color: #f4f4ff;">sound_file</span>=<span style="color: #A1D08E;">"$1"</span>
    <span style="color: #787878;"># </span><span style="color: #787878;">Try different audio players
</span>    <span style="color: #FFA657;">if </span><span style="color: #79C0FF;">command</span> -v paplay &gt;/dev/null 2&gt;&amp;1; <span style="color: #FFA657;">then</span>
        paplay --volume=78643 <span style="color: #A1D08E;">"$sound_file"</span> &gt;/dev/null 2&gt;&amp;1 &amp;
    <span style="color: #FFA657;">elif </span><span style="color: #79C0FF;">command</span> -v aplay &gt;/dev/null 2&gt;&amp;1; <span style="color: #FFA657;">then</span>
        aplay -v 15 <span style="color: #A1D08E;">"$sound_file"</span> &gt;/dev/null 2&gt;&amp;1 &amp;
    <span style="color: #FFA657;">elif </span><span style="color: #79C0FF;">command</span> -v mplayer &gt;/dev/null 2&gt;&amp;1; <span style="color: #FFA657;">then</span>
        mplayer -really-quiet -volume 150 <span style="color: #A1D08E;">"$sound_file"</span> &gt;/dev/null 2&gt;&amp;1 &amp;
    <span style="color: #FFA657;">else</span>
        <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Error: No suitable audio player found (paplay, aplay, or mplayer)"</span>
        <span style="color: #FFA657;">exit</span> 1
    <span style="color: #FFA657;">fi</span>
<span style="color: #8c8c8c;">}</span>

<span style="color: #787878;"># </span><span style="color: #787878;">Get initial state
</span><span style="color: #f4f4ff;">previous_state</span>=$<span style="color: #8c8c8c;">(</span><span style="color: #ff4f58;">cat "$POWER_SUPPLY_PATH"</span><span style="color: #8c8c8c;">)</span>
<span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Initial charger state: $previous_state"</span>

<span style="color: #787878;"># </span><span style="color: #787878;">Monitor for changes
</span><span style="color: #FFA657;">while</span> true; <span style="color: #FFA657;">do</span>
    <span style="color: #f4f4ff;">current_state</span>=$<span style="color: #8c8c8c;">(</span><span style="color: #ff4f58;">cat "$POWER_SUPPLY_PATH"</span><span style="color: #8c8c8c;">)</span>

    <span style="color: #FFA657;">if</span> <span style="color: #8c8c8c;">[</span><span style="color: #93a8c6;">[</span> <span style="color: #A1D08E;">"$current_state"</span> != <span style="color: #A1D08E;">"$previous_state"</span> <span style="color: #93a8c6;">]</span><span style="color: #8c8c8c;">]</span>; <span style="color: #FFA657;">then</span>
        <span style="color: #FFA657;">if</span> <span style="color: #8c8c8c;">[</span><span style="color: #93a8c6;">[</span> <span style="color: #A1D08E;">"$current_state"</span> == <span style="color: #A1D08E;">"1"</span> <span style="color: #93a8c6;">]</span><span style="color: #8c8c8c;">]</span>; <span style="color: #FFA657;">then</span>
            <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Charger plugged in"</span>
            play_sound <span style="color: #A1D08E;">"$POWER_PLUG_SOUND"</span>
        <span style="color: #FFA657;">else</span>
            <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Charger unplugged"</span>
            play_sound <span style="color: #A1D08E;">"$POWER_UNPLUG_SOUND"</span>
        <span style="color: #FFA657;">fi</span>
        <span style="color: #f4f4ff;">previous_state</span>=<span style="color: #A1D08E;">"$current_state"</span>
    <span style="color: #FFA657;">fi</span>

    sleep 1
<span style="color: #FFA657;">done</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgee6598d" class="outline-3">
<h3 id="orgee6598d">Others</h3>
<div class="outline-text-3" id="text-orgee6598d">
<ul class="org-ul">
<li><p>
调整对比度(X11)
</p>

<p>
<code>sudo pacman -S xorg-xgamma</code>
</p>

<p>
<code>xgamma -gamma 0.8</code>
</p></li>
<li><p>
设置屏幕亮度
</p>

<p>
<code>brightnessctl set 20%</code>
</p></li>
<li><p>
解决 macbooks 无法播放音频的问题：
</p>

<p>
<code>sudo pacman -S asahi-audio</code>
</p></li>
<li><p>
opensnatch 因为 eBPF 报错
</p>

<p>
修改 <code>/etc/opensnitchd/default-config.json</code>
</p>

<p>
把 procmonitormethod 更改成 proc
</p></li>

<li><p>
音量控制：sudo pacman -S pavucontrol
</p>

<p>
更轻量化的：sudo pacman -S volumeicon
</p></li>
</ul>
</div>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-linux.html">Linux</a> </div>]]></description>
  <category><![CDATA[Linux]]></category>
  <link>https://www.vandee.art/blog/2025-12-09-native-linux-on-apple-silicon-mac.html</link>
  <guid>https://www.vandee.art/blog/2025-12-09-native-linux-on-apple-silicon-mac.html</guid>
  <pubDate>Tue, 09 Dec 2025 11:03:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[我的 Emacs 键位设置]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgf382524">TL;DR</a></li>
<li><a href="#org8fead67">组合快捷键 VS 序列快捷键</a></li>
<li><a href="#orgaefbc2b">我的键位设置</a>
<ul>
<li><a href="#org7a0ba35">General</a></li>
<li><a href="#orga3554ad">mark &amp; move</a></li>
<li><a href="#org308fdc9">hydra &amp; general</a></li>
<li><a href="#org9953df0">Misc</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<div id="outline-container-orgf382524" class="outline-2">
<h2 id="orgf382524">TL;DR</h2>
<div class="outline-text-2" id="text-orgf382524">
<p>
我更喜欢在 Emacs 里编辑文字和代码，但是更习惯 vim 的编辑模式和设计，Emacs 里原生的 Ctrl 组合键设计对于频繁的代码编辑来说，有点反人类。
</p>
</div>
</div>
<div id="outline-container-org8fead67" class="outline-2">
<h2 id="org8fead67">组合快捷键 VS 序列快捷键</h2>
<div class="outline-text-2" id="text-org8fead67">
<p>
组合快捷键位：Ctrl+C，序列快捷键：leader key + 按键，Space -&gt; C。
</p>

<ul class="org-ul">
<li>组合快捷键的优势: 相应更快，需要执行键位操作的绝对次数更少，按一次组合键视为一次键位操作。</li>
<li>序列快捷键的优势: 键位的设置更加灵活，手指更轻松。但是需要执行的按键操作的绝对次数更多，同样按一次按键视为依次键位操作。</li>
</ul>

<p>
我认为它们对应着两种思维模式:
</p>

<ul class="org-ul">
<li>组合快捷键里的 Ctrl、Alt、Shift、Command 是附加键，这些不同的附加键位映射不同的功能。在 window 里，和应用窗口相关的菜单操作通常是 Alt，和系统相关的通常是 Win。也就是说，它是常规按键+功能的叠加组合。Mac 里的 Option 和 Command 同理。</li>

<li>序列快捷键则是设定一个 leader key 作为功能的入口，例如 Nvim 里通常 Space 作为 leader key，Space -&gt; f，表示和 file 文件相关的，Space -&gt; f -&gt; r，表示浏览最近的文件 recent files。它是一种递进的层级设计。不同的功能选择不同的 leader key，vim 里的 g 也就是一个 leader key。</li>
</ul>

<p>
在 Emacs 里，C-x(Ctrl+x) 是和 window 窗口相关的快捷键，这个组合键实际上也是一个 leader key。由于 Emacs 和通常的文字编辑器里没有 vim 的输入模式的区分，都是按键直接输入文字，因此必须得加上 Ctrl 这个功能附加键避免输入字符。
</p>

<p>
Vim 有三种编辑模式：Normal，Visual，Insert。normal 对应光标的移动，visual 对应区域选定，insert 对应输入。按 v 进入 visual，i、a、s、c 都可以进入 insert，jk 快速连按则是退出 insert。jkhl 分别对应光标的下上左右移动，其他的就不展开了。Vim 这套设计逻辑实现了不依赖鼠标的全键盘文本编辑器里的光标移动，页面滚动，快速更改，删除，查找。
</p>
</div>
</div>
<div id="outline-container-orgaefbc2b" class="outline-2">
<h2 id="orgaefbc2b">我的键位设置</h2>
<div class="outline-text-2" id="text-orgaefbc2b">
<p>
现在 vibe 这么方便了，为什么还要在这个上面花这么多心思？我觉得用键盘打字 coding 和弹吉他的感觉很像。在 Emacs 里配置这些键位对我来说，就像在调琴弦，调合成器一样。vibe 更多的是享受结果，而这些则是享受过程。
</p>

<p>
按键的设置和设计，往大了说，这些键位的映射也是个人的思维和逻辑习惯的映射。编程是一种表达的艺术，类比绘画，键位的编辑器设置就是画笔笔触的个人艺术风格。
</p>

<p>
对于编辑代码的人来说，这些快捷键设置就像一个搞影像编辑的人的 Photoshop 的自定义动作一样，每个人都有自己的思维习惯和操作习惯。让一个程序员失去编程能力只需要一步：换掉他的键盘，然后配置另一个人的按键配置🤣 。
</p>

<p>
所以后面也只是简单说明一些配置按键用到的 Emacs 包和键位设置的思路。
</p>

<p>
Why emacs not vim? 只是因为更习惯 Emacs 了，这些在 vim 和 Nvim 里同样可以。
</p>
</div>
<div id="outline-container-org7a0ba35" class="outline-3">
<h3 id="org7a0ba35">General</h3>
<div class="outline-text-3" id="text-org7a0ba35">
<p>
现在配置了 m 作为 mark 的 leader key。Emacs 里的 mark 相当于 vim 里的 visual 模式。但是 Emacs 默认的 mark 键位我很不习惯，vim 里 visual 模式快速选择 symbol，word，sentence 中英混合再加上代码又不是那么方便。把 m 绑定在了 Emacs 的 <code>mark-sexp</code> 上，现在 mm 就可以连续 mark 了。
</p>

<p>
Vim 默认的 f，w，e，b 小范围移动，vi，va 选定函数内部特定的内容，gd 跳转到定义，]] 函数间跳转，再加上自定义的 m 序列按键，Emacs 里自带的 <code>forward-sexp</code> , <code>backward-sexp</code> 等函数，日常的代码的选中移动基本可以全键盘覆盖。
</p>

<p>
Vim 最核心设计的就是它的三个编辑模式，便利的移动导航是 vim 的灵魂，弊端就是需要频繁的切换模式。Normal 模式 c，a，i，d，x，s 提供了非常全面、便捷的增添删减方法，但是 insert 模式下就只是 insert（可以临时执行一次 normal 指令）。
</p>

<p>
在 vim 里，快速删除前后的内容可以使用 d 加上方向导航键位，例如 dl,dw,db,de，也可以使用 c 在删除之后直接进入 insert。但是在 insert 之后再想执行 d 的快捷删除就得退出 insert 模式。
</p>

<p>
最恶心的就是在输出各种成对出现的 <code>()</code> , <code>{}</code> , <code>""</code> 的时候，这偏偏又是代码里频率很高的。输入完括号内的内容之后，移动光标到括号外再输入，这个过程在 vim 里要先退出 insert，移动光标，再进入 insert，而组合键只需要一次移动光标的操作（Emacs 里是 Ctrl+f,Ctrl+b。箭头方向键在一般的键盘里都太远了），这种场景下我觉得组合键的优势是很明显的，也更符合直觉。当然习惯了也都差不多，多一次 jk 也不麻烦，但有时候就是觉得有点膈应。
</p>

<p>
2025-12-07 added：
</p>

<p>
这个问题原来很多插件都可以解决。在输入完()之后，只需要再按一次相应成对符号右边的符号就可以移动到成对符号外了。
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">when</span> <span style="color: #93a8c6;">(</span>fboundp <span style="color: #FFA657;">'</span><span style="color: #95a99f;">electric-pair-mode</span><span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">setq</span> electric-pair-pairs <span style="color: #b0b1a3;">(</span>append electric-pair-pairs <span style="color: #FFA657;">'</span><span style="color: #97b098;">(</span><span style="color: #aebed8;">(</span>?\{ . ?\}<span style="color: #aebed8;">)</span> <span style="color: #aebed8;">(</span>?\<span style="color: #FFA657;">'</span> <span style="color: #95a99f;">.</span> ?\<span style="color: #FFA657;">'</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span>add-hook <span style="color: #FFA657;">'</span><span style="color: #95a99f;">after-init-hook</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">electric-pair-mode</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span>add-hook <span style="color: #FFA657;">'</span><span style="color: #95a99f;">after-init-hook</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">electric-indent-mode</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>

<p>
想过其他许多方式来减少 vim 模式切换的操作，但是实际体验下来还是多切换更省事。移动的时候还是退回到 normal，极少数情况下也用 Ctrl 组合键在 insert 模式下移动光标。复制粘贴删除的操作原则上都在 normal 模式里进行，m 键位的设置也是在 normal 模式下的，极少数编辑操作（快速删除到行尾，快速删除当前光标到单词的末尾，快速删除当前光标到单词的开头等）使用 Ctrl 组合键在 insert 模式下使用。
</p>

<p>
因此在 Emacs 里补足 insert 模式就好了。
</p>

<p>
除去 vim 模式和 Emacs 本身占用的键位，可以自定义的其实不多，我觉得比较合适的是 <code>m</code> , <code>r</code> , <code>,</code> , <code>.</code> , <code>/</code> , <code>;</code> , <code>'</code> , <code>[</code> , <code>]</code>
</p>

<p>
它们既可以作为 leader key ，还可以和 Ctrl 等附加键作为组合键。Emacs 和 vim 里它们都没有绑定很核心的功能或是空缺的设置。
</p>

<p>
在 Emacs 的快捷键设置里 Ctrl 记作 C，Alt 和 Option 记作 M，Shift 记作 S，Win 和 Command 记作 s(super 键)，组合键用 <code>-</code> 链接起来，ctrl+c 记作 <code>C-c</code> 。Emacs 可以自定义 minor mode，用 hook 在不同的编程语言里激活不同的自定义 minor mode，各自的 mode map 又可以设置不同的快捷键，相同的快捷键就可以实现不同的功能了。
</p>

<p>
在这几年的使用中，逐渐形成了下面的这些按键配置和习惯。Evil 里有许多完全不常用的功能会占用快捷键的键位，许多默认键位和原生的 vim 也不相同，所以能取消的都取消了，在函数的选择上也尽量使用 Emacs 原生的函数，Emacs 有的就不用 evil 的了。
</p>

<p>
感觉这些快捷键的设置上还是比较符合直觉的。
</p>

<p>
下面是一些具体的配置片段和常用的自定义功能:
</p>
</div>
</div>
<div id="outline-container-orga3554ad" class="outline-3">
<h3 id="orga3554ad">mark &amp; move</h3>
<div class="outline-text-3" id="text-orga3554ad">
<p>
下面的配置包含了设定 mark 方便在代码编辑里来回跳转，defun，symbol，word 的快速复制剪切。
</p>

<p>
对比 vio 选中 symbol -&gt; y 复制，ms 只需要按两次。少一次按键在复杂度上就少了一个层级。
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #787878;">;; </span><span style="color: #787878;">https://github.com/VandeeFeng/emacs.d/blob/archlinux/lisp/init-editing-utils.el
</span><span style="color: #787878;">;; </span><span style="color: #787878;">Mark &amp; edit
</span><span style="color: #8c8c8c;">(</span>global-set-key <span style="color: #93a8c6;">(</span>kbd <span style="color: #A1D08E;">"M-m"</span><span style="color: #93a8c6;">)</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">set-mark-command</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">with-eval-after-load</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">evil</span>
  <span style="color: #93a8c6;">(</span>define-prefix-command <span style="color: #FFA657;">'</span><span style="color: #95a99f;">my/mark-map</span><span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span>define-key evil-normal-state-map <span style="color: #b0b1a3;">(</span>kbd <span style="color: #A1D08E;">"m"</span><span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">my/mark-map</span><span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span>define-key evil-motion-state-map <span style="color: #b0b1a3;">(</span>kbd <span style="color: #A1D08E;">";"</span><span style="color: #b0b1a3;">)</span> nil<span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">evil-define-key</span> <span style="color: #FFA657;">'</span><span style="color: #b0b1a3;">(</span>normal visual<span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">global</span>
    <span style="color: #A1D08E;">"gc"</span> <span style="color: #FFA657;">#'</span><span style="color: #95a99f;">comment-dwim</span><span style="color: #93a8c6;">)</span>

  <span style="color: #787878;">;; </span><span style="color: #787878;">this keybindings only use not in insert mode
</span>  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">dolist</span> <span style="color: #b0b1a3;">(</span>binding <span style="color: #FFA657;">'</span><span style="color: #97b098;">(</span><span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"m"</span> . mark-sexp<span style="color: #aebed8;">)</span>
                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"p"</span> . set-pin-mark<span style="color: #aebed8;">)</span> <span style="color: #787878;">; </span><span style="color: #787878;">&#36825;&#26159;&#33258;&#24049;&#23454;&#29616;&#30340; init-mark.el
</span>                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"g"</span> . goto-pin-mark<span style="color: #aebed8;">)</span> <span style="color: #787878;">; </span><span style="color: #787878;">&#31616;&#21270;&#29256;&#30340; bookmark
</span>                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"d"</span> . mark-defun<span style="color: #aebed8;">)</span>
                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">";"</span> . comment-indent<span style="color: #aebed8;">)</span>
                     <span style="color: #787878;">;; </span><span style="color: #787878;">(";" . comment-dwim) ; use gc instead
</span>                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"k"</span> . move-dup-move-lines-up<span style="color: #aebed8;">)</span>
                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"j"</span> . move-dup-move-lines-down<span style="color: #aebed8;">)</span>
                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"u"</span> . upcase-dwim<span style="color: #aebed8;">)</span> <span style="color: #787878;">; </span><span style="color: #787878;">equal to g U in vim
</span>                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"s"</span> . thing-copy-symbol<span style="color: #aebed8;">)</span>
                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"S"</span> . thing-cut-symbol<span style="color: #aebed8;">)</span>
                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"w"</span> . thing-copy-word<span style="color: #aebed8;">)</span>
                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"W"</span> . thing-cut-word<span style="color: #aebed8;">)</span>
                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"-"</span> . thing-copy-to-line-end<span style="color: #aebed8;">)</span>
                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"_"</span> . thing-cut-to-line-end<span style="color: #aebed8;">)</span>
                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"0"</span> . thing-copy-to-line-beginning<span style="color: #aebed8;">)</span>
                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">")"</span> . thing-cut-to-line-beginning<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span>define-key my/mark-map <span style="color: #97b098;">(</span>kbd <span style="color: #aebed8;">(</span>car binding<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span> <span style="color: #97b098;">(</span>cdr binding<span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>
  <span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">with-eval-after-load</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">evil</span>
  <span style="color: #787878;">;; </span><span style="color: #787878;">normal, visual, insert
</span>  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">dolist</span> <span style="color: #b0b1a3;">(</span>binding <span style="color: #FFA657;">'</span><span style="color: #97b098;">(</span><span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"C-s"</span> . backward-kill-sexp<span style="color: #aebed8;">)</span>
                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"C-S-s"</span> . kill-back-to-indentation<span style="color: #aebed8;">)</span>
                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"C-d"</span> . kill-sexp<span style="color: #aebed8;">)</span>
                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"C-k"</span> . kill-visual-line<span style="color: #aebed8;">)</span>
                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"C-y"</span> . clipboard-yank<span style="color: #aebed8;">)</span>
                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"C-a"</span> . beginning-of-line<span style="color: #aebed8;">)</span>
                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"C-e"</span> . end-of-line<span style="color: #aebed8;">)</span>
                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"C-b"</span> . backward-char<span style="color: #aebed8;">)</span> <span style="color: #787878;">;; </span><span style="color: #787878;">&#35206;&#30422; evil &#30340;&#38190;&#20301;&#65292;&#22238;&#24402; Emacs &#40664;&#35748;&#38190;&#20301;
</span>                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"C-f"</span> . forward-char<span style="color: #aebed8;">)</span> <span style="color: #787878;">;; </span><span style="color: #787878;">&#35206;&#30422; evil &#30340;&#38190;&#20301;&#65292;&#22238;&#24402; Emacs &#40664;&#35748;&#38190;&#20301;
</span>                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"C-n"</span> . next-line<span style="color: #aebed8;">)</span> <span style="color: #787878;">;; </span><span style="color: #787878;">&#35206;&#30422; evil &#30340;&#38190;&#20301;&#65292;&#22238;&#24402; Emacs &#40664;&#35748;&#38190;&#20301;
</span>                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"C-p"</span> . previous-line<span style="color: #aebed8;">)</span> <span style="color: #787878;">;; </span><span style="color: #787878;">&#35206;&#30422; evil &#30340;&#38190;&#20301;&#65292;&#22238;&#24402; Emacs &#40664;&#35748;&#38190;&#20301;
</span>                     <span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #FFA657;">dolist</span> <span style="color: #97b098;">(</span>state <span style="color: #FFA657;">'</span><span style="color: #aebed8;">(</span>normal visual insert<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span>evil-global-set-key state <span style="color: #aebed8;">(</span>kbd <span style="color: #b0b0b3;">(</span>car binding<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span> <span style="color: #aebed8;">(</span>cdr binding<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>

  <span style="color: #787878;">;; </span><span style="color: #787878;">;; visual, insert
</span>  <span style="color: #787878;">;; </span><span style="color: #787878;">(dolist (binding '(("C-h" . backward-char)
</span>  <span style="color: #787878;">;;                    </span><span style="color: #787878;">("C-l" . forward-char)
</span>  <span style="color: #787878;">;;                    </span><span style="color: #787878;">("C-j" . next-line)
</span>  <span style="color: #787878;">;;                    </span><span style="color: #787878;">("C-k" . previous-line)))
</span>  <span style="color: #787878;">;;   </span><span style="color: #787878;">(dolist (state '(visual insert))
</span>  <span style="color: #787878;">;;     </span><span style="color: #787878;">(evil-global-set-key state (kbd (car binding)) (cdr binding))))
</span>
  <span style="color: #787878;">;; </span><span style="color: #787878;">normal visual
</span>  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">dolist</span> <span style="color: #b0b1a3;">(</span>binding <span style="color: #FFA657;">'</span><span style="color: #97b098;">(</span><span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"-"</span> . end-of-line<span style="color: #aebed8;">)</span>
                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">","</span> . backward-sexp<span style="color: #aebed8;">)</span>
                     <span style="color: #aebed8;">(</span><span style="color: #A1D08E;">"."</span> . forward-sexp<span style="color: #aebed8;">)</span>
                     <span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #FFA657;">dolist</span> <span style="color: #97b098;">(</span>state <span style="color: #FFA657;">'</span><span style="color: #aebed8;">(</span>normal visual<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span>evil-global-set-key state <span style="color: #aebed8;">(</span>kbd <span style="color: #b0b0b3;">(</span>car binding<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span> <span style="color: #aebed8;">(</span>cdr binding<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>

  <span style="color: #93a8c6;">(</span>define-key evil-motion-state-map <span style="color: #b0b1a3;">(</span>kbd <span style="color: #A1D08E;">"C-v"</span><span style="color: #b0b1a3;">)</span> nil<span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span>global-unset-key <span style="color: #b0b1a3;">(</span>kbd <span style="color: #A1D08E;">"C-v"</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span>global-set-key <span style="color: #b0b1a3;">(</span>kbd <span style="color: #A1D08E;">"S-&lt;backspace&gt;"</span><span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">delete-char</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org308fdc9" class="outline-3">
<h3 id="org308fdc9">hydra &amp; general</h3>
<div class="outline-text-3" id="text-org308fdc9">
<p>
由于我使用 evil，设置 leader key 还是用的 general，但是最近把按键的设置转到了 hydra，因为它可以根据不同的 Emacs 的 major mode 显示不同的 hydra key body。同样一个触发键，在 org mode 里可以显示 org 的快捷键设置，在不同的编程语言 mode 里可以专门的快捷键。
</p>

<p>
我有时候也用 Nvim，所以还是用 SPC 作为 leader key：
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #787878;">;; </span><span style="color: #787878;">https://github.com/VandeeFeng/emacs.d/blob/archlinux/lisp/init-hydra.el
</span><span style="color: #787878;">;; </span><span style="color: #787878;">general &#35774;&#32622; leader key SPC
</span><span style="color: #8c8c8c;">(</span>general-define-key
 <span style="color: #79C0FF;">:states</span> <span style="color: #FFA657;">'</span><span style="color: #93a8c6;">(</span>normal motion visual<span style="color: #93a8c6;">)</span>
 <span style="color: #79C0FF;">:keymaps</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">override</span>
 <span style="color: #79C0FF;">:prefix</span> <span style="color: #A1D08E;">"SPC"</span>
 <span style="color: #A1D08E;">""</span> <span style="color: #FFA657;">'</span><span style="color: #93a8c6;">(</span>hydra-leader/body <span style="color: #79C0FF;">:wk</span> <span style="color: #A1D08E;">"hydra leader"</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #787878;">;; </span><span style="color: #787878;">&#19981;&#21516;&#27169;&#24335;&#30340;&#24120;&#29992;&#24555;&#25463;&#38190;&#35774;&#32622;
</span><span style="color: #787878;">;; </span><span style="color: #787878;">Mode-specific hydra bindings
</span><span style="color: #8c8c8c;">(</span>define-key evil-normal-state-map <span style="color: #93a8c6;">(</span>kbd <span style="color: #A1D08E;">"C-."</span><span style="color: #93a8c6;">)</span> nil<span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">defun</span> <span style="color: #96a6c8;">hydra-mode-setup</span> <span style="color: #93a8c6;">()</span>
  <span style="color: #787878;">"Setup hydra bindings for specific modes."</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">cond</span>
   <span style="color: #b0b1a3;">(</span><span style="color: #97b098;">(</span>eq major-mode <span style="color: #FFA657;">'</span><span style="color: #95a99f;">dired-mode</span><span style="color: #97b098;">)</span>
    <span style="color: #97b098;">(</span>local-set-key <span style="color: #aebed8;">(</span>kbd <span style="color: #A1D08E;">"C-."</span><span style="color: #aebed8;">)</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">hydra-dired/body</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>

   <span style="color: #b0b1a3;">(</span><span style="color: #97b098;">(</span>eq major-mode <span style="color: #FFA657;">'</span><span style="color: #95a99f;">org-mode</span><span style="color: #97b098;">)</span>
    <span style="color: #97b098;">(</span>local-set-key <span style="color: #aebed8;">(</span>kbd <span style="color: #A1D08E;">"C-."</span><span style="color: #aebed8;">)</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">hydra-org/body</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>

   <span style="color: #b0b1a3;">(</span><span style="color: #97b098;">(</span>eq major-mode <span style="color: #FFA657;">'</span><span style="color: #95a99f;">magit-status-mode</span><span style="color: #97b098;">)</span>
    <span style="color: #97b098;">(</span>local-set-key <span style="color: #aebed8;">(</span>kbd <span style="color: #A1D08E;">"C-."</span><span style="color: #aebed8;">)</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">hydra-magit/body</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>

   <span style="color: #b0b1a3;">(</span><span style="color: #97b098;">(</span>derived-mode-p <span style="color: #FFA657;">'</span><span style="color: #95a99f;">prog-mode</span><span style="color: #97b098;">)</span>
    <span style="color: #97b098;">(</span>local-set-key <span style="color: #aebed8;">(</span>kbd <span style="color: #A1D08E;">"C-."</span><span style="color: #aebed8;">)</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">hydra-code/body</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #787878;">;; </span><span style="color: #787878;">Add mode-specific setup to hooks
</span><span style="color: #8c8c8c;">(</span>add-hook <span style="color: #FFA657;">'</span><span style="color: #95a99f;">dired-mode-hook</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">hydra-mode-setup</span><span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span>add-hook <span style="color: #FFA657;">'</span><span style="color: #95a99f;">org-mode-hook</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">hydra-mode-setup</span><span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span>add-hook <span style="color: #FFA657;">'</span><span style="color: #95a99f;">magit-status-mode-hook</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">hydra-mode-setup</span><span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span>add-hook <span style="color: #FFA657;">'</span><span style="color: #95a99f;">prog-mode-hook</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">hydra-mode-setup</span><span style="color: #8c8c8c;">)</span>

</pre>
</div>
</div>
</div>
<div id="outline-container-org9953df0" class="outline-3">
<h3 id="org9953df0">Misc</h3>
<div class="outline-text-3" id="text-org9953df0">
<p>
其他自定义函数在：<a href="https://github.com/VandeeFeng/emacs.d/blob/archlinux/lisp/init-custom-functions.el">https://github.com/VandeeFeng/emacs.d/blob/archlinux/lisp/init-custom-functions.el</a>
</p>

<p>
jk 退出 insert：
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #787878;">;; </span><span style="color: #787878;">jk &#36864;&#20986; insert
</span><span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">with-eval-after-load</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">evil</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">use-package</span> key-chord
    <span style="color: #79C0FF;">:ensure</span> t
    <span style="color: #79C0FF;">:config</span>
    <span style="color: #b0b1a3;">(</span>key-chord-mode 1<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #FFA657;">setq</span> key-chord-two-keys-delay 0.3<span style="color: #b0b1a3;">)</span> <span style="color: #787878;">;; </span><span style="color: #787878;">&#29256;&#26412;&#26356;&#26032;&#20043;&#21518;&#65292;&#40664;&#35748;j k &#30340;&#21028;&#26029;&#26102;&#38388;&#21464;&#23569;&#20102;
</span>    <span style="color: #b0b1a3;">(</span>key-chord-define evil-insert-state-map <span style="color: #A1D08E;">"jk"</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">evil-normal-state</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>

<p>
compile grep search：
</p>

<p>
这是我用的最多的一个搜索。可以用 grep 搜索当前文件目录下关键字。用 Emacs 里的 compile 模式的好处是，它会在搜索结果的 minibuffer 里显示对应的文件的跳转链接，直接点击就跳转了。
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #787878;">;; </span><span style="color: #787878;">compile grep
</span><span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">defun</span> <span style="color: #96a6c8;">my/compile-grep-rn</span> <span style="color: #93a8c6;">(</span>pattern<span style="color: #93a8c6;">)</span>
  <span style="color: #787878;">"Run `grep -irn` with the given PATTERN in the current directory."</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">interactive</span> <span style="color: #A1D08E;">"sGrep pattern: "</span><span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span>compile <span style="color: #b0b1a3;">(</span>format <span style="color: #A1D08E;">"grep -irn '</span><span style="color: #95a99f;">%s</span><span style="color: #A1D08E;">' ."</span> pattern<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>

<p>
compile 指令执行之后自动聚焦 compilation buffer：
</p>

<p>
默认情况下，执行完 compile 指令，弹出 compilation buffer 的时候，光标还是在原来的 buffer，每次都要移动一次，很烦。
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #787878;">;; </span><span style="color: #787878;">Auto switch to compilation buffer after compile finishes
</span><span style="color: #8c8c8c;">(</span>add-hook <span style="color: #FFA657;">'</span><span style="color: #95a99f;">compilation-finish-functions</span>
          <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">lambda</span> <span style="color: #b0b1a3;">(</span>buffer _status<span style="color: #b0b1a3;">)</span>
            <span style="color: #b0b1a3;">(</span>select-window <span style="color: #97b098;">(</span>get-buffer-window buffer<span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>

<p>
org-backlink:
</p>

<p>
同样也是用 grep 搜索当前 org 笔记的反链，可以结合 embark 添加后续功能。
</p>

<div class="org-src-container">
<pre class="src src-elisp">
<span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">defun</span> <span style="color: #96a6c8;">my/org-backlink</span> <span style="color: #93a8c6;">()</span>
  <span style="color: #787878;">"Find all org files in the current directory that link to the current file.
The search is performed using `rgrep` for the specific pattern
'filename.org][filename]]'."</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">interactive</span><span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">unless</span> buffer-file-name
    <span style="color: #b0b1a3;">(</span><span style="color: #f43841;">error</span> <span style="color: #A1D08E;">"Current buffer is not visiting a file"</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>

  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">let*</span> <span style="color: #b0b1a3;">(</span><span style="color: #97b098;">(</span>current-file <span style="color: #aebed8;">(</span>file-name-nondirectory buffer-file-name<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
         <span style="color: #97b098;">(</span>current-dir <span style="color: #aebed8;">(</span>file-name-directory buffer-file-name<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
         <span style="color: #97b098;">(</span>file-basename <span style="color: #aebed8;">(</span>file-name-sans-extension current-file<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
         <span style="color: #787878;">;; </span><span style="color: #787878;">Search for the literal string "filename.org][filename]]"
</span>         <span style="color: #97b098;">(</span>search-pattern <span style="color: #aebed8;">(</span>concat <span style="color: #b0b0b3;">(</span>regexp-quote current-file<span style="color: #b0b0b3;">)</span>
                                 <span style="color: #A1D08E;">"</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E;">]</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E;">["</span>
                                 <span style="color: #b0b0b3;">(</span>regexp-quote file-basename<span style="color: #b0b0b3;">)</span>
                                 <span style="color: #A1D08E;">"</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E;">]</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E;">]"</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span>rgrep search-pattern <span style="color: #A1D08E;">"*.org"</span> current-dir<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>

<p>
simple claude:
</p>

<p>
使用 shell，快速运行 Claude Code 执行 <code>claude -p</code> 指令回答一些简单的问题，把结果输出到单独的 buffer。有时候不想用 gptel 就用这个。可以替换成 Gemini 和 Codex。
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #787878;">;; </span><span style="color: #787878;">simple claude code shell command
</span><span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">defun</span> <span style="color: #96a6c8;">my/claude-shell-command</span> <span style="color: #93a8c6;">(</span>prompt<span style="color: #93a8c6;">)</span>
  <span style="color: #787878;">"Execute claude command asynchronously and display the output."</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">interactive</span> <span style="color: #A1D08E;">"sClaude prompt: "</span><span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">let*</span> <span style="color: #b0b1a3;">(</span><span style="color: #97b098;">(</span>output-buffer-name <span style="color: #A1D08E;">"*Claude Output*"</span><span style="color: #97b098;">)</span>
         <span style="color: #97b098;">(</span>output-buffer <span style="color: #aebed8;">(</span>get-buffer-create output-buffer-name<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
         <span style="color: #97b098;">(</span>shell-program <span style="color: #aebed8;">(</span><span style="color: #FFA657;">or</span> <span style="color: #b0b0b3;">(</span>getenv <span style="color: #A1D08E;">"SHELL"</span><span style="color: #b0b0b3;">)</span> shell-file-name<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
         <span style="color: #787878;">;; </span><span style="color: #787878;">Use shell-quote-argument
</span>         <span style="color: #97b098;">(</span>command-str <span style="color: #aebed8;">(</span>format <span style="color: #A1D08E;">"claude -p %s"</span> <span style="color: #b0b0b3;">(</span>shell-quote-argument prompt<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #FFA657;">with-current-buffer</span> output-buffer
      <span style="color: #97b098;">(</span><span style="color: #FFA657;">setq</span> buffer-read-only nil<span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span>erase-buffer<span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span><span style="color: #FFA657;">setq-local</span> header-line-format <span style="color: #aebed8;">(</span>format <span style="color: #A1D08E;">"Claude Output for prompt: %s"</span> prompt<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #787878;">;; </span><span style="color: #787878;">(display-buffer output-buffer) ; Show the buffer immediately
</span>    <span style="color: #b0b1a3;">(</span>message <span style="color: #A1D08E;">"Claude command running asynchronously..."</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #787878;">;; </span><span style="color: #787878;">Start the async process
</span>    <span style="color: #b0b1a3;">(</span><span style="color: #FFA657;">let</span> <span style="color: #97b098;">(</span><span style="color: #aebed8;">(</span>process <span style="color: #b0b0b3;">(</span>start-process <span style="color: #A1D08E;">"claude-process"</span>
                                  output-buffer-name
                                  shell-program
                                  <span style="color: #A1D08E;">"-lc"</span>
                                  command-str<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
      <span style="color: #787878;">;; </span><span style="color: #787878;">Set a function to be called when the process finishes
</span>      <span style="color: #97b098;">(</span>set-process-sentinel process <span style="color: #FFA657;">#'</span><span style="color: #95a99f;">my/claude-process-sentinel</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">defun</span> <span style="color: #96a6c8;">my/claude-process-sentinel</span> <span style="color: #93a8c6;">(</span>process _event<span style="color: #93a8c6;">)</span>
  <span style="color: #787878;">"Sentinel for the claude async process. Handles success and error cases."</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">when</span> <span style="color: #b0b1a3;">(</span>memq <span style="color: #97b098;">(</span>process-status process<span style="color: #97b098;">)</span> <span style="color: #FFA657;">'</span><span style="color: #97b098;">(</span>exit signal<span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #FFA657;">let*</span> <span style="color: #97b098;">(</span><span style="color: #aebed8;">(</span>buffer <span style="color: #b0b0b3;">(</span>process-buffer process<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span>
           <span style="color: #aebed8;">(</span>exit-code <span style="color: #b0b0b3;">(</span>process-exit-status process<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span><span style="color: #FFA657;">cond</span>
       <span style="color: #787878;">;; </span><span style="color: #787878;">Case 1: Process failed (non-zero exit code)
</span>       <span style="color: #aebed8;">(</span><span style="color: #b0b0b3;">(</span>/= exit-code 0<span style="color: #b0b0b3;">)</span>
        <span style="color: #b0b0b3;">(</span>kill-buffer buffer<span style="color: #b0b0b3;">)</span>
        <span style="color: #b0b0b3;">(</span><span style="color: #FFA657;">if</span> <span style="color: #90a890;">(</span>= exit-code 127<span style="color: #90a890;">)</span>
            <span style="color: #90a890;">(</span>message <span style="color: #A1D08E;">"Error: '</span><span style="color: #95a99f;">claude</span><span style="color: #A1D08E;">' command not found. Please ensure it's in your shell's PATH."</span><span style="color: #90a890;">)</span>
          <span style="color: #90a890;">(</span>message <span style="color: #A1D08E;">"Error: Claude command failed with exit code %d."</span> exit-code<span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span>

       <span style="color: #787878;">;; </span><span style="color: #787878;">Case 2: Process succeeded but produced no output
</span>       <span style="color: #aebed8;">(</span><span style="color: #b0b0b3;">(</span>zerop <span style="color: #90a890;">(</span><span style="color: #FFA657;">with-current-buffer</span> buffer <span style="color: #a2b6da;">(</span>buffer-size<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span>
        <span style="color: #b0b0b3;">(</span>kill-buffer buffer<span style="color: #b0b0b3;">)</span>
        <span style="color: #b0b0b3;">(</span>message <span style="color: #A1D08E;">"Claude command finished with no output."</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span>

       <span style="color: #787878;">;; </span><span style="color: #787878;">Case 3: Success
</span>       <span style="color: #aebed8;">(</span>t
        <span style="color: #b0b0b3;">(</span><span style="color: #FFA657;">with-current-buffer</span> buffer
          <span style="color: #90a890;">(</span><span style="color: #FFA657;">setq</span> buffer-read-only t<span style="color: #90a890;">)</span>
          <span style="color: #90a890;">(</span>goto-char <span style="color: #a2b6da;">(</span>point-min<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span>
        <span style="color: #b0b0b3;">(</span>display-buffer buffer<span style="color: #b0b0b3;">)</span>
        <span style="color: #b0b0b3;">(</span>message <span style="color: #A1D08E;">"Claude command finished."</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

</pre>
</div>

<p>
浏览器划词提问：
</p>

<p>
利用 org-protocol 和 JavaScript 对浏览器页面里的特定内容在 Emacs 里用 gptel 提问
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">require</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">org-protocol</span><span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">require</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">gptel</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">require</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">server</span><span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">unless</span> <span style="color: #93a8c6;">(</span>server-running-p<span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span>server-start<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #787878;">;; </span><span style="color: #787878;">Handler for gptel queries from browser
</span><span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">defun</span> <span style="color: #96a6c8;">my/gptel-org-protocol-handler</span> <span style="color: #93a8c6;">(</span>info<span style="color: #93a8c6;">)</span>
  <span style="color: #787878;">"Handle gptel query from org-protocol.
INFO is the data passed by org-protocol."</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">let</span> <span style="color: #b0b1a3;">(</span><span style="color: #97b098;">(</span>text <span style="color: #aebed8;">(</span>plist-get info <span style="color: #79C0FF;">:text</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #FFA657;">when</span> <span style="color: #97b098;">(</span><span style="color: #FFA657;">and</span> text <span style="color: #aebed8;">(</span>not <span style="color: #b0b0b3;">(</span>string-empty-p text<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span><span style="color: #FFA657;">let</span> <span style="color: #aebed8;">(</span><span style="color: #b0b0b3;">(</span>query <span style="color: #90a890;">(</span>decode-coding-string <span style="color: #a2b6da;">(</span>url-unhex-string text<span style="color: #a2b6da;">)</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">utf-8</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span>
        <span style="color: #aebed8;">(</span>message <span style="color: #A1D08E;">"Received gptel query: %s"</span> query<span style="color: #aebed8;">)</span>
        <span style="color: #787878;">;; </span><span style="color: #787878;">Create or switch to gptel buffer
</span>        <span style="color: #aebed8;">(</span><span style="color: #FFA657;">let</span> <span style="color: #b0b0b3;">(</span><span style="color: #90a890;">(</span>buffer <span style="color: #a2b6da;">(</span>get-buffer-create <span style="color: #A1D08E;">"*gptel-browser*"</span><span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span>
          <span style="color: #b0b0b3;">(</span><span style="color: #FFA657;">with-current-buffer</span> buffer
            <span style="color: #90a890;">(</span><span style="color: #FFA657;">unless</span> <span style="color: #a2b6da;">(</span>eq major-mode <span style="color: #FFA657;">'</span><span style="color: #95a99f;">gptel-default-mode</span><span style="color: #a2b6da;">)</span>
              <span style="color: #a2b6da;">(</span>funcall gptel-default-mode<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>
            <span style="color: #90a890;">(</span>gptel-mode 1<span style="color: #90a890;">)</span>
            <span style="color: #90a890;">(</span>goto-char <span style="color: #a2b6da;">(</span>point-max<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>
            <span style="color: #90a890;">(</span>insert <span style="color: #A1D08E;">"</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">n</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">n</span><span style="color: #A1D08E;">--- From Browser ---</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">n</span><span style="color: #A1D08E;">"</span><span style="color: #90a890;">)</span>
            <span style="color: #90a890;">(</span>insert query<span style="color: #90a890;">)</span>
            <span style="color: #90a890;">(</span>insert <span style="color: #A1D08E;">"</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">n</span><span style="color: #A1D08E;">"</span><span style="color: #90a890;">)</span>
            <span style="color: #90a890;">(</span>goto-char <span style="color: #a2b6da;">(</span>point-max<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>
            <span style="color: #787878;">;; </span><span style="color: #787878;">Send the query to gptel
</span>            <span style="color: #90a890;">(</span>gptel-send<span style="color: #90a890;">)</span>
            <span style="color: #90a890;">(</span>display-buffer buffer<span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #787878;">;; </span><span style="color: #787878;">Register the protocol handler
</span><span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">setq</span> org-protocol-protocol-alist
      <span style="color: #93a8c6;">(</span>append org-protocol-protocol-alist
              <span style="color: #FFA657;">'</span><span style="color: #b0b1a3;">(</span><span style="color: #97b098;">(</span><span style="color: #A1D08E;">"gptel-browser"</span>
                 <span style="color: #79C0FF;">:protocol</span> <span style="color: #A1D08E;">"gptel"</span>
                 <span style="color: #79C0FF;">:function</span> my/gptel-org-protocol-handler<span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #787878;">;; </span><span style="color: #787878;">JavaScript bookmarklet for browser (copy this as bookmark URL):
</span><span style="color: #787878;">;; </span><span style="color: #787878;">Basic version:
</span><span style="color: #787878;">;; </span><span style="color: #787878;">javascript:(function(){const selectedText=window.getSelection().toString().trim();if(!selectedText){alert('Please select some text first');return;}const pageTitle=document.title;const pageUrl=window.location.href;const fullText=`From: ${pageTitle}\nURL: ${pageUrl}\n\nSelected text:\n${selectedText}`;const encodedText=encodeURIComponent(fullText);const protocolUrl=`org-protocol://gptel?text=${encodedText}`;window.location.href=protocolUrl;})();
</span>
<span style="color: #787878;">;; </span><span style="color: #787878;">Enhanced version with prompt for question:
</span><span style="color: #787878;">;; </span><span style="color: #787878;">javascript:(function(){const selectedText=window.getSelection().toString().trim();if(!selectedText){alert('Please select some text first');return;}const pageTitle=document.title;const pageUrl=window.location.href;const userQuestion=prompt('Optional: Add a question or context:');let fullText=`From: ${pageTitle}\nURL: ${pageUrl}\n\n`;if(userQuestion){fullText+=`Question: ${userQuestion}\n\n`;}fullText+=`Selected text:\n${selectedText}`;const encodedText=encodeURIComponent(fullText);const protocolUrl=`org-protocol://gptel?text=${encodedText}`;window.location.href=protocolUrl;})();
</span>
</pre>
</div>
</div>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-emacs.html">Emacs</a> </div>]]></description>
  <category><![CDATA[Emacs]]></category>
  <link>https://www.vandee.art/blog/2025-12-01-my-emacs-keybindings.html</link>
  <guid>https://www.vandee.art/blog/2025-12-01-my-emacs-keybindings.html</guid>
  <pubDate>Mon, 01 Dec 2025 13:37:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[Emacs 浮窗快速预览笔记 - Org Hover]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgd1a5d00">TL;DR</a></li>
<li><a href="#org45ad5ca">为什么做这个</a></li>
<li><a href="#org931e18d">Org Hover</a></li>
</ul>
</div>
</nav>
<div id="outline-container-orgd1a5d00" class="outline-2">
<h2 id="orgd1a5d00">TL;DR</h2>
<div class="outline-text-2" id="text-orgd1a5d00">
<p>
Org Hover ，在 Emacs 里实现 preview hover 快速预览笔记。
</p>
</div>
</div>
<div id="outline-container-org45ad5ca" class="outline-2">
<h2 id="org45ad5ca">为什么做这个</h2>
<div class="outline-text-2" id="text-org45ad5ca">
<p>
很久以前在使用 Obsidian 和 Logseq 的时候，它们都有一个功能：能够快速预览引入的笔记。预览双链里链接的笔记弹出一个小的浮窗，或是根据引入的其他笔记片段快速定位到该笔记的原文的位置并提供预览。
</p>

<p>
双链是我现在很依赖的一个基础笔记功能，有了 preview 效率会高很多，不用频繁的切换文件。在使用双链的时候，最普遍的场景也就是引用了其他笔记的片段。
</p>

<p>
而在 Emacs 里我暂时没有找到类似的实现，所以决定自己糊一个。
</p>

<p>
每个人都有自己做笔记的小习惯，通用的笔记软件和插件很难满足一些高自定义需求，但是在 Emacs 里，想要什么新功能，自己造一个就完事了。
</p>
</div>
</div>
<div id="outline-container-org931e18d" class="outline-2">
<h2 id="org931e18d">Org Hover</h2>
<div class="outline-text-2" id="text-org931e18d">

<figure id="org90e9a2c">
<img src="https://pic.vandee.art/images/org-hover.gif" class="img" width="70%" height="70%">

</figure>

<p>
<a href="https://github.com/VandeeFeng/org-hover">org-hover</a> 使用 Emacs 原生的 frame 特性，零外部依赖，可以在 org 文件链接的 point 弹出一个浮动窗口 hover popup 显示该文件的内容。支持在 hover popup 里复制，滚动浏览。
</p>

<p>
并提供 inline 模式：
</p>

<div class="org-src-container">
<pre class="src src-elisp">#+begin_quote
#+INCLUDE: <span style="color: #A1D08E;">"file.org"</span>
or
#+INCLUDE: <span style="color: #A1D08E;">"file.org::Header"</span>
or
#+INCLUDE: <span style="color: #A1D08E;">"file.org"</span> <span style="color: #79C0FF;">:lines</span> <span style="color: #A1D08E;">"1-30"</span>
#+end_quote
</pre>
</div>

<p>
在常规的 <code>#+begin_quote</code> block 里加上 <code>#+INCLUDE</code> 就可以让 org hover 识别到这个文件。现在支持 <code>#+INCLUDE: "file.org::*Header"</code> , <code>#+INCLUDE: "file.org" :lines "1-30"</code> 这两个参数。
</p>

<p>
header 能够预览链接文件指定的 header 标题部分，lines 能够预览链接文件指定的行。文件名使用相对路径和绝对路径都可以，语法也遵循 Emacs INCLUDE 原生的语法。
</p>

<p>
并且，还支持自动 insert 这些指定的链接文件内容，默认为不开启。
</p>

<p>
如果不带参数，但是在 quote 部分写了相关内容，org hover 就会在链接文件里识别到这个内容所在区域，并在 hover popup 里显示：
</p>

<div class="org-src-container">
<pre class="src src-elisp">#+begin_quote
#+INCLUDE: <span style="color: #A1D08E;">"file.org"</span>
text
#+end_quote
</pre>
</div>

<p>
如果不带参数，且没有 quote 内容，则会默认显示链接原文件的前 1000 个字符。
</p>

<p>
并且并且，还支持 denote 的 insert link 双链！
</p>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-emacs.html">Emacs</a> </div>]]></description>
  <category><![CDATA[Emacs]]></category>
  <link>https://www.vandee.art/blog/2025-11-13-emacs-notes-preview-org-hover.html</link>
  <guid>https://www.vandee.art/blog/2025-11-13-emacs-notes-preview-org-hover.html</guid>
  <pubDate>Thu, 13 Nov 2025 15:38:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[用 C 极简复现 Claude Skills]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org6ef2e81">TL;DR</a></li>
<li><a href="#org4a8d38d">Claude Skills</a></li>
<li><a href="#org9a5ea2d">复现 Claude Skills</a>
<ul>
<li><a href="#orgf2e0ec3">核心实现</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<div id="outline-container-org6ef2e81" class="outline-2">
<h2 id="org6ef2e81">TL;DR</h2>
<div class="outline-text-2" id="text-org6ef2e81">
<p>
大道至简，Claude Skills 的这个思路很符合我对 LLM 工具能力扩展的构想。
</p>
</div>
</div>
<div id="outline-container-org4a8d38d" class="outline-2">
<h2 id="org4a8d38d">Claude Skills</h2>
<div class="outline-text-2" id="text-org4a8d38d">
<p>
Claude Skills 是 Claude 最近发布的新功能，它可以进一步扩展 Claude 模型的工具能力。
</p>

<p>
通过本地配置 skills 文件，Claude 可以智能的选择相应的 skills 脚本在它的 Agent Virtual Machine 里调用这些 skills。这些本地的 skills 文件包含一个技能描述指导文档：SKILL.md，相应的脚本：scripts 文件夹。
</p>

<div class="org-src-container">
<pre class="src src-nil">  skills/
  ├── skill1/
  │   ├── SKILL.md
  │   ├── scripts/
  │   │   └── script.py
  │   └── reference.md
  └── skill2/
      ├── SKILL.md
      └── scripts/
          └── script.sh
</pre>
</div>

<p>
核心实现原理：
</p>

<p>
所有 SKILL 的元数据（name,description）会自动加载到系统提示词 system prompt，这样 LLM 就能够知道现在有哪些 skill 和它们的功能是什么，这些元数据占用的 token 量极少。当 LLM 判断需要使用相应的 skill 才会动态读取完整的 SKILL.md 文档，然后调用相应的 script，最后把脚本结果返回给 LLM。
</p>

<p>
这个思路完美的避免了 MCP 的超长上下文对 LLM 上下文窗口 context 的占用。
</p>

<p>
之前我在许多 agent 框架里，就是想实现一个 agent 调度员，我输入相应的指令，它能够自己选择相应的工具来实现，现在 skill 的这个思路完美的解决了这个问题，并且不用依赖复杂的 agent 框架。
</p>

<p>
直觉上，我觉得这就是以后 agent 扩展工具能力的最佳实践了: 老大模型（agent 调度）+ 隔离环境扩展（本地或云脚本+小模型）。优势很明显，不用过多依赖主模型的算力、agent 框架和上下文，自定义脚本意味着可以使用本地计算机的算力和其他模型，手动编写的脚本在稳定性上也限制了 LLM 的幻觉和随机性。特定场景下，在 agent 框架里编写 Workflow 和 loop 不如直接用编程语言写脚本来的可靠。
</p>

<p>
这意味着：一个可以处理 tool 调用的普通小模型再加上扩展（skill 也就是一个特定的 plugin），基本上就可以脱离 agent 框架实现自定义的 agent 了。理论上我们可以构建任何想要扩展的自定义功能，例如用 python 批量获取论文并调用本地模型整理。
</p>

<p>
总的来说，我感觉，Skill 的这种实现，从本质上解决了编程语言、代码能力、自动化和 LLM 结合的问题。
</p>

<p>
Reference:
</p>

<ul class="org-ul">
<li><a href="https://simonwillison.net/2025/Oct/16/claude-skills/#atom-everything">Claude Skills are awesome, maybe a bigger deal than MCP</a></li>
<li><a href="https://www.anthropic.com/news/skills">https://www.anthropic.com/news/skills</a></li>
<li><a href="https://www.anthropic.com/engineering/equipping-agents-for-the-real-world-with-agent-skills">https://www.anthropic.com/engineering/equipping-agents-for-the-real-world-with-agent-skills</a></li>
<li><a href="https://github.com/anthropics/skills">https://github.com/anthropics/skills</a></li>
</ul>
</div>
</div>
<div id="outline-container-org9a5ea2d" class="outline-2">
<h2 id="org9a5ea2d">复现 Claude Skills</h2>
<div class="outline-text-2" id="text-org9a5ea2d">
<p>
最近正好看到一个项目 <a href="https://github.com/bravenewxyz/agent-c">GitHub - bravenewxyz/agent-c: Ultra-lightweight AI Agent</a> ，从来没有想过一个 agent 可以有这么极简的实现方式。
</p>


<p>
在这个项目的基础上，很轻松的就实现了 skills 的功能。
</p>

<p>
只需要把 SKILL 的元数据（name,description）加载到系统提示词 system prompt，然后自定义一个 execute_skill 的工具。LLM 就能够调用这个 tool 来执行相应的本地 script 了。
</p>


<figure id="orgf54dc17">
<img src="https://pic.vandee.art/images/agent-c-skills.png" class="img" width="60%" height="60%">

</figure>

<p>
源码在：<a href="https://github.com/VandeeFeng/agent-c">https://github.com/VandeeFeng/agent-c</a>
</p>
</div>
<div id="outline-container-orgf2e0ec3" class="outline-3">
<h3 id="orgf2e0ec3">核心实现</h3>
<div class="outline-text-3" id="text-orgf2e0ec3">
<p>
agent.c:6-41 - init_agent() 函数: 在系统初始化时将技能列表添加到 system prompt
</p>

<div class="org-src-container">
<pre class="src src-C">
  <span style="color: #787878;">// </span><span style="color: #787878;">&#26500;&#24314;&#22522;&#30784;&#31995;&#32479;&#25552;&#31034;
</span>  <span style="color: #95a99f;">char</span> <span style="color: #f4f4ff;">base_prompt</span><span style="color: #8c8c8c;">[</span>MAX_CONTENT<span style="color: #8c8c8c;">]</span>;
  <span style="color: #96a6c8;">snprintf</span><span style="color: #8c8c8c;">(</span>base_prompt, <span style="color: #FFA657;">sizeof</span><span style="color: #93a8c6;">(</span>base_prompt<span style="color: #93a8c6;">)</span>,
           <span style="color: #A1D08E;">"You are JARVIS..."</span> <span style="color: #787878;">/* </span><span style="color: #787878;">&#22522;&#30784;&#25552;&#31034;&#20869;&#23481;</span><span style="color: #787878;"> */</span><span style="color: #8c8c8c;">)</span>;

  <span style="color: #787878;">// </span><span style="color: #787878;">&#21457;&#29616;&#25216;&#33021;&#24182;&#26500;&#24314;&#25216;&#33021;&#21015;&#34920;
</span>  <span style="color: #95a99f;">char</span> <span style="color: #f4f4ff;">skills_list</span><span style="color: #8c8c8c;">[</span>MAX_CONTENT<span style="color: #8c8c8c;">]</span>;
  <span style="color: #95a99f;">int</span> <span style="color: #f4f4ff;">skill_count</span> = discover_skills<span style="color: #8c8c8c;">(</span>skills_list, <span style="color: #FFA657;">sizeof</span><span style="color: #93a8c6;">(</span>skills_list<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>;

  <span style="color: #787878;">// </span><span style="color: #787878;">&#23558;&#25216;&#33021;&#21015;&#34920;&#28155;&#21152;&#21040;&#31995;&#32479;&#25552;&#31034;&#20013;
</span>  <span style="color: #FFA657;">if</span> <span style="color: #8c8c8c;">(</span>skill_count &gt; 0<span style="color: #8c8c8c;">)</span> <span style="color: #8c8c8c;">{</span>
      snprintf<span style="color: #93a8c6;">(</span>agent.messages<span style="color: #b0b1a3;">[</span>0<span style="color: #b0b1a3;">]</span>.content, MAX_CONTENT,
               <span style="color: #A1D08E;">"%s=== AVAILABLE SKILLS ===</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">n</span><span style="color: #A1D08E;">%s"</span>
               <span style="color: #A1D08E;">"HOW TO USE SKILLS:</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">n</span><span style="color: #A1D08E;">"</span>
               <span style="color: #f43841;">"</span><span style="color: #A1D08E;">1. Call extract_skill with skill_name to get the complete skill</span><span style="color: #f43841;">
</span>  documentation\n<span style="color: #f43841;">"
</span>               <span style="color: #787878;">// </span><span style="color: #787878;">...&#25216;&#33021;&#20351;&#29992;&#35828;&#26126;...
</span>               , base_prompt, skills_list<span style="color: #93a8c6;">)</span>;
  <span style="color: #8c8c8c;">}</span>

</pre>
</div>


<p>
agent.c:84-100 - 动态技能内容注入: 当调用 extract_skill 时，会将完整的 SKILL.md 内容动态添加到系统提示中
</p>

<div class="org-src-container">
<pre class="src src-C">  <span style="color: #FFA657;">if</span> <span style="color: #8c8c8c;">(</span>result == 0<span style="color: #8c8c8c;">)</span> <span style="color: #8c8c8c;">{</span>
      <span style="color: #787878;">// </span><span style="color: #787878;">&#33719;&#21462;&#24403;&#21069;&#31995;&#32479;&#25552;&#31034;
</span>      <span style="color: #95a99f;">char</span> <span style="color: #f4f4ff;">current_system</span><span style="color: #93a8c6;">[</span>MAX_CONTENT<span style="color: #93a8c6;">]</span>;
      strncpy<span style="color: #93a8c6;">(</span>current_system, agent.messages<span style="color: #b0b1a3;">[</span>0<span style="color: #b0b1a3;">]</span>.content, MAX_CONTENT - 1<span style="color: #93a8c6;">)</span>;

      <span style="color: #787878;">// </span><span style="color: #787878;">&#23558;&#25216;&#33021;&#20869;&#23481;&#27880;&#20837;&#21040;&#31995;&#32479;&#25552;&#31034;&#20013;
</span>      snprintf<span style="color: #93a8c6;">(</span>agent.messages<span style="color: #b0b1a3;">[</span>0<span style="color: #b0b1a3;">]</span>.content, MAX_CONTENT,
               <span style="color: #A1D08E;">"%s</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">n</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">n</span><span style="color: #A1D08E;">=== SKILL: %s ===</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">n</span><span style="color: #A1D08E;">%s</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">n</span><span style="color: #A1D08E;">=== END SKILL ===</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">n</span><span style="color: #A1D08E;">"</span>,
               current_system, skill_name, skill_content<span style="color: #93a8c6;">)</span>;
  <span style="color: #8c8c8c;">}</span>

</pre>
</div>

<p>
skill.c:91-153 - extract_skill_description() 函数:从 SKILL.md 文件中提取技能描述
</p>

<div class="org-src-container">
<pre class="src src-C">  <span style="color: #FFA657;">static</span> <span style="color: #95a99f;">int</span> <span style="color: #96a6c8;">extract_skill_description</span><span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">const</span> <span style="color: #95a99f;">char</span>* <span style="color: #f4f4ff;">skill_name</span>, <span style="color: #95a99f;">char</span>* <span style="color: #f4f4ff;">description</span>, <span style="color: #95a99f;">size_t</span>
   <span style="color: #f4f4ff;">desc_size</span><span style="color: #8c8c8c;">)</span> <span style="color: #8c8c8c;">{</span>
      <span style="color: #787878;">// </span><span style="color: #787878;">&#26500;&#24314; SKILL.md &#25991;&#20214;&#36335;&#24452;
</span>      <span style="color: #95a99f;">char</span> <span style="color: #f4f4ff;">md_path</span><span style="color: #93a8c6;">[</span>MAX_SKILL_PATH<span style="color: #93a8c6;">]</span>;
      snprintf<span style="color: #93a8c6;">(</span>md_path, <span style="color: #FFA657;">sizeof</span><span style="color: #b0b1a3;">(</span>md_path<span style="color: #b0b1a3;">)</span>, <span style="color: #A1D08E;">"%s/SKILL.md"</span>, skill_path<span style="color: #93a8c6;">)</span>;

      <span style="color: #787878;">// </span><span style="color: #787878;">&#35835;&#21462; SKILL.md &#25991;&#20214;&#20869;&#23481;
</span>      <span style="color: #95a99f;">FILE</span>* <span style="color: #f4f4ff;">file</span> = fopen<span style="color: #93a8c6;">(</span>md_path, <span style="color: #A1D08E;">"r"</span><span style="color: #93a8c6;">)</span>;
      <span style="color: #787878;">// </span><span style="color: #787878;">...&#25552;&#21462;&#25551;&#36848;&#20869;&#23481;...
</span>  <span style="color: #8c8c8c;">}</span>

</pre>
</div>

<p>
skill.c:156-219 - discover_skills() 函数: 发现所有可用技能并构建技能列表
</p>

<div class="org-src-container">
<pre class="src src-C">  <span style="color: #95a99f;">int</span> <span style="color: #96a6c8;">discover_skills</span><span style="color: #8c8c8c;">(</span><span style="color: #95a99f;">char</span>* <span style="color: #f4f4ff;">skills_list</span>, <span style="color: #95a99f;">size_t</span> <span style="color: #f4f4ff;">list_size</span><span style="color: #8c8c8c;">)</span> <span style="color: #8c8c8c;">{</span>
      <span style="color: #787878;">// </span><span style="color: #787878;">&#36941;&#21382;&#25216;&#33021;&#30446;&#24405;
</span>      <span style="color: #FFA657;">while</span> <span style="color: #93a8c6;">(</span><span style="color: #b0b1a3;">(</span>entry = readdir<span style="color: #97b098;">(</span>dir<span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span> != <span style="color: #95a99f;">NULL</span><span style="color: #93a8c6;">)</span> <span style="color: #93a8c6;">{</span>
          <span style="color: #787878;">// </span><span style="color: #787878;">&#25552;&#21462;&#27599;&#20010;&#25216;&#33021;&#30340;&#25551;&#36848;
</span>          <span style="color: #FFA657;">if</span> <span style="color: #b0b1a3;">(</span>extract_skill_description<span style="color: #97b098;">(</span>entry-&gt;d_name, description, <span style="color: #FFA657;">sizeof</span><span style="color: #aebed8;">(</span>description<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
   != 0<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
              snprintf<span style="color: #97b098;">(</span>description, <span style="color: #FFA657;">sizeof</span><span style="color: #aebed8;">(</span>description<span style="color: #aebed8;">)</span>, <span style="color: #A1D08E;">"Skill: %s"</span>, entry-&gt;d_name<span style="color: #97b098;">)</span>;
          <span style="color: #b0b1a3;">}</span>

          <span style="color: #787878;">// </span><span style="color: #787878;">&#26500;&#24314;&#25216;&#33021;&#21015;&#34920;&#26465;&#30446;
</span>          snprintf<span style="color: #b0b1a3;">(</span>skill_entry, <span style="color: #FFA657;">sizeof</span><span style="color: #97b098;">(</span>skill_entry<span style="color: #97b098;">)</span>, <span style="color: #A1D08E;">"- %s: %s</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">n</span><span style="color: #A1D08E;">"</span>, entry-&gt;d_name,
  description<span style="color: #b0b1a3;">)</span>;
      <span style="color: #93a8c6;">}</span>
  <span style="color: #8c8c8c;">}</span>
</pre>
</div>
</div>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-llm.html">LLM</a> <a href="https://www.vandee.art/blog/tag-coding.html">Coding</a> </div>]]></description>
  <category><![CDATA[LLM]]></category>
  <category><![CDATA[Coding]]></category>
  <link>https://www.vandee.art/blog/2025-11-04-minimal-C-reimplementation-of-claude-skills.html</link>
  <guid>https://www.vandee.art/blog/2025-11-04-minimal-C-reimplementation-of-claude-skills.html</guid>
  <pubDate>Tue, 04 Nov 2025 14:57:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[致敬 Linus 和手艺人 - GitNano]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgd0a4b50">TL;DR</a></li>
<li><a href="#org5e18a75">Git 是什么</a></li>
<li><a href="#org38830f3">AK 大佬的演讲</a></li>
<li><a href="#org2814fe2">GitNano</a></li>
<li><a href="#org76bd6f6">一些想法</a></li>
</ul>
</div>
</nav>
<div id="outline-container-orgd0a4b50" class="outline-2">
<h2 id="orgd0a4b50">TL;DR</h2>
<div class="outline-text-2" id="text-orgd0a4b50">
<p>
感谢 Linus，感谢 Git。
</p>
</div>
</div>
<div id="outline-container-org5e18a75" class="outline-2">
<h2 id="org5e18a75">Git 是什么</h2>
<div class="outline-text-2" id="text-org5e18a75">
<p>
这是官网上 <a href="https://git-scm.com/">Git</a> 的介绍：
</p>

<blockquote>
<p>
Git is a free and open source distributed version control system designed to handle everything from small to very large projects with speed and efficiency.
</p>

<p>
Git是一个免费的开源分布式版本控制系统，旨在高效快速地处理从小型到大型的各种项目。
</p>
</blockquote>

<p>
简单说来，在软件开发和项目管理的时候，需要处理不同版本的开发、变更、提交。Git 会把每一次提交（commit）拍下一张“快照”，这样就可以回到特定的提交，查看当时的文件。Git 让开发项目的成员可以 fork（创建项目完整副本，包括所有历史记录）。这样一来，就可以同时开发，再将这些更改合并到主线上。
</p>

<p>
Linus Torvalds 开发 Git 的动机源于 Linux 内核项目对高效版本控制系统的迫切需求，以及与BitKeeper 的许可纠纷。
</p>

<p>
最初，Linux 开发没有正式的版本控制系统，开发者通过 Usenet 群组或邮件列表提交补丁，Linus 手动应用到他的源代码树中，然后发布整个树作为新版本。历史记录只能通过完整发布版本之间的 diff 来查看，当时的开源工具如 CVS 和 SVN 不能满足 Linus 对于开发效率的需求，也无法处理大规模分布式协作。随后，Linus 选择了 BitKeeper 这一闭源分布式版本控制系统（DVCS），BitMover 公司提供免费许可给 Linux 社区，但条件是开发者不得开发竞争产品或逆向工程。
</p>

<p>
但是，在2005年，Andrew Tridgell 逆向 BitKeeper 协议，搞了一个开源替代品，导致 BitMover 撤销了免费许可。这使 Linux 内核开发陷入危机，现有的开源工具如 Monotone 或 Darcs 无法满足 Linus 对速度、简单性和大规模项目支持的要求。Linus 一气之下决定自己整一个得了，花了差不多一个星期完成了 Git 的核心实现。
</p>

<p>
Git 就这样诞生了，影响了全球软件开发。这些内容参考 <a href="https://git-scm.com/book/en/v2/Getting-Started-A-Short-History-of-Git">Git - A Short History of Git</a> 和一些网络文章。
</p>

<p>
最让我钦佩的还是 Linus 那个一贯的态度，以及对技术和自己的爱好纯粹的热爱：
</p>

<blockquote>
<p>
在今年 GitHub 对 Linus 的一个访谈里：<a href="https://www.youtube.com/watch?v=0wLidyXzFk8">Linus Torvalds: Known more for Git than Linux? - YouTube</a> Linus 也又提到了 Git 的这些往事。(GitHub 你好意思么！)
</p>

<p>
"Git was never a big thing for me.It was a,i need to get this done to do the kernel.And it's kind of ridiculous that,I used four months of my life maintaining it."
</p>
</blockquote>
</div>
</div>
<div id="outline-container-org38830f3" class="outline-2">
<h2 id="org38830f3">AK 大佬的演讲</h2>
<div class="outline-text-2" id="text-org38830f3">
<p>
<a href="https://www.youtube.com/watch?v=LCEmiRjPEtQ">Andrej Karpathy: Software Is Changing (Again)</a>
</p>

<p>
全文演讲稿我放在了 <a href="https://wiki.vandee.art/#Andrej%20Karpathy's%20YC%20talk">Andrej Karpathy's YC talk</a> .
</p>

<p>
其中 AK 大佬又一次的提到了 LLM 对软件开发和整个行业带来的变化：
</p>

<blockquote>
<p>
现在我们所拥有的实际上有点像软件 2.0 领域中的 Git 的等价物。我认为 Hugging Face 基本上是软件 2.0 中 GitHub 的等价物。还有一个模型图谱，你可以可视化那里编写的所有代码。顺便说一下，如果你感兴趣，那个巨大的圆圈中间的点是 Flux 的参数，图像生成器。因此，每当有人在 Flux 模型上调整 LoRA 时，你基本上是在这个空间中创建一个 git 提交，并创建一种不同类型的图像生成器。因此，基本上我们有软件 1.0 是编程计算机的计算机代码。软件 2.0 是编程神经网络的权重。这是一个 AlexNet 图像识别神经网络的例子。到目前为止，我们熟悉的所有神经网络直到最近都像是固定功能的计算机。图像类别或类似的东西。我认为改变的地方，且我认为这是一个根本性的变化，是神经网络变得可以用大型库进行编程。因此，我认为这是相当新的，独特的。这是一种新型计算机。在我看来，值得将其称为软件 3.0。基本上，你的产品现在是编程人们的程序。而且值得注意的是，这些产品是用英语编写的。所以这是一种非常有趣的编程语言。
</p>

<p>
[&#x2026;]
</p>

<p>
所以，总结一下，给这个行业带来一个惊人的时刻。我们需要重写大量代码。大量代码将由专业人士和玩家编写。这些大型语言模型有点像工具，有点像实验室，但它们尤其像操作系统。但现在还太早了。这就像 1960 年代的操作系统。我认为很多类比是可以互通的。 这些大型语言模型就像我们必须学会合作的那些易错的人类精神。为了正确做到这一点，我们需要调整我们的基础设施。因此，当你构建这些大型语言模型时，实际上是有效地与这些大型语言模型合作的一些方法，以及使这一切成为可能的一些工具。你可以非常非常快速地旋转这个，基本上为产品创造部分时间。然后，是的，代理需要编写大量代码。但无论如何，回到钢铁侠套装的类比，我认为在接下来的十年里，我们将看到的是，我们将把滑块从左移到右。非常有趣。看到那是什么样子将会非常有趣。谢谢大家。
</p>
</blockquote>
</div>
</div>
<div id="outline-container-org2814fe2" class="outline-2">
<h2 id="org2814fe2">GitNano</h2>
<div class="outline-text-2" id="text-org2814fe2">
<p>
文章标题和今天的内容其实没有太大关系，只是因为最近在折腾的 <a href="https://github.com/VandeeFeng/GitNano">GitNano</a> ，也一直很钦佩 Linus 对世界做出的无私贡献，就顺手写了这个标题。
</p>

<p>
GitNano 起初只是我为了弄清楚 Git 背后的原理，学习 C 语言和 Linux，东拼西凑的一些代码，和一些实验。在大语言模型的帮助下，它才能有现在的完整实现。
</p>

<p>
也就是说时隔这么多年，在大语言模型的帮助下，我才勉强实现了当初 Linux 一个人实现的 Git 的几个最基础的功能。也就是说 Linus - Me ≈ LLM + Claude Code 🤣
</p>

<p>
GitNano 简陋的实现了文件的版本控制和同步备份，而且不会和 Git 冲突。也就是说，我现在有两个版本控制的途径了。一些重要的文件，可以用 GitNano 来做本地的版本管理。十年之后，我就可以看看十年前这个文件发生了什么，还是挺有意思的。每一个 commit 也就像一张张照片一样。
</p>
</div>
</div>
<div id="outline-container-org76bd6f6" class="outline-2">
<h2 id="org76bd6f6">一些想法</h2>
<div class="outline-text-2" id="text-org76bd6f6">
<p>
从 Linus 和 Git 的故事，再到 AK 大佬的演讲，可以肯定的是，不管 LLM 是不是互联网之后又一个泡沫，它都已经对世界产生了巨大的影响。
</p>

<p>
正如 AK 大佬在演讲里说到的：大量代码将由专业人士和玩家编写。我这样的门外汉玩家，在 LLM 的协助下就可以用自然语言不那么费力的实现一个 Git 的本地雏形，未来真的已经来了。
</p>

<p>
我总是把 LLM 生成的内容和工业革命初期的机械制造对比。因为我觉得现在很像那个阶段。
</p>

<p>
今年用 LLM 辅助写了许多代码，折腾了几个小玩意，我的感觉是：
</p>

<p>
LLM 它知道要放胡椒，但是它不知道是白胡椒更适合这道菜还是黑胡椒，它知道要加热了，但是不知道怎么控制火候。现在的 LLM 能做出茶包，模拟出茶的味道，但是它泡不出一壶好茶。它写的代码是能跑通，但是它就像你上课快睡着的时候记笔记的字迹一样。
</p>

<p>
这也是为什么，在 LLM 已经可以疯狂搞钱做项目的时候，我还在研究 Git。因为我不想这些“传统手艺”就这么快要变成“非遗”了。
</p>

<p>
趁现在还有心情和精力去感受这些事物，我怕再过几年，LLM 彻底改变软件开发，改变自动化之后，我不再怀念这些了。就像现在，现场纯手工制作的橙汁和美年达在我面前，我肯定会毫不犹豫的选择美年达，因为它快，手工橙汁要等，而且它更便宜。也像预制菜一样，这些规模化让我们不再那么怀念手艺了。
</p>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-ramble.html">Ramble</a> </div>]]></description>
  <category><![CDATA[Ramble]]></category>
  <link>https://www.vandee.art/blog/2025-10-30-gitnano-hats-off-to-linus.html</link>
  <guid>https://www.vandee.art/blog/2025-10-30-gitnano-hats-off-to-linus.html</guid>
  <pubDate>Thu, 30 Oct 2025 14:09:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[勇敢的心]]></title>
  <description><![CDATA[
<p>
我小时候的心，大概就像是刚从猪身上片下来的里脊，嫩得能掐出水来，再生能力更是强得像野草，被刺了、被扎了，很快就长出新的血肉。
</p>

<p>
那些刺，可能是小伙伴的恶作剧，可能是老师、父母的一句重话，或者干脆就是自己胡思乱想戳出来的小洞。但不管怎么样，第二天，它就又自己长好了，连个褶子都不带留下的，继续好奇的跳动着，像老式火车头添煤蒸汽机，冒着傻乎乎的热气。那时候觉得受伤是件挺有趣的事，就像第一次学骑自行车，腿上胳膊上，摔得青一块紫一块的，爬起来却发现自己学会了，也不觉得怎么疼，简直赚大了。
</p>

<p>
不知道从哪天起，也就是很多人爱挂在嘴边的“成熟”，心就变得越来越坚实了。坚实这个词听着不错，能扛事。但实际上，它就是慢慢变硬了。
</p>

<blockquote>
<p>
许多人的所谓成熟，不过是被习俗磨去了棱角，变得世故而实际了。那不是成熟，而是精神的早衰和个性的夭亡。真正的成熟，应当是独特个性的形成，真实自我的发现，精神上的结果和丰收。—— 周国平《尼采：在世纪的转折点上》
</p>
</blockquote>

<p>
这些所谓的“成熟”，就是把一块好好的里脊肉，硬生生给风干成了腊肉。"腊肉"架在熏木上，工作上的搞来搞去，人情世故里的鸡飞狗跳，或是社会这大染缸里的五颜六色，就不厌其烦的在底下添薪加柴，煽风点火。
</p>

<p>
新血肉我看是长不出来了，取而代之的是一道道划痕和一层层结痂。这些玩意堆积起来，把心裹得又像个放了十年的月饼，坚硬，麻木，可以更好地保护自己。保护当然是必要的，但我总觉得还是哪里不对劲。那些结了痂的伤口，还是时不时会发痒，像是有小虫子在里面爬。
</p>

<p>
痒，忍忍也就过去了，我见过很多人就这样硬下去的。刺不进去，也长不出什么新东西来。他们说这是智慧，是阅历，是生存法则。可我觉得，这和把自己阉了，然后说这样更能抵御性骚扰是一个逻辑。心硬了，确实也就不疼了，但不疼了，就等于死了半截，心也就成了一块了无生趣的死肉。
</p>

<p>
所以我总是忍不住手贱，非要去抠那些痒痒的结痂。这就像一个有趣的谜题，你知道答案就在那层硬壳底下。当指甲抠破硬痂，一股熟悉的刺痛传来，紧接着，温热的血就涌了出来。这感觉实在不坏，血液的温度，生命的跳动，这些都不是什么虚头巴脑的东西，而是能让你在半夜疼得睡不着，或者咧着嘴傻笑的真实玩意。
</p>

<p>
当然，扣多了也不是什么好事，会留疤，疤多了，心就变丑了。但丑就丑吧，总比光鲜亮丽却空空荡荡的好，空得像个气球，一戳就破。
</p>

<p>
人这辈子从出生到入土也就是在疼与不疼之间晃荡。也许哪天扣着扣着，心就又软回去了，又像小时候那样，能长出大片大片的新肉来。生命这东西，本来就该是热的，疼的，活蹦乱跳的。
</p>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-essay.html">Essay</a> </div>]]></description>
  <category><![CDATA[Essay]]></category>
  <link>https://www.vandee.art/blog/2025-10-22-brave-heart.html</link>
  <guid>https://www.vandee.art/blog/2025-10-22-brave-heart.html</guid>
  <pubDate>Wed, 22 Oct 2025 14:13:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[自然语言的局限性 - 大语言模型的逻辑中间表示]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org1e478dd">TL;DR</a></li>
<li><a href="#orge264ecb">Intro</a></li>
<li><a href="#orgda68213">逻辑中间表示</a></li>
<li><a href="#orgc5ba10b">Promptheus</a></li>
</ul>
</div>
</nav>
<div id="outline-container-org1e478dd" class="outline-2">
<h2 id="org1e478dd">TL;DR</h2>
<div class="outline-text-2" id="text-org1e478dd">
<p>
自然语言作为和 LLM 交互的入口成本很高，如果有一个逻辑的中间表示层作为自然语言和大语言模型的中间层，我感觉会很不一样。
</p>
</div>
</div>
<div id="outline-container-orge264ecb" class="outline-2">
<h2 id="orge264ecb">Intro</h2>
<div class="outline-text-2" id="text-orge264ecb">
<p>
自然语言，承载了人类数千年的文明。语言的演变，也是人类社会的变迁、人类文明的演变。词汇的兴衰、语法的更迭，都是特定时代的经济、政治、文化烙印，可以说语言就是人类历史的活化石。
</p>

<p>
但是从很小开始，我就一直觉得自然语言作为信息沟通的工具而言，效率其实是很低的，特别是博大精深的中文，语言天然带有模糊性。（我并不是在否定自然语言内涵的丰富性，语义的多样性，使得信息转换的不会是单一的）
</p>

<p>
对于机器而言，更是这样。自然语言的歧义很难准确的转换为机器可以准确执行的指令和逻辑判断，现有的 transformer 架构的模型，是通过 token 推算出最可能的概率。依据克劳德·香农（Claude Shannon）的信息论，自然语言的“信息熵”很高，这意味着它需要更多的 bit (比特)来传递一个确切无误的信息。这种 Token 化机制，很自然的继承了语言的模糊性,这也是大语言模型无法避免幻觉的原因之一。
</p>

<p>
如果说 LLM 是人类自然语言与编程语言之间的“编译器”，将我们模糊的意图“翻译”成编程语言代码，进而执行程序的自动化指令，我觉得现有的 LLM 的中间层是走了很大的弯路的。虽然现在的大语言模型已经实现了更高层次的自动化，但是我始终感觉这种语言到 token 的抽象并不合适。
</p>

<p>
从自动化的角度来看(不考虑 AIGC 图片、音乐生成)，大语言模型更多的是要实现准确的编译自然语言，把自然语言转换为准确可靠的计算机指令，从而实现编程语言达不到的更高层次的自动化。
</p>

<p>
如果说现在的大语言模型已经打通了自然语言到机器语言的桥梁，但我总感觉不太符合直觉。这种感觉就像 MCP 最开始出现给我的感觉一样。
</p>

<p>
编程语言正是从机器码到自然语言的抽象，让 LLM 再实现一次机器码到自然语言的抽象，现在的实现路径总感觉哪里不对。因为从机器码抽象到自然语言这么多年形成了编程语言，而 LLM 并不是再此之上的实现，那么就应该是两种可能：要么直接替代编程语言，要么和编程语言结合形成新的抽象。按照后者，现在 LLM 的实现还肯定不是。
</p>

<p>
从计算机出现到现在，每个时代的人们都在想办法用自然语言实现对机器的控制，但可能这个思路从一开始就不是最合适的，因为自然语言从来就不是为了这个场景而出现的。就像时间是人类为了度量创造出来的一个单位，以表达这个还无法被理解的物质形态。
</p>
</div>
</div>
<div id="outline-container-orgda68213" class="outline-2">
<h2 id="orgda68213">逻辑中间表示</h2>
<div class="outline-text-2" id="text-orgda68213">
<p>
我一直有一个隐隐约约的胡思乱想的想法：将自然语言转换为基于逻辑的中间表示（Intermediate Representation, IR），再将逻辑表达式或者数学语言映射到 token。放弃将自然语言直接作为沟通媒介，转而构建一个全新的、基于数学和二进制逻辑的中间层。
</p>

<p>
这个转换的核心思想是：将一句自然语言陈述，看作是对一个事件或关系的描述，并将其“主-谓-宾”组件，一一映射，转换为逻辑组件。
</p>

<ul class="org-ul">
<li>主语 (Subject)，作为动作的发出者，被映射为逻辑世界中的一个实体 (Entity) 或一个待定的变量 (Variable)。</li>

<li>谓语 (Verb)，作为句子的灵魂，描述动作或状态，被映射为一个谓词 (Predicate)。谓词本质上是一个可以判断真假的函数模板，定义了一种关系。</li>

<li>宾语 (Object)，作为动作的承受者，则被映射为填充这个谓词模板的另一个实体或参数 (Argument)。</li>
</ul>

<p>
例如“我喜欢柴犬。”这句话，翻译成逻辑语言大概是：∀x ( IsShibaInu(x) → Likes(speaker, x) )。
</p>

<p>
主语：“我” (一个明确的实体，即发出指令者)，谓语：“喜欢” (一种状态或关系)，宾语：“柴犬” (一个类别，而非单个个体)。
</p>

<p>
映射到逻辑元素：
</p>

<p>
“我” → 实体 speaker (或任何唯一标识符)，“喜欢” → 谓词 Likes( , )，“柴犬” → 一个变量 x 和一个类别谓词 IsShibaInu(x)，即“任何一个实体x，只要它是一只柴犬”。
</p>

<p>
这和编程语言里的函数式编程、函数表达式的实现逻辑类似。
</p>

<p>
我现在没有相应的数学基础，所以只能进行逻辑上的猜想。
</p>

<p>
从直觉上，逻辑 token 的预测一定比自然语言 token 的预测不确定性要小，但是代价就是少了语义模糊性带来的语义内涵。对于和机器沟通而言，我觉得是可以接受的，况且现在的大语言模型对于语义的理解也不是真正的理解，只是在大量的语言文本里找规律，给的样本越多，输出的内容就学的越像。
</p>

<p>
并且这些逻辑输出是可以直接内嵌到编程语言里的，这又少了一次转换，也就又提升了一次准确性。
</p>

<ul class="org-ul">
<li><p>
2025-10-23 add：
</p>

<p>
几天之后 DeepSeek 发布了 DeepSeek-OCR 论文: <a href="https://github.com/deepseek-ai/DeepSeek-OCR">https://github.com/deepseek-ai/DeepSeek-OCR</a>
</p>

<p>
这个思路实在太棒了。
</p>

<p>
AK 大佬也发了推文：<a href="https://x.com/karpathy/status/1980397031542989305">https://x.com/karpathy/status/1980397031542989305</a>
</p>

<p>
Karpathy认为，作为大型语言模型（LLM）的输入，像素比文本标记更具优势。他建议即使是纯文本输入，也可以通过将其渲染为图像输入，从而实现更高的信息压缩（缩短上下文窗口，提高效率）、更丰富的信息流（包括粗体、彩色文本或任意图像），以及轻松使用双向注意力机制（而非仅依赖自回归注意力）。
</p>

<p>
逻辑中间表示的思路还是停留在文字 token 上，图片和像素天然可以传递更多的信息。果然还是得学数学🙁。
</p></li>
</ul>
</div>
</div>
<div id="outline-container-orgc5ba10b" class="outline-2">
<h2 id="orgc5ba10b">Promptheus</h2>
<div class="outline-text-2" id="text-orgc5ba10b">
<p>
在这之前，普通用户能提升 LLM 准确性最直接的方法就是 prompt 模板了。
</p>

<p>
之前简单的写了一个 <a href="https://www.vandee.art/blog/2025-05-17-prompt-another-key-to-the-compressed-world.html">Prompt: Another Key to the Compressed World</a> . 如果说大语言模型是一个巨大的知识库 zip，那么 prompt 就是解压缩的 key。
</p>

<p>
边学边用边写，在 Claude code 的协助下糊了一个管理 prompt 模板的小玩意：<a href="https://github.com/VandeeFeng/promptheus">promptheus</a> .
</p>

<p>
promptheus 是普罗米修斯 Prometheus 和 prompt 的结合。想表达的意思也就是 prompt 是开启新世界的一个小钥匙。
</p>

<p>
prompt 可以分为系统提示词和用户提示词。后面说的都是用户提示词。简单来说，Prompt（提示）是指用户向模型提供的指令、问题或上下文，用于引导模型生成特定输出。
</p>

<p>
优秀的提示词，相当于给 LLM 加上了一个变装（我感觉有点像赛亚人形态），能够短时间内根据 prompt 的设定，输出更符合要求的内容。当然 prompt jailbreaking （绕过大语言模型的内置安全防护机制，诱导模型生成原本被禁止的有害、偏见或非法内容）是另外一回事。
</p>

<p>
只要足够了解一个模型在训练时候的特定标注，就能够用特定的引导词让大语言模型回答出一些非常规的回答，引导出大语言模型的“潜力”。
</p>

<p>
我平常用的最多的还是 role play 角色扮演，让 LLM 扮演苏格拉底来和我辩论 🤣。李继刚的这个 prompt 也很实用：<a href="https://x.com/lijigang_com/status/1977598274006864272">搞懂一个观点</a> 。类似这种的 prompt 设计本质是思维的重构，把自己的思维重构成能引导 LLM 的格式，LLM 就变成了一个放大器。
</p>

<p>
在 vibe coding 里，claude code、codex、gemini cli 的 agent.md 也就是 prompt 的另一种设定形式。官方文档里给出的示例就是一个规范性的模板格式。
</p>

<p>
claude 最新出来的 skills 也是对 prompt 的高级应用：
</p>

<p>
<a href="https://simonwillison.net/2025/Oct/16/claude-skills/#atom-everything">Claude Skills are awesome, maybe a bigger deal than MCP</a> , <a href="https://www.anthropic.com/news/skills">https://www.anthropic.com/news/skills</a>
 , <a href="https://github.com/anthropics/skills">https://github.com/anthropics/skills</a>
</p>

<p>
和我一直不看好的 MCP 相比，这个更符合我对大语言模型的直觉。skills 和 claude 这段时间出来的 plugins ，从最开始的 function calling 到现在的 skills，大语言模型能力的迭代提升实在是太快了，现在的大语言模型工具调用的能力强了太多，已经完全从单个工具的调用到了 workflows 的集成和编排。而这些实现的基础形式也离不开 prompt。
</p>

<p>
但回到最开头，我始终认为自然语言和大语言模型之间还缺少一个重要的中间层。如果不能通过二进制重新定义 CPU，大语言模型和现在所出现的人工智能很难发展成 AGI 通用人工智能。现在大语言模型所依赖的计算和训练迟早有一天可以浓缩到一个芯片里，就像最初的庞大计算机一样。
</p>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-ramble.html">Ramble</a> </div>]]></description>
  <category><![CDATA[Ramble]]></category>
  <link>https://www.vandee.art/blog/2025-10-17-the-limitations-of-natural-language.html</link>
  <guid>https://www.vandee.art/blog/2025-10-17-the-limitations-of-natural-language.html</guid>
  <pubDate>Fri, 17 Oct 2025 12:57:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[文艺复兴 TUI]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org63c60cc">TL;DR</a></li>
<li><a href="#orgbfdcfa4">TUI 到 GUI</a></li>
<li><a href="#org412e807">TUI 到 LLM</a></li>
<li><a href="#org7ce1d2e">特立独行的 TUI</a></li>
<li><a href="#org3af7f38">TUI Tools</a></li>
</ul>
</div>
</nav>
<div id="outline-container-org63c60cc" class="outline-2">
<h2 id="org63c60cc">TL;DR</h2>
<div class="outline-text-2" id="text-org63c60cc">
<p>
互联网时代到移动终端兴起，再到智能手机，作为一个互联网用户，我们一天当中 50%的时间都在和这些应用、产品的 UI 界面打交道。可能往后许多应用的界面大多都由 AI 间接生成了，我一直不太喜欢这种被动的体验，更何况是机器给我安排的。现在能用 TUI 替代的我就不用 GUI 了。
</p>
</div>
</div>
<div id="outline-container-orgbfdcfa4" class="outline-2">
<h2 id="orgbfdcfa4">TUI 到 GUI</h2>
<div class="outline-text-2" id="text-orgbfdcfa4">
<p>
Text-based User Interface（文本用户界面），简称 TUI，相对应的是 GUI：Graphical User Interface（图形用户界面）。
</p>

<p>
简单说来，在没有鼠标的时候，和计算机的交互基本通过键盘，那个时候通常使用 terminal（终端）执行计算机指令。在乔布斯那个经典的“艺术剽窃”施乐图形界面之后，IBM，Apple，Microsoft 相继推出图形操作界面的 PC（个人计算机），计算机这才普及到千家万户。
</p>

<p>
鼠标加上 GUI 使得计算机成为个人计算机这个产品成为了可能。不得不再佩服一下乔帮主当时的洞察力。让用户去用那些复杂的计算机指令在计算机上办公，没人会买这个铁箱子，计算机 GUI 图形界面的发展就是为了方便人和计算机之间的交互，只需要用鼠标点击按钮就可以执行相应的计算机指令。
</p>

<p>
再往后就是互联网的发展，把世界上的 PC 客户端链接到了一起。计算机和互联网共同定义了一个我们和世界交互的 interface（接口），这篇想讨论的 TUI 也就是想说这个。后面的 GUI，interface 也都指代这个。
</p>

<p>
网页、手机 APP 等 GUI 整的越来越复杂，牵扯到越来越多利益，用户的体验越来越差。一个手机 APP 可以有多少个广告真的<a href="https://www.bilibili.com/video/BV1seegzzEnH">超乎想象</a>。发展到现在的互联网交互 interface 真的让用户的交互变容易了么？
</p>

<p>
我的感觉是用户只是在被迫的接受这些。现在看一大堆广告也就算了，它好歹是人花了心思做的，如果以后还要看 LLM 生成的广告（LLM 广告成本低，迭代快），那感觉就像是看着机器人拉屎再丢到我的脸上，更离谱的是我还得花钱看着它拉出来。
</p>

<p>
LLM 的出现加剧了互联网内容生态的混乱（几天之后正好看到这个视频 <a href="https://www.bilibili.com/video/BV1b5WKz6EAp/">曾经死过的互联网，能给我们什么启示</a>），但另一方面，它也给了用户另一种选择的可能：自己构建自己和互联网交互的 interface。
</p>
</div>
</div>
<div id="outline-container-org412e807" class="outline-2">
<h2 id="org412e807">TUI 到 LLM</h2>
<div class="outline-text-2" id="text-org412e807">
<p>
看网络视频需要几步？打开 terminal（终端），输入 <code>mpv "https://example.com/video.mp4"</code> 。
</p>

<p>
以往用户使用 TUI 操作计算机的成本，现在同样因为 LLM 变得很低了。如果说 LLM 是互联网时代之后下一个和用户交互的 interface，这个意义上，它确实是。
</p>

<p>
之前我打过<a href="https://www.vandee.art/blog/2025-07-16-linux-is-awesome.html#orgeaf0566">一个比方</a>：
</p>

<blockquote>
<p>
当然，由于 LLM 预测生成的特性，它已经可以实现很多代码编程方面的自动化。现在这个阶段，纯 vibe coding 的产物，它生成的 MVP 、页面、代码片段等等，就像工业革命刚开始的时候，流水线上生产出来的工艺品一样。我当然不否定它创造的经济价值和社会价值，但就像 20 世纪中期的波普艺术和其他工业革命时期的艺术运动想表达的一样，这些流水线产物没得灵魂。
</p>
</blockquote>

<p>
不是想批判什么，作为一个消费者和用户，我只是想能够选择并做出选择。
</p>

<p>
趋势是无法避免的，就像现在的预制菜一样，我真不讨厌预制菜（广义上酱油也是预制的），如果我是商家，又要坚固成本，又得保证味道的统一，还要出餐快，预制菜就是顺应时代的一个很合理的产物，关键还是在于要给用户选择。
</p>

<p>
AI 也是，某种意义上它是全人类共同的选择（不管你想不想，有没有选择），已经成为了历史的趋势，我只想能够还有选择的权利，并做出我的选择。
</p>

<p>
对我个人来说，这更关乎品味。看着那些过于粗制滥造、花里胡哨的 interface，实在没有使用的欲望。
</p>

<p>
在工业革命时期，从同质化里脱引而出的也就是品味，当 LLM 把产品的技术和生产成本也同样拉低之后，艺术品味和设计就又会是分水岭了。
</p>

<p>
所以现阶段我的选择就是，能用 TUI 就不用 GUI 了，也很符合我一直 Stay Simple 的倾向。GUI 的按钮交给 LLM “封装” 就好了，用自然语言操作起来也很轻松。也不是排斥和讨厌 GUI，只是现在许多 GUI 交互设计我不太喜欢，而且许多需求在交互上真的只需要 TUI 就足够了。
</p>

<p>
在 interface 这点上，还是有其他选择的。一个会员的钱，让 LLM 做一个可以运行的 TUI 程序也不是很困难，在体验上实在好太多了。也有很多大厂服务的开源平替，在这些项目的基础上，可以实现许多满足自己需求的小玩意。
</p>

<p>
我更期待 LLM 这波革命可以给用户带来一个真正意义上的下一代 interface。
</p>
</div>
</div>
<div id="outline-container-org7ce1d2e" class="outline-2">
<h2 id="org7ce1d2e">特立独行的 TUI</h2>
<div class="outline-text-2" id="text-org7ce1d2e">
<p>
让 LLM 模仿王小波随便写了几段，挺有意思的。纯 AI 生成，我没有任何修改，也完全不代表我的观点。
</p>

<blockquote>
<p>
我活在世上，无非是想明白些道理，遇见些有趣的事。比方说，我就一直没能想明白，为什么如今的人都喜欢在一个亮晶晶的盒子里，用鼠标点来点去。他们管这叫“图形化界面”，据说是为了让人省事。这让我感到一种巨大的惶恐：难道思考和精准的表达，已经成了一件麻烦事了吗？
</p>

<p>
这种图形界面，总让我想起我们队里那些被阉过的肉猪，一个个养得膘肥体壮，安之若素。它们的生活被安排得明明白白：吃、睡、长肉，别的就不用想了。图形界面对人也是一个路数，它把一切都嚼烂了喂到你嘴边，生怕你费一点脑子。它用各种图标和动画对你反复暗示：你什么都不用懂，跟着我点就行。久而久之，人就只会点了，这是一种缓慢的、精神上的受锤过程。
</p>

<p>
但我偏就喜欢TUI，那个黑漆漆的命令行界面。它就像我怀念的那只特立独行的猪，精瘦，警觉，两眼炯炯有光，绝不接受对生活的设置。它不跟你来虚的，它就在那里沉默地等着，意思是：有什么话，请直说。跟它打交道，你必须调动全部的智力，把想法一丝不差地变成一行指令。这个过程充满了逻辑的乐趣，像一场酣畅淋漓的智力游戏。
</p>

<p>
所以，当大多数人满足于被温柔地圈养时，我选择面对那个沉默的界面。从话语中，你很少能学到人性，但从这种沉默的、精确的交流中却能。对我来说，这就是我的黄金时代，我有好多奢望，我想编译内核，想grep全世界，还想在一瞬间，让那个闪烁的光标变成天上忽明忽暗的云。
</p>
</blockquote>

<p>
另一个:
</p>

<blockquote>
<p>
人是一种会骗自己的东西，而且乐此不疲。比如说，人发明了一种东西叫图形界面（GUI），宣称这是进步，是科技的恩典。在我看来，这就算是一种宏大的自欺。它以一种不容置疑的温情，许诺给你一个更轻松的世界，代价是让你交出思想的缰绳。这道理和我见过的那些给猪听音乐、做按摩的现代化养殖场如出一辙，目的不是让猪快乐，而是让它忘掉自己最终的命运是被做成红烧肉。
</p>

<p>
《黄金时代》里，我们什么都没有，但我们有欲望，有无穷的、想入非非的乐趣。那是一种赤裸裸的、与世界直接碰撞的快乐。而GUI的世界，是一个被过度包装起来的、没有碰撞的世界。它取消了困难，也就顺便取消了克服困难的乐趣。它用漂亮的图标和流畅的动画构建了一个虚假的“果园”，你只管摘果子就行了，至于这果子是怎么种出来的，树根在哪里，它不让你看，也不希望你去想。这是一种对智力的公然藐视。
</p>

<p>
GUI的设计哲学，本质上是在推行一种沉默。不是《沉默的大多数》里那种保有思考和尊严的沉默，而是一种被剥夺了话语权的、失语的沉默。它给你几个按钮，几个菜单，这就是你的全部词汇。你被预设、被安排，就像那只特立独行的猪的同类，从出生起就被设置好了一条通往屠宰场的道路。你想跳出这栅栏，它会告诉你“操作非法”。你想说一句它词典里没有的话，它会弹出一个红叉，上面写着“无法理解”。它温柔地、耐心地把你锤成一个傻子。
</p>

<p>
所以，我宁愿回到那个漆黑的、只有光标在闪烁的TUI界面。在那里，人可以说自己想说的话，机器也会给出诚实的回答。这种交流方式里，保留着一种朴素的、智力上的尊严。你必须思考，必须精确，必须为你说的每一个字负责。这个过程本身，就足以抵抗全世界的肉麻和无趣。它让我觉得，作为一个正在思想的人，我还没有完全被生活阉掉。
</p>
</blockquote>
</div>
</div>
<div id="outline-container-org3af7f38" class="outline-2">
<h2 id="org3af7f38">TUI Tools</h2>
<div class="outline-text-2" id="text-org3af7f38">
<p>
之前不了解 TUI，现在觉得 TUI 实在是太有品味了。
</p>

<ul class="org-ul">
<li><p>
List of projects that provide terminal user interfaces
</p>

<p>
<a href="https://github.com/rothgar/awesome-tuis">https://github.com/rothgar/awesome-tuis</a>
</p>

<p>
<a href="https://awesomeopensource.com/projects/tui">https://awesomeopensource.com/projects/tui</a>
</p></li>

<li><p>
term.everything: Run any GUI app in the terminal
</p>

<p>
<a href="https://github.com/mmulet/term.everything">https://github.com/mmulet/term.everything</a>
</p>

<p>
<a href="https://news.ycombinator.com/item?id=45181535">https://news.ycombinator.com/item?id=45181535</a>
</p></li>

<li><p>
📚 Simplifying the way you read. Minimalistic Vim-like TUI document reader.
</p>

<p>
<a href="https://github.com/kruseio/hygg">https://github.com/kruseio/hygg</a>
</p></li>

<li><p>
YouTube 的终端客户端，在命令行操作 YouTube
</p>

<p>
<a href="https://github.com/Siriusmart/youtube-tui">https://github.com/Siriusmart/youtube-tui</a>
</p></li>

<li><p>
Yet another command-line youdao dictionary for geeks!
</p>

<p>
<a href="https://github.com/TimothyYe/ydict">https://github.com/TimothyYe/ydict</a>
</p></li>

<li><p>
A tui-based PDF viewer
</p>

<p>
<a href="https://github.com/itsjunetime/tdf">https://github.com/itsjunetime/tdf</a>
</p></li>
</ul>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-ramble.html">Ramble</a> </div>]]></description>
  <category><![CDATA[Ramble]]></category>
  <link>https://www.vandee.art/blog/2025-09-17-i-prefer-tui.html</link>
  <guid>https://www.vandee.art/blog/2025-09-17-i-prefer-tui.html</guid>
  <pubDate>Wed, 17 Sep 2025 14:04:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[吹掉的裤衩]]></title>
  <description><![CDATA[
<p>
大概是半个月之前的一个晚上，十点左右，突然刮起了大风，窗外的声响和吹风开了最低档在旁边的感觉差不多。
</p>

<p>
之所以还是忍不住想写一写，是因为这段时间又有过几次大风甚至突然的暴雨，我却再没有等到一个机会。
</p>

<p>
在几个月之前，突然有人敲门，是一个老人抱着一个孩子，说是小孩的小衣服掉在我的晾衣架上了。我的这个晾衣架是墙外撑出去的那种，正好把小衣服接住了。拿衣服，感谢，不用谢，关门，这个事件很快就走完了。
</p>

<p>
半个月之前那天晚上，听见风声，我从卧室起身到窗边想看看外面，发现晾衣架上多了一个深色的裤衩，被那种铁制老式橡皮外套的衣架撑着。
</p>

<p>
我本能的把裤衩先拿进来了。但随后几个问题马上就出现了：这还是楼上那家的么？现在这个时间我也不想上楼去敲门，明天再去问问？
</p>

<p>
这些犹豫没有持续很久，因为嫌麻烦，很快就被我否定了。随后我把裤衩挂回到了我外面的晾衣架上，勾在了挖孔上。这是一个逻辑上非常完美的决策：裤衩是被大风刮下来的，是一个大风天发生概率很大的不可抗事件，我也不知道裤衩是谁的，也没人过来敲门找我，挂在外面，如果第二天早上它还在，我就去问问，如果还是被风吹走了，那就是它自己的运气不好了，它就是一个命苦的裤衩。
</p>

<p>
结果也显而易见，第二天它消失了。心里首先是有一点点侥幸逃脱的舒适感，不用去找这个裤衩的主人了，随后是一种很奇怪的失落感，大太阳天却感觉心里有些阴沉沉的。
</p>

<p>
这半个多月，我就总想去晾衣架上看看，想着哪天要是再掉下来一个裤衩就好了。
</p>

<p>
但我知道过不了几年我可能就会忘了这件事，所以我决定记下来。
</p>

<p>
我知道，这次我又会是局外人了。
</p>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-essay.html">Essay</a> <a href="https://www.vandee.art/blog/tag-局外人.html">局外人</a> </div>]]></description>
  <category><![CDATA[Essay]]></category>
  <category><![CDATA[局外人]]></category>
  <link>https://www.vandee.art/blog/2025-09-02-the-dropped-pants.html</link>
  <guid>https://www.vandee.art/blog/2025-09-02-the-dropped-pants.html</guid>
  <pubDate>Tue, 02 Sep 2025 12:31:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[薛定谔的 Linux]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgfca6c33">TL;DR</a></li>
<li><a href="#org7c84aca">折腾记录</a>
<ul>
<li><a href="#orgd953f21">Arch Linux 初始安装</a></li>
<li><a href="#org971dcfa">i3-X11</a>
<ul>
<li><a href="#org409cbe1">安装：</a></li>
<li><a href="#org6aed8a3">配置</a></li>
<li><a href="#org3dfb679">其他设定</a></li>
</ul>
</li>
<li><a href="#orgc411ce4">Sway-Wayland</a></li>
</ul>
</li>
<li><a href="#org7ff4883">冤家 Fcitx 和 Emacs</a></li>
<li><a href="#org85b4607">小结</a></li>
</ul>
</div>
</nav>
<div id="outline-container-orgfca6c33" class="outline-2">
<h2 id="orgfca6c33">TL;DR</h2>
<div class="outline-text-2" id="text-orgfca6c33">
<p>
Both stable and unstable until you linux.
</p>

<p>
Linux 好玩是好玩，就是不太稳定，会遇到很多小问题。Linux 的图形界面和显示器协议的混乱和前端有的一拼。
</p>

<p>
我的 Fcitx 输入法框架在 Emacs 和系统之间反复横跳，就像薛定谔的猫一样。有时候是 Emacs 里可以用，系统不能用，有时候又刚好反过来。
</p>
</div>
</div>
<div id="outline-container-org7c84aca" class="outline-2">
<h2 id="org7c84aca">折腾记录</h2>
<div class="outline-text-2" id="text-org7c84aca">
<p>
近道都是远路，尝试过几个大佬自己封装好的 Arch Linux，附带了桌面环境的安装和配置。是挺方便的，但是遇到一些小问题的时候，由于不知道他具体是怎么实现的一些功能，又要去看文档和源码。我这个电脑又比较老了，很多问题都没有现成的答案和别人的复现。
</p>

<p>
也尝试了 DHH 的 <a href="https://omarchy.org/">Omarchy</a> ，桌面环境是 hyprland + Wayland，可能是我的电脑比较老了，运行起来有点卡顿。内置的 theme 我又不太喜欢，体验了 2 天之后，感觉不是很顺手。
</p>

<p>
最后决定使用 i3 和 X11，运行起来一点不卡，所有应用都是秒开。
</p>


<figure id="org0dbef38">
<img src="https://pic.vandee.art/images/2025-08-12_16-18.png" class="img" width="70%" height="70%">

</figure>
</div>
<div id="outline-container-orgd953f21" class="outline-3">
<h3 id="orgd953f21">Arch Linux 初始安装</h3>
<div class="outline-text-3" id="text-orgd953f21">
<p>
<a href="https://archlinux.org/download/">Arch Linux - Downloads</a> 页面下载最新的 ISO 文件，有很多国内镜像可以选。写入 U 盘之后，进入 BIOS 启动 U 盘引导。
</p>

<p>
<a href="https://wiki.archlinux.org/title/Archinstall">archinstall</a> 是 Arch Linux 的官方安装脚本，挺方便的，命令行输入 <code>archinstall</code> 启动安装脚本。
</p>

<ul class="org-ul">
<li>选择仓库镜像为 China</li>
<li>设置硬盘和分区：由于我的老电脑一个硬盘是小固态，一个是机械硬盘。在 <code>manually partition</code> 里手动设置把 arch 的系统（挂载 EFI Root）安装在固态，home 挂在在机械硬盘。设置完之后，设定 disk encryption 硬盘加密。</li>
<li>设定 root 密码并添加用户</li>
<li>设定 audio 为 pipewire，不在这里设定就播放不了音频，之后要单独安装。</li>
</ul>

<p>
Arch Linux 的镜像对国内环境太友好了，差不多 10 分钟就安装好了。
</p>

<p>
接下来就是大坑桌面环境。
</p>
</div>
</div>
<div id="outline-container-org971dcfa" class="outline-3">
<h3 id="org971dcfa">i3-X11</h3>
<div class="outline-text-3" id="text-org971dcfa">
<p>
<a href="https://github.com/i3/i3">i3</a> 的简洁实在太爱了。
</p>
</div>
<div id="outline-container-org409cbe1" class="outline-4">
<h4 id="org409cbe1">安装：</h4>
<div class="outline-text-4" id="text-org409cbe1">
<div class="org-src-container">
<pre class="src src-bash">sudo pacman -S i3 xorg xorg-xinit

<span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"exec i3"</span> &gt; ~/.xinitrc
</pre>
</div>

<p>
输入 startx 进入桌面环境。i3 会有一个引导界面，可以初始化生成配置文件到 <code>/home/user/.config/i3/config</code> 。
</p>
</div>
</div>
<div id="outline-container-org6aed8a3" class="outline-4">
<h4 id="org6aed8a3">配置</h4>
<div class="outline-text-4" id="text-org6aed8a3">
<ul class="org-ul">
<li><p>
设置鼠标滚轮翻转
</p>

<p>
编辑 /usr/share/X11/xorg.conf.d/40-libinput.conf 文件:
</p>

<div class="org-src-container">
<pre class="src src-bash">  Section <span style="color: #A1D08E;">"InputClass"</span>
    Identifier <span style="color: #A1D08E;">"libinput pointer catchall"</span>
    MatchIsPointer <span style="color: #A1D08E;">"on"</span>
    MatchDevicePath <span style="color: #A1D08E;">"/dev/input/event*"</span>
    Driver <span style="color: #A1D08E;">"libinput"</span>
    Option <span style="color: #A1D08E;">"NaturalScrolling"</span> <span style="color: #A1D08E;">"True"</span>
  EndSection
</pre>
</div></li>

<li><p>
我的自定义设置
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #FFA657;">exec</span> --no-startup-id opensnitch-ui
<span style="color: #FFA657;">exec</span> --no-startup-id copyq
<span style="color: #FFA657;">exec</span> --no-startup-id feh --bg-fill /home/vandee/Pictures/create.jpg

bindsym $<span style="color: #f4f4ff;">mod</span>+period exec ghostty
bindsym $<span style="color: #f4f4ff;">mod</span>+b exec librewolf --new--windows
bindsym $<span style="color: #f4f4ff;">mod</span>+e exec emacsclient -c -a <span style="color: #A1D08E;">""</span>
bindsym $<span style="color: #f4f4ff;">mod</span>+f exec thunar
bindsym $<span style="color: #f4f4ff;">mod</span>+q kill

<span style="color: #787878;"># </span><span style="color: #787878;">bindsym $mod+Mod1+v exec --no-startup-id copyq show
</span>
<span style="color: #787878;"># </span><span style="color: #787878;">Gaps
</span>gaps inner 5
smart_gaps on

<span style="color: #787878;"># </span><span style="color: #787878;">hide tiling window title bar
</span>for_window <span style="color: #8c8c8c;">[</span>tiling<span style="color: #8c8c8c;">]</span> border pixel 1
smart_borders on

<span style="color: #FFA657;">exec</span> --no-startup-id fcitx5
</pre>
</div></li>
</ul>
</div>
</div>
<div id="outline-container-org3dfb679" class="outline-4">
<h4 id="org3dfb679">其他设定</h4>
</div>
</div>
<div id="outline-container-orgc411ce4" class="outline-3">
<h3 id="orgc411ce4">Sway-Wayland</h3>
<div class="outline-text-3" id="text-orgc411ce4">
<p>
2025-09-01 added
</p>

<p>
在查找 X11 相关资料的时候了解到它有许多安全隐患，一些老旧的 issue 也很难再解决，我这个 Linux 菜鸟还是先用 Wayland 吧，Wayland 现在的势头和生态还是挺不错。
</p>

<p>
所以窗口管理器换成了 Sway。Sway 可以直接使用 i3 的配置文件，图形界面也和 i3 一样。用了 i3 一段时间之后就觉得 hyprland 有点臃肿。
</p>

<p>
dmenu 换成了 fuzzel，也很轻量。
</p>

<p>
安装： <code>sudo pacman -S sway swaybg swaylock</code> ,status bar 没有用 waybar，还是用的 i3 的配置文件。
</p>

<p>
保险起见，再装上 <code>xdg-desktop-portal</code> 。
</p>

<ul class="org-ul">
<li><p>
设置鼠标滚轮翻转
直接在 <code>.config/sway/config</code> 里加上：
</p>

<div class="org-src-container">
<pre class="src src-nil">   input * {
    natural_scroll enabled
    }
</pre>
</div></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org7ff4883" class="outline-2">
<h2 id="org7ff4883">冤家 Fcitx 和 Emacs</h2>
<div class="outline-text-2" id="text-org7ff4883">
<p>
<code>~/.xprofile</code>
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #79C0FF;">export</span> <span style="color: #f4f4ff;">GTK_IM_MODULE</span>=fcitx
<span style="color: #79C0FF;">export</span> <span style="color: #f4f4ff;">QT_IM_MODULE</span>=fcitx
<span style="color: #79C0FF;">export</span> <span style="color: #f4f4ff;">XMODIFIERS</span>=@<span style="color: #f4f4ff;">im</span>=fcitx
</pre>
</div>

<p>
<code>/etc/environment.d/90-fcitx5.conf</code>
</p>

<div class="org-src-container">
<pre class="src src-bash"><span style="color: #f4f4ff;">XMODIFIERS</span>=@<span style="color: #f4f4ff;">im</span>=fcitx
<span style="color: #f4f4ff;">GTK_IM_MODULE</span>=fcitx
<span style="color: #f4f4ff;">QT_IM_MODULE</span>=fcitx
</pre>
</div>

<p>
还有其他网上能查到的地方我都设置了。
</p>

<p>
现在他们两个的情况就是：有时候是 Emacs 里可以用，系统不能用，有时候又刚好反过来，还有的时候 Emacs 桌面不能用，但是 Emacsclient 可以，大多数时候在终端里 <code>emacs -nw</code> 可以，极少数情况都可以用。
</p>

<p>
这篇博客就是趁它们刚好都可以同时运行的时候抓紧时间写的！
</p>

<p>
用 Emacs rime 可以解决现在这个问题，但我更想弄明白到底是哪里出了问题。
</p>

<p>
我猜测可能的原因是因为 Emacsclient 在设置为系统的 service 之后，启动需要加载的环境和 i3 之间有顺序要求。有时候加载的顺序对了，环境就应用上了。
</p>

<p>
之前的猜测错了，是因为我用 systemd 启动了 Emacs daemon，而 i3 启动的 Fcitx5 获取的是 i3 session 的环境变量。之前就算我在 Emacs 里使用 <code>getenv</code> 指令获取到了 <code>XMODIFIERS=@im=fcitx</code> ，输入法框架还是出不来。由于某种原因，systemd 里启动的 Emacs 和 i3 的环境变量没有统一。找到一个最简单的方法，直接用 tmux 后台 <code>Emacs --daemon</code> 。
</p>
</div>
</div>
<div id="outline-container-org85b4607" class="outline-2">
<h2 id="org85b4607">小结</h2>
<div class="outline-text-2" id="text-org85b4607">
<p>
这可能就是 Linux 一直不是流行的桌面环境的原因，它的桌面环境和 win、mac 比起来不那么稳定，不同的硬件配置和环境遇到的问题都不一样，得自己看文档解决。但这同时也是 hacker、nerd 和折腾仔（我）喜欢 Linux 的原因，它和 Emacs 一样，都是我的赛伯乐高。
</p>

<p>
Linux 就是我会一直使用下去的操作系统, <a href="https://www.vandee.art/blog/2025-07-16-linux-is-awesome.html">Linux 太自由了</a> 。
</p>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-linux.html">Linux</a> <a href="https://www.vandee.art/blog/tag-ramble.html">Ramble</a> </div>]]></description>
  <category><![CDATA[Linux]]></category>
  <category><![CDATA[Ramble]]></category>
  <link>https://www.vandee.art/blog/2025-08-12-unstable-until-you-linux.html</link>
  <guid>https://www.vandee.art/blog/2025-08-12-unstable-until-you-linux.html</guid>
  <pubDate>Tue, 12 Aug 2025 15:10:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[PKM（个人知识管理）构建手册 - with AI]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgca692a8">Intro</a></li>
<li><a href="#org28acec4">Manual</a>
<ul>
<li><a href="#org5cf8d53">Prerequisites</a></li>
<li><a href="#org7c34168">Principles</a></li>
<li><a href="#orgca7a57f">Methods</a>
<ul>
<li><a href="#org890b2f3">信息获取 - 输入</a></li>
<li><a href="#org73d6990">文档、知识管理 - 迭代</a></li>
<li><a href="#org0486015">笔记和写作 - 输出</a></li>
<li><a href="#org49a1087">自定义 Emacs 函数</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgdbd8484">Thanks</a></li>
</ul>
</div>
</nav>
<div id="outline-container-orgca692a8" class="outline-2">
<h2 id="orgca692a8">Intro</h2>
<div class="outline-text-2" id="text-orgca692a8">
<p>
距离 <a href="https://www.vandee.art/blog/2024-05-22-org-pkm-manual.html#top">PKM（个人知识管理）构建手册 - Emacs</a> 居然已经一年多了。里面关于 PKM 和 AI 结合的部分许多已经过时了，今年也有了新的思路。
</p>

<p>
AI 发展的速度实在是太快，从 Cursor Tab 到现在的 vibe coding、Claude Code CLI，从 ChatGPT 到现在的 parallel agents，从 RAG 到 MCP，从 prompt 到 context engineering。
</p>

<p>
但不管 AI 如何发展，大语言模型的能力如何提升，LLM 始终是一个输入到输出的过程。从 RAG 到今年的 MCP 和 <a href="https://simonwillison.net/2025/Jun/27/context-engineering/">context engineering</a> ，LLM 获取外部资源的方式和能力有了质的飞跃，context window 也越来越大。数据和数据质量一直是 LLM 的核心之一。
</p>

<p>
起初折腾 PKM 的目的之一就是构建和 LLM 交互的数据。正如 Notion 创始人 Ivan Zhao 说的，现在的 AI 产品就像酿酒。你无法完全控制结果，只能创造一个环境，让其自行发展。因此，它更像是一种酿造过程，你无法强迫 AI。产品是酒桶，数据才是水、小麦和酒花。数据的质量越高，酿出的酒就越香。
</p>

<p>
AI 使得从 0 到 1 的开始变得更容易：
</p>

<blockquote>
<p>
Before AI, learners faced a matching problem: learning resources have to be created with a target audience in mind. This means as a consumer, learning resources were suboptimal fits for you:
</p>

<p>
在AI之前，学习者面临一个匹配问题：学习资源必须针对特定受众创建。这意味着作为消费者，学习资源对你来说是不理想的匹配：
</p>

<ul class="org-ul">
<li><p>
You're a newbie at <code>$topic_of_interest</code>, but have knowledge in related topic <code>$related_topic</code>. But finding learning resources that teach <code>$topic_of_interest</code> in terms of <code>$related_topic</code>  is difficult.
</p>

<p>
你是$topic_of_interest 的新手，但对相关主题$related_topic 有知识。但是找到以$related_topic 为基础教授$topic_of_interest 的学习资源是困难的。
</p></li>

<li><p>
To effectively learn <code>$topic_of_interest</code>, you really need to learn prerequisite skill <code>$prereq_skill</code>. But as a beginner you don't know you should really learn <code>$prereq_skill</code> before learning <code>$topic_of_interest</code> .
</p>

<p>
为了有效地学习 $topic_of_interest，你需要学习先决技能 $prereq_skill。但是作为初学者，你不知道你应该在学习 $topic_of_interest 之前先学习 $prereq_skill。
</p></li>

<li><p>
You have basic knowledge of <code>$topic_of_interest</code>, but have plateaued, and have difficulty finding the right resources for <code>$intermediate_sticking_point</code>
</p>

<p>
你对 $topic_of_interest 有基本知识，但已经停滞不前，并且在寻找合适的 $intermediate_sticking_point 资源方面遇到困难。
</p></li>
</ul>

<p>
via: <a href="https://elroy.bot/blog/2025/07/29/ai-is-a-floor-raiser-not-a-ceiling-raiser.html#license">https://elroy.bot/blog/2025/07/29/ai-is-a-floor-raiser-not-a-ceiling-raiser.html#license</a>
</p>
</blockquote>
</div>
</div>
<div id="outline-container-org28acec4" class="outline-2">
<h2 id="org28acec4">Manual</h2>
<div class="outline-text-2" id="text-org28acec4">
<p>
这个手册的重点是分享一些思路，我选择的这些实现只是参考，找到适合自己的方法才是这个手册的目的。PKM 基本的构建思路都在 <a href="https://www.vandee.art/blog/2024-05-22-org-pkm-manual.html#top">PKM（个人知识管理）构建手册 - Emacs</a> ，这个手册侧重和 AI 的整合。
</p>
</div>
<div id="outline-container-org5cf8d53" class="outline-3">
<h3 id="org5cf8d53">Prerequisites</h3>
<div class="outline-text-3" id="text-org5cf8d53">
<p>
LLM API KEY，终端或 IDE，AI 和编程的基础知识，还涉及到一点 self-hosting。
</p>
</div>
</div>
<div id="outline-container-org7c34168" class="outline-3">
<h3 id="org7c34168">Principles</h3>
<div class="outline-text-3" id="text-org7c34168">
<p>
基于 transformer 架构的 LLM 本质上就是一个概率生成器，因此 PKM with AI 总体的原则就是：让 LLM 提升自己的能力，帮助自己找到实现目标的最大可能性方案。
</p>

<ul class="org-ul">
<li>让 AI 帮助自己提出更好的问题，而不是 AI 速读</li>
<li>让 AI 去掉无关信息，更好的聚焦 key points</li>
<li>让 AI 评估、测试自己的思考和方案，更好的迭代</li>
<li>让 AI 生成路标和地图，而不是代替自己走完全程</li>
</ul>
</div>
</div>
<div id="outline-container-orgca7a57f" class="outline-3">
<h3 id="orgca7a57f">Methods</h3>
<div class="outline-text-3" id="text-orgca7a57f">
<p>
Google NotebookLM 是 AI 和知识、文档交互的一个很完美的实现，但我始终认为这种层面的知识管理和交互并不能很有效的提升思维。
</p>

<p>
各种 RAG 类知识管理项目或软件，从本质上达到的效果是：根据特定的文档获得更准确的检索结果的生成。GraphRAG 效果确实可以比传统 RAG 更好，但它们始终是在学习资料中「检索」和「生成」。
它可以提升知识管理的效率，但这和思维的提升是两码事。
</p>

<p>
而且，只要是生成，就会降低准确性，对我来说，我不想在检索知识的时候，看到 LLM 一大堆废话，只想准确快速的找到我想检索的信息。虽然通过特定的 prompt 可以优化 RAG 生成内容和原文一致性，但问题的关键不在这里，生成其实是不必须的，关键在检索。而传统的文档检索其实就相当够用了，我一直在 Emacs 里使用正则和 tags 进行检索，这比丢给 LLM 20 个文档，等个 1 分钟要快太多了。
</p>

<p>
所以 PKM with AI，我的思路是：让 LLM 更好的配合 PKM 完成检索，生成路标和知识网点地图，把检索做到极致，去掉生成的部分。
</p>

<p>
因此我构建了 <a href="https://www.vandee.art/blog/2025-06-10-nonotes-auto-completion.html">NoNotes</a> ,用向量相似检索自动补全替代 RAG 生成。创造来源于思维的流动，而思维的流动就是联想，我在需要相关概念的时候，直接检索光标当前内容，在高度原子化的 PKM 里通过向量相似检索补全相关的概念和引用来源。
</p>

<p>
随着 context engineering 概念的兴起，我觉得 memory layer，数据接口，是 PKM 和 AI 结合比较合适的方向，例如 <a href="https://supermemory.ai/">supermemory</a> 这个项目，从它刚开始就一直在关注，现在发展的挺不错的。
</p>

<p>
用 Dify、n8n 构建 Workflow 也是很不错的选择，但是对于 PKM 我不太想增加太多的中间流程，也不想花太多时间为了 PKM 去学它们。
</p>
</div>
<div id="outline-container-org890b2f3" class="outline-4">
<h4 id="org890b2f3">信息获取 - 输入</h4>
<div class="outline-text-4" id="text-org890b2f3">
<p>
获取零散信息、新闻我一直通过 RSS，<a href="https://www.vandee.art/blog/2024-11-10-database-of-flowing-knowledge.html">ReadWise</a> 今年不打算续订了，转向了 <a href="https://www.vandee.art/blog/2025-07-04-after-reading-emacs-hoarder.html">Hoarder</a> 。修改了一下 <a href="https://github.com/VandeeFeng/obsidian-clipper">obsidian-clipper</a> 用来在网页里高亮阅读保存到 Hoarder。在 Emacs 里写了一个小脚本，用来同步 Hoarder 的高亮和笔记到本地。还搞了个小玩意 <a href="https://github.com/VandeeFeng/RSS-CLI">RSS-CLI</a> 。
</p>

<p>
我尝试过好几个 AI 聚合信息的项目，起初体验是挺不错，每天 AI 自动根据信息源生成摘要和简报，但时间久了，感觉就像是在吃预制菜，甚至是二手预制菜（许多信息源也就是 AI 生成的）。而且由于是用同一个总结模板 prompt 在总结不同类型的信息，很多时候总结的要点都不准确。
</p>

<p>
还是在 RSS 阅读器里自己看更有滋味。
</p>

<p>
再一个，与其让 AI 从海量信息源里找到自己感兴趣想要的，不如转向关注自己感兴趣的人和圈子，多接触到具体的人和事。信息茧房其实也就是自己更愿意相信或接受什么罢了，不同的圈子和阶层都固然会有信息茧房，要不然就不是圈子了。
</p>

<p>
我的 RSS 订阅源是日积月累慢慢发现的，这种发现只有用心看了文章才会有，AI 速读总结不出作者隐藏在字里行间里的思维以及写作的表达技巧。
</p>
</div>
</div>
<div id="outline-container-org73d6990" class="outline-4">
<h4 id="org73d6990">文档、知识管理 - 迭代</h4>
<div class="outline-text-4" id="text-org73d6990">
</div>
<ul class="org-ul">
<li><a id="org72c344d"></a>笔记编辑器选择<br>
<div class="outline-text-5" id="text-org72c344d">
<p>
Notion 其实一直是一个很不错的选择，特别是现在的 AI 功能挺好用的，上手也没有什么门槛。obsidian 也不用多说，现在有很多很好用的 AI 插件，obsidian 的生态是真的活跃。
</p>

<p>
但是用了 Emacs 之后，其他的就真不想用了。
</p>

<p>
今年从 org-roam 转为使用 <a href="https://github.com/protesilaos/denote">denote</a> ,org-roam 的 UI 从来就没怎么用过，除了可以对外展示一下有多少笔记之外，我觉得没啥用。
</p>

<p>
Emacs 里的 org 文档作为初始笔记，高度原子化之后整理到 tiddlywiki，形成常青笔记和原子笔记。
</p>

<p>
在原子笔记里，我又精炼了一部分，向量化之后储存在向量数据库，通过 NoNotes 补全。如果遇到哪个概念补全不出来，那就说明这个概念还没有掌握或着精炼的程度不够。
</p>

<p>
<a href="https://cloud.llamaindex.ai/">cloud.Llamaindex</a> 和 NoNotes 的实现类似，可以 index 文档，提供 RAG 接口，Qdrant 这类向量数据库加上 MCP 也可以达到类似的效果。自动补全用自己喜欢的语言再写一个和系统交互的 API 就 OK 了。
</p>

<p>
笔记的同步就用 GitHub 就好了，笔记的版本管理和备份是很必须的，GitHub 的 commit 对于管理笔记太合适了。如果特别看重隐私或者讨厌 GitHub，可以自托管 <a href="https://docs.gitea.com/">Gitea</a> 或 <a href="https://about.gitlab.com/install/">GitLab</a>。
</p>
</div>
</li>
<li><a id="org4634785"></a>迭代<br>
<div class="outline-text-5" id="text-org4634785">
<p>
每个星期我会让 LLM 总结一下 PKM 里新增的内容，用 python 写了一个小脚本获取我 GitHub 仓库的 git diff，可以选日期范围，指定的仓库。PKM 丢在了 GitHub ，脚本会生成一个 MD 文档，包含 git commit 新增的内容，把文档丢给 LLM，让它提出几个相关的深度思考问题。
</p>

<p>
在 prompt 的设计上，我喜欢让 LLM 扮演一个批判者，用完全相反的视角分析我的观点，往往会有意想不到的惊喜。
</p>

<p>
也可以用 n8n 或者 GitHub Actions 自动完成这个过程，让 LLM 每周敲打一下自己。
</p>

<p>
迭代是我觉得 PKM 里最重要的一环，让 AI 帮助自己提出更好的问题，找到自己 <a href="https://wiki.vandee.art/#%E6%89%BE%E5%88%B0%E7%9F%A5%E8%AF%86%E7%9A%84%E7%BC%9D%E9%9A%99">知识的缝隙</a> 。
</p>
</div>
</li>
<li><a id="orgdeb87fb"></a>其他和 AI 交互的工具<br>
<div class="outline-text-5" id="text-orgdeb87fb">
<p>
一个 Gemini CLI 管理笔记的例子：Gemini CLI 在半小时内整理了 400 个笔记，在各个主题之间建立了有意义的联系，重命名、整理，合理构建笔记集合，via: <a href="https://x.com/karminski3/status/1939502900503355669">https://x.com/karminski3/status/1939502900503355669</a>
</p>

<p>
这些 CLI 工具不拿来编程，做 PKM 管理也很合适。比起 chat UI，这些 CLI coding 工具提供了更底层、更便捷的 LLM 接口。
</p>

<p>
在 Emacs 里，我一直用 gptel，也很方便。其他和 vibe coding 相关的我记录在了 <a href="https://www.vandee.art/blog/2025-06-30-vibe-coding-tips.html">Vibe Coding Tips</a> ,小工具记录在了 <a href="https://www.vandee.art/blog/2025-01-20-fragmented-knowledge-learning-with-ai.html">碎片知识学习 - with AI</a> 。
</p>
</div>
</li>
</ul>
</div>
<div id="outline-container-org0486015" class="outline-4">
<h4 id="org0486015">笔记和写作 - 输出</h4>
<div class="outline-text-4" id="text-org0486015">
<p>
PKM 知识管理只是学习的方法，永远不是目的。做知识管理很容易就会做成了管理知识，变成了折腾各种笔记工具，学习各种笔记软件，甚至被笔记软件或平台捆绑。这也是 Nonotes 想避免的，笔记不应该被笔记软件或者笔记载体局限甚至捆绑。
</p>

<p>
学习资料在变成笔记的过程中，在精炼和重述的时候，思维已经得到了一些锻炼，但这还远远不够。
</p>

<p>
PKM 的迭代一定要有表达和输出。<a href="https://wiki.vandee.art/#%E5%A6%82%E6%9E%9C%E4%BD%A0%E6%80%9D%E8%80%83%E8%80%8C%E4%B8%8D%E8%BE%93%E5%87%BA%EF%BC%8C%E4%BD%A0%E5%8F%AA%E6%98%AF%E4%BB%A5%E4%B8%BA%E8%87%AA%E5%B7%B1%E5%9C%A8%E6%80%9D%E8%80%83">如果你思考而不输出，你只是以为自己在思考</a> ，脑子里知道了，和写出来，讲出来，画出来是两码事。
</p>

<p>
关于表达，我想讨论的重点不是表达能力和华丽的写作技巧，而是：表达和输出是自我和外界信息的交互、反馈和对抗。用嘴说话和面部表情是我们最平常最熟悉的思维输出和表达，写作、音乐、绘画、编程其实也是一样，只是用了不同的载体和形式。
</p>

<p>
如果把人和人的思维比作计算机，外界信息给定一个输入，人给出输出（没有反馈和输出这里也算作输出的一种，也就是输出为 0），每一个时间、空间下自己的输出就构成了当下别人眼里的自己和自己认为的自己，而每一个当下就构成了自我和物质世界之间的信息交互，也就是所谓的存在。
</p>

<p>
我挺喜欢汪峰的 <a href="https://www.bilibili.com/video/BV1TJ411T7qa/">存在</a> ，名字和自我介绍从我们出生开始，到最后刻在墓碑上，没有多少人给了自己这个问题很好的答案：我该如何存在。
</p>

<p>
希望在 AI 的帮助下，我能够找到我的答案。
</p>
</div>
</div>
<div id="outline-container-org49a1087" class="outline-4">
<h4 id="org49a1087">自定义 Emacs 函数</h4>
<div class="outline-text-4" id="text-org49a1087">
<p>
simple claude:
</p>

<p>
使用 shell，快速运行 Claude Code 执行 <code>claude -p</code> 指令回答一些简单的问题，把结果输出到单独的 buffer。有时候不想用 gptel 就用这个。可以替换成 Gemini 和 Codex。
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #787878;">;; </span><span style="color: #787878;">simple claude code shell command
</span><span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">defun</span> <span style="color: #96a6c8;">my/claude-shell-command</span> <span style="color: #93a8c6;">(</span>prompt<span style="color: #93a8c6;">)</span>
  <span style="color: #787878;">"Execute claude command asynchronously and display the output."</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">interactive</span> <span style="color: #A1D08E;">"sClaude prompt: "</span><span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">let*</span> <span style="color: #b0b1a3;">(</span><span style="color: #97b098;">(</span>output-buffer-name <span style="color: #A1D08E;">"*Claude Output*"</span><span style="color: #97b098;">)</span>
         <span style="color: #97b098;">(</span>output-buffer <span style="color: #aebed8;">(</span>get-buffer-create output-buffer-name<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
         <span style="color: #97b098;">(</span>shell-program <span style="color: #aebed8;">(</span><span style="color: #FFA657;">or</span> <span style="color: #b0b0b3;">(</span>getenv <span style="color: #A1D08E;">"SHELL"</span><span style="color: #b0b0b3;">)</span> shell-file-name<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
         <span style="color: #787878;">;; </span><span style="color: #787878;">Use shell-quote-argument
</span>         <span style="color: #97b098;">(</span>command-str <span style="color: #aebed8;">(</span>format <span style="color: #A1D08E;">"claude -p %s"</span> <span style="color: #b0b0b3;">(</span>shell-quote-argument prompt<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #FFA657;">with-current-buffer</span> output-buffer
      <span style="color: #97b098;">(</span><span style="color: #FFA657;">setq</span> buffer-read-only nil<span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span>erase-buffer<span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span><span style="color: #FFA657;">setq-local</span> header-line-format <span style="color: #aebed8;">(</span>format <span style="color: #A1D08E;">"Claude Output for prompt: %s"</span> prompt<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #787878;">;; </span><span style="color: #787878;">(display-buffer output-buffer) ; Show the buffer immediately
</span>    <span style="color: #b0b1a3;">(</span>message <span style="color: #A1D08E;">"Claude command running asynchronously..."</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #787878;">;; </span><span style="color: #787878;">Start the async process
</span>    <span style="color: #b0b1a3;">(</span><span style="color: #FFA657;">let</span> <span style="color: #97b098;">(</span><span style="color: #aebed8;">(</span>process <span style="color: #b0b0b3;">(</span>start-process <span style="color: #A1D08E;">"claude-process"</span>
                                  output-buffer-name
                                  shell-program
                                  <span style="color: #A1D08E;">"-lc"</span>
                                  command-str<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
      <span style="color: #787878;">;; </span><span style="color: #787878;">Set a function to be called when the process finishes
</span>      <span style="color: #97b098;">(</span>set-process-sentinel process <span style="color: #FFA657;">#'</span><span style="color: #95a99f;">my/claude-process-sentinel</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">defun</span> <span style="color: #96a6c8;">my/claude-process-sentinel</span> <span style="color: #93a8c6;">(</span>process _event<span style="color: #93a8c6;">)</span>
  <span style="color: #787878;">"Sentinel for the claude async process. Handles success and error cases."</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">when</span> <span style="color: #b0b1a3;">(</span>memq <span style="color: #97b098;">(</span>process-status process<span style="color: #97b098;">)</span> <span style="color: #FFA657;">'</span><span style="color: #97b098;">(</span>exit signal<span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #FFA657;">let*</span> <span style="color: #97b098;">(</span><span style="color: #aebed8;">(</span>buffer <span style="color: #b0b0b3;">(</span>process-buffer process<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span>
           <span style="color: #aebed8;">(</span>exit-code <span style="color: #b0b0b3;">(</span>process-exit-status process<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span><span style="color: #FFA657;">cond</span>
       <span style="color: #787878;">;; </span><span style="color: #787878;">Case 1: Process failed (non-zero exit code)
</span>       <span style="color: #aebed8;">(</span><span style="color: #b0b0b3;">(</span>/= exit-code 0<span style="color: #b0b0b3;">)</span>
        <span style="color: #b0b0b3;">(</span>kill-buffer buffer<span style="color: #b0b0b3;">)</span>
        <span style="color: #b0b0b3;">(</span><span style="color: #FFA657;">if</span> <span style="color: #90a890;">(</span>= exit-code 127<span style="color: #90a890;">)</span>
            <span style="color: #90a890;">(</span>message <span style="color: #A1D08E;">"Error: '</span><span style="color: #95a99f;">claude</span><span style="color: #A1D08E;">' command not found. Please ensure it's in your shell's PATH."</span><span style="color: #90a890;">)</span>
          <span style="color: #90a890;">(</span>message <span style="color: #A1D08E;">"Error: Claude command failed with exit code %d."</span> exit-code<span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span>

       <span style="color: #787878;">;; </span><span style="color: #787878;">Case 2: Process succeeded but produced no output
</span>       <span style="color: #aebed8;">(</span><span style="color: #b0b0b3;">(</span>zerop <span style="color: #90a890;">(</span><span style="color: #FFA657;">with-current-buffer</span> buffer <span style="color: #a2b6da;">(</span>buffer-size<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span>
        <span style="color: #b0b0b3;">(</span>kill-buffer buffer<span style="color: #b0b0b3;">)</span>
        <span style="color: #b0b0b3;">(</span>message <span style="color: #A1D08E;">"Claude command finished with no output."</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span>

       <span style="color: #787878;">;; </span><span style="color: #787878;">Case 3: Success
</span>       <span style="color: #aebed8;">(</span>t
        <span style="color: #b0b0b3;">(</span><span style="color: #FFA657;">with-current-buffer</span> buffer
          <span style="color: #90a890;">(</span><span style="color: #FFA657;">setq</span> buffer-read-only t<span style="color: #90a890;">)</span>
          <span style="color: #90a890;">(</span>goto-char <span style="color: #a2b6da;">(</span>point-min<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span>
        <span style="color: #b0b0b3;">(</span>display-buffer buffer<span style="color: #b0b0b3;">)</span>
        <span style="color: #b0b0b3;">(</span>message <span style="color: #A1D08E;">"Claude command finished."</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

</pre>
</div>

<p>
浏览器划词提问：
</p>

<p>
利用 org-protocol 和 JavaScript 对浏览器页面里的特定内容在 Emacs 里用 gptel 提问
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">require</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">org-protocol</span><span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">require</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">gptel</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">require</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">server</span><span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">unless</span> <span style="color: #93a8c6;">(</span>server-running-p<span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span>server-start<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #787878;">;; </span><span style="color: #787878;">Handler for gptel queries from browser
</span><span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">defun</span> <span style="color: #96a6c8;">my/gptel-org-protocol-handler</span> <span style="color: #93a8c6;">(</span>info<span style="color: #93a8c6;">)</span>
  <span style="color: #787878;">"Handle gptel query from org-protocol.
INFO is the data passed by org-protocol."</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">let</span> <span style="color: #b0b1a3;">(</span><span style="color: #97b098;">(</span>text <span style="color: #aebed8;">(</span>plist-get info <span style="color: #79C0FF;">:text</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #FFA657;">when</span> <span style="color: #97b098;">(</span><span style="color: #FFA657;">and</span> text <span style="color: #aebed8;">(</span>not <span style="color: #b0b0b3;">(</span>string-empty-p text<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span><span style="color: #FFA657;">let</span> <span style="color: #aebed8;">(</span><span style="color: #b0b0b3;">(</span>query <span style="color: #90a890;">(</span>decode-coding-string <span style="color: #a2b6da;">(</span>url-unhex-string text<span style="color: #a2b6da;">)</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">utf-8</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span>
        <span style="color: #aebed8;">(</span>message <span style="color: #A1D08E;">"Received gptel query: %s"</span> query<span style="color: #aebed8;">)</span>
        <span style="color: #787878;">;; </span><span style="color: #787878;">Create or switch to gptel buffer
</span>        <span style="color: #aebed8;">(</span><span style="color: #FFA657;">let</span> <span style="color: #b0b0b3;">(</span><span style="color: #90a890;">(</span>buffer <span style="color: #a2b6da;">(</span>get-buffer-create <span style="color: #A1D08E;">"*gptel-browser*"</span><span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span>
          <span style="color: #b0b0b3;">(</span><span style="color: #FFA657;">with-current-buffer</span> buffer
            <span style="color: #90a890;">(</span><span style="color: #FFA657;">unless</span> <span style="color: #a2b6da;">(</span>eq major-mode <span style="color: #FFA657;">'</span><span style="color: #95a99f;">gptel-default-mode</span><span style="color: #a2b6da;">)</span>
              <span style="color: #a2b6da;">(</span>funcall gptel-default-mode<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>
            <span style="color: #90a890;">(</span>gptel-mode 1<span style="color: #90a890;">)</span>
            <span style="color: #90a890;">(</span>goto-char <span style="color: #a2b6da;">(</span>point-max<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>
            <span style="color: #90a890;">(</span>insert <span style="color: #A1D08E;">"</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">n</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">n</span><span style="color: #A1D08E;">--- From Browser ---</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">n</span><span style="color: #A1D08E;">"</span><span style="color: #90a890;">)</span>
            <span style="color: #90a890;">(</span>insert query<span style="color: #90a890;">)</span>
            <span style="color: #90a890;">(</span>insert <span style="color: #A1D08E;">"</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">n</span><span style="color: #A1D08E;">"</span><span style="color: #90a890;">)</span>
            <span style="color: #90a890;">(</span>goto-char <span style="color: #a2b6da;">(</span>point-max<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>
            <span style="color: #787878;">;; </span><span style="color: #787878;">Send the query to gptel
</span>            <span style="color: #90a890;">(</span>gptel-send<span style="color: #90a890;">)</span>
            <span style="color: #90a890;">(</span>display-buffer buffer<span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #787878;">;; </span><span style="color: #787878;">Register the protocol handler
</span><span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">setq</span> org-protocol-protocol-alist
      <span style="color: #93a8c6;">(</span>append org-protocol-protocol-alist
              <span style="color: #FFA657;">'</span><span style="color: #b0b1a3;">(</span><span style="color: #97b098;">(</span><span style="color: #A1D08E;">"gptel-browser"</span>
                 <span style="color: #79C0FF;">:protocol</span> <span style="color: #A1D08E;">"gptel"</span>
                 <span style="color: #79C0FF;">:function</span> my/gptel-org-protocol-handler<span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #787878;">;; </span><span style="color: #787878;">JavaScript bookmarklet for browser (copy this as bookmark URL):
</span><span style="color: #787878;">;; </span><span style="color: #787878;">Basic version:
</span><span style="color: #787878;">;; </span><span style="color: #787878;">javascript:(function(){const selectedText=window.getSelection().toString().trim();if(!selectedText){alert('Please select some text first');return;}const pageTitle=document.title;const pageUrl=window.location.href;const fullText=`From: ${pageTitle}\nURL: ${pageUrl}\n\nSelected text:\n${selectedText}`;const encodedText=encodeURIComponent(fullText);const protocolUrl=`org-protocol://gptel?text=${encodedText}`;window.location.href=protocolUrl;})();
</span>
<span style="color: #787878;">;; </span><span style="color: #787878;">Enhanced version with prompt for question:
</span><span style="color: #787878;">;; </span><span style="color: #787878;">javascript:(function(){const selectedText=window.getSelection().toString().trim();if(!selectedText){alert('Please select some text first');return;}const pageTitle=document.title;const pageUrl=window.location.href;const userQuestion=prompt('Optional: Add a question or context:');let fullText=`From: ${pageTitle}\nURL: ${pageUrl}\n\n`;if(userQuestion){fullText+=`Question: ${userQuestion}\n\n`;}fullText+=`Selected text:\n${selectedText}`;const encodedText=encodeURIComponent(fullText);const protocolUrl=`org-protocol://gptel?text=${encodedText}`;window.location.href=protocolUrl;})();
</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgdbd8484" class="outline-2">
<h2 id="orgdbd8484">Thanks</h2>
<div class="outline-text-2" id="text-orgdbd8484">
<p>
如果这些内容对你有所帮助，我会很开心。
</p>

<p>
AI 带来的便利性一定会让人变懒。变懒可以，但变笨不行。
</p>

<p>
另见:
</p>
<ul class="org-ul">
<li><a href="https://www.vandee.art/blog/2025-12-01-my-emacs-keybindings.html">我的 Emacs 键位设置</a></li>
<li><a href="https://www.vandee.art/blog/2024-05-22-org-pkm-manual.html#org8655a2e">PKM（个人知识管理）构建手册 - Emacs</a></li>
<li><a href="https://www.vandee.art/blog/2024-08-02-nvim-pkm-manual.html">PKM（个人知识管理）构建手册 - Nvim</a></li>
<li><a href="https://www.vandee.art/blog/2025-01-20-fragmented-knowledge-learning-with-ai.html">碎片知识学习 - with AI</a></li>
<li><a href="https://www.vandee.art/blog/2024-12-24-the-structrued-knowledge-workflow-with-ai.html">结构化知识工作流 - with AI</a></li>
<li><a href="https://www.vandee.art/blog/2025-05-23-information-vectorization.html">AI 驱使下的信息向量化</a></li>
<li><a href="https://www.vandee.art/blog/2025-06-10-nonotes-auto-completion.html">从有形到无形 - NoNotes，知识库自动补全</a></li>
<li><a href="https://www.vandee.art/blog/2025-07-04-after-reading-emacs-hoarder.html">稍后阅读新方案 Emacs-Hoarder</a></li>
</ul>

<p>
Relative reading：<a href="https://evrim.zone/blog/opinion/vibes_casino">Vibe Coding Casino</a> ， <a href="https://blog.val.town/vibe-code">Vibe code is legacy code</a> ，<a href="https://www.youtube.com/watch?v=vagyIcmIGOQ&amp;t=5292s">DHH: Future of Programming</a>
</p>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-pkm.html">PKM</a> </div>]]></description>
  <category><![CDATA[PKM]]></category>
  <link>https://www.vandee.art/blog/2025-08-02-pkm-manual-combined-ai.html</link>
  <guid>https://www.vandee.art/blog/2025-08-02-pkm-manual-combined-ai.html</guid>
  <pubDate>Sat, 02 Aug 2025 18:25:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[Linux 太自由了]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org4549e8b">TL;DR</a></li>
<li><a href="#org00be956">“不可避免的 AI”</a></li>
<li><a href="#org9c4be1b">Arch Linux 配置记录</a>
<ul>
<li><a href="#org4f77520">脚本</a></li>
<li><a href="#orgfe3118c">dotfiles</a></li>
<li><a href="#orga4dbdfc">桌面环境和窗口管理</a></li>
<li><a href="#orgc90e55e">Tips</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<div id="outline-container-org4549e8b" class="outline-2">
<h2 id="org4549e8b">TL;DR</h2>
<div class="outline-text-2" id="text-org4549e8b">
<p>
Linux 就是我从现在开始会一直使用下去的操作系统。它的太多设计理念和我不谋而合，Linus 有太多理念和我不谋而合。
</p>
</div>
</div>
<div id="outline-container-org00be956" class="outline-2">
<h2 id="org00be956">“不可避免的 AI”</h2>
<div class="outline-text-2" id="text-org00be956">
<p>
从接触到个人电脑 PC 这个概念开始，就一直用的 Windows，直到很晚才开始使用 Mac，最初的原因也只是需要处理摄影的照片，Mac 的 M 芯片在刚出来的时候就是王炸。
</p>

<p>
之前我对操作系统一直没有什么概念，用着顺手，系统 UI 看着舒服就好了，对 PC 和操作系统也没有什么特殊的情怀和偏爱。但近几年，Windows 首先开始把 AI 功能整合到操作系统默认的系统服务里，这种趋势是我很反感的。要是很有用也就算了，隐私问题就更得不到保证，现在 Apple 也开始了。作为一个普通的消费者，如果产品里没有我可以选择的需求，不用就好了。
</p>

<p>
AI 现在的发展趋势，更多的是资本的裹挟。它直接导致，如果不接入它，就会被市场淘汰。所以操作系统整合 AI 这个趋势，我很理解，如果以后它们单独推出不绑定 AI 的操作系统版本，我还是有可能会继续用。但是如果你把这些强行让消费者来买单，不给消费者选择，这是我反感的。PC 这个产品，或者说操作系统压根就和 AI 没有半毛钱必然的关系啊，为啥我要使用 PC 就一定要用 AI？这就好像我只是想骑自行车，但是必须要带上一个一直会在旁边 BB 的导航一样，我不需要给资本的这些运作买单。几个巨头，大佬发发推，搞搞发布会，融融资，AI 就成了必然和必须，所谓的 AI 革命就开始了。
</p>

<blockquote>
<p>
AI 就是一种新型的操作系统，帮你完成各种任务。这个系统的 CPU 就是大模型，内存就是模型的上下文窗口，窗口越大能完成的任务规模就越大。
</p>

<p>
&#x2013; <a href="https://rlancemartin.github.io/2025/06/23/context_engineering/">Andrej Karpathy</a>
</p>
</blockquote>

<p>
我其实很期待根据上面 AK 大佬所构想的以 LLM 大语言模型为驱动的新操作系统，想想就挺有意思的：当 CPU 里直接集成了大语言模型模块之后，每次打开一个系统里的新窗口，它都可以动态的根据你短暂的操作历史、或是天气、心情，生成。这才是我觉得真正的 AI 整合到操作系统。
</p>

<p>
但 AI 现在的形态最多只是一种更智能的自动化实现(agent &amp; agentic workflow)，距离通用人工智能（AGI）还有很远。
</p>

<p>
互联网发展到现在已经成为了一个普惠的基础服务设施，但 AI 现在还不是，对 AI 过度鼓吹的那些布道者所宣称的普惠性，到现在我还没有真正体会到。它们正在把 token 变成现在的网络流量一样，网络流量的付费那是基础服务设施的付费，AI 现在的 token 付费完全还只是产品的付费。工业革命不管怎么样，是完全把人类社会的生产力提高了一个层次，机器替代了许多重复性的人工劳动实现了自动化，AI 革命距离它提高社会整体生产力还有太远，现在还只是资本游戏的开头。解决不了能源问题，以 AI 现在的耗电量，我都怕撑不到 AI 革命正式开始的那一天。
</p>

<p>
当然，由于 LLM 预测生成的特性，它已经可以实现很多代码编程方面的自动化。现在这个阶段，纯 vibe coding 的产物，它生成的 MVP 、页面、代码片段等等，就像工业革命刚开始的时候，流水线上生产出来的工艺品一样。我当然不否定它创造的经济价值和社会价值，但就像 20 世纪中期的波普艺术和其他工业革命时期的艺术运动想表达的一样，这些流水线产物没得灵魂。
</p>

<p>
<a href="https://en.wikipedia.org/wiki/David_Heinemeier_Hansson">David Heinemeier Hansson</a> 在最近一次 <a href="https://www.youtube.com/watch?v=vagyIcmIGOQ&amp;t=5292s">Lex Fridman 的访谈</a> 里说到：
</p>

<blockquote>
<p>
"I use AI in a separate window. I don't enjoy Cursor or Windsurf, I can literally feel competence draining out of my fingers."
</p>

<p>
"我在一个单独的窗口中使用人工智能。我不喜欢Cursor或Windsurf，我真的能感觉到能力从我的指尖流失。"
</p>
</blockquote>

<p>
DHH 还表示，手动自己编程在键盘上的敲打，就像弹吉他一样，你无法通过观看弹吉他视频就掌握弹吉他这个技能。你可以通过 vibe coding 快速了解到很多，但是这和真正上手掌握一个技术是两回事。
</p>

<p>
作为一个行业外的人，我很赞同 DHH 的观点。vibe coding、AI、自动化，可以提高效率，但这和兴趣爱好、自己的热爱是两码事，可以用 AI 套套公式做出一个爆款口水歌 (我并不否认这种成功) ，也可以只是表达表达自我搞搞乐队，just for fun。我一直无所谓对于 AI 革命哪种观点是正确的，这没太大意义，历史前进的方向不会因为现在这些对错而改变，但保持自己对于这些改变的态度很重要，坚持自己的选择就好。
</p>

<p>
Flowith 的创始人 Derek 有句话说的挺好：品味是人类在 AI 时代最后的壁垒。对于 AI 带来的这些变革，我其实更多的还是期待，仅从艺术这个我更感兴趣的领域来说，可能又可以经历一次大的艺术变革了，艺术领域也太多年没有新鲜玩意了。
</p>

<p>
对于 “不可避免的 AI”，<a href="https://tomrenner.com/posts/llm-inevitabilism/">The sound of inevitability</a> 这个文章的观点挺好：
</p>

<blockquote>
<p>
People advancing an inevitabilist world view state that the future they perceive will inevitably come to pass. It follows, relatively straightforwardly, that the only sensible way to respond to this is to prepare as best you can for that future.
</p>

<p>
持有不可避免主义世界观的人声称他们所感知的未来将不可避免地到来。相对简单地说，回应这一点的唯一明智方式就是尽可能为那个未来做好准备。
</p>

<p>
This is a fantastic framing method. Anyone who sees the future differently to you can be brushed aside as “ignoring reality”, and the only conversations worth engaging are those that already accept your premise.
</p>

<p>
这是一种绝妙的框架方法。任何与您看待未来不同的人都可以被视为“忽视现实”，而唯一值得参与的对话是那些已经接受您前提的对话。
</p>

<p>
I’m not convinced that LLMs are the future. I’m certainly not convinced that they’re the future I want. But what I’m most certain of is that we have choices about what our future should look like, and how we choose to use machines to build it.
</p>

<p>
我并不相信大型语言模型是未来。我当然不相信它们是我想要的未来。但我最确定的是，我们对未来应该是什么样子有选择权，以及我们选择如何使用机器来构建它。
</p>
</blockquote>

<p>
今年一直在看 C 语言，体验 C 语言最合适的操作系统当然就是 Linux 了。在虚拟机里许多底层的实验操作起来不是很方便，正好还有一个很老的电脑已经不能装 Win10 了，最开始是抱着试一试的想法，安装了 Arch Linux，没想到使用体验实在是太好了，一点不卡。选 Arch Linux 是因为它的 wiki 做的太好了，对于新手很友好，Arch 的自由度也很高。
</p>

<p>
再加上，Emacs 在 Linux 里才是满血的，现在所有的 workflow，除了 PS 处理照片和 ollama 的本地模型之外，都迁移到了这个老电脑 Arch Linux。
</p>

<p>
Mac 里的 Emacsclient 一直感觉怪怪的，在 Linux 里体验就很顺畅，打开 Emacsclient 也是秒开，和 Nvim 打开的速度一样快。
</p>

<p>
如果说上面的这些是让我开始使用 Linux 的诱因，那么 Linus 和 <a href="https://wiki.vandee.art/#%E3%80%8AJust%20For%20Fun%E3%80%8B">《Just For Fun》</a> 这本书，就是让我会一直使用 Linux 的原因。Linus 开源 Linux 的这个决定实在是太伟大了。Linus 对于他实现的许多我看来很了不起的事情，只是很谦虚的表示：他在当时完全没有想到后面的事情，只是觉得自己对这些很感兴趣就做了，从结果来看就是自己一次次的走在了自己的前面。
</p>

<p>
Linux 这种自由的感觉很舒服。
</p>
</div>
</div>
<div id="outline-container-org9c4be1b" class="outline-2">
<h2 id="org9c4be1b">Arch Linux 配置记录</h2>
<div class="outline-text-2" id="text-org9c4be1b">
<p>
简单记录一下从 Mac 迁移到 Arch Linux 的配置。
</p>
</div>
<div id="outline-container-org4f77520" class="outline-3">
<h3 id="org4f77520">脚本</h3>
<div class="outline-text-3" id="text-org4f77520">
<p>
让 LLM 随便弄了一个 Linux 的初始化脚本，安装一些我需要的软件和配置。
</p>

<div class="org-src-container">
<pre class="src src-bash">
<span style="color: #787878;">#</span><span style="color: #787878;">!/bin/bash
</span>
<span style="color: #787878;"># </span><span style="color: #787878;">Exit immediately if a command exits with a non-zero status.
</span><span style="color: #79C0FF;">set</span> -e

<span style="color: #787878;"># </span><span style="color: #787878;">Check if the script is run as root
</span><span style="color: #FFA657;">if</span> <span style="color: #8c8c8c;">[</span> <span style="color: #A1D08E;">"$(</span><span style="color: #ff4f58;">id -u</span><span style="color: #A1D08E;">)"</span> -ne 0 <span style="color: #8c8c8c;">]</span>; <span style="color: #FFA657;">then</span>
  <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"This script must be run as root"</span> &gt;&amp;2
  <span style="color: #FFA657;">exit</span> 1
<span style="color: #FFA657;">fi</span>

<span style="color: #787878;"># </span><span style="color: #787878;">--- Package Lists ---
</span><span style="color: #f4f4ff;">BASE_PACKAGES</span>=<span style="color: #A1D08E;">"git curl neovim emacs vim feh mpv docker opensnitch"</span>
<span style="color: #f4f4ff;">FCITX5_PACKAGES_ARCH</span>=<span style="color: #A1D08E;">"fcitx5 fcitx5-rime fcitx5-chinese-addons fcitx5-configtool"</span>
<span style="color: #f4f4ff;">FCITX5_PACKAGES_UBUNTU</span>=<span style="color: #A1D08E;">"fcitx5 fcitx5-rime fcitx5-chinese-addons fcitx5-config-qt"</span>
<span style="color: #f4f4ff;">FCITX5_PACKAGES_FEDORA</span>=<span style="color: #A1D08E;">"fcitx5 fcitx5-rime fcitx5-chinese-addons fcitx5-configtool"</span>
<span style="color: #f4f4ff;">FCITX5_PACKAGES_SUSE</span>=<span style="color: #A1D08E;">"fcitx5 fcitx5-rime fcitx5-chinese-addons fcitx5-configtool"</span>

<span style="color: #787878;"># </span><span style="color: #787878;">Function to install packages on Arch Linux
</span><span style="color: #96a6c8;">install_arch</span><span style="color: #8c8c8c;">()</span> <span style="color: #8c8c8c;">{</span>
  <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Updating system..."</span>
  pacman -Syu --noconfirm --needed
  <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Installing packages for Arch..."</span>
  <span style="color: #FFA657;">for</span> pkg<span style="color: #FFA657;"> in</span> $<span style="color: #f4f4ff;">BASE_PACKAGES</span> $<span style="color: #f4f4ff;">FCITX5_PACKAGES_ARCH</span> base-devel; <span style="color: #FFA657;">do</span>
    pacman -S --noconfirm --needed <span style="color: #A1D08E;">"$pkg"</span> || <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Skipping '$pkg': not found or error."</span>
  <span style="color: #FFA657;">done</span>
<span style="color: #8c8c8c;">}</span>

<span style="color: #787878;"># </span><span style="color: #787878;">Function to install packages on Ubuntu/Debian
</span><span style="color: #96a6c8;">install_ubuntu</span><span style="color: #8c8c8c;">()</span> <span style="color: #8c8c8c;">{</span>
  <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Updating system..."</span>
  apt-get update
  <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Installing packages for Debian/Ubuntu..."</span>
  apt-get install -y --ignore-missing $<span style="color: #f4f4ff;">BASE_PACKAGES</span> $<span style="color: #f4f4ff;">FCITX5_PACKAGES_UBUNTU</span> docker.io build-essential
<span style="color: #8c8c8c;">}</span>

<span style="color: #787878;"># </span><span style="color: #787878;">Function to install packages on Fedora
</span><span style="color: #96a6c8;">install_fedora</span><span style="color: #8c8c8c;">()</span> <span style="color: #8c8c8c;">{</span>
  <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Installing packages for Fedora..."</span>
  <span style="color: #FFA657;">for</span> pkg<span style="color: #FFA657;"> in</span> $<span style="color: #f4f4ff;">BASE_PACKAGES</span> $<span style="color: #f4f4ff;">FCITX5_PACKAGES_FEDORA</span>; <span style="color: #FFA657;">do</span>
    dnf -y install <span style="color: #A1D08E;">"$pkg"</span> || <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Skipping '$pkg': not found or error."</span>
  <span style="color: #FFA657;">done</span>
  <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Installing development tools for Fedora..."</span>
  dnf -y groupinstall <span style="color: #A1D08E;">"C Development Tools and Libraries"</span> || <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Skipping 'C Development Tools and Libraries' group: not found or error."</span>
<span style="color: #8c8c8c;">}</span>

<span style="color: #787878;"># </span><span style="color: #787878;">Function to install packages on OpenSUSE
</span><span style="color: #96a6c8;">install_opensuse</span><span style="color: #8c8c8c;">()</span> <span style="color: #8c8c8c;">{</span>
    <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Installing packages for OpenSUSE..."</span>
    <span style="color: #FFA657;">for</span> pkg<span style="color: #FFA657;"> in</span> $<span style="color: #f4f4ff;">BASE_PACKAGES</span> $<span style="color: #f4f4ff;">FCITX5_PACKAGES_SUSE</span>; <span style="color: #FFA657;">do</span>
        zypper install -y <span style="color: #A1D08E;">"$pkg"</span> || <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Skipping '$pkg': not found or error."</span>
    <span style="color: #FFA657;">done</span>
    <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Installing development tools for OpenSUSE..."</span>
    zypper install -y -t pattern devel_basis || <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Skipping 'devel_basis' pattern: not found or error."</span>
<span style="color: #8c8c8c;">}</span>


<span style="color: #787878;"># </span><span style="color: #787878;">Detect the distribution by checking for the package manager
</span><span style="color: #FFA657;">if </span><span style="color: #79C0FF;">command</span> -v pacman &amp;&gt; /dev/null; <span style="color: #FFA657;">then</span>
    install_arch
<span style="color: #FFA657;">elif </span><span style="color: #79C0FF;">command</span> -v apt-get &amp;&gt; /dev/null; <span style="color: #FFA657;">then</span>
    install_ubuntu
<span style="color: #FFA657;">elif </span><span style="color: #79C0FF;">command</span> -v dnf &amp;&gt; /dev/null; <span style="color: #FFA657;">then</span>
    install_fedora
<span style="color: #FFA657;">elif </span><span style="color: #79C0FF;">command</span> -v zypper &amp;&gt; /dev/null; <span style="color: #FFA657;">then</span>
    install_opensuse
<span style="color: #FFA657;">else</span>
    <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Could not detect a supported package manager (pacman, apt, dnf, zypper)."</span>
    <span style="color: #FFA657;">exit</span> 1
<span style="color: #FFA657;">fi</span>

<span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Basic packages installation complete."</span>
<span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Setting up Fcitx5 environment variables..."</span>

<span style="color: #787878;"># </span><span style="color: #787878;">Create environment file for Fcitx5
</span>mkdir -p /etc/environment.d
cat &gt; /etc/environment.d/90-fcitx5.conf &lt;&lt; EOL<span style="color: #ffff00; font-weight: bold;">
QT_IM_MODULE=fcitx
XMODIFIERS=@im=fcitx
EOL
</span>
<span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Starting Rime configuration..."</span>

<span style="color: #787878;"># </span><span style="color: #787878;">Run the Rime configuration as the user who invoked sudo
</span><span style="color: #FFA657;">if</span> <span style="color: #8c8c8c;">[</span> -n <span style="color: #A1D08E;">"$SUDO_USER"</span> <span style="color: #8c8c8c;">]</span>; <span style="color: #FFA657;">then</span>
    sudo -u <span style="color: #A1D08E;">"$SUDO_USER"</span> bash -c <span style="color: #A1D08E;">'
        echo "Cloning plum repository..."
        if [ -d "$HOME/plum" ]; then
            echo "$HOME/plum already exists. Skipping clone."
        else
            git clone --depth 1 https://github.com/rime/plum "$HOME/plum"
        fi

        echo "Changing to plum directory..."
        cd "$HOME/plum"

        echo "Installing rime-ice..."
        rime_frontend=fcitx5-rime bash rime-install iDvel/rime-ice:others/recipes/full
    '</span>
<span style="color: #FFA657;">else</span>
    <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Could not determine the user to install Rime for."</span>
    <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Please run the following commands manually as a regular user:"</span>
    <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"git clone --depth 1 https://github.com/rime/plum ~/plum"</span>
    <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"cd ~/plum"</span>
    <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"rime_frontend=fcitx5-rime bash rime-install iDvel/rime-ice:others/recipes/full"</span>
<span style="color: #FFA657;">fi</span>


<span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Installation and setup complete."</span>
<span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Please reboot your system for all changes to take effect."</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgfe3118c" class="outline-3">
<h3 id="orgfe3118c">dotfiles</h3>
<div class="outline-text-3" id="text-orgfe3118c">
<p>
bash，tmux，Emacs，Nvim，还有其他的配置一直用 GitHub 在同步，迁移起来也很顺畅。
</p>

<p>
Mac 和 Linux 在文件路径上基本是一致的，需要改的也很少。我也没有啥复杂的开发环境。。。
</p>
</div>
</div>
<div id="outline-container-orga4dbdfc" class="outline-3">
<h3 id="orga4dbdfc">桌面环境和窗口管理</h3>
<div class="outline-text-3" id="text-orga4dbdfc">
<p>
2025-09-14 added : 已经转到了 Wayland 和 Sway，偶尔也用 X11 <a href="https://www.vandee.art/blog/2025-08-12-unstable-until-you-linux.html">薛定谔的 Linux</a>
</p>

<p>
KDE 的 Plasma 太重了，许多功能我也不需要。在 Arch Linux 里，发现 hyprland 自由度很高，就选择了这个。
</p>

<p>
Gnome 不太喜欢，之前在虚拟机里一直用的 Ubuntu 就是 Gnome，整个的设计和操作逻辑都不太喜欢。看起来和 MacOS 挺像，但是用起来我感觉挺不顺手，而且 Mac 的 Dock 栏我一直不太喜欢。
</p>

<p>
一直使用的是堆叠式的窗口管理，现在换到了 hyprland 的平铺式，才发现我更喜欢平铺式，特别是在大屏幕上，体验太好了。在 hyprland 里配置快捷键和启动项很方便，在绑定了快捷键之后，可以全键盘操作切换窗口和 Workspace。
</p>

<p>
登录还是使用的 KDE SDDM。
</p>

<p>
弄了一个小脚本用来把当前窗口隐藏到 hyprland 的 special Workspace，我感觉很实用：
</p>

<div class="org-src-container">
<pre class="src src-bash">
<span style="color: #787878;">#</span><span style="color: #787878;">!/bin/bash
</span>
<span style="color: #787878;"># </span><span style="color: #787878;">Directory to store the original workspace ID of the window
</span><span style="color: #f4f4ff;">STATE_DIR</span>=<span style="color: #A1D08E;">"/tmp/hypr-special-state"</span>
mkdir -p <span style="color: #A1D08E;">"$STATE_DIR"</span>

<span style="color: #787878;"># </span><span style="color: #787878;">Get active window info as JSON
</span><span style="color: #f4f4ff;">active_window_json</span>=$<span style="color: #8c8c8c;">(</span><span style="color: #ff4f58;">/usr/bin/hyprctl activewindow -j</span><span style="color: #8c8c8c;">)</span>

<span style="color: #787878;"># </span><span style="color: #787878;">Extract address and workspace info
</span><span style="color: #f4f4ff;">window_address</span>=$<span style="color: #8c8c8c;">(</span><span style="color: #ff4f58;">echo "$active_window_json" | /usr/bin/jq -r '.address'</span><span style="color: #8c8c8c;">)</span>
<span style="color: #f4f4ff;">workspace_id</span>=$<span style="color: #8c8c8c;">(</span><span style="color: #ff4f58;">echo "$active_window_json" | /usr/bin/jq -r '.workspace.id'</span><span style="color: #8c8c8c;">)</span>
<span style="color: #f4f4ff;">workspace_name</span>=$<span style="color: #8c8c8c;">(</span><span style="color: #ff4f58;">echo "$active_window_json" | /usr/bin/jq -r '.workspace.name'</span><span style="color: #8c8c8c;">)</span>

<span style="color: #787878;"># </span><span style="color: #787878;">Exit if no active window is found
</span><span style="color: #FFA657;">if</span> <span style="color: #8c8c8c;">[</span> -z <span style="color: #A1D08E;">"$window_address"</span> <span style="color: #8c8c8c;">]</span> || <span style="color: #8c8c8c;">[</span> <span style="color: #A1D08E;">"$window_address"</span> == <span style="color: #A1D08E;">"null"</span> <span style="color: #8c8c8c;">]</span>; <span style="color: #FFA657;">then</span>
    <span style="color: #FFA657;">exit</span> 0
<span style="color: #FFA657;">fi</span>

<span style="color: #787878;"># </span><span style="color: #787878;">Path to the state file for the current window
</span><span style="color: #f4f4ff;">STATE_FILE</span>=<span style="color: #A1D08E;">"$STATE_DIR/$window_address"</span>

<span style="color: #787878;"># </span><span style="color: #787878;">Check if the window is in the special workspace
</span><span style="color: #FFA657;">if</span> <span style="color: #8c8c8c;">[</span><span style="color: #93a8c6;">[</span> <span style="color: #A1D08E;">"$workspace_name"</span> == <span style="color: #A1D08E;">"special"</span>* <span style="color: #93a8c6;">]</span><span style="color: #8c8c8c;">]</span>; <span style="color: #FFA657;">then</span>
    <span style="color: #787878;"># </span><span style="color: #787878;">Window is in a special workspace, move it back to its original workspace
</span>    <span style="color: #FFA657;">if</span> <span style="color: #8c8c8c;">[</span> -f <span style="color: #A1D08E;">"$STATE_FILE"</span> <span style="color: #8c8c8c;">]</span>; <span style="color: #FFA657;">then</span>
        <span style="color: #f4f4ff;">target_workspace</span>=$<span style="color: #8c8c8c;">(</span><span style="color: #ff4f58;">cat "$STATE_FILE"</span><span style="color: #8c8c8c;">)</span>
        rm <span style="color: #A1D08E;">"$STATE_FILE"</span> <span style="color: #787878;"># </span><span style="color: #787878;">Clean up the state file
</span>    <span style="color: #FFA657;">else</span>
        <span style="color: #787878;"># </span><span style="color: #787878;">Fallback: if no state file is found, move to the first available regular workspace
</span>        <span style="color: #f4f4ff;">target_workspace</span>=$<span style="color: #8c8c8c;">(</span><span style="color: #ff4f58;">/usr/bin/hyprctl workspaces -j | /usr/bin/jq -r '.[] | select(.id &gt;= 1</span><span style="color: #A1D08E;">) | .id'</span> | head -n 1<span style="color: #8c8c8c;">)</span>
        <span style="color: #787878;"># </span><span style="color: #787878;">Default to workspace 1 if no other regular workspace is found
</span>        <span style="color: #FFA657;">if</span> <span style="color: #8c8c8c;">[</span> -z <span style="color: #A1D08E;">"$target_workspace"</span> <span style="color: #8c8c8c;">]</span>; <span style="color: #FFA657;">then</span>
            <span style="color: #f4f4ff;">target_workspace</span>=1
        <span style="color: #FFA657;">fi</span>
    <span style="color: #FFA657;">fi</span>

    <span style="color: #787878;"># </span><span style="color: #787878;">Move the specific window to the target workspace
</span>    /usr/bin/hyprctl dispatch movetoworkspace <span style="color: #A1D08E;">"$target_workspace,address:$window_address"</span>
<span style="color: #FFA657;">else</span>
    <span style="color: #787878;"># </span><span style="color: #787878;">Window is not in a special workspace, so move it there and save its current workspace
</span>    <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"$workspace_id"</span> &gt; <span style="color: #A1D08E;">"$STATE_FILE"</span>
    /usr/bin/hyprctl dispatch movetoworkspacesilent <span style="color: #A1D08E;">"special,address:$window_address"</span>
<span style="color: #FFA657;">fi</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgc90e55e" class="outline-3">
<h3 id="orgc90e55e">Tips</h3>
<div class="outline-text-3" id="text-orgc90e55e">
<p>
在国内，安装 Linux 遇到的最大的问题应该就是网络问题了。
</p>

<p>
在没有安装桌面环境之前，只有命令行，配置代理很不方便。Arch 是可以在安装之前选择国内的镜像的，但是涉及到需要使用 GitHub 和 yay 的包，就不行了。
</p>

<p>
好在可以直接在 Arch 里， <code>sudo pacman -S v2ray</code> ，然后把代理的 config.json 用 U 盘挂载，导入进来就好了。
</p>
</div>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-linux.html">Linux</a> <a href="https://www.vandee.art/blog/tag-ramble.html">Ramble</a> </div>]]></description>
  <category><![CDATA[Linux]]></category>
  <category><![CDATA[Ramble]]></category>
  <link>https://www.vandee.art/blog/2025-07-16-linux-is-awesome.html</link>
  <guid>https://www.vandee.art/blog/2025-07-16-linux-is-awesome.html</guid>
  <pubDate>Wed, 16 Jul 2025 13:30:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[稍后阅读新方案 Emacs-Hoarder]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgd95bd97">TL;DR</a></li>
<li><a href="#orgb8fb681">Hoarder</a></li>
<li><a href="#orgcc4a60e">Emacs-Hoarder</a></li>
<li><a href="#org36c8ff8">Obsidian-Web-Clipper</a></li>
</ul>
</div>
</nav>
<div id="outline-container-orgd95bd97" class="outline-2">
<h2 id="orgd95bd97">TL;DR</h2>
<div class="outline-text-2" id="text-orgd95bd97">
<p>
从 Omnivore 到 <a href="https://github.com/VandeeFeng/bookmark-summary%20">Clip</a> ,再到 ReadWise，一直没有找到一个符合自己需求和习惯的稍后阅读 + 高亮剪藏方案。再持续观察和试用 <a href="https://github.com/hoarder-app/hoarder/">Hoarder</a> 之后，最终决定就是它了。
</p>

<p>
因此之前的 clip 就正式 <a href="https://memo.vandee.art/issue/63">停用</a> 了。
</p>
</div>
</div>
<div id="outline-container-orgb8fb681" class="outline-2">
<h2 id="orgb8fb681">Hoarder</h2>
<div class="outline-text-2" id="text-orgb8fb681">
<p>
<a href="https://github.com/karakeep-app/karakeep">Karakeep</a> （原 Hoarder），作者的解释是：
</p>

<blockquote>
<p>
The name Karakeep is inspired by the Arabic word "كراكيب" (karakeeb), a colloquial term commonly used to refer to miscellaneous clutter, odds and ends, or items that may seem disorganized but often hold personal value or hidden usefulness. It evokes the image of a messy drawer or forgotten box, full of stuff you can't quite throw away—because somehow, it matters (or more likely, because you're a hoarder!).
</p>

<p>
Karakeep 这个名称的灵感来源于阿拉伯词语 “كراكيب” (karakeeb)，这是一个口语化术语，通常用来指代杂物、零碎物品，或者看起来杂乱无章但往往具有个人价值或隐藏用处的物品。它唤起了一个凌乱的抽屉或被遗忘的箱子的形象，里面塞满了你无法完全扔掉的东西——因为不知怎的，它很重要（或者更可能是，因为你是个囤积者！）。
</p>
</blockquote>

<p>
我还是习惯叫 Hoarder，后面也都用这个。
</p>

<p>
Hoarder 可以看作是一个精简版的 ReadWise，支持 RSS feed，书签导入，URL 导入，高亮笔记，webhook，还有简明的 API 文档。有移动端客户端，浏览器插件，支持 sefl-hosting。
</p>

<p>
结合 LLM 的功能是生成 tags 书签，生成 summary 总结，可以不使用。也支持 MCP。
</p>

<p>
除了这些之外，再没有其他臃肿的功能了。关注了这么久，这个项目的开发方向一直很稳定，没有加入杂七杂八的噱头功能。
</p>

<p>
部署也很方便（没有服务器就本地跑）：
</p>

<div class="org-src-container">
<pre class="src src-bash">mkdir karakeep-app

wget https://raw.githubusercontent.com/karakeep-app/karakeep/main/docker/docker-compose.yml

<span style="color: #787878;"># </span><span style="color: #787878;">.env
</span><span style="color: #f4f4ff;">KARAKEEP_VERSION</span>=release
<span style="color: #f4f4ff;">NEXTAUTH_SECRET</span>=super_random_string
<span style="color: #f4f4ff;">MEILI_MASTER_KEY</span>=another_random_string
<span style="color: #f4f4ff;">NEXTAUTH_URL</span>=http://localhost:3000
</pre>
</div>

<p>
它没有深度绑定 AI 反而是我现在决定长期使用它的原因了。
</p>

<p>
ReadWise 用了快一年了，实际的使用当中，ReadWise 的 AI 功能基本没怎么用，前几个月出来的可以根据 highlight 提问对话还是挺好用。
</p>

<p>
而且现在 PKM 里绝大部分的内容都已经接入了 <a href="https://www.vandee.art/blog/2025-06-10-nonotes-auto-completion.html">Nonotes</a> 做向量相似检索和补全。
</p>

<p>
我现在需要的是一个多端同步，支持稍后阅读，RSS 订阅，高亮笔记的中转站，Hoarder 的功能正好很契合。尝试过自己搭，但是真的很麻烦，还是用现成的吧。
</p>

<p>
AI 速读没得灵魂，渐进式阅读，高亮剪藏更容易进入心流，引发深度思考。
</p>

<p>
它的缺点嘛，就是 UI 太丑了，而且移动端和浏览器插件的功能很简陋。
</p>

<p>
基于 <a href="https://github.com/obsidianmd/obsidian-clipper">Obsidian-Web-Clipper</a> 插件修改了一下，增加了导入到 Hoarder 的功能： <a href="https://github.com/VandeeFeng/obsidian-clipper/tree/hoarder">https://github.com/VandeeFeng/obsidian-clipper/tree/hoarder</a>
</p>

<p>
可以把剪藏的内容记录到 hoarder 的 note 部分，并保存网页。
</p>
</div>
</div>
<div id="outline-container-orgcc4a60e" class="outline-2">
<h2 id="orgcc4a60e">Emacs-Hoarder</h2>
<div class="outline-text-2" id="text-orgcc4a60e">
<p>
写了一个小工具在 Emacs 里同步 Hoarder 的高亮。正好把 Gemini CLI 拉出来练练，Lisp 的括号真是 LLM 杀手。在重构代码的时候，每次都不能正确的处理括号，Claude、GPT 也是一样。
</p>

<p>
Github: <a href="https://github.com/VandeeFeng/Emacs-Hoarder">https://github.com/VandeeFeng/Emacs-Hoarder</a>
</p>

<p>
Hoarder 有 MCP 可以检索笔记、添加笔记，所以其他功能就不重复做了。后面想到什么方便的功能再慢慢加。
</p>
</div>
</div>
<div id="outline-container-org36c8ff8" class="outline-2">
<h2 id="org36c8ff8">Obsidian-Web-Clipper</h2>
<div class="outline-text-2" id="text-org36c8ff8">
<p>
用 Obsidian-Web-Clipper 已经很长时间了，这就是目前为止我用过最好的网页剪藏工具。
</p>

<p>
Github：<a href="https://github.com/obsidianmd/obsidian-clipper">https://github.com/obsidianmd/obsidian-clipper</a>
</p>

<p>
几个亮点：
</p>
<ul class="org-ul">
<li>可以自定义剪藏的模板</li>
<li>可以结合 LLM 自定义 prompt 进一步优化剪藏的内容</li>
<li>内置了一个阅读器视图</li>
</ul>

<p>
Obsidian-Web-Clipper 提供了相当多的变量和语法，可以发挥想象设计出很多有意思的模板。具体可以查看 <a href="https://help.obsidian.md/web-clipper">帮助文档</a> 。
</p>

<p>
就算不使用 obsidian，它也可以很好的融合到其他的工作流当中。
</p>

<p>
例如这个用在 Emacs 里的 org 格式剪藏模板：
</p>

<div class="org-src-container">
<pre class="src src-nil">
**{{title}}
&lt;{{date|date:"YYYY-MM-DD ddd HH:mm"}}&gt;

source: {{url}}

{{content}}

</pre>
</div>

<p>
也可以直接生成 org 文件，甚至美观的 HTML 网页或者 SVG 小卡片方便社交网络分享。
</p>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-emacs.html">Emacs</a> </div>]]></description>
  <category><![CDATA[Emacs]]></category>
  <link>https://www.vandee.art/blog/2025-07-04-after-reading-emacs-hoarder.html</link>
  <guid>https://www.vandee.art/blog/2025-07-04-after-reading-emacs-hoarder.html</guid>
  <pubDate>Fri, 04 Jul 2025 20:06:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[Vibe Coding Tips]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org990b379">TL;DR</a></li>
<li><a href="#orgc5eb547">General Tips</a></li>
<li><a href="#org2bcde4b">Container</a>
<ul>
<li><a href="#org2f3bfa7">Coding Assistant Container</a></li>
<li><a href="#orgb2f3621">MCP Container</a></li>
</ul>
</li>
<li><a href="#org29d5e6e">Articles</a></li>
<li><a href="#org912eb34">CLI AI Coding Tools</a></li>
</ul>
</div>
</nav>
<div id="outline-container-org990b379" class="outline-2">
<h2 id="org990b379">TL;DR</h2>
<div class="outline-text-2" id="text-org990b379">
<p>
各种 Vibe Coding 工具不是关键，它们背后对模型优化的实现才是。Vibe Coding 在带来了便利的同时，也增加了许多安全隐患，为 AI 设置隔离环境很有必要。
</p>

<p>
持续记录一下 vibe coding 的相关 tips。
</p>

<p>
<a href="https://memo.vandee.art/issue/62">Vibe Coding Timeline #62 - Git Memo</a>
</p>
</div>
</div>
<div id="outline-container-orgc5eb547" class="outline-2">
<h2 id="orgc5eb547">General Tips</h2>
<div class="outline-text-2" id="text-orgc5eb547">
<p>
由于我的主力 IDE 一直是 Emacs，在 Cursor 刚出来的时候，各种针对 Cursor 的 Cursor rules，各种 workflow 铺天盖地，当时就觉得没有必要花时间去研究。在 Emacs 里使用 gptel 和 aider 可以解决我 80%的问题。
</p>

<p>
事实证明当时的判断是正确的，没有把时间和精力过多的用在学习 cursor 这个工具上面。现在 Cursor 被 Claude code 抄家背刺了，变笨了许多。现在风向又铺天盖地的倒向了 Claude code。
</p>

<p>
现在的 Vibe Coding 也是一样，以后还会出现更智能的 vibe 工具和形态，AI 的迭代实在太快了。
</p>

<p>
这些工具本身不是那么关键，之前 Cursor 对 Claude 优化的 prompt 和方法，以及现在 Claude code 的底层优化才是 vibe coding 这个阶段更值得学习的。
</p>

<p>
OpenAI 的 codex, Gemini CLI 相继开源，背后的核心实现会越来越清晰。
</p>

<p>
最近一直在看三巨头的代码库，还有这个 <a href="https://github.com/sst/opencode">https://github.com/sst/opencode</a> ，让 Gemini CLI 分析 Gemini CLI 也是挺有趣。
</p>

<p>
这些 CLI 代码工具不一定要拿来写代码，就像 cursor 可以和 obsidian 的库结合做笔记一样。
</p>

<p>
<code>gemini -p "&lt;prompt&gt;"</code> 直接调用 Gemini CLI 完全可以当作一个终端的 AI 小助手了。也可以结合其他工作流，充分利用 Gemini 超长的上下文提供 context 给其他 LLM。
</p>

<p>
很久之前的这个 <a href="https://github.com/OpenInterpreter/open-interpreter">OpenInterpreter/open-interpreter</a> 项目能做的事，现在用 CLI 代码工具也可以轻松实现了。 <a href="https://github.com/warpdotdev/Warp">warpdotdev/Warp</a> AI 终端的很多功能现在也可以使用 Gemini CLI 等工具实现了。
</p>
</div>
</div>
<div id="outline-container-org2bcde4b" class="outline-2">
<h2 id="org2bcde4b">Container</h2>
<div class="outline-text-2" id="text-org2bcde4b">
</div>
<div id="outline-container-org2f3bfa7" class="outline-3">
<h3 id="org2f3bfa7">Coding Assistant Container</h3>
<div class="outline-text-3" id="text-org2f3bfa7">
<p>
参考 <a href="https://xuanwo.io/2025/03-how-i-vibe-coding/">How I Vibe Coding?</a> 这篇 blog 里的思路实践了一下，用 docker 给 Claude code 等这些 AI CLI 代码工具设定一个隔离环境。
</p>

<p>
Claude 4 的编程效果现在普遍认为是最好的，但是 Claude 的封控太严格了，我也没那么大编程的需求，封一次号就又要折腾。
</p>

<p>
Gemini 2.5 Pro 的 API 现在每天有 1000 次免费请求，对我来说足够了。Gemini 的超长 context window 对分析和学习项目帮助很大。但 Gemini 免费的代价就是共享对话的数据。
</p>

<p>
以 Gemini CLI 为例，执行 <code>docker build -t YOUR-IMAGE-NAME .</code> build image。
</p>

<div class="org-src-container">
<pre class="src src-nil">FROM ubuntu:latest

# Update system and install base dependencies
RUN apt-get update &amp;&amp; apt-get upgrade -y &amp;&amp; \
    DEBIAN_FRONTEND=noninteractive apt-get install -y \
    build-essential \
    git \
    curl \
    wget \
    vim \
    neovim \
    sudo \
    openssh-client \
    ca-certificates \
    gnupg

# Install development tools
RUN apt-get install -y \
    python3 \
    python3-pip \
    jq \
    tmux \
    htop \
    tree \
    unzip \
    protobuf-compiler \
    zip

# Install Node.js and npm
RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - &amp;&amp; \
    apt-get install -y nodejs &amp;&amp; \
    npm install -g pnpm yarn


# Install ripgrep and fd-find
RUN apt-get update &amp;&amp; \
    apt-get install -y ripgrep fd-find


# Create a regular user
RUN useradd -m -G sudo -s /bin/bash user &amp;&amp; \
    echo "user ALL=(ALL) NOPASSWD: ALL" &gt;&gt; /etc/sudoers

# Switch to user for installations
USER user
WORKDIR /home/user

# Switch back to root for cleanup
USER root

# Clean apt cache
RUN apt-get clean &amp;&amp; \
    rm -rf /var/lib/apt/lists/*

# Switch back to user
USER user

# Install Gemini CLI globally (user has npm permissions via sudo)
RUN sudo npm install -g @google/gemini-cli

# Set working directory
WORKDIR /workspace

# Set shell to bash and ensure .bashrc is loaded
SHELL ["/bin/bash", "-c"]
RUN echo '[ -f ~/.bashrc ] &amp;&amp; source ~/.bashrc' &gt;&gt; ~/.bash_profile

CMD ["/bin/bash", "-l", "-c", "gemini"]
</pre>
</div>

<p>
以 bash 为例，在 <code>~/.bashrc</code> 里添加：
</p>

<div class="org-src-container">
<pre class="src src-bash">
<span style="color: #787878;"># </span><span style="color: #787878;">geminix
</span><span style="color: #79C0FF;">alias</span> <span style="color: #f4f4ff;">geminix</span>=<span style="color: #A1D08E;">'docker run -it --rm \
  -v $(</span><span style="color: #ff4f58;">pwd</span><span style="color: #A1D08E;">):/workspace \
  -v ~/.bashrc:/home/user/.bashrc \
  -v ~/.config/gh:/home/user/.config/gh \
  YOUR-IMAGE-NAME'</span>

</pre>
</div>

<p>
<code>-v $(pwd):/workspace</code> 会把当前目录挂载到 docker 的 volume。可以根据需求挂载更多的目录。
</p>

<p>
这样就实现了在 docker 隔离环境里使用 Gemini CLI 或其他 AI 工具，vibe coding 指定的项目。
</p>

<p>
如果在 macOS，用 OrbStack 就更方便了，它可以直接共享本机和 container 的数据。
</p>
</div>
</div>
<div id="outline-container-orgb2f3621" class="outline-3">
<h3 id="orgb2f3621">MCP Container</h3>
<div class="outline-text-3" id="text-orgb2f3621">
<p>
MCP 我一直觉得不是很必须，但是偶尔还是会用用，MCP 的安全隐患比 LLM 更大。
</p>

<p>
MCP Container 相关的项目也挺多，我用的是: <a href="https://github.com/TBXark/mcp-proxy">https://github.com/TBXark/mcp-proxy</a>
</p>

<p>
<a href="https://miantiao.me/posts/guide-to-running-mcp-server-in-a-sandbox/">在 Docker 沙箱中运行 MCP Server | 面条实验室</a> 作者还写了一个教程。
</p>

<p>
我已经把我常用的几个 MCP 都部署好了。
</p>

<p>
用的最多的就是 sequential-thinking ，Exa search。
</p>
</div>
</div>
</div>
<div id="outline-container-org29d5e6e" class="outline-2">
<h2 id="org29d5e6e">Articles</h2>
<div class="outline-text-2" id="text-org29d5e6e">
<p>
整理了一些感觉还不错的文章
</p>

<ul class="org-ul">
<li>The contents of /mnt/skills in Claude's code interpreter environment
<a href="https://github.com/simonw/claude-skills">https://github.com/simonw/claude-skills</a>
via: <a href="https://simonwillison.net/2025/Oct/10/claude-skills">https://simonwillison.net/2025/Oct/10/claude-skills</a>
<a href="https://simonwillison.net/2025/Oct/10/superpowers/#atom-everything">Superpowers: How I'm using coding agents in October 2025</a></li>

<li><a href="https://simonwillison.net/2025/Oct/7/vibe-engineering/#atom-everything">Vibe engineering</a>
simon 大佬也讨厌 vibes 这个定义</li>

<li><a href="https://www.anthropic.com/news/claude-code-on-the-web">Claude Code web - Anthropic’s Cloud-Based Async Agent</a> ‍
Anthropic 刚刚发布了一个网页异步版本的 Claude Code，在研究预览中，仅供 Pro 和 Max 订阅者使用，它让您能够跨不同 repos 启动多个编码任务，所有任务都在他们的云基础设施上并行运行。
Simon Willison 写了一篇非常不错的博客，分享了他与 Claude Code web 的体验，并且他指出了重要的一点：需要不断批准的代理非常缓慢，但是这个在 "YOLO mode" 中运行，具有适当的沙箱设置，这使它真正有用。<a href="https://simonwillison.net/2025/Oct/20/claude-code-for-web/">https://simonwillison.net/2025/Oct/20/claude-code-for-web/</a></li>

<li><p>
<a href="https://simonwillison.net/2025/Oct/22/claude-code-logs/#atom-everything">Don&amp;#x27;t let Claude Code delete your session logs</a>
</p>

<p>
不幸的是，Claude Code 有一个讨厌的默认行为，会在 30 天后删除这些！ 你不能完全禁用这个，但你至少可以通过将这个添加到你的 ~/.claude/settings.json 文件中来延迟它 274 年：
</p>

<p>
{
"cleanupPeriodDays": 99999
}
</p></li>

<li><a href="https://hojberg.xyz/the-programmer-identity-crisis/">The Programmer Identity Crisis ❈ Simon Højber</a>
真正的手艺人啊！</li>
<li><a href="https://geohot.github.io//blog/jekyll/update/2025/09/12/ai-coding.html">AI Coding | the singularity is nearer</a>
这篇的观点挺赞同</li>
<li><a href="https://idiallo.com/blog/writing-code-is-easy-reading-is-hard">Writing Code Is Easy. Reading It Isn’t.</a></li>
<li><a href="https://blog.sigplan.org/2025/08/29/ai-models-need-a-virtual-machine/">AI Models Need a Virtual Machine | SIGPLAN Blog</a></li>
<li><a href="https://guangzhengli.com/blog/zh/vibe-coding-and-context-coding">谈谈 AI 编程工具的进化与 Vibe Coding</a></li>
<li><p>
<a href="https://ghuntley.com/agent/">how to build a coding agent: free workshop</a>
</p>

<p>
<a href="https://github.com/ghuntley/how-to-build-a-coding-agent">https://github.com/ghuntley/how-to-build-a-coding-agent</a>
</p></li>

<li><a href="https://minusx.ai/blog/decoding-claude-code/">Minusx | What makes Claude Code so damn good (and how to recreate that magic in your agent)!?</a></li>
<li><a href="https://evrim.zone/blog/opinion/vibes_casino">Vibe Coding Casino – blog/opinion/vibes_casino — evrim.zone</a></li>
<li><a href="https://blog.val.town/vibe-code">Vibe code is legacy code | Val Town Blog</a></li>
<li><a href="https://onevcat.com/2025/08/claude-code/">一个半月高强度 Claude Code 使用后感受 | OneV's Den</a></li>
<li><a href="https://www.anthropic.com/news/how-anthropic-teams-use-claude-code">How Anthropic teams use Claude Code \ Anthropic</a></li>
<li><a href="https://www.dzombak.com/blog/2025/08/getting-good-results-from-claude-code/">Getting Good Results from Claude Code • Chris Dzombak</a>
文章的 CLAUDE.md 还不错</li>
</ul>
</div>
</div>
<div id="outline-container-org912eb34" class="outline-2">
<h2 id="org912eb34">CLI AI Coding Tools</h2>
<div class="outline-text-2" id="text-org912eb34">
<p>
整理了一些现在 star 比较多的 CLI AI Coding 项目：
</p>

<ul class="org-ul">
<li><p>
CCSeva: A beautiful macOS menu bar app for tracking your Claude Code usage in real-time. Monitor token consumption, costs, and usage patterns with an elegant interface.
</p>

<p>
<a href="https://github.com/Iamshankhadeep/ccseva">https://github.com/Iamshankhadeep/ccseva</a>
</p></li>

<li><p>
SuperClaude: this lightweight framework turns claude code into a complete dev partner
</p>

<p>
<a href="https://github.com/NomenAK/SuperClaude">https://github.com/NomenAK/SuperClaude</a>
</p></li>

<li><p>
claudia: Claude code GUI
</p>

<p>
<a href="https://github.com/getAsterisk/claudia">https://github.com/getAsterisk/claudia</a>
</p></li>

<li><p>
Open Codex CLI: 一个大佬 fork 了 OpenAI 最近出的 CLI 工具，支持了更多的模型。
</p>

<p>
<a href="https://github.com/ymichael/open-codex">https://github.com/ymichael/open-codex</a>
</p></li>

<li><p>
codex: Lightweight coding agent that runs in your terminal
</p>

<p>
<a href="https://github.com/openai/codex">https://github.com/openai/codex</a>
</p></li>

<li><p>
opencode: AI coding agent, built for the terminal.
</p>

<p>
<a href="https://github.com/sst/opencode">https://github.com/sst/opencode</a>
</p></li>

<li><p>
opencode: OpenCode is a Go-based CLI application that brings AI assistance to your terminal. It provides a TUI (Terminal User Interface) for interacting with various AI models to help with coding tasks, debugging, and more.
</p>

<p>
<a href="https://github.com/opencode-ai/opencode">https://github.com/opencode-ai/opencode</a>
</p></li>

<li><p>
Claude Squad: Claude Squad is a terminal app that manages multiple Claude Code, Codex (and other local agents including Aider) in separate workspaces, allowing you to work on multiple tasks simultaneously.
</p>

<p>
<a href="https://github.com/smtg-ai/claude-squad">https://github.com/smtg-ai/claude-squad</a>
</p></li>
<li><p>
一个 OpenRouter 的开源增强版，LMRouter，会支持所有 LLM /图片/视频/音频/embedding模型，提供统一的OpenAI/Anthropic/Responses API接口。
</p>

<p>
<a href="https://github.com/LMRouter/lmrouter-core">https://github.com/LMRouter/lmrouter-core</a>
</p></li>
<li><p>
Control Claude Code remotely via email. Start tasks locally, receive notifications when Claude completes them, and send new commands by simply replying to emails.
</p>

<p>
<a href="https://github.com/JessyTsui/Claude-Code-Remote">https://github.com/JessyTsui/Claude-Code-Remote</a>
</p></li>
<li><p>
claude-code-templates: CLI tool for configuring and monitoring Claude Code
</p>

<p>
<a href="https://github.com/davila7/claude-code-templates">https://github.com/davila7/claude-code-templates</a>
</p></li>
<li><p>
charmbracelet/crush 是一个专为终端打造的 AI 编程助手，它能够在你最喜欢的命令行环境下，为你的开发工作提供智能支持。该项目以 Go 语言开发，主打轻量、高效和极简美学，结合了 Glamour 风格的界面表现。crush 能帮助你更高效地编写、理解和管理代码，让 AI 助手真正融入你的终端开发流程，提升工作体验和生产力。
</p>

<p>
<a href="https://github.com/charmbracelet/crush">https://github.com/charmbracelet/crush</a>
</p></li>
<li><p>
ccundo seamlessly integrates with Claude Code to provide granular undo functionality. It reads directly from Claude Code's session files to track file operations and allows you to selectively revert changes with full preview and cascading safety.
</p>

<p>
<a href="https://github.com/RonitSachdev/ccundo">https://github.com/RonitSachdev/ccundo</a>
</p></li>
<li><p>
claude-code-proxy: A proxy server that enables Claude Code to work with OpenAI-compatible API providers. Convert Claude API requests to OpenAI API calls, allowing you to use various LLM providers through the Claude Code CLI.
</p>

<p>
<a href="https://github.com/fuergaosi233/claude-code-proxy">https://github.com/fuergaosi233/claude-code-proxy</a>
</p></li>
<li><p>
claude-code-router: 可以将 Claude Code 里面的请求转发到其他你自定义的模型中，比如本地 Ollama 或者任何一个大模型的云服务。
</p>

<p>
<a href="https://github.com/musistudio/claude-code-router">https://github.com/musistudio/claude-code-router</a>
</p></li>
</ul>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-coding.html">Coding</a> </div>]]></description>
  <category><![CDATA[Coding]]></category>
  <link>https://www.vandee.art/blog/2025-06-30-vibe-coding-tips.html</link>
  <guid>https://www.vandee.art/blog/2025-06-30-vibe-coding-tips.html</guid>
  <pubDate>Mon, 30 Jun 2025 17:27:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[从有形到无形 - NoNotes，知识库自动补全]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgde03f7c">TL;DR</a></li>
<li><a href="#orgcf1ad01">知识的流动性</a></li>
<li><a href="#org9e54be0">自动补全 VS RAG</a></li>
<li><a href="#org1b2e579">NoNotes</a></li>
</ul>
</div>
</nav>
<div id="outline-container-orgde03f7c" class="outline-2">
<h2 id="orgde03f7c">TL;DR</h2>
<div class="outline-text-2" id="text-orgde03f7c">
<p>
NoNotes 的意思就是字面上的意思，没有笔记。NoNotes 提供一个接口，通过向量相似性检索，根据当前输入自动补全相关的笔记。
</p>

<p>
自动联想补全，回归知识、思考最自然的样子。
</p>
</div>
</div>
<div id="outline-container-orgcf1ad01" class="outline-2">
<h2 id="orgcf1ad01">知识的流动性</h2>
<div class="outline-text-2" id="text-orgcf1ad01">
<p>
在最开始，我设定 PKM（个人知识管理）系统的几个底层原则之一就是：知识一定要能够自然的流动起来。如果一个笔记，它不能和其他笔记通过自然的逻辑有机的联系起来，不能流动起来，时间久了它就会被遗忘，这种笔记是无效的。
</p>

<p>
举个例子，在生活里我们经常会遇到这种情况，一个常用物，有时候就是会不记得它被放在了哪里，突然就找不到了，它的下一次出现可能就得是搬家的时候了。
</p>

<p>
知识和笔记也是一样。正是因为它太常用了，以至于我们不会刻意的去记忆它在哪里，它已经成为了一种习惯。
</p>

<p>
我理想中的笔记载体形态应该想水一样，它的形态可以自由变化，可以很好的和其他事物兼容。它应该可以像水的固态、液态、气态一样，根据实际的情况变幻自己的状态。它应该也是一种习惯，不需要刻意的怎么样。
</p>

<p>
知识管理和学习是从无到有，现在我需要实现从有到无，PKM 最终要实现的是思维、能力的提升。做笔记的目的从来也不是做笔记，学习的目的也从来不是学习，正如巴菲特所说 <a href="https://wiki.vandee.art/#%E6%9C%80%E5%A5%BD%E7%9A%84%E6%8A%95%E8%B5%84%E6%B0%B8%E8%BF%9C%E6%98%AF%E4%BD%A0%E8%87%AA%E5%B7%B1">最好的投资永远是你自己</a> 。它是为了能够更好的和物质世界的信息交互，不断提升自己成长的效率，让自己在每一个选择的实践当中，提升最优决策实现的可能性。
</p>

<p>
做笔记和学习如果只是停留在笔记，那么它顶多只是一些对自己很有用的资料而已，创造不了太多价值。
</p>

<blockquote>
<p>
Steve Jobs on why thinking without doing is incomplete:
</p>

<p>
史蒂夫·乔布斯谈到为什么不行动的思考是不完整的：
</p>

<p>
“My observation is that the doers are the major thinkers. The people that really create the things that change this industry are both the thinker and doer in one person. And if we really go back and we examine, you know, did Leonardo have a guy off to the side that was thinking five years out in the future what he would paint or the technology he would use to paint it? Of course not. Leonardo was the artist, but he also mixed all his own paints. He also was a fairly good chemist. He knew about pigments, knew about human anatomy. And combining all of those skills together, the art and the science, the thinking and the doing, was what resulted in the exceptional result. And there is no difference in our industry. The people that have really made the contributions have been the thinkers and the doers.”
</p>

<p>
“我的观察是，行动者是主要的思想者。真正创造出改变这个行业的事物的人，既是思想者也是行动者。如果我们真的回过头来审视，你知道，达芬奇是否有一个人在旁边思考他五年后会画什么，或者他会使用什么技术来绘画？当然没有。达芬奇是艺术家，但他也自己调配所有的颜料。他也是一个相当不错的化学家。他了解颜料，了解人体解剖。将所有这些技能结合在一起，艺术与科学，思考与行动，才产生了卓越的结果。在我们的行业中没有区别。真正做出贡献的人是思想者和行动者。”
</p>
</blockquote>
</div>
</div>
<div id="outline-container-org9e54be0" class="outline-2">
<h2 id="org9e54be0">自动补全 VS RAG</h2>
<div class="outline-text-2" id="text-org9e54be0">
<p>
大语言模型的相关概念给了我一些启发，如果说 LLM 本身就是一个通过知识库联想输出最大可能性结果的系统，那么做笔记也可以是这样。再结合 LSP、IDE 的自动补全，NoNotes 的雏形逐渐清晰起来：根据知识库的内容，根据当前的输入自动补全最相关的内容。
</p>

<p>
NoNotes 想达到的实现和 RAG（Retrieval-Augmented Generation）最大的不同是，它的重点不在 generation，而是联想和检索。
</p>

<p>
RAG 已经很好的实现了 LLM 和外部数据交互的问题，MCP (Model Context Protocol) 也是一样，它们都是通过给 LLM 提供额外的数据接口来增加 LLM 的能力，让它能够更准确的生成内容。
</p>

<p>
我一直不太想过多的依赖一种工具来管理知识，即使 LLM 再强大，这点也不会变。Google 的 NotebookLM 已经做到了知识库形态很完整的实现，可以直接和大量的数据对话，类似的大小型知识库 RAG 项目也非常多非常成熟，但是这种层面的知识交互，并不能很好的实现我想把知识流动起来的根本原则。
</p>

<p>
它们的重点都是在生成，这也就意味着，很难通过这种和知识的交互直接返还我想查找到的原文内容（特定的 prompt 还是可以实现，但这又增加了学习和使用的成本）。而 NoNotes 通过检索自动补全的是我相关的笔记原文，这就可以在一定程度上保证，我的思考和学习是原汁原味的。再一个 RAG 的生成的速度是很难保证实时补全的。
</p>

<p>
我也不太想通过 LLM 的生成来管理、生成笔记，这样总感觉不是自己的，也很难在学习的过程里进入心流和深度思考。还是一个字一个字的敲，更自在。
</p>

<p>
自动补全可能是我现在能想到的，最简洁，最自然的实现流动知识的实现。未来能集成到输入法里也说不定呢。
</p>
</div>
</div>
<div id="outline-container-org1b2e579" class="outline-2">
<h2 id="org1b2e579">NoNotes</h2>
<div class="outline-text-2" id="text-org1b2e579">
<p>
无论 LLM 技术怎么迭代，最核心的还是数据，没有输入，LLM 就没有输出。NoNotes 只想提供一个数据接口，技术栈也非常简单，数据库，向量相似性检索，embedding 嵌入。把知识库的文档分块，向量化储存在数据库就完事了。
</p>

<p>
难点在数据的处理和联想的算法，这部分我还在学习。
</p>

<p>
源码就不放出来了，因为整个实现还只是雏形，而且也很好实现，可以选择的框架和编程语言也很多。
</p>

<p>
NoNotes 现在支持 CLI 导入单个文件、单个句子、文件夹，暂时只能处理 Markdown、PDF、txt 文本。
</p>


<figure id="org5d6eeb9">
<img src="https://pic.vandee.art/images/nonotes-cli.gif" class="img" width="50%" height="50%">

</figure>

<p>
现在做了两个 API，一个是向量相似性检索的，一个是 RAG 的。效果如下：
</p>


<figure id="orgb09383e">
<img src="https://pic.vandee.art/images/nonotes.gif" class="img" width="50%" height="50%">

</figure>

<p>
目前只实现了在 Emacs 里的自动补全，我补全用的是 corfu。
</p>

<p>
现在已经在数据库里导入了很多知识库里的笔记，搞了几个表，memory，knowledge。memory 就相当于备忘录了,现在可以自动补全最近干了什么了。
</p>

<p>
我觉得面对 LLM 和以后 AI 技术的发展，把非结构化数据向量化，是一个很好的实践，提供一个属于自己的可用的知识接口。
</p>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-emacs.html">Emacs</a> <a href="https://www.vandee.art/blog/tag-pkm.html">PKM</a> <a href="https://www.vandee.art/blog/tag-ramble.html">Ramble</a> </div>]]></description>
  <category><![CDATA[Emacs]]></category>
  <category><![CDATA[PKM]]></category>
  <category><![CDATA[Ramble]]></category>
  <link>https://www.vandee.art/blog/2025-06-10-nonotes-auto-completion.html</link>
  <guid>https://www.vandee.art/blog/2025-06-10-nonotes-auto-completion.html</guid>
  <pubDate>Tue, 10 Jun 2025 10:25:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[AI 驱使下的信息向量化]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org7a42d03">从检索到生成</a></li>
<li><a href="#orga32d088">RSS 订阅</a></li>
<li><a href="#orgcdf1a5d">数据向量化</a></li>
<li><a href="#orgca2a4db">小结</a></li>
</ul>
</div>
</nav>
<p>
前两天的 <a href="https://io.google/2025/">Google I/O</a> 有点炸裂，Google 这是掀桌子了，一下子放出了基于 Gemini 的整个生态的布局。这个网站整理了主要内容：<a href="https://google-io-2025.kcores.com/">https://google-io-2025.kcores.com/</a>。
</p>

<p>
可以感觉到 Google 的战略和 OpenAI 是完全不一样的。基于 Google 庞大的生态应用，Google 正在逐步用 AI 接管这些，这次的 Google I／O 把蓝图完整的呈现了。
</p>

<p>
从这次的 Google I／O 结合最近在看的 <a href="https://book.douban.com/subject/35440637/">互联网口述历史第1辑·英雄创世记</a> ，AI 对互联网内容和信息将带来的变革是颠覆性的。
</p>
<div id="outline-container-org7a42d03" class="outline-2">
<h2 id="org7a42d03">从检索到生成</h2>
<div class="outline-text-2" id="text-org7a42d03">
<p>
传统互联网上的搜索正在逐步从检索转变为生成。
</p>

<p>
作为长期处于传统搜索垄断地位的 Google，已经正式接入 AI 搜索了。这意味着以后的搜索可能就会变成今天的百度了。
</p>

<p>
互联网从诞生到现在积累了这么多年的信息和内容，可能真的马上要画上句号了。信息的价值只在它能够被检索到的时候才真正存在，再好的内容，不能被检索到，在互联网里它就相当于不存在了。
</p>

<p>
算法、流量这些现象同样也会慢慢发生在 AI 搜索。为了能够更好的让 AI 检索到，本来就越来越少的优质信息创作内容会更少。全自动 AI 生成，或半自动 AI 生成的信息一定会越来越多，传统的 SEO 也一定会向 AI 算法倾斜。
</p>

<p>
从内容到检索全部都被 AI 接管之后，不就变成百度了。
</p>

<p>
由于大语言模型本身的特性，不同于传统搜索引擎的关键字检索，如果不能在 prompt 里准确的描述出想搜索的内容，它一定会大话连篇的生成一大堆不太相关的东西。
</p>

<p>
从检索到生成，这就是我从 Google I/O 里感受最大的一点。以后在互联网上的搜索会逐步被 LLM 的生成所替代。
</p>

<p>
十年之后，各种 deep search 可能就真的替代现在的传统搜索了。
</p>

<p>
互联网上的信息正在逐步被向量化（embedded），从有血有肉的内容变成一个个 token。
</p>
</div>
</div>
<div id="outline-container-orga32d088" class="outline-2">
<h2 id="orga32d088">RSS 订阅</h2>
<div class="outline-text-2" id="text-orga32d088">
<p>
<a href="https://github.com/glidea/zenfeed/">https://github.com/glidea/zenfeed/</a> ,最近看到的这个 GitHub 项目解决了我的大问题。它直接把 RSS 源内容的向量化，而不是像我之前用完整的 RSS 内容做 RAG。
</p>

<p>
在原项目的基础上，根据我自己的需求改了一下 <a href="https://github.com/vandeefeng/zenfeed/">https://github.com/vandeefeng/zenfeed/</a> ，现在用的相当舒服。现在可以直接用自然语言检索每天新闻里我感兴趣的内容了。
</p>

<p>
RSS 是我面对算法、信息茧房等问题坚持下来的信息获取习惯。从人出发，到信息，是我觉得面对现在 AI 技术带来的信息困境比较好的路径。这几年的 RSS 订阅，从 blog（点）穿起了这些 blog 的人（线），再到现在的他们辐射出的领域（面），积累了许多我觉得还算高质量的信息源。
</p>

<p>
算法、流量决定着我们现在能看到的大部分信息流，如果以后搜索真的也被 AI 全面接管了，检索也不行了，就只能从感兴趣的人出发了。
</p>

<p>
之前 <a href="https://www.vandee.art/2024-11-10-database-of-flowing-knowledge.html">数据库的搭建 - 流动知识检索</a> 现在可以在这个项目的基础上继续发展了。这就是我以后的新闻信息检索入口。
</p>

<p>
从各大模型厂商推出 deep search 到现在，我也还是不想深入使用。数据源的质量自己不能控制，再怎么 deep 也不会是我想要的信息。当然，prompt 设计的好，还是可以筛选出很多高质量内容的。用多了就感觉有点厌烦了，直接 Google 一下反而神清气爽。
</p>

<p>
现在 deep search 一下，再用几个流行的 prompt 生成卡片网页、播客、甚至短视频，再发布到小红书、抖音、B 站、公众号等社交平台，整个工作流成本很低，也很容易复刻，也就导致大量的AI 生成的同质化内容。它们的质量参差不齐，我也实在不想浪费时间在这些信息上面。很多这些信息，啪啪啪一大堆，看起来也很美观，很有逻辑，但大多看完之后就像没看一样，数据的真实性就更不能保证了。
</p>

<p>
<a href="https://wiki.vandee.art/#%E6%99%BA%E5%8A%9B%E8%82%A5%E8%83%96%E5%8D%B1%E6%9C%BA">信息肥胖</a>、信息健康这个概念很早就有了，只不过我感觉重视的人不太多。
</p>
</div>
</div>
<div id="outline-container-orgcdf1a5d" class="outline-2">
<h2 id="orgcdf1a5d">数据向量化</h2>
<div class="outline-text-2" id="text-orgcdf1a5d">
<p>
虽然 AI 技术带来的很多变化我都不喜欢，但再不情愿也没用。拒绝 AI 的这次技术浪潮在将来会带来的变革，就好像在说我今天就是不用互联网。当更多的基础设施和服务都像 Google 这次接入 AI 之后，就算不直接使用也会间接使用到。
</p>

<p>
既然信息和数据在未来只有被向量化才能发挥更大的价值，那就先做好准备吧。
</p>

<p>
从我开始折腾 PKMS（个人知识管理）开始，就有这方面的考虑了。
</p>

<p>
数据始终是最核心的。再好的模型，没有优质的数据输入，也是白搭。
</p>

<p>
计划陆续要把 PKM 数据库里的内容全部向量化。大量数据的向量化优化，最近还在学习。
</p>
</div>
</div>
<div id="outline-container-orgca2a4db" class="outline-2">
<h2 id="orgca2a4db">小结</h2>
<div class="outline-text-2" id="text-orgca2a4db">
<p>
未来的互联网正在逐步变成一个个 token，GitHub 已经被 <a href="https://deepwiki.com/">DeepWiki</a> 变成 token 了，其他的还会远么？
</p>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-ramble.html">Ramble</a> </div>]]></description>
  <category><![CDATA[Ramble]]></category>
  <link>https://www.vandee.art/blog/2025-05-23-information-vectorization.html</link>
  <guid>https://www.vandee.art/blog/2025-05-23-information-vectorization.html</guid>
  <pubDate>Fri, 23 May 2025 19:51:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[Prompt: Another Key to the Compressed World]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgc49320e">Intro</a></li>
<li><a href="#org2872c56">Keyword 关键字</a></li>
<li><a href="#org45cbd86">小结</a></li>
</ul>
</div>
</nav>
<div id="outline-container-orgc49320e" class="outline-2">
<h2 id="orgc49320e">Intro</h2>
<div class="outline-text-2" id="text-orgc49320e">
<blockquote>
<p>
未来能第一个说出来这些「Magic Words」的人，就率先打开了一个新的参数空间。
</p>

<p>
via: <a href="https://x.com/lijigang_com/status/1921103439813283862">https://x.com/lijigang_com/status/1921103439813283862</a>
</p>
</blockquote>

<p>
如果说在互联网时代，能够打开浏览器，在搜索框里进行搜索已经是一个必备的技能，那么 AI 时代，会用 prompt 获取到自己需要的内容也是一样。
</p>

<p>
LLM 迭代很快，但不管技术怎么迭代，prompt 作为输入的窗口是不会消失的。
</p>

<p>
对于普通人来说，我觉得 prompt 是最直接，也最容易上手的了。
</p>

<p>
Prompt <a href="https://zh.wikipedia.org/wiki/%E6%8F%90%E7%A4%BA%E5%B7%A5%E7%A8%8B">提示工程</a> ,简单来说就是我们和 LLM 交互的时候输入的 input，LLM 的回答就是 output。
</p>

<p>
LLM 是一个概率计算器，它需要通过输入来计算出可能性最大的输出。对不同模型的底层原理越是了解，就越能通过 prompt 发挥出模型的效果。但对于普通人来说，这个学习成本太大了。
</p>

<p>
而且随着 LLM 的迭代，大模型的能力会越来越强，它对于自然语言的理解会更好，prompt 也可以写的越来越简洁，不必须非要掌握那些特定的格式和技巧。
</p>

<p>
Chain of Thought (CoT) (思维链提示)，Tree of Thoughts (ToT) (思维树提示)，ReAct (Reason &amp; Act) (推理与行动提示)等等这些在推理模型出现之后，都不是那么必须了。现在 Role prompting (角色提示) 是我用的最多，效果最好的，也最简单。如果不是特定需求下，prompt 写的太复杂，反而会影响 LLM 的输出。
</p>

<p>
因此，我觉得未来 prompt 的重心会随着 LLM 能力的提升进一步向思维和表达偏移。
</p>
</div>
</div>
<div id="outline-container-org2872c56" class="outline-2">
<h2 id="org2872c56">Keyword 关键字</h2>
<div class="outline-text-2" id="text-org2872c56">
<p>
AI 善于回答问题，但不善于提出问题。如何提出更好的问题，才使用 AI 工具的关键。
</p>

<p>
拿李继刚的这个 prompt 举例：
</p>

<blockquote>
<p>

</p>

<p>
P(x,t) | W(x) ^ L(x)
</p>

<ul class="org-ul">
<li>W(x): 这个世界是「网状」的，要观察 x 事件，是否陷入了单点思考或线性思考，有没有考虑周边关联结点的影响</li>

<li>L(x): 这个世界是「立体」的，要观察 x 事件，当前的描述是在哪个层次上，再上一层（更抽象）是什么，再下一层（更具体）是什么？</li>

<li>P(x): 这个世界是「概率」的，量子世界的测不准原理一直存在着，x 事件成立的概率是多少？对言之凿凿要抱有极大的警惕心，量子不同意。</li>

<li>P(t): 这个世界是「动态」的。x 事件的描述，过去成立，现在还成立吗？未来还成立吗？充分条件发生变化了吗？这个世界一直在变，x 事件为什么会不变？</li>
</ul>

<p>
vai: <a href="https://x.com/lijigang_com/status/1923407635245854964">https://x.com/lijigang_com/status/1923407635245854964</a>
</p>
</blockquote>


<p>
LLM 就是一个概率计算器，我一直以来的用法也就是：让 LLM 放大我的思维。
</p>

<p>
当我们在思考过程中那个小灯泡亮起来的时候，也就是大脑的神经突触连接了，LLM 的底层原理也是模拟大脑。
</p>

<p>
当我在想一系列的概念、问题的时候，LLM 可以帮助我快速的计算出各种概率，找到它们直接的联系，发散，增加我的想象力。
</p>

<p>
这意味着我不再需要在我的记忆里储存那些大量的信息，只需要建立目录和索引，LLM 会帮助我通过这些索引找到它们之间的联系。当然前提是需要对这些概念有理解，也需要自己甄别 LLM 的幻觉。
</p>

<p>
这也是近两年我一直在做的事情，把信息、知识压缩成一系列的关键字和索引。各种 PKM 就是我想接入 LLM 的数据。
</p>

<p>
LLM 是数据的压缩，它就是一个巨大的 ZIP，prompt 就是解压的钥匙了。
</p>

<p>
在一个模型的基础上根据自己的数据和语料训练出一个自己的大语言模型，我觉得在未来会像每个人有电脑一样普遍。每个人都会有自己的去中心化知识库。
</p>

<p>
我最近在折腾树莓派，闲鱼上一个也就 500。接入我的 PKM 数据库，连上 LLM，一个简易的个人小助手 JARVIS 就搞定了。视觉识别，语音对话都很好实现。
</p>
</div>
</div>
<div id="outline-container-org45cbd86" class="outline-2">
<h2 id="org45cbd86">小结</h2>
<div class="outline-text-2" id="text-org45cbd86">
<p>
每一次新的技术出现一定会让我们变懒，这也是技术的初衷，让生活变得便利。
</p>

<p>
变懒可以，但变笨不行。
</p>

<p>
LLM 只是一个工具，指望它能让自己干出什么原本就不可能的事情是不现实的，它能做的只是在原有的基础上放大这个概率。
</p>

<p>
当这些概率都发生变化的时候，或许就会有神奇的事情发生呢？
</p>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-ramble.html">Ramble</a> </div>]]></description>
  <category><![CDATA[Ramble]]></category>
  <link>https://www.vandee.art/blog/2025-05-17-prompt-another-key-to-the-compressed-world.html</link>
  <guid>https://www.vandee.art/blog/2025-05-17-prompt-another-key-to-the-compressed-world.html</guid>
  <pubDate>Sat, 17 May 2025 11:28:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[The Real Way to Engage with AI Agent]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org4aa0a34">Intro</a></li>
<li><a href="#org10d607b">Emacs</a></li>
<li><a href="#orga8d45bc">Nvim</a></li>
<li><a href="#org5bee759">小结</a></li>
</ul>
</div>
</nav>
<div id="outline-container-org4aa0a34" class="outline-2">
<h2 id="org4aa0a34">Intro</h2>
<div class="outline-text-2" id="text-org4aa0a34">
<p>
OpenAI 最近计划花 30 亿美元<a href="https://www.bloomberg.com/news/articles/2025-04-16/openai-said-to-be-in-talks-to-buy-windsurf-for-about-3-billion">收购 windsurf</a> ，字节也在今年终于发布了 <a href="https://www.trae.ai/">Trae</a> ，这两个都是和 <a href="https://www.cursor.com">Cursor</a> 一样的 AI IDE（集成开发环境Integrated Development Environment）。也是今年模型即产品开始这个概念开始推行，Google 和 OpenAI 从年初到现在陆续放出了很多新的模型。但大模型这玩意太烧钱了，通过推出新模型已经调动不起消费者的热情了，IDE 成了新的赛道。
</p>

<p>
OpenAI 的这个 30 亿的收购最起码证明了 AI IDE 的重要性。如果说各种 chat app 是定位普通用户的简单易用的产品，那么 IDE 就是面向开发者的产品。开发者才是使用 API 的大头，那么多模型的 API，怎么让开发者更愿意用自己的呢，最直接的思路就是和 IDE 绑定了吧，就像 Cursor 从推出就默认使用 Claude 一样。
</p>

<p>
那么，对于普通用户和开发者之间的群体呢，比如说我，就是想更深入的玩玩，IDE 也是一个很好的入口。
</p>

<p>
Cursor 让 <a href="https://en.wikipedia.org/wiki/Vibe_coding">vibe coding</a> 这个概念流行起来，这个概念又推动了 IDE 的竞争和发展。在以前 IDE 就是给开发者写代码用的，但是现在有了大语言模型，IDE 可以直接和 LLM 交互，再加上 RAG、MCP，IDE 其实就是一个 “agent” 的操作台了，也就是 agent 的 agent。通过 <a href="https://modelcontextprotocol.io/introduction">MCP</a>(Model Context Protocol) ，IDE 的功能被无限放大。我虽然一直不喜欢 MCP，但它确实又推动了 AI 行业。
</p>

<p>
现在有很多 AI 套壳产品，比较流行的有 <a href="https://chatwise.app/">ChatWise</a> , <a href="https://cherry-ai.com/">Cherry Studio</a> ，<a href="https://refly.ai/">Refly</a> ，但我还是更喜欢 Emacs 和 Nvim。我一直不太喜欢用过渡态的产品，两头都顾不上。它们也没有提供多少可以进一步提升我效率的功能。
</p>

<p>
AI 迭代的太快了，后面还会出现更多未完成的中间态概念，少数完全由这些概念堆砌起来的热度产品除了会浪费金钱，更主要的是会浪费时间。
</p>

<p>
现在推出的很多 agent 概念产品，我认为都还在过渡期。不如直接上手 Emacs 和 Nvim，它们是可以更直接触及底层的 IDE，也是开始接触 agent 更合适的入口。
</p>
</div>
</div>
<div id="outline-container-org10d607b" class="outline-2">
<h2 id="org10d607b">Emacs</h2>
<div class="outline-text-2" id="text-org10d607b">
<p>
我现在日常用的比较多的就是：<a href="https://github.com/MatthewZMD/aidermacs">aidermacs</a> , <a href="https://github.com/karthink/gptel">gptel</a> , <a href="https://github.com/milanglacier/minuet-ai.el">minuet-ai.el</a> 。
</p>

<p>
它们基本覆盖了我 90% 的使用需求了。代码补全，项目架构分析，片段问答，都和 Emacs 结合的很舒服。
</p>

<p>
具体的使用情况在之前的博客里有，就不重复了。
</p>


<figure id="org7d43945">
<img src="https://testingcf.jsdelivr.net/gh/vandeefeng/gitbox@main/img/llmchat.gif" class="img" width="50%" height="50%">

</figure>
</div>
</div>
<div id="outline-container-orga8d45bc" class="outline-2">
<h2 id="orga8d45bc">Nvim</h2>
<div class="outline-text-2" id="text-orga8d45bc">
<p>
<a href="https://github.com/yetone/avante.nvim/">yetone/avante.nvim</a> 是一个 Nvim 插件，可以在 Nvim 里获得类似 cursor 的体验。
</p>


<figure id="orgedb11a1">
<img src="https://pic.vandee.art/images/nvim.gif" class="img" width="50%" height="50%">

</figure>


<figure id="org36d9f0d">
<img src="https://pic.vandee.art/images/nvim-code.gif" class="img" width="50%" height="50%">

</figure>
</div>
</div>
<div id="outline-container-org5bee759" class="outline-2">
<h2 id="org5bee759">小结</h2>
<div class="outline-text-2" id="text-org5bee759">
<p>
我的体验下来，极致的 vibe coding 首选还是 cursor。其他同类产品替代不了 cursor 的还是它的 tab 补全和模型调教。它的 tab 就真的像有读心术一样，很准确的知道我下一步想做什么。当然还有它的各种免费破解（支持正版！）
</p>

<p>
AI 套壳产品里的功能，在 IDE 里 90% 都可以实现。如果只把 IDE 当作 IDE，那也太看不起 OpenAI 的 30 亿了。
</p>

<p>
未来学家托夫勒的《未来的冲击》里提出了一个观点：人类社会将变快。我们生活的根本特征，不再是持久，<a href="https://www.ruanyifeng.com/blog/2025/04/weekly-issue-346.html">而是短暂</a>。
</p>

<p>
vibe coding 是趋势，我们以后会用上越来越多品质不那么高，甚至是一次性的即抛产品，但我觉得品质反而会更成为核心的竞争力。
</p>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-ramble.html">Ramble</a> </div>]]></description>
  <category><![CDATA[Ramble]]></category>
  <link>https://www.vandee.art/blog/2025-04-26-the-real-way-to-engage-with-ai-agent.html</link>
  <guid>https://www.vandee.art/blog/2025-04-26-the-real-way-to-engage-with-ai-agent.html</guid>
  <pubDate>Sat, 26 Apr 2025 11:59:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[The Passing Future]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgbcc8f85">AI 举着喇叭</a></li>
<li><a href="#org0a2d78d">The Passing Future</a></li>
<li><a href="#org42261a4">2025-04-20 added</a></li>
</ul>
</div>
</nav>
<p>
最近博客更新的频次少了不少，原因之一是部分不成文的思考记录在了 <a href="https://x404.xyz/memo">GitMemo</a> 。
</p>

<p>
更深层次的原因我自认为是：上个阶段我需要深度思考的问题已经解决的七七八八了，现在处在过渡到下个阶段的过渡期。
</p>

<p>
佐证就是这些记录本身：
</p>


<figure id="org41089ed">
<img src="https://pic.vandee.art/images/task.png" class="img" width="50%" height="50%">

</figure>

<p>
现在每周 AI 都会自动根据我记录的这些思考帮我提出几个需要接着深入思考的问题，这些良性的多巴胺就像一根根柴火，让我思考的大脑一直烧的旺旺的。
</p>
<div id="outline-container-orgbcc8f85" class="outline-2">
<h2 id="orgbcc8f85">AI 举着喇叭</h2>
<div class="outline-text-2" id="text-orgbcc8f85">
<p>
一个事物价值的大小，受到系统识别的影响。许多很好的事物，由于我没有相关的识别，它们对我来说就不会那么重要。
</p>

<p>
现在的 AI 就像互联网刚开始萌芽的时候，它已经不算是悄无声息地在改变我们的生活了，甚至是举着喇叭了，但是仍然会有许多群体没有相关的识别。
</p>

<p>
我不是一个 AI 的布道者，也没有相关的利益，也从来不想写 AI 怎么怎么好之类的东西。只是记录记录它带来的变化，记录记录它本身，之前的博客里也已经记录了不少。
</p>

<p>
香菜有多好吃，吃了就自然会知道，喜欢吃的爱的不得了，不喜欢的碰也不会碰。但是，当所有的菜里都放香菜的时候，就是另外一回事了。
</p>

<p>
说人话就是：AI 是未来一定会写进课本的东西。
</p>
</div>
</div>
<div id="outline-container-org0a2d78d" class="outline-2">
<h2 id="org0a2d78d">The Passing Future</h2>
<div class="outline-text-2" id="text-org0a2d78d">
<p>
这两年我一直在做各种记录，PKM 是对知识的记录，摄影是对感受的记录，博客是对思考的记录。
</p>

<p>
对我这些决策影响比较大的是 <a href="https://wiki.vandee.art/#%E3%80%8A%E6%97%B6%E9%97%B4%E7%9A%84%E7%A7%A9%E5%BA%8F%E3%80%8B">卡洛• 罗韦利的《时间的秩序》</a> ，过去、现在、未来对我来说是一个范畴的事。
</p>

<p>
这些记录，一部分是给过去的，一部分是给未来的。
</p>

<p>
凯文凯利在一个<a href="https://wiki.vandee.art/#%E7%9C%8B%E8%A7%812033%20%E7%AC%AC%E5%8D%81%E4%B8%80%E6%9C%9F%EF%BD%9C%E5%86%AF%E5%A4%A7%E5%88%9A%C3%97%E5%87%AF%E6%96%87%C2%B7%E5%87%AF%E5%88%A9">访谈</a>里谈到：思考未来最难的事情正是理解现在，而更关键的问题是什么是现在。
</p>

<p>
“现在”或者说“当下”，在我这里就是 The Passing Future。
</p>

<p>
我一直在想象，如果真的可以超越光速，到达时间的维度，应该怎么看待现在的物质世界。
</p>

<p>
因此我正在着手创造一个不会被现在的时间度量所限制的东西，它可以承载巨量信息，可以具象化思维，可以根据环境做出适应性的变化，它既不实际存在又无处不在，其他的现在还不能剧透。
</p>

<p>
在人工智能技术的帮助下，我觉得它一定是可以实现的。
</p>

<p>
随手拿起一张黑胶，指尖触碰唱片的封套，细细摩挲封面上岁月的痕迹。泛黄的边角，褪色的色彩，都是时间无声无息留下的讯息。唱针缓缓落下，与唱片纹路触碰，那些细微的、带着时光颗粒感的 “嘶嘶” 声，就像是一个时光隧道，一下子把我拉回到相隔的世纪。
</p>

<p>
无数这些相似时刻，都是永恒的缩影，是我们可以用心感受到的超越光速的时间旅行，就是我们的 The Passing Future。
</p>
</div>
</div>
<div id="outline-container-org42261a4" class="outline-2">
<h2 id="org42261a4">2025-04-20 added</h2>
<div class="outline-text-2" id="text-org42261a4">
<p>
几天之后看到这个：<a href="https://mp.weixin.qq.com/s/i5FFQTWbcp7zCMf8EUTUzQ">分享一个对我帮助很大的思维方式</a>
</p>

<blockquote>
<p>
同样，我现在的每一个思考和行动，又在塑造着未来的自己。那么，当未来的我回顾过去，是会感谢今天的自己，还是会后悔？
</p>

<p>
这是一种十分有趣的视角。
</p>

<p>
你会发现，把时间拉长，你看待许多事物的眼光会全然不同。你不再拘泥于它在当下会如何，而是能够跨越更宽广的生命长度去看待它，思考它会对你在将来带来什么、造成什么影响。
</p>

<p>
这也就是我今天想跟你分享的思维方式：把「过去的我」和「未来的我」联系起来，从整个生命长度去看待问题，而不是孤立的当下。
</p>
</blockquote>

<p>
李睿秋 Lachel 是我很喜欢的一个作者，我的许多思维方向和习惯都和他很相似。
</p>

<p>
这已经是好几次了，偶然发现我们在差不多的时间段里思考者这些相似的问题。
</p>

<p>
这也算是一种没有时间、空间限制的交流吧，等我们互相看到对方的文字的时候。
</p>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-ramble.html">Ramble</a> </div>]]></description>
  <category><![CDATA[Ramble]]></category>
  <link>https://www.vandee.art/blog/2025-04-14-the-passing-future.html</link>
  <guid>https://www.vandee.art/blog/2025-04-14-the-passing-future.html</guid>
  <pubDate>Mon, 14 Apr 2025 10:41:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[或许可以这样看待大语言模型]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org8eaef3d">大语言模型是什么</a></li>
<li><a href="#org956bd8d">或许可以这样看待大语言模型</a>
<ul>
<li><a href="#org6a8df7b">知识库 ZIP</a></li>
<li><a href="#org1ecdb37">自然语言编程</a></li>
</ul>
</li>
<li><a href="#orgbcdc694">小结</a></li>
</ul>
</div>
</nav>
<p>
最近被 DeepSeek 刷屏了，我其实是有点烦的。这种过度的宣传，不可避免的会蒙蔽少部分看热闹的人，但这就是热度本身。
</p>

<p>
本来是不太想写今天的内容的，但想着或许我这两年自学 AI 的经验可以帮助到哪些和我开始一样对 AI 感兴趣的人。正是因为我是一个 AI 行业的局外人，所以才能有不一样的视角。前几天的 <a href="https://www.vandee.art/2025-02-03-emacs-is-all-you-need.html">Emacs is all you need</a> ，也完全是因为看到咸鱼上有人在炒作 DeepSeek 才写的。今天的也是类似，或许可以分享一些真正有用的东西。
</p>

<p>
我没有 AI 方面的专业背景，因此也不会涉及到专业的术语，只是一些学习的路径和思路，仅供参考。如果这些内容帮助到了你，我会很开心。
</p>
<div id="outline-container-org8eaef3d" class="outline-2">
<h2 id="org8eaef3d">大语言模型是什么</h2>
<div class="outline-text-2" id="text-org8eaef3d">
<p>
看完 Andrej Karpathy 大佬的这两个视频：
</p>

<p>
<a href="https://www.youtube.com/watch?v=zjkBMFhNj_g&amp;t=1218s">{1hr Talk} Intro to Large Language Models - YouTube</a> , <a href="https://www.youtube.com/watch?v=7xTGNNLPyMI&amp;t=7959s">Deep Dive into LLMs like ChatGPT - YouTube</a>
</p>

<p>
基本上就对大语言模型 LLM 有了宏观上的概念了。
</p>

<p>
Transformer Neural Net 3D visualizer: <a href="https://bbycroft.net/llm">https://bbycroft.net/llm</a> ,这个网站用 3D 模型详细的展示了 transformer 架构的原理和过程。
</p>

<p>
用 AK 大佬的话来说，LLM 就是一个巨大的 ZIP，它汇聚了特定时间点互联网上海量的相对优质的知识和资源。这来源于在 pre-training 预训练过程中的数据集。之后的 post-training 不会改变 LLM 的基础知识（RAG 算是额外知识）。
</p>

<p>
本质上，LLM 就是在特定数据集的基础上，通过 transformer 架构神经网络来通过输入预测下一个词（现阶段流行的的大语言模型基本是基于 transformer 架构）。至于 transformer 架构是什么，可以简单理解为一个编码器和一个解码器。所有输入 LLM 的内容，最终会被 LLM 理解为一个个的 token, <a href="https://tiktokenizer.vercel.app/">https://tiktokenizer.vercel.app/</a> 这个网站可以详细的看到输入的内容对于 LLM 来说是什么。
</p>

<p>
简单来说就是，一个个的 token 组成 sequence ，LLM 根据输入的内容，预测最可能的输出。平常计费的时候，消耗了多少多少 token ,也就是它。这就是发生在 LLM 对话框后面的简单过程。
</p>

<p>
上面的概念都来自与 AK 的视频，不是我自己的理解。
</p>

<p>
当然 LLM 背后的技术肯定比上面说的复杂，但实现的逻辑其实没那么难理解。
</p>

<p>
更多的关于 LLM 的基础知识，在 GitHub 上随便搜搜就有大量的合集。
</p>

<p>
推荐几个：
</p>
<ul class="org-ul">
<li><a href="https://zhuanlan.zhihu.com/p/338817680">Transformer模型图解-知乎</a>，这篇文章很通俗详细的介绍了，transormer架构的原理。</li>
<li>3Blue1Brown 讲解 LLM 原理的视频，很优秀： <a href="https://www.bilibili.com/video/BV1TZ421j7Ke">【官方双语】直观解释注意力机制，Transformer的核心</a> , <a href="https://www.bilibili.com/video/BV13z421U7cs/">【官方双语】GPT是什么？直观解释Transformer</a> ， <a href="https://www.bilibili.com/video/BV1xmA2eMEFF/">【官方双语】大语言模型的简要解释</a> ，<a href="https://www.youtube.com/watch?v=9-Jl0dxWQs8">How might LLMs store facts | Chapter 7, Deep Learning - YouTube</a></li>
<li>李沐深度学习经典、新论文逐段精读 ：<a href="https://github.com/mli/paper-reading">https://github.com/mli/paper-reading</a></li>
<li><a href="https://llmbook-zh.github.io/">大语言模型 | LLMBook-zh</a></li>
<li><a href="https://github.com/HandsOnLLM/Hands-On-Large-Language-Models">Hands-On-Large-Language-Models</a></li>
<li><a href="https://github.com/rasbt/LLMs-from-scratch">GitHub - rasbt/LLMs-from-scratch</a></li>
<li><p>
这是一个简单的技术科普教程项目，主要聚焦于解释一些有趣的，前沿的技术概念和原理。每篇文章都力求在 5 分钟内阅读完成。
</p>

<p>
<a href="https://github.com/karminski/one-small-step">https://github.com/karminski/one-small-step</a>
</p></li>
</ul>
</div>
</div>
<div id="outline-container-org956bd8d" class="outline-2">
<h2 id="org956bd8d">或许可以这样看待大语言模型</h2>
<div class="outline-text-2" id="text-org956bd8d">
<p>
这部分是我自己的理解，仅仅仅供参考。
</p>
</div>
<div id="outline-container-org6a8df7b" class="outline-3">
<h3 id="org6a8df7b">知识库 ZIP</h3>
<div class="outline-text-3" id="text-org6a8df7b">
<p>
我一直是这么看待大语言模型的，它就是一个巨大的知识库，通过特定的 prompt，就可以拟人化的和这个知识库互动。
</p>

<p>
因此抛开 LLM 背后复杂的实现，在实际应用上，完全可以把它当作是自己的一个朋友、老师、私人助手。
</p>

<p>
我们不必再去搜索许多专业的知识，因为在预训练的时候，LLM 这个 ZIP 里已经记录了，在预测的时候，它会优先从“记忆” 中回答，这也是容易产生幻觉的原因。当 LLM 在回答自己知识库之外的问题时，因为是预测的最可能的回答，它就会开始胡编乱造，也就是 hallucination。
</p>

<p>
针对知识库之外的回答，现在的 LLM 基于 Agent，可以调用 tool 来实现联网的搜索，让回答更加准确。还有 RAG（Retrieval-Augmented Generation 检索增强生成）来 embed（嵌入）特定的文档和知识库。
</p>

<p>
因此，在学习方面应用 LLM 就变成了，用特定的语句（prompt），去检索 LLM 的知识库，用特定的方式和这个朋友来互动。也难怪 OpenAI 会下那么大的力气在 AI 教育上，有了这个知识库，某种程度上，就有了一个 24 小时在线的老师。
</p>

<p>
这和看书其实没太大差别，只是从用手去翻书变成了用 prompt 检索问答。
</p>
</div>
</div>
<div id="outline-container-org1ecdb37" class="outline-3">
<h3 id="org1ecdb37">自然语言编程</h3>
<div class="outline-text-3" id="text-org1ecdb37">
<p>
要说 LLM 在最开始对那个行业的冲击最大，那一定是程序员。简单来说，现在不必要必须掌握编程语言，在 LLM 的帮助下，就可以用自然语言进行编程。
</p>

<p>
因此，我也一直把 LLM 看作是一个新的编程语言。
</p>

<p>
对于普通人来说，编程可以解决什么问题呢？
</p>

<p>
如果说,编程的本质是将人类解决问题的思维（算法）转化为计算机可以执行的指令,赋予机器理解并执行复杂任务的能力,那么，LLM 极大的降低了这个过程的门槛。
</p>

<p>
我们现在的生活已经离不开互联网，更加离不开依附在互联网上的各种软件和服务，而这些都离不开计算机编程。
</p>

<p>
在 iPhone 上通过快捷指令截图识别内容、四象限日程提醒、新闻聚合筛选自己感兴趣的内容等等这些自定义的功能，在 LLM 的帮助下，普通人一个星期就可以开发出一个简单的 MVP( Minimum Viable Product 最小可行产品 ) 了。对于没有编程经验的人来说，LLM 大大降低了 MVP 开发的技术门槛和时间成本。
</p>

<p>
简单说就是，原本需要付费才能有的服务，现在自己动动手就可以平替了。
</p>
</div>
</div>
</div>
<div id="outline-container-orgbcdc694" class="outline-2">
<h2 id="orgbcdc694">小结</h2>
<div class="outline-text-2" id="text-orgbcdc694">
<p>
LLM 拓宽了想象力的边界，这是我对 LLM 最简单的理解。
</p>

<p>
纵观人类历史的推动和发展，最离不开的就是想象力：从哥白尼的日心说，到爱因斯坦的相对论；从莱特兄弟的飞机到 spaceX；从图灵的图灵机，再到现在的大语言模型。
</p>

<p>
是人类的想象能力让我们点燃了第一个知识的火把，在大自然严酷的生存法则里进化生存了下来，也是想象让我们不断走出柏拉图之穴探求知识和真理，也是想象让我们在苦难和痛苦中保持着乐观和希望。正是想象，让人类能够创造出属于我们自己的历史，把一个个幻想变成现实。
</p>

<p>
LLM 是技术和工具, 决定上限的，始终是我们自身的思维能力。就像武林高手，即使手持柳枝也能削铁如泥。
</p>

<p>
Imagine and creating！对我来说，这是世界上最好玩的事情了。
</p>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-llm.html">LLM</a> <a href="https://www.vandee.art/blog/tag-ramble.html">Ramble</a> </div>]]></description>
  <category><![CDATA[LLM]]></category>
  <category><![CDATA[Ramble]]></category>
  <link>https://www.vandee.art/blog/2025-02-13-LLM-is-a-big-ZIP-of-knowledge.html</link>
  <guid>https://www.vandee.art/blog/2025-02-13-LLM-is-a-big-ZIP-of-knowledge.html</guid>
  <pubDate>Thu, 13 Feb 2025 15:14:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[Emacs is all you need]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgf5c4ee7">TL;DR</a></li>
<li><a href="#org0b31bbd">前言</a></li>
<li><a href="#org4490bd3">热情的扩散</a></li>
<li><a href="#org69d1764">AI StartKit</a></li>
</ul>
</div>
</nav>
<div id="outline-container-orgf5c4ee7" class="outline-2">
<h2 id="orgf5c4ee7">TL;DR</h2>
<div class="outline-text-2" id="text-orgf5c4ee7">
<p>
Emacs is all you need
</p>
</div>
</div>
<div id="outline-container-org0b31bbd" class="outline-2">
<h2 id="org0b31bbd">前言</h2>
<div class="outline-text-2" id="text-org0b31bbd">
<p>
这几年最正确的决定就是入手了现在这台 Macbook M1 max。如果说当时我就遇见到了现在它能够给我带来的改变，你肯定不信，但事实就是如此。
</p>

<p>
其实当初是为了摄影才考虑的，原来的老台式在一次渲染延时摄影的时候，苦苦等待了 3 小时之后，结果死机了，这仅仅只是一个 1 分钟的延时。综合考虑到还需要一台接近 Linux 体验的的系统开始学习编程，还想玩玩本地模型，于是直接上了顶配，而价格是当时 Macbook M3 max 的一半。
</p>

<p>
如果没有这台 Macbook 就不会这么愉快的用上 Emacs ，也就不会有现在的整个 PKM 体系，也不会有 <a href="https://www.vandee.art/2024-05-22-org-pkm-manual.html">PKM（个人知识管理）构建手册 - Emacs</a> ,也不会有现在部署的几个个人网站，也不会有现在突飞猛进的学习效率：<a href="https://www.vandee.art/2025-01-20-fragmented-knowledge-learning-with-ai.html">碎片知识学习 - with AI</a>，我可能还在继续用 Logseq。大的变数就是从这些看似不起眼的小决定开始萌芽。
</p>

<p>
关于 Emacs 部分今天不准备多说什么，而是想先聊聊 <a href="https://github.com/VandeeFeng/gitmemo/issues/34">热情的扩散</a> 。
</p>
</div>
</div>
<div id="outline-container-org4490bd3" class="outline-2">
<h2 id="org4490bd3">热情的扩散</h2>
<div class="outline-text-2" id="text-org4490bd3">
<p>
不知道从什么时候开始，在 Emacs 里敲键盘这件事本身就会让我觉得很有意思。
</p>

<p>
相似的，我其实不喜欢读论文，但用自己构建的工具来学论文，就变得有意思了。我也很懒，平常不太爱出远门，但是带上相机，我就有了去很多地方的兴趣。
</p>

<p>
这应该就是热情的扩散。
</p>

<p>
当在一个领域或者某个阶段当中，不可避免的需要面对枯燥乏味或是很难推进的事物，附加上各种鸡汤式的理由来强行说服自己不会是我的做法，依靠奖励来推动行动也不可取，强迫自己对一个东西发展出兴趣更没有必要。
</p>

<p>
Embark on something with passion and interest，在自己感兴趣的事物的基础上发展、扩散到更多的领域。这应该是一种更正面的，克服枯燥、懒惰的方法。
</p>
</div>
</div>
<div id="outline-container-org69d1764" class="outline-2">
<h2 id="org69d1764">AI StartKit</h2>
<div class="outline-text-2" id="text-org69d1764">
<p>
从 OpenAI 到现在的 2025 年，其实许多人都还没有真正接触到 AI，大部分人只是接触到了 AI 化的产品，例如 ChatGPT 的 APP，更有一部分根本对 AI 就没太大兴趣。在我的概念里，调用过 LLM 的 API 才可能叫接触过 AI 了。
</p>

<p>
我不是 AI 的布道者，更没有相关利益捆绑，也丝毫不想鼓吹 AI。但技术变革就是在彻底改变生活的时候才会被称作变革，在这之前的过程往往会被忽略，就像互联网一样。
</p>

<p>
可以毫不关心，只是等待生活被 AI 新技术彻底改变的时候，继续享受新的生活，也可以在被它彻底改变之前，不让它改变自己。我不喜欢被动的接受，仅此而已。
</p>

<p>
对于后者，Emacs 就是最好的 startkit。它可以解决从 0 到 1 的问题，解决一个问题最难部分的就是开始。
</p>

<p>
在咸鱼上已经有本地部署 DeepSeek 的教程在卖了，很难想象几行代码就可以卖 20 块，而且销量还不错。这不是信息差带来的消费，这只是懒。这个 20 块，5 年之后可能就是你会消费的 20 万。LLM 大语言模型 说简单点就是一个巨大的 ZIP，玩 LLM 只是需要一个打开这个 ZIP 的工具而已。
</p>

<p>
So, All you need is Emacs.
</p>

<p>
从 Emacs 开始，自然就会掌握编程的基础概念，Emacs 提供了高度可自定义的代码编辑器、自带终端、更直接的 compile，也就是和 AI 开始真正接触的入口，当然 Emacs 远不止如此。感兴趣的可以看这个：<a href="https://www.youtube.com/watch?v=81MdyDYqB-A">Configuring Emacs on My New Laptop - YouTube</a>
</p>

<p>
和 Cursor 这种 AI 代码编辑器相比，Emacs 当然没有那么开箱即用，但捷径往往是远路。
</p>

<p>
也并不是只有 Emacs 才是适合 AI 行业外的 AI StartKit，但是能够像 Emacs 一样既能充当向导，又能构建出自己的工具的，真没有几个。
</p>

<p>
就像我刚开始使用 Emacs 的时候看到的一篇文章说的那样：Emacs 已经改变了我的生活。
</p>

<p>
更准确的说，应该是持续学习，让我不那么容易被改变。
</p>

<p>
最后，这篇文章就是在 Emacs 的 org-mode 里，直接和 DeepSeek-R1 自动补全协同生成的。这不比咸鱼的 20 块消费玩的开心多了？
</p>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-ramble.html">Ramble</a> </div>]]></description>
  <category><![CDATA[Ramble]]></category>
  <link>https://www.vandee.art/blog/2025-02-03-emacs-is-all-you-need.html</link>
  <guid>https://www.vandee.art/blog/2025-02-03-emacs-is-all-you-need.html</guid>
  <pubDate>Mon, 03 Feb 2025 13:10:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[碎片知识学习 - with AI]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org858bf97">前言</a></li>
<li><a href="#orgca0a129">PDF 阅读</a></li>
<li><a href="#org1b8e3a9">网页阅读</a></li>
<li><a href="#orgcb96298">零散的概念</a></li>
<li><a href="#orga9ed220">搜索</a>
<ul>
<li><a href="#org10b5598">2025-03-08 added</a></li>
</ul>
</li>
<li><a href="#org1ba92a0">其他工具</a></li>
</ul>
</div>
</nav>
<div id="outline-container-org858bf97" class="outline-2">
<h2 id="org858bf97">前言</h2>
<div class="outline-text-2" id="text-org858bf97">
<p>
对于是否要拥抱 AI，在程序员里大致可以分为两派：一部分是坚决不用，一类是已经将 AI 融入了自己的工作流程。后面就简称为革新派和精英派。
</p>

<ul class="org-ul">
<li>精英派不用 AI 来写代码的原因也简单充分，AI 写出来的代码就是垃圾，我可以自己写的更好为什么要让 AI 来破坏我的优美的代码？</li>

<li>革新派的观点也很简单，借助 AI 可以简化许多复杂的流程，例如自动补全、自动修正、自动测试、自动修复、自动提交等等。类似 Cursor 的 AI 代码编辑器，完全可以说改变了代码工作的方式。</li>
</ul>

<p>
我是一个行业外的人，自然不需要有太多立场，不需要站队。也没有什么压力，必须要跟上行业的大趋势，保住工作。因此我对于 AI 的出发点是优化信息处理、优化学习流程。并且，对于编程和 AI，我本身也挺有兴趣。我和 AI 相关的博客文章也都不是什么技术文章，更多的是一个行业外的人的记录和分享。
</p>

<p>
对于行业外的人，大致可以分为几种：一起吹泡泡吃行业红利的，和我类似关注 AI 在知识上的应用的，借助 AI 开始独立开发的。现在借助各种 AI 代码工具，行业外的人确实可以很快做出一些 MVP，或者一些小工具，大语言模型打破了自然语言编程的壁垒。我这半年也借助 AI 实现了许多以前想做但做不出来的小项目。
</p>

<p>
2024 的小泡泡是 RAG 、prompt 和 AI 逻辑推理，半年不到就冒出来不少于 5 种 RAG 类型，各种神级优化 prompt，现在回过头来看呢，真正落地到实际项目的没有多少。
</p>

<p>
2025 AI 的新泡泡是 Agents，其实也就是换了一种说法。让 AI 根据特定的 prompt 可以调用 tools，定义不同的 Agent 类，来分析完成不同的任务。LangChain、OpenAI、Gemini 都推出了各自的 Agents 框架，之前基于老框架的代码就全部都得更新才能正常运行，因为底层的函数调用都更改了。小业务、小项目只能被大趋势牵着走，牵一发动全身。
</p>

<p>
我想表达的是，这些 AI 的隐性成本是我这类行业外的人不需要支付的。
</p>

<p>
查理芒格说过，最大的投资永远是自己。不管是 AI 行业内的还是行业外的，核心始终都应该在提升自己上，过度的追赶趋势，在泡泡破了的时候就得不偿失了。这也是我始终没有太深入的研究 Dify、Coze 这类中间类型的 AI 工具的原因。掌握更多底层的知识和逻辑是更重要的。
</p>

<p>
后面是最近关于 PDF 和网页阅读的一些方法。日常需要 AI 来帮助的主要也是这两类。
</p>
</div>
</div>
<div id="outline-container-orgca0a129" class="outline-2">
<h2 id="orgca0a129">PDF 阅读</h2>
<div class="outline-text-2" id="text-orgca0a129">
<p>
<a href="https://github.com/echohive42/AI-reads-books-page-by-page">GitHub - echohive42/AI-reads-books-page-by-page</a> 这个项目前段时间上了 GitHub Trends，项目逻辑很值得学习，立马 fork 自定义了一下：<a href="https://github.com/VandeeFeng/ReadPDFpbp">https://github.com/VandeeFeng/ReadPDFpbp</a> 。主要增加了 ollama 和 OpenRouter 模型的调用，还有一些自定义的参数，可以直接在 CLI 里调用。行业标准害人啊，cookbook 里都默认使用 OpenAI 和 Claude 的 API。
</p>

<p>
这个项目可以逐页阅读 PDF，生成知识要点，并根据页面分段总结。一个 50 页以上的 PDF，自己看就有点吃力了。NotebookLM 虽然很好用，但是超过了 80 页左右的 PDF，我实际用下来也不是很准确。
</p>

<p>
这个项目可以逐页阅读总结出关键的概念和知识点，然后再找到相关页面精读。另外一个优势就是本地模型是免费的，几个 200 页的 PDF 用 OpenAI 可能几刀就没了。
</p>
</div>
</div>
<div id="outline-container-org1b8e3a9" class="outline-2">
<h2 id="org1b8e3a9">网页阅读</h2>
<div class="outline-text-2" id="text-org1b8e3a9">
<p>
<a href="https://github.com/vandeefeng/gitmemo/issues/26">在知识之间、AI 之间创造 connection</a> 这里是有关用 phidata 构建 Agent 来同时分析 2 个以上网页文章的内容。
</p>

<p>
解决了同时在几个主题相似的网页文章里快速找到关键信息的问题，效率提升不少。相关的项目很多，自己折腾了一下，主要是增加了导出的功能，这个对于我来说很重要。
</p>

<p>
导出历史对话就可以进一步整合，这个功能在许多大型 RAG 项目里就是不给。
</p>
</div>
</div>
<div id="outline-container-orgcb96298" class="outline-2">
<h2 id="orgcb96298">零散的概念</h2>
<div class="outline-text-2" id="text-orgcb96298">
<p>
平常一些概念上的学习，之前是在 OpenWeb UI 里，现在基本都在 Emacs 里用 gptel 了，全部都汇总在一个 org 文档里。
</p>


<figure id="org76e9bd2">
<img src="https://testingcf.jsdelivr.net/gh/vandeefeng/gitbox@main/img/llmchat.gif" class="img" width="50%" height="50%">

</figure>
</div>
</div>
<div id="outline-container-orga9ed220" class="outline-2">
<h2 id="orga9ed220">搜索</h2>
<div class="outline-text-2" id="text-orga9ed220">
<p>
一般的搜索直接用 DuckDuckGo 。再就是自己改了一下的 <a href="https://github.com/VandeeFeng/Gemini-Search">Gemini-Search</a> ，部署到 docker 调用 Gemini 的 API 实现类似 Perplexity 的体验。
</p>
</div>
<div id="outline-container-org10b5598" class="outline-3">
<h3 id="org10b5598">2025-03-08 added</h3>
<div class="outline-text-3" id="text-org10b5598">
<p>
最近各种 Deep Research 和 Deep Search 大大提升了用 AI 搜索的效率。OpenAI 和 Grok 的深度搜索效果都挺不错的。Deep Research 使用了半个多月，对我来说它最大的作用是针对一定的领域、topic，开拓思路，快速的找到这些问题领域的框架和索引。
</p>

<p>
强烈推荐下面几个可以自己折腾的：
</p>

<ul class="org-ul">
<li><p>
node-DeepResearch: 可以自己部署，支持Gemini (latest gemini-2.0-flash) / OpenAI / LocalLLM 做推理模型，用 Jina Reader 搜索和处理网页内容。在需要获取全面但简洁的信息的时候，效果还挺不错的。
</p>

<p>
README 的说明也挺有道理：
</p>

<blockquote>
<p>
与 OpenAI/Gemini/Perplexity 的“深度研究”不同，我们仅专注于通过我们的迭代过程找到正确的答案。我们不为长篇幅文章进行优化，那是一个完全不同的问题——因此，如果您需要从深度搜索中获得快速、简洁的答案，那么您来对地方了。如果您正在寻找像 OpenAI/Gemini/Perplexity 那样的 AI 生成的长篇报告，那么这不适合您。
</p>
</blockquote>

<p>
Github: <a href="https://github.com/jina-ai/node-DeepResearch/">https://github.com/jina-ai/node-DeepResearch/</a>
</p>

<p>
Websites: <a href="https://search.jina.ai">https://search.jina.ai</a>
</p></li>

<li><p>
deep-research-web-ui: 这个项目是 <a href="https://github.com/dzhng/deep-research">https://github.com/dzhng/deep-research</a> 的可视化版本，并做了一些改进。联网搜索服务：Tavily (每月 1000 次免费搜索), Firecrawl（支持自部署），支持 OpenAI compatible, SiliconFlow, DeepSeek, OpenRouter, Ollama 。
</p>

<p>
Github: <a href="https://github.com/AnotiaWang/deep-research-web-ui">https://github.com/AnotiaWang/deep-research-web-ui</a>
</p></li>

<li><p>
Storm：An LLM-powered knowledge curation system that researches a topic and generates a full-length report with citations.
</p>

<p>
STORM 是一个大型语言模型系统，能够根据互联网搜索从零开始撰写类似维基百科的文章。Co-STORM 进一步增强了其功能，使人类能够与大型语言模型系统协作，以支持更符合需求和偏好的信息搜索和知识策划。
</p>

<p>
GitHub：<a href="https://github.com/stanford-oval/storm">https://github.com/stanford-oval/storm</a>
</p>

<p>
Websites：<a href="https://storm.genie.stanford.edu/">https://storm.genie.stanford.edu/</a>
</p></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org1ba92a0" class="outline-2">
<h2 id="org1ba92a0">其他工具</h2>
<div class="outline-text-2" id="text-org1ba92a0">
<p>
另外要强烈安利 <a href="https://github.com/nbonamy/witsy">Witsy</a> 这个项目，不多介绍了，它就是我到目前为止用过最好用的 LLM 客户端。
</p>

<p>
Cursor、VSCode、Windsurf 等编辑器，不写代码，纯粹拿来学习也是完全没有问题的。还可以和 obsidian 这样的知识库 RAG 联动。
</p>

<p>
该白嫖的行业红利还是要嫖的。
</p>

<p>
当然我的最爱还是 Emacs。
</p>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-pkm.html">PKM</a> </div>]]></description>
  <category><![CDATA[PKM]]></category>
  <link>https://www.vandee.art/blog/2025-01-20-fragmented-knowledge-learning-with-ai.html</link>
  <guid>https://www.vandee.art/blog/2025-01-20-fragmented-knowledge-learning-with-ai.html</guid>
  <pubDate>Mon, 20 Jan 2025 16:48:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[结构化知识工作流-with AI]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgf9faafa">Intro</a></li>
<li><a href="#org9a8530f">信息处理</a>
<ul>
<li><a href="#orgaf67f75">被动信息</a></li>
<li><a href="#org0057262">主动信息</a></li>
</ul>
</li>
<li><a href="#org60e701c">文章精读</a></li>
<li><a href="#org6a0a6e4">笔记</a>
<ul>
<li><a href="#org76efd94">Chipper</a></li>
</ul>
</li>
<li><a href="#org2003824">输出</a></li>
<li><a href="#orgb4df3f0">小结</a></li>
</ul>
</div>
</nav>
<p>
今年花了很多时间在研究 LLM 和知识库的结合上，整理一下现在的流程，后面有更新了也都放在这里。
</p>

<p>
每当我们习惯了一种模式之后，大脑就获得了这种习惯的松弛感，就好像出去吃饭的时候，到了一个熟悉的餐厅熟悉的环境，看到了熟悉的菜单，感觉很从容。我本能的会记住这种大脑的感觉，就好像闻到了一个气味，下一次再闻到它的时候，就很自然的会回忆起相关的细节。每当这个松弛感出现之后，我就意识到，是时候要更新了。
</p>

<p>
因为，一个开了 20 年车的司机，很可能在技术上没有进步反而倒退了，在习惯和熟悉感之中，许多技能就会退化，更要命的是，它会释放一个错误的信号：这种建立在持续时间长短之上的自信和权威是我们经常会放大的。
</p>

<p>
因此，我养成了一个习惯，也就是当松弛感出现之后，强迫大脑去习惯新的习惯。在这个过程当中，就好像带上了一个放大镜，那些在习惯之下拙劣的细节被放大。
</p>
<div id="outline-container-orgf9faafa" class="outline-2">
<h2 id="orgf9faafa">Intro</h2>
<div class="outline-text-2" id="text-orgf9faafa">
<p>
信息很容易被误认为是知识，我们每天会被动和主动的接受到许多信息，会自然的获得一种感觉：我今天又学到了，知道了很多新鲜的东西。但这不是知识，当信息被固定和<a href="https://wiki.vandee.art/#%E6%9B%B4%E5%A4%9A%E7%9A%84%E7%BB%93%E6%9E%84%E5%8C%96%E7%9F%A5%E8%AF%86">结构化</a>之后，才可能被称作知识。
</p>

<p>
在 AI 的帮助下，这个过程变得更系统也更便捷。学习不是一系列任务，更不只是一个阶段性的教育，而是生物进化过程当中一个必然会参与的活动。对于我来说，我很享受这个过程，学习就好像健身锻炼一样，再内啡肽和多巴胺的作用下，正反馈其实很容易建立。
</p>

<p>
在《穷查理宝典》里我最大的收获就是 <a href="https://www.vandee.art/2023-12-06-learn-all-the-time.html">Learn All The Time</a> 。
</p>
</div>
</div>
<div id="outline-container-org9a8530f" class="outline-2">
<h2 id="org9a8530f">信息处理</h2>
<div class="outline-text-2" id="text-org9a8530f">
<p>
信息处理部分的目标是：
</p>

<ul class="org-ul">
<li>统一在一个地方阅读，现在是 Readwise 可能明年会自己搭建。</li>
<li>渐进式阅读，每一次高亮标注重点之后，最终生成高度原子化的概念。</li>
<li>通过 Emacs 的 agenda 和自制的回顾卡片，让知识流动起来，融入循环。</li>
</ul>

<p>
最终在一次次的迭代之后，这些信息会被筛选成高度原子化的笔记，记录到 <a href="https://wiki.vandee.art/#%E6%9B%B4%E5%A4%9A%E7%9A%84%E7%BB%93%E6%9E%84%E5%8C%96%E7%9F%A5%E8%AF%86">Vandee — Wiki</a> 。
</p>

<p>
视频学习，现在基本全部都在 google 的 <a href="https://notebooklm.google.com/">NotebookLM</a>，太方便了。
</p>

<p>
基于这些就有许多有意思的项目可以做了，例如最近在折腾的，从数据库里检索一个星期之内的信息，做一个简报，用 GitHub action 实现自动化。
</p>
</div>
<div id="outline-container-orgaf67f75" class="outline-3">
<h3 id="orgaf67f75">被动信息</h3>
<div class="outline-text-3" id="text-orgaf67f75">
<p>
现在我的被动信息获取主要来源于 RSS 订阅，今年开通了 Readwise 的订阅，并在 claude 的帮助下构建了一个信息固定的 workflow：<a href="https://www.vandee.art/2024-11-10-database-of-flowing-knowledge.html">数据库的搭建 - 流动知识检索</a> 、<a href="https://www.vandee.art/2024-10-12-bookmark-and-summary-by-github-actions.html">用 GitHub 仓库做书签和 AI 摘要 - 流动知识检索</a> 。
</p>

<p>
在 Readwise 里阅读 RSS 的推送，用 <a href="https://github.com/osmoscraft/osmosmemo">osmos::memo</a> 书签插件剪藏网页文章，保存到 Readwise 阅读，并同步保存到 teable 的数据库。进一步通过 Github action 生成 <a href="https://clip.vandee.art/">Vandee's Clip</a> 。
</p>

<p>
通过渐进式阅读，在迭代高亮标注几次之后，最后在 Emacs 里通过 capture 固定到 <code>clip.org</code> ，作为剪藏的元数据，方便以后的工作流提取。
</p>

<p>
在一个开源项目的基础上，修改了一下，搞了一个信息聚合的：<a href="https://github.com/VandeeFeng/wisecrawl/">VandeeFeng/wisecrawl</a> 。ReadWise 今年就不打算用了，全部接入数据库。RSS 阅读器现在使用的是 <a href="https://github.com/electh/nextflux">electh/nextflux</a> 和 <a href="https://github.com/miniflux/v2">miniflux</a> &#x2013;2025-05-05
</p>
</div>
</div>
<div id="outline-container-org0057262" class="outline-3">
<h3 id="org0057262">主动信息</h3>
<div class="outline-text-3" id="text-org0057262">
<p>
目前会每天看一看这些网站：
</p>
<ul class="org-ul">
<li><a href="https://zeli.app/zh">Zeli - 用中文阅读Hacker News和AI论文</a></li>
<li><a href="https://newsnow.busiyi.world/c/focus">NewsNow</a></li>
<li><a href="https://huggingface.co/papers">Daily Papers - Hugging Face</a></li>
<li><a href="https://emacs-china.org/">Emacs China</a></li>
<li><a href="https://trendshift.io/">Trendshift - Explore open-source repositories and find some insights</a></li>
<li><a href="https://hellogithub.com/en">Interesting open-source community - HelloGitHub</a></li>
<li><a href="https://linux.do/">LINUX DO - 新的理想型社区</a></li>
</ul>

<p>
还有一些自己关注大佬的博客和 GitHub 仓库。
</p>

<p>
最近在听播客，这是我长时间纯文字阅读之后忽略的部分。现在播客的大环境挺好的，有许多高质量的资源。
</p>
</div>
</div>
</div>
<div id="outline-container-org60e701c" class="outline-2">
<h2 id="org60e701c">文章精读</h2>
<div class="outline-text-2" id="text-org60e701c">
<p>
最近用 phidata 和 ollama 构建了一个简单的本地 <a href="https://memo.vandee.art/issue/26">RAG assistant</a> ，可以直接输入文章 url，结合文章内容具体的提问，这样就可以同时对多个相关内容的文章进行系统的提问，效率提升了不少。
</p>

<p>
这个过程当中，AI 会帮助我剔除我不关心的部分，快速的找到概念之间的联系，并发散思维，帮助我提出更好的问题。
</p>

<p>
AI 善于回答问题，但它不善于提出问题。使用 AI 学习了很长时间之后，我觉得很重要的一点就是：让 AI 帮助自己提出问题。而这些，一个简单的 prompt 就可以解决。
</p>

<p>
这一步的目标是：在知识之间、AI 之间创造 connection。如果只是机械的把 AI 当作一个阶段性的工具，那么它的价值是很有限的。更进一步，AI 完全可以是一个 24 小时全天在线的朋友。它可以帮助自己提出更好的问题，找到自己思维习惯的盲区，是知识、信息、思维的一个很好的连接点。
</p>
</div>
</div>
<div id="outline-container-org6a0a6e4" class="outline-2">
<h2 id="org6a0a6e4">笔记</h2>
<div class="outline-text-2" id="text-org6a0a6e4">
<p>
笔记部分是固定结构化知识最核心的一步，<a href="https://wiki.vandee.art/#%E6%89%BE%E5%88%B0%E7%9F%A5%E8%AF%86%E7%9A%84%E7%BC%9D%E9%9A%99">找到知识的缝隙</a>。
</p>

<p>
经过几个月迭代出了 <a href="https://www.vandee.art/2024-05-22-org-pkm-manual.html">PKM（个人知识管理）构建手册 - Emacs</a> ，现在终于有了一个基于 Emacs 的比较满意的笔记流程。作为 PKM 的基础库，这里保存着最原始的笔记材料和历史记录。
</p>

<p>
高度原子化的笔记输出到 <a href="https://wiki.vandee.art/#%E6%9B%B4%E5%A4%9A%E7%9A%84%E7%BB%93%E6%9E%84%E5%8C%96%E7%9F%A5%E8%AF%86">Vandee — Wiki</a> ，在 Emacs 里用 bash 脚本记录到 tiddlywiki。
</p>

<p>
在 Emacs 里用 <a href="https://github.com/karthink/gptel">gptel</a> 可以很方便的和 AI 交互对话，直接在 org 文档里记录和 LLM 对话的内容。这个挺关键的，和 AI 对话的检索是个大问题。现在的 AI 平台很分散，各自的数据又都不能导出，这对于记录 AI 学习笔记来说，很麻烦。直接在 Emacs 里和 AI 交互就解决了这个痛点。
</p>

<p>
下一步要构建数据库版本的笔记，和 Emacs 的工作流结合起来，<a href="https://memo.vandee.art/issue/26">在知识之间、AI 之间创造 connection</a> 。
</p>

<p>
supabase 最进又更新了 <a href="https://database.build/">Postgres Sandbox</a> ,和我的思路不谋而合。
</p>
</div>
<div id="outline-container-org76efd94" class="outline-3">
<h3 id="org76efd94">Chipper</h3>
<div class="outline-text-3" id="text-org76efd94">
<p>
Github: <a href="https://github.com/TilmanGriesel/chipper">https://github.com/TilmanGriesel/chipper</a>
</p>

<p>
其实很早就关注了这个项目，但是一直没有尝试。这个项目基于 Elasticsearch 来实现文档搜索和 RAG。LLM 的提供支持 ollama 和 huggingface。提供脚本一键 docker 部署很方便。
</p>

<p>
我看重的功能是：它可以提供一个 ollama 的代理。也就是使用这个项目的 ollama 代理之后，就可以直接调用项目的文档 RAG 了，而这个项目管理文档 RAG 很方便。这样就可以把它当作是一个文档搜索引擎了。
</p>
</div>
</div>
</div>
<div id="outline-container-org2003824" class="outline-2">
<h2 id="org2003824">输出</h2>
<div class="outline-text-2" id="text-org2003824">
<p>
<a href="https://wiki.vandee.art/#%E5%A6%82%E6%9E%9C%E4%BD%A0%E6%80%9D%E8%80%83%E8%80%8C%E4%B8%8D%E8%BE%93%E5%87%BA%EF%BC%8C%E4%BD%A0%E5%8F%AA%E6%98%AF%E4%BB%A5%E4%B8%BA%E8%87%AA%E5%B7%B1%E5%9C%A8%E6%80%9D%E8%80%83">如果你思考而不输出，你只是以为自己在思考</a> ，费曼学习法里说的太多了，study in public。
</p>

<p>
作为结构化知识循环的最后一步，输出的过程当中，是对结构化知识的检验也是应用。更重要的是，一个信息如果不能融入一个系统或者环境，它的封闭性会削弱这个信息的价值。
</p>

<p>
做笔记当然是为自己做的，但是它的价值是可以放大的。向外的探索和向内的探索同样重要，俗话说三人行必有我师，信息的披露和流动对于向内的探索是很有帮助的。
</p>

<p>
现在只是把这些输出到 <a href="https://www.vandee.art/">Vandee's Blog</a> 和 <a href="https://memo.vandee.art/">Git Memo</a> ，并没有加入太多社交属性。可以被搜索引擎检索到对于我现在来说就挺足够了。
</p>

<ul class="org-ul">
<li>Blog: <a href="https://www.vandee.art/2024-10-24-my-first-org-blog.html">我的第一篇 org 博客</a> ,博客现在也直接在 Emacs 里写作，很巴适。生成静态网页发布到 GitHub 通过 Vercel 部署，Cloudflare 加速和管理 DNS。</li>
<li>Memo: <a href="https://github.com/VandeeFeng/gitmemos">VandeeFeng/gitmemos: An alternative to Memos depending on github issues and supabase</a> ,在 cursor 的协助下，糊了一个 gitmemos 用来当作朋友圈的替代,不知道是哪个好心人给了一个仅有的 star 🤣。这个项目主要是想增加一点社交属性，把一些小想法记录下来，通过卡片分享。<a href="https://github.com/VandeeFeng/gitmemo/issues/6">没有记录就没有发生，而记录本身已经是一种反抗</a> ,有事没事记两笔。</li>
</ul>
</div>
</div>
<div id="outline-container-orgb4df3f0" class="outline-2">
<h2 id="orgb4df3f0">小结</h2>
<div class="outline-text-2" id="text-orgb4df3f0">
<p>
<a href="https://wiki.vandee.art/#%E6%8F%90%E5%8D%87%E5%BD%B1%E5%93%8D%E5%8A%9B">提升影响力</a> ，做一个 <a href="https://wiki.vandee.art/#%E9%92%A5%E5%8C%99%E4%BA%BA(Key%20Man)">钥匙人(Key Man)</a> ，每个人的价值都应该能在不同的体系里得到放大和体现，这样社会平均价值自然会得到提升。
</p>

<p>
思考和写作是一个很好的起点，也是每个普通人下一秒就可以开始的事情。
</p>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-pkm.html">PKM</a> </div>]]></description>
  <category><![CDATA[PKM]]></category>
  <link>https://www.vandee.art/blog/2024-12-24-the-structrued-knowledge-workflow-with-ai.html</link>
  <guid>https://www.vandee.art/blog/2024-12-24-the-structrued-knowledge-workflow-with-ai.html</guid>
  <pubDate>Tue, 24 Dec 2024 14:10:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[2024 - 需]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgb9db0b8">2024</a></li>
<li><a href="#org02ed2c5">总结是在做什么？</a></li>
</ul>
</div>
</nav>
<p>
我给我今年的关键词是：需，是周易的一个卦象。卦辞：有孚，光亨，贞吉，利涉大川。尽管今年又新学了一些东西，但总体来说储蓄还远远不够。
</p>

<p>
我其实不习惯写总结，一直觉得没有太大必要，该做的都做了，没有做的也总结不出什么。但近几年有了新的看法。
</p>

<p>
2024 年 12 月 2 日，牛津大学出版社宣布“脑腐”（brain rot）为 2024 年<a href="https://corp.oup.com/news/brain-rot-named-oxford-word-of-the-year-2024/">牛津年度词汇</a>，各大知名机构都会在年底公布它们今年的数据总结，政府同样会有经济总结、工作总结报告，虽然这些对外的属性较多，它们需要权衡各方面的利弊，公布一个对外的说法，但多少会反应出一些当年的趋势。不同立场的分析主体会带有主观偏向，但数据是实打实的。怎么判断形势、趋势？我觉得从这些总结报告入手，是个很好的方法，可以顺着找到相关的数据自己分析。
</p>
<div id="outline-container-orgb9db0b8" class="outline-2">
<h2 id="orgb9db0b8">2024</h2>
<div class="outline-text-2" id="text-orgb9db0b8">
<p>
自己的总结当然向内的属性就要偏重一些了。也一样从数据出发来分析。
</p>

<p>
这两年看的书还是太少，今年也没有达到一个月一本的目标，总共阅读了 7 本书：
</p>


<figure id="orgb747f03">
<img src="https://testingcf.jsdelivr.net/gh/vandeefeng/gitbox@main/img/books.png" class="img" width="50%" height="50%">

</figure>

<p>
Blog 共 13 篇，里面我觉得还不错的有：<a href="https://www.vandee.art/2024-05-22-org-pkm-manual.html">PKM（个人知识管理）构建手册 - Emacs</a> 、 <a href="https://www.vandee.art/2024-05-05-the-value-of-art.html">也说说艺术的价值</a> 、<a href="https://www.vandee.art/2024-07-30-the-imitation-game-of-art.html">艺术的模仿游戏</a> 、<a href="https://www.vandee.art/2024-11-21-recording-is-resistance.html">记录本身就是一种反抗 - gitmemo</a> 、<a href="https://www.vandee.art/2024-03-15-the-weight-of-three-cabbages.html">三颗大包菜</a> 、<a href="https://www.vandee.art/2024-02-01-poor-sheep.html">羊好可怜</a>。
</p>

<p>
总体来说，今年对 Emacs 更加精进了，从 DoomEmacs 转为自己配置 Emacs，PKM 也更加完善，Emacs 记录原始的笔记作为 PKM 基本库，迭代到 <a href="https://x.vandee.art/wiki">Vandee — Wiki</a> 精炼成原子笔记，<a href="https://x.vandee.art/memo">GitMemo</a> 带上社交属性来记录 Memo 并作为朋友圈替代，<a href="https://x.vandee.art/clip">Clip</a> 剪藏有记录价值的文章，<a href="https://x.vandee.art/blog">Blog</a> 作为写作的输出。这几个部署的分板块都迭代自 Emacs 原始的数据。
</p>

<p>
得益于 cursor，构建了 <a href="https://github.com/VandeeFeng/gitmemos">GitMemo</a> 。又继续学习了 JavaScript、Rust、C、Python 等几种计算机语言。乐理基础也囫囵吞枣的又系统的看了一下，听了许多古典音乐，其中最喜欢的有 Vivaldi 的 The Four Seasons 四季。
</p>

<p>
今年主要在内核的修炼，我感觉我和自然的交融更加融洽了。这应该得益于《周易》和古典乐。摄影今年没有太多新的拍摄，原因就是要修炼内核，明年看看成效，希望能碰到好的题材。
</p>
</div>
</div>
<div id="outline-container-org02ed2c5" class="outline-2">
<h2 id="org02ed2c5">总结是在做什么？</h2>
<div class="outline-text-2" id="text-org02ed2c5">
<p>
我们有时会在一个阶段快要结束的时候产生一种时间过的很快的感觉，这其实是因为重复性的事物在日常生活中占据的比例比较大，所以我们会觉得每天做了许多，但又好像什么都没做，在大脑里就没有留下什么，于是在回顾的时候就会感觉，怎么时间一下就过去了？
</p>

<p>
以往我也会有这种类似的感觉，但这两年明显减少了。因为在每个月我都会自动有根据 Journal 生成的 AI 小结，每天我都有可以度量的具体事物，每个阶段都计划了任务。
</p>

<p>
总结可以放慢这些时间，用文字和记录来度量这些过去的时光。
</p>

<p>
更重要的是，每年把自己向内的总结和外界的总结一对比，就可以知道自己和外界的缝隙在哪里，在下一年做出针对性的调整。
</p>

<p>
根据香农的信息论，社会可以被描述为一个复杂的通信系统，其中信息是基本构建块。社会成员通过各种渠道（如言语、文字、表情等）交换和传递信息，以实现合作与协调，其中个人和社会机构扮演编码器、解码器及信道的角色。
</p>

<p>
通过总结的过滤和优化，个体能够更高效地压缩信息，减少误解，提高交流质量。在《智人之上》里更是强调了信息+想象可以发挥多大的作用。这几年我的许多出发点也都来自对信息的处理，明年也会继续。
</p>

<p>
以后每年就用周易的卦象名来总结，挺有意思的。
</p>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-ramble.html">Ramble</a> </div>]]></description>
  <category><![CDATA[Ramble]]></category>
  <link>https://www.vandee.art/blog/2024-12-12-the-summary-of-2024.html</link>
  <guid>https://www.vandee.art/blog/2024-12-12-the-summary-of-2024.html</guid>
  <pubDate>Thu, 12 Dec 2024 13:34:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[AI 交互的隐性成本]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgcf21a4d">AI 交互的隐性成本</a>
<ul>
<li><a href="#org497f5ca">Prompt 成本</a></li>
<li><a href="#orgd200423">试错成本</a></li>
<li><a href="#orgd866aab">构建成本</a></li>
<li><a href="#org5ef2c5a">依赖成本</a></li>
</ul>
</li>
<li><a href="#org2f9ee9d">技术革命</a></li>
</ul>
</div>
</nav>
<p>
从 ChatGPT 出现到现在已经两年了，也是从 ChatGPT 开始，让我们很自然的把和 AI 的交互形式放在了 Chat 这种形式上。这也是我对 AI 产品的第一印象，从和大语言模型 LLM 的打字、语言交流开始，我们和 AI 有了第一次近距离的接触。当我们一次次惊叹于 ChatGPT、Claude 等 AI 产品发布的新特性时，随着把使用 AI 已经当作了一种习惯之后，一个重要的问题逐渐被忽略了：AI 的使用成本。AI 真的直接提升了我们的效率，节约了成本么？
</p>

<p>
如果把 AI 使用成本分成显性和隐性，对用户而言显性成本的包括：API 的充值，pro 会员的充值等等这些实际的消费。而隐性的成本很少有人提及，它们包括但不限于：学习使用的成本，依赖的成本，还有今天想说说的交互的成本。
</p>

<p>
<a href="https://www.lesswrong.com/posts/tqmQTezvXGFmfSe7f/how-much-are-llms-actually-boosting-real-world-programmer">How Much Are LLMs Actually Boosting Real-World Programmer Productivity? — LessWrong</a> 这篇文章也提及到了这个问题
</p>
<div id="outline-container-orgcf21a4d" class="outline-2">
<h2 id="orgcf21a4d">AI 交互的隐性成本</h2>
<div class="outline-text-2" id="text-orgcf21a4d">
</div>
<div id="outline-container-org497f5ca" class="outline-3">
<h3 id="org497f5ca">Prompt 成本</h3>
<div class="outline-text-3" id="text-org497f5ca">
<p>
与 AI 的交互远远不只是聊天 Chat 这种形式。这只是 ChatGPT 将大语言模型 LLM 代入大众视野当中一个成功的产品。我们都知道现在 LLM 可以理解人类的自然语言，通过预测以聊天的方式进行交互，这直接打破了编程语言和自然语言之间的壁垒，我们可以直接使用自然语言来和计算机沟通了。而这之间被忽略的是：我们和 LLM 的交互同样是有成本的，这个成本就是 prompt，提示词。
</p>

<p>
要想让 LLM 更精准的理解和处理我们的需求，就必须了解 prompt。简单来说，合适的 prompt 触发了 LLM 的关键字，它才能更精准的预测分析输出结果，而和 LLM 交互最合适的自然语言是英语。这也就是为什么，同样的意思，换一句话可能 LLM 生成的结果就会更好。对于不是英语母语的使用者来说，这就是双重成本。
</p>

<p>
而且不同的 LLM 对于 prompt 语法的支持程度也不一样。Claude 对 XML 格式支持的比较好，而 GPT 对 JSON 格式支持的比较好，llama 则更适合用 markdown 语法来写。
</p>
</div>
</div>
<div id="outline-container-orgd200423" class="outline-3">
<h3 id="orgd200423">试错成本</h3>
<div class="outline-text-3" id="text-orgd200423">
<p>
prompt 又直接影响沟通交互的成本。
</p>

<p>
人和人之间沟通的成本我们很好理解，AI 的交互也是一样。如果 prompt 不合适，你会发现 LLM 很笨。在一次次让它理解我们提问的过程当中，无形的会消耗掉很多时间和精力。对于 LLM 来说，简单和困难的事情往往和人类相反。我们需要把对于自己复杂的问题转换为对 AI 简单的问题，才能真正有效的解决我们的问题。
</p>

<p>
比如我想要查询王小波的生平信息。如果只是说“给我介绍一下王小波”，就过于宽泛。换成 “请告诉我关于王小波的主要作品和生活年代的相关信息。” 效果就会好很多。
</p>

<p>
往往一个问题，我们需要和 AI 迭代至少 2 到 3 次，才能得到想要的结果。许多问题相反传统的解决方法会更直接有效。
</p>

<p>
这次重构 GitMemo 的时候，用 cursor 来 debug，每一次就是 10 分钟，加上部署到 Vercel，一个小问题经常要花费半小时，而请一个程序员来看看，可能只是 5 分钟的事。
</p>
</div>
</div>
<div id="outline-container-orgd866aab" class="outline-3">
<h3 id="orgd866aab">构建成本</h3>
<div class="outline-text-3" id="text-orgd866aab">
<p>
因此我们自然会往下想到通过多个 AI 协作来提高成功率。
</p>

<p>
想提高 AI 解决问题的成功率，最直接的方法就是 Workflow 和 Agent 了。这也就是 Dify、Coze 瞄准的切入点。学习使用这些工具、中间件又是一个成本，各个平台的会员也是。
</p>

<p>
更进一步如果想从源头训练一个 LLM，最起码需要看得懂 Python，有一个 IDE，一个像样的显卡和电脑。再就是一个科学上网的工具。
</p>
</div>
</div>
<div id="outline-container-org5ef2c5a" class="outline-3">
<h3 id="org5ef2c5a">依赖成本</h3>
<div class="outline-text-3" id="text-org5ef2c5a">
<p>
当你完成了上面的学习，付出了高昂的成本之后，恭喜你，你大概率已经成功依赖上 AI 了。
</p>

<p>
你会进入一个恶性循环，在达到一定 AI 熟练度之前，上面提到的几点不完全的隐性成本，会随着对 AI 的使用而增加，导致解决问题本身的效率降低。依赖上之后，传统的技能熟练度下降，效率又更低了。如果不能越过这个阈值，那么 AI 的使用反而会带来副作用。
</p>

<p>
和其他技术一样 AI 一定会让人更懒，但我们同样可以借助它让自己变得更聪明，而不是依赖上它从变懒到变笨。
</p>
</div>
</div>
</div>
<div id="outline-container-org2f9ee9d" class="outline-2">
<h2 id="org2f9ee9d">技术革命</h2>
<div class="outline-text-2" id="text-org2f9ee9d">
<p>
利用蒸汽驱动机器，这使得工厂可以建在远离河流的地方，极大地提高了生产效率，并开启了工业革命。后来电力的应用再一次彻底改变了生产和生活方式。再到互联网、智能手机，直到现在可能已经到来的 AI 革命。
</p>

<p>
每一次技术的革新，科学的发展，都会提高生产力，提升效率，但这不等于是对个人的，相反技术的革命会增加个人的成本，个人要适应这些变化，还有更多<a href="https://wiki.vandee.art/#%E6%8A%80%E6%9C%AF%E8%BF%9B%E6%AD%A5%E7%9A%84%E4%BB%A3%E4%BB%B7">技术进步的代价</a>。
</p>

<p>
让 AI 帮助自己思考才是本质，最大的投资永远应该是自己。
</p>

<p>
这也是为什么，近大半年我一直在折腾我的各种 PKM。用 AI 来优化信息获取、信息整理，帮助自己思考，我认为是一劳永逸的。学 AI 就是学一个新的语言，一个和代码、二进制沟通的语言，而这个语言迟早会和当初英文一样，编入义务教育的课本。
</p>

<p>
就单纯想想以后不想被那些和我曾经一样嚣张跋扈的年轻人鄙视，就很有动力了🤣。
</p>

<p>
想到什么后面再更新。
</p>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-ramble.html">Ramble</a> </div>]]></description>
  <category><![CDATA[Ramble]]></category>
  <link>https://www.vandee.art/blog/2024-12-08-The-Hidden-Costs-of-AI-Interaction.html</link>
  <guid>https://www.vandee.art/blog/2024-12-08-The-Hidden-Costs-of-AI-Interaction.html</guid>
  <pubDate>Sun, 08 Dec 2024 16:18:00 +0800</pubDate>
</item>
<item>
  <title><![CDATA[记录本身就是一种反抗 - gitmemo]]></title>
  <description><![CDATA[
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org4ada20e">Gitmemo</a></li>
<li><a href="#org5999ac4">记录与反抗</a></li>
</ul>
</div>
</nav>
<p>
<a href="https://www.vandee.art/2024-10-28-memos-and-ssl-config.html">还是入坑了 Memos</a> ,大概一个月之前在 VPS 上部署了 memos，挺好玩的。也是因为这几天服务器的 IP 突然被 GFW blocked 了，memos 的数据备份到不是很麻烦，长期来看，我大中华的网络太不稳定了。
</p>

<p>
很久之前就看到这个利用 GitHub issues 构建博客的项目：<a href="https://github.com/yihong0618/gitblog/issues/177">gitblog</a> ,作者 yihong0618 和我的许多想法都很相似。
</p>

<p>
思来想去还是决定把 memos 迁移到 GitHub 上记录。
</p>

<p>
<a href="https://laike9m.com/blog/people-die-but-long-live-github,122/">People Die, but Long Live GitHub</a> 这篇文章里写到：
</p>

<blockquote>
<p>
GitHub 已经成为互联网最重要的基础设施之一，有太多人，太多事都直接或间接地依赖于 GitHub，除非人类在未来完全不需要开源代码(这显然不可能)，否则我想不出 GitHub 有关闭的可能。对 GitHub 来说，存在 100 年简直是小意思，500 年也不是不可能。这是我的预言，不一定准确，但我还挺有信心的。
</p>

<p>
人总想留下某种痕迹，证明自己活过，然而事实上，99.999%  的普通人就这么被历史遗忘了——曾经是这样。我们处在信息时代的早期，同样也处在人类文明的早期。从今往后，被数字化的东西只会越来越多。既然有人意识到了 GitHub 的独特性，随着时间推移，越来越多的人总会意识到。那时候会发生什么？自然是，越来越多的人会把自己的信息搬到 GitHub 上，依托 GitHub  实现曾经人们可望而不可及的"永生"。人有两次死亡，第一次是肉体，第二次是被人忘记。我忘记这句话是谁说的了，但现在我们已经可以回避第二次。只要  GitHub 支持，就一定会有人这么做，至少我是其中之一。几十几百年后，GitHub  将成为世界上最大的数字公墓，注册用户大部分都已去世，然而个人主页，项目，commit 历史 还述说着他们生前做过的事——就比如 Joe 的博客。这虽然是个比较 creepy 的推论，但从另一个角度想，却证明了人类的巨大进步：对抗死亡是人类文明的永恒主题，而我们已经实现了阶段性胜利。
</p>
</blockquote>
<div id="outline-container-org4ada20e" class="outline-2">
<h2 id="org4ada20e">Gitmemo</h2>
<div class="outline-text-2" id="text-org4ada20e">
<p>
简单记录一下过程。
</p>

<p>
<code>git clone git@github.com:yihong0618/gitblog.git</code> ,修改 <code>config.toml</code> 里的 GitHub Pages 的 url，因为这个项目通过 GitHub Pages 部署 Zola 的页面。
</p>

<p>
生成一个新的 GitHub secret，开启 issue 的读写权限，一定不要忘了在仓库的 settings 里打开 Actions 读写的权限。因为我就忘了。
</p>

<p>
在 Python 脚本里就可以自定义生成 README 的格式了。Zola 本身也提供了很多主题，在 <code>config.toml</code> 里配置就 ok。由于这个项目使用的还是 master 分支，GitHub 现在的默认分支是 main，因此涉及到的部分需要修改成 main。
</p>

<p>
GitHub issue 提供 tag 的功能，自带 markdown 编辑器和预览，也可以上传图片、文件、视频。对于记录来说功能足够了，检索也很方便。
</p>

<p>
这是新的 memo 地址：<a href="https://x.vandee.art/memo">https://x.vandee.art/memo</a>
</p>

<p>
我的 GitHub 仓库地址：<a href="https://github.com/VandeeFeng/gitmemo">https://github.com/VandeeFeng/gitmemo</a>
</p>
</div>
</div>
<div id="outline-container-org5999ac4" class="outline-2">
<h2 id="org5999ac4">记录与反抗</h2>
<div class="outline-text-2" id="text-org5999ac4">
<p>
<a href="https://wiki.vandee.art/#%E6%B2%A1%E6%9C%89%E8%AE%B0%E5%BD%95%E5%B0%B1%E6%B2%A1%E6%9C%89%E5%8F%91%E7%94%9F%EF%BC%8C%E8%80%8C%E8%AE%B0%E5%BD%95%E6%9C%AC%E8%BA%AB%E5%B7%B2%E7%BB%8F%E6%98%AF%E4%B8%80%E7%A7%8D%E5%8F%8D%E6%8A%97">没有记录就没有发生，而记录本身已经是一种反抗</a> ，都说历史是属于胜利者的，但那些被历史掩埋的气味和色彩永远都会存在。
</p>

<p>
看似平稳的秩序背后是无数抗争的呐喊与血泪，有自由就一定伴随着反抗。这些沉重的底色就好像在暗房里冲印的底片，色彩的背后是那些灰白的褪色了的故事。
</p>

<p>
看似稳定有序的秩序从来就是无序的，如果说反抗是为了秩序，这从开始就是一个伪命题。反抗这个词带有着默认被压迫的属性，而压迫和不平等是必然的，反抗作为它们的对立面其实是同等级的存在，并不需要添油加醋的加上那么多英雄色彩。太多所谓的反抗其实只是实现的落差带来的利己表演，只是一些出于本能的情绪和反应，这些在我的标准里不能称作是反抗，更准确的说来，应该是生物本能的自我保护。大多数人和事连反抗的对象都没有对上号，又谈何反抗？反抗的是这些不公，还是那些完全不符合人情道义的事物，还是和自己标准不相符带来的愤慨和不理解。所以我们一直在说的反抗，到底是在反抗什么？
</p>

<p>
我更愿意用正面的感情来描述反抗这个通过和压迫对立来表现的词语：“希望”，我欣赏的历史上的反抗大多是“希望”。正是因为希望那些永远不可能达到的事物，希望着自由和平等，我们才会一直努力的追求，奋斗，抗争，坚持，传承。
</p>

<p>
我记录这些并不是为了反抗什么，虽然带着同样的目的，但手段可以就是手段，它不象征任何。扫地僧扫地其实并不是为了什么，它只是在扫地，它的手段和目的已经融为一体互相转化了，但又不通过任何目的来驱使这个手段。
</p>

<p>
现在我自然还没有达到这种境界，就只是凭着直觉记录着，不反抗什么，只是保持希望，保持热爱，像大地一样承载和接受。大地愤怒么？它从来都很平静，但平静得让人类不敢轻易践踏自然的法则，这是比“反抗”更坚实、更伟大的力量，因为它会滋生希望而不是畏惧、愤怒和伤害。
</p>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-ramble.html">Ramble</a> </div>]]></description>
  <category><![CDATA[Ramble]]></category>
  <link>https://www.vandee.art/blog/2024-11-21-recording-is-resistance.html</link>
  <guid>https://www.vandee.art/blog/2024-11-21-recording-is-resistance.html</guid>
  <pubDate>Thu, 21 Nov 2024 19:04:00 +0800</pubDate>
</item>
</channel>
</rss>
