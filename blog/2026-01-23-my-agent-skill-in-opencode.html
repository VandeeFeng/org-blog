<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="description" content="è™½ç„¶æˆ‘ä¸å–œæ¬¢ vibe codingï¼Œä½†æ˜¯ SKILL æ˜¯å¾ˆå€¼å¾—å­¦ä¹ çš„ã€‚ä¸€ä¸ªå¥½çš„ SKILL é‡Œå¯ä»¥å­¦åˆ°å·¥ç¨‹å¸ˆçš„ç»éªŒã€é€»è¾‘ï¼Œä»¥åŠç²¾ç‚¼çš„ promptã€‚">
<link rel="alternate"
      type="application/rss+xml"
      href="https://www.vandee.art/blog/rss.xml"
      title="RSS feed for https://www.vandee.art/blog/">
<title>My Agent Skill in OpenCode</title>
<meta property="og:title" content="My Agent Skill in OpenCode">
<meta property="og:type" content="article" />
<meta property="og:description" content="è™½ç„¶æˆ‘ä¸å–œæ¬¢ vibe codingï¼Œä½†æ˜¯ SKILL æ˜¯å¾ˆå€¼å¾—å­¦ä¹ çš„ã€‚ä¸€ä¸ªå¥½çš„ SKILL é‡Œå¯ä»¥å­¦åˆ°å·¥ç¨‹å¸ˆçš„ç»éªŒã€é€»è¾‘ï¼Œä»¥åŠç²¾ç‚¼çš„ promptã€‚">
<meta property="og:url" content="https://www.vandee.art/blog/2026-01-23-my-agent-skill-in-opencode.html">
<meta name="author" content="Vandee">
       <meta name="referrer" content="origin-when-cross-origin">
       <meta name="viewport" content="width=device-width, initial-scale=1.0">

       <link rel="stylesheet" href="assets/css/blog-style.css" type="text/css"/>
       <link rel="stylesheet"
             href="https://testingcf.jsdelivr.net/npm/remixicon@4.7.0/fonts/remixicon.css"/>
       <link rel="stylesheet"
             href="https://testingcf.jsdelivr.net/npm/@fancyapps/ui@4.0.12/dist/fancybox.css"/>
       <link rel="icon" type="image/x-icon" href="/favicon.ico"/>

       <script src="https://testingcf.jsdelivr.net/npm/@fancyapps/ui@4.0.12/dist/fancybox.umd.js" defer></script>
       <script src="https://testingcf.jsdelivr.net/npm/pangu@7.2.0/dist/browser/pangu.umd.js" defer></script>
       <script defer>
         document.addEventListener("DOMContentLoaded", () => {
           pangu.autoSpacingPage();
         });
       </script>

       <script src="assets/js/app.js" defer></script>
       <script src="assets/js/copyCode.js" defer></script>
       <script src="assets/js/shiba.js" defer></script>
       <script src="assets/js/search.js" defer></script></head>
<body>
<div id="preamble" class="status">
      <header>
      <h1><a href="https://www.vandee.art/blog/">Vandee's Blog</a></h1>
      <img class="shiba" width="100px" src="assets/shiba_gif/shiba_idle_8fps.gif">
      <nav>
      <a href="https://www.vandee.art/blog/">Home</a>
      <a href="https://x404.xyz/wiki">Wiki</a>
      <a href="https://x404.xyz/photo">Photo</a>
      <a href="projects.html">Projects</a>
      <a href="archive.html">Archive</a>
      <a href="tags.html">Tags</a>
      <div id="search-container">
        <input type="text" id="search-input" placeholder="e.g. Emacs PKM...">
        <i class="ri-search-line ri-xl"></i>
      </div>
      </nav>
      </header></div>
<div id="content">
<div class="post-date">23 Jan 2026</div><h1 class="post-title"><a href="https://www.vandee.art/blog/2026-01-23-my-agent-skill-in-opencode.html">My Agent Skill in OpenCode</a></h1>
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org08035bd">TL;DR</a></li>
<li><a href="#orgb4056ac">Agent Skills</a>
<ul>
<li><a href="#orgfa85c6b">ç®€ä»‹</a></li>
<li><a href="#org8b9d005">SKILL è§£å†³äº†ä»€ä¹ˆé—®é¢˜</a></li>
<li><a href="#orgb62e01b">ç¼–å†™ SKILL æ˜¯åœ¨å¹²ä»€ä¹ˆ</a></li>
</ul>
</li>
<li><a href="#org684c210">My Agent Conf</a>
<ul>
<li><a href="#orgac58cac">Core Rules</a></li>
<li><a href="#org7a49b3d">Maintain a hierarchical codebase map</a></li>
<li><a href="#orgca79ffb">Prepared with clear purpose</a></li>
<li><a href="#org65e621d">Just files and loops, no more complicated</a></li>
<li><a href="#orge63837e">Handoff when stucked</a></li>
<li><a href="#org36659af">Maintain memory</a></li>
<li><a href="#orga5abcad">Maintain useful patterns</a></li>
<li><a href="#org3565d34">Maintain code quality and style</a></li>
</ul>
</li>
<li><a href="#orgc2d61a3">OpenCode in Emacs</a></li>
<li><a href="#org0c83527">Bubblewrap Sandbox</a></li>
</ul>
</div>
</nav>
<div id="outline-container-org08035bd" class="outline-2">
<h2 id="org08035bd">TL;DR</h2>
<div class="outline-text-2" id="text-org08035bd">
<p>
è™½ç„¶æˆ‘ä¸å–œæ¬¢ vibe codingï¼Œä½†æ˜¯ SKILL æ˜¯å¾ˆå€¼å¾—å­¦ä¹ çš„ã€‚
</p>

<p>
ä¸€ä¸ªå¥½çš„ SKILL é‡Œå¯ä»¥å­¦åˆ°å·¥ç¨‹å¸ˆçš„ç»éªŒã€é€»è¾‘ï¼Œä»¥åŠç²¾ç‚¼çš„ promptã€‚
</p>

<p>
Tool æ˜¯ LLM çš„åŸºç¡€å·¥å…·ï¼Œagent æ¡†æ¶æ˜¯æ“ä½œç³»ç»Ÿï¼ŒMCP æ˜¯ USB æ¥å£ï¼ŒSKILL æ˜¯ä¸“å®¶æŠ€èƒ½æ–‡æ¡£ã€‚
</p>
</div>
</div>
<div id="outline-container-orgb4056ac" class="outline-2">
<h2 id="orgb4056ac">Agent Skills</h2>
<div class="outline-text-2" id="text-orgb4056ac">
</div>
<div id="outline-container-orgfa85c6b" class="outline-3">
<h3 id="orgfa85c6b">ç®€ä»‹</h3>
<div class="outline-text-3" id="text-orgfa85c6b">
<p>
<a href="https://github.com/agentskills/agentskills">agentskills/agentskills</a> æ˜¯å‰æ®µæ—¶é—´ <a href="https://www.linuxfoundation.org/press/linux-foundation-announces-the-formation-of-the-agentic-ai-foundation">Linux Foundation Announces the Formation of the Agentic AI Foundation (AAIF)</a> Claude å¼€æºçš„ã€‚
</p>

<p>
åœ¨è¿™ä¹‹å‰ SKILL å°±å·²ç»å‡ºç°äº†ã€‚
</p>

<blockquote>
<p>
Agent Skills are a simple, open format for giving agents new capabilities and expertise.
</p>

<p>
Skills are folders of instructions, scripts, and resources that agents can discover and use to perform better at specific tasks. Write once, use everywhere.
</p>

<p>
via: <a href="https://github.com/agentskills/agentskills">https://github.com/agentskills/agentskills</a>
</p>
</blockquote>

<p>
SKILL æ˜¯ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æ˜¯ SKILL.mdã€scriptsã€referencesã€templatesï¼Œæä¾› agent ä¸€ä¸ªä¸“ä¸šé¢†åŸŸçš„ä¸“ä¸šæŠ€èƒ½ã€‚
</p>

<p>
è¿™æ ·è¯´ï¼Œå¬èµ·æ¥è¿˜æ˜¯æœ‰ç‚¹æŠ½è±¡ã€‚æˆ‘ä¹Ÿä¸æƒ³å±•å¼€è¯´æ˜ SKILL çš„æ¦‚å¿µï¼Œè‡ªå·±ä¸Šæ‰‹æ˜¯ç†è§£å®ƒæœ€å¥½çš„æ–¹å¼ã€‚
</p>

<p>
<a href="https://www.vandee.art/blog/2025-11-04-minimal-C-reimplementation-of-claude-skills.html">ç”¨ C æç®€å¤ç° Claude Skills</a> é‡Œæ˜¯æˆ‘ä¹‹å‰ç”¨ C å®ç°çš„ç®€åŒ–ç‰ˆçš„ SKILL é€»è¾‘ã€‚
</p>

<p>
è¿™ä¸¤ä¸ªç½‘ç«™é‡Œæœ‰å¾ˆå¤š SKILL å¯ä»¥æ¢ç´¢å­¦ä¹ ï¼š<a href="https://skillsmp.com/">https://skillsmp.com/</a>ï¼Œ <a href="https://skills.sh/">https://skills.sh/</a>
</p>
</div>
</div>
<div id="outline-container-org8b9d005" class="outline-3">
<h3 id="org8b9d005">SKILL è§£å†³äº†ä»€ä¹ˆé—®é¢˜</h3>
<div class="outline-text-3" id="text-org8b9d005">
<p>
MCP çš„å·¥å…·ä¿¡æ¯ä¼šå ç”¨å¤§é‡çš„ context çª—å£ï¼ŒSKILL å¾ˆå¥½çš„é¿å…äº†è¿™ä¸ªé—®é¢˜ã€‚
</p>

<p>
åœ¨ <code>SKILL.md</code> YAML éƒ¨åˆ†çš„ description æ˜¯å¯¹è¿™ä¸ª SKILL çš„ä»‹ç»ã€‚å½“ agent è¿è¡Œçš„æ—¶å€™ï¼Œåªä¼šé¢„åŠ è½½è¿™éƒ¨åˆ†å†…å®¹ï¼Œå½“ agent åˆ¤æ–­éœ€è¦ä½¿ç”¨åˆ°çš„æ—¶å€™ï¼Œæ‰ä¼šåŠ è½½å®Œæ•´çš„ <code>SKILL.md</code> ã€‚
</p>

<p>
å¦‚æœè¯´ MCP æ˜¯é€šç”¨å·¥å…·ï¼Œé‚£ä¹ˆ SKILL å°±æ˜¯å¯ä»¥é«˜åº¦è‡ªå®šä¹‰çš„ local toolã€‚
</p>
</div>
</div>
<div id="outline-container-orgb62e01b" class="outline-3">
<h3 id="orgb62e01b">ç¼–å†™ SKILL æ˜¯åœ¨å¹²ä»€ä¹ˆ</h3>
<div class="outline-text-3" id="text-orgb62e01b">
<p>
å½“é‡åˆ°ä¸€ç§ç±»å‹çš„é—®é¢˜æ—¶ï¼ŒæŠŠå¤„ç†å®ƒä»¬çš„æ–¹å¼è§„èŒƒæ€§çš„å›ºå®šä¸‹æ¥ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª SKILL äº†ã€‚
</p>

<p>
èƒ½å¤ŸæŠŠè¿™ä¸ªé—®é¢˜ä»¥åŠè§£å†³é—®é¢˜çš„åŠæ³•å®Œæ•´çš„æŠ½è±¡æˆä¸€ä¸ª SKILLï¼Œä¹Ÿå˜ç›¸çš„è¯´æ˜äº†è‡ªå·±å·²ç»æŒæ¡äº†ä¸€ç§å¤„ç†é—®é¢˜çš„æ–¹æ³•ã€‚
</p>

<p>
æ‰€ä»¥ï¼Œæˆ‘è™½ç„¶ä¸å–œæ¬¢ vibe codingï¼Œä½†æ˜¯å¾ˆå–œæ¬¢çœ‹ SKILLã€‚
</p>

<p>
ä¸€ä¸ªå¥½çš„ SKILL é‡Œï¼Œå¯ä»¥çœ‹åˆ°ä¼˜ç§€å·¥ç¨‹å¸ˆå¯¹é—®é¢˜å¤„ç†ã€æŠ½è±¡çš„èƒ½åŠ›ã€‚æ›´ä¸ç”¨è¯´é‡Œé¢æ¶µç›–äº† prompt æç¤ºè¯å·¥ç¨‹å‘å±•åˆ°ç°åœ¨çš„ç»éªŒå’ŒæŠ€å·§ï¼Œè¿™ä¹ˆå¥½çš„å­¦ä¹ èµ„æºï¼Œåœ¨ä»¥å¾€æ˜¯ä»˜è´¹éƒ½å¾ˆéš¾çœ‹åˆ°çš„ã€‚
</p>

<p>
å¤§å‚æ”¾å‡ºæ¥çš„å®˜æ–¹ SKILL é‚£éƒ½æ˜¯é—¨é¢å•Šï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šå¹²è´§çš„ã€‚
</p>
</div>
</div>
</div>
<div id="outline-container-org684c210" class="outline-2">
<h2 id="org684c210">My Agent Conf</h2>
<div class="outline-text-2" id="text-org684c210">
<p>
ä¸‹é¢çš„æ¯ä¸ªæ ‡é¢˜å°±æ˜¯æˆ‘è§‰å¾—åœ¨å’Œ agent åˆä½œçš„æ—¶å€™æ¯”è¾ƒå€¼å¾—å…³æ³¨çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯æˆ‘ç°é˜¶æ®µç†è§£åˆ°çš„ä¸€äº›å®è·µåŸåˆ™ã€‚
</p>

<p>
ä» Claude Code è½¬åˆ° OpenCodeï¼Œæ„Ÿè§‰ä¸€åˆ‡è‰¯å¥½ã€‚
</p>

<p>
æˆ‘ä¸æ˜¯ç¨‹åºå‘˜ï¼Œä¹Ÿä¸éœ€è¦é«˜è´¨é‡çš„ä»£ç ã€‚æˆ‘æ›´å–œæ¬¢ OpenCode çš„ä¸€äº›è®¾è®¡ç†å¿µï¼ŒClaude Code é™åˆ¶å¤ªå¤šï¼Œä¹Ÿå…¬å¼€è¡¨ç¤ºä¸è®©æˆ‘ä»¬ç”¨ï¼Œé‚£å°±ä¸ç”¨å¥½äº†ã€‚
</p>

<p>
åœ¨ OpenCode é‡Œ vibe ä¸€äº›å°ç©æ„è¿˜æ˜¯å¾ˆå¤Ÿç”¨çš„ã€‚
</p>

<p>
æˆ‘è™½ç„¶ä¸å–œæ¬¢ vibeï¼Œä½†æ˜¯éœ€è¦å®ç°ä¸€äº›åŸå‹å‡è®¾çš„æ—¶å€™ï¼Œvibe è¿˜æ˜¯æå¥½çš„ã€‚
</p>

<p>
å†ä¸€ä¸ªï¼Œä¸äº†è§£ vibe åˆæ€ä¹ˆèƒ½è¯´è‡ªå·±ä¸å–œæ¬¢å‘¢ï¼Ÿ
</p>
</div>
<div id="outline-container-orgac58cac" class="outline-3">
<h3 id="orgac58cac">Core Rules</h3>
<div class="outline-text-3" id="text-orgac58cac">
<p>
Just files and loops!
</p>

<p>
Provide specific <code>Best Practices</code>, <code>Pros &amp; Cons</code>, <code>Red Flags</code>
</p>

<p>
Keep it simple!
</p>
</div>
</div>
<div id="outline-container-org7a49b3d" class="outline-3">
<h3 id="org7a49b3d">Maintain a hierarchical codebase map</h3>
<div class="outline-text-3" id="text-org7a49b3d">
<blockquote>
<p>
Your best engineers donâ€™t grep randomly. They have a mental map:
</p>
<ul class="org-ul">
<li>What each folder owns</li>
<li>What breaks if you touch it wrong</li>
<li>Where the real logic lives</li>
</ul>

<p>
via: <a href="https://www.railly.dev/blog/intent-layer/">https://www.railly.dev/blog/intent-layer/</a>
</p>
</blockquote>

<p>
SKILL: intent-layer <a href="https://github.com/crafter-station/skills">https://github.com/crafter-station/skills</a>
</p>

<p>
å¦‚æœæ¯æ¬¡æ–°çš„ session éƒ½è®© agent æ¢ç´¢ä¸€æ¬¡é¡¹ç›®ä»£ç ï¼Œåˆä¸æ–¹ä¾¿ï¼Œåˆæµªè´¹æ—¶é—´ã€‚
</p>

<p>
ç»™é¡¹ç›®ä»£ç æä¾›ä¸€ä¸ªæŒç»­æ›´æ–°çš„ codebase map è¿˜æ˜¯å¾ˆå¿…è¦çš„ã€‚
</p>

<p>
è¿™è®© agent åœ¨æ¯æ¬¡å¯¹è¯çš„æ—¶å€™åœ¨ context é‡ŒåŒ…å«é¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯å’Œæ¶æ„ã€‚
</p>

<p>
also: <a href="https://github.com/affaan-m/everything-claude-code/blob/main/commands/update-codemaps.md">https://github.com/affaan-m/everything-claude-code/blob/main/commands/update-codemaps.md</a>
</p>
</div>
</div>
<div id="outline-container-orgca79ffb" class="outline-3">
<h3 id="orgca79ffb">Prepared with clear purpose</h3>
<div class="outline-text-3" id="text-orgca79ffb">
<p>
SKILL: Onboard <a href="https://github.com/ChrisWiles/claude-code-showcase/blob/main/.claude/commands/onboard.md">https://github.com/ChrisWiles/claude-code-showcase/blob/main/.claude/commands/onboard.md</a>
</p>

<p>
åœ¨å¼€å§‹å…·ä½“çš„ä»»åŠ¡ä¹‹å‰ï¼Œç»™äºˆ agent æ˜ç¡®çš„ç›®æ ‡ä»¥åŠè¦æ¶‰åŠåˆ°çš„å…·ä½“æ–‡ä»¶ã€‚
</p>

<p>
æ˜ç¡®æ¸…æ™°çš„æè¿°è‡ªå·±çš„éœ€æ±‚éå¸¸é‡è¦ã€‚DO and DONOT.
</p>

<p>
å¯¹äºå¤§éƒ¨åˆ†æ¨¡å‹ï¼Œè‹±æ–‡ prompt æ•ˆæœæ¯”ä¸­æ–‡å¥½ã€‚
</p>
</div>
</div>
<div id="outline-container-org65e621d" class="outline-3">
<h3 id="org65e621d">Just files and loops, no more complicated</h3>
<div class="outline-text-3" id="text-org65e621d">
<p>
SKILL: Planning with Files <a href="https://github.com/OthmanAdi/planning-with-files">https://github.com/OthmanAdi/planning-with-files</a>
</p>

<p>
åœ¨ agent æ‰§è¡Œå…·ä½“ä»»åŠ¡çš„æ—¶å€™ï¼Œplanning with files è¿™ä¸ªæ¡†æ¶çš„è®¾è®¡å¾ˆå€¼å¾—å­¦ä¹ ã€‚
</p>

<p>
å®ƒç”¨ä¸‰ä¸ªæ–‡ä»¶è®°å½•å’Œè§„åˆ’ agent çš„ task planï¼Œéå¸¸ç®€æ´ï¼Œæ•ˆæœæ‹”ç¾¤ã€‚
</p>

<p>
ç»“åˆæˆ‘åœ¨ opencode é‡Œçš„ä½¿ç”¨ï¼Œæˆ‘åŠ ä¸Šäº† memory éƒ¨åˆ†ï¼š
</p>

<div class="org-src-container">
<pre class="src src-nil">1. Use the `session-info` tool to retrieve the current conversation's [session-title]
2. Run `date +%Y%m%d-%H%M%S` command to get the [YYYYMMDD-HHMMSS timestamp]
   Create the `session folder`: `mkdir -p $HOME/.MemoryMD/$(basename $(git rev-parse --show-toplevel))/[YYYYMMDD-HHMMSS timestamp]-[session-title]`
3. All generated markdown files should be created in that `session folder`.
</pre>
</div>

<p>
æ²¡æœ‰é€‰æ‹©åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºæ˜¯ä¸ºäº†å¤šä¸ª session å’Œ git-worktree å¹¶è¡Œåœºæ™¯ä¸‹ï¼Œæ–¹ä¾¿å…±äº«ã€‚
</p>

<p>
session-info æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„ toolï¼Œåœ¨ OpenCode é‡Œç”¨æ¥è·å–å½“å‰ session ä¿¡æ¯ï¼Œç”Ÿæˆä¸Šé¢æåˆ°çš„æ–‡ä»¶å¤¹ï¼š
</p>

<p>
<code>tools/session-info.ts</code> :
</p>

<div class="org-src-container">
<pre class="src src-js"><span style="color: #FFA657;">import</span> <span style="color: #8c8c8c;">{</span> tool <span style="color: #8c8c8c;">}</span> from <span style="color: #A1D08E;">"@opencode-ai/plugin"</span>
<span style="color: #FFA657;">import</span> <span style="color: #8c8c8c;">{</span> execSync <span style="color: #8c8c8c;">}</span> from <span style="color: #A1D08E;">"child_process"</span>
<span style="color: #FFA657;">import</span> <span style="color: #8c8c8c;">{</span> homedir <span style="color: #8c8c8c;">}</span> from <span style="color: #A1D08E;">"os"</span>

<span style="color: #FFA657;">export</span> <span style="color: #FFA657;">default</span> tool<span style="color: #8c8c8c;">(</span><span style="color: #93a8c6;">{</span>
  description: <span style="color: #A1D08E;">"Get current session information including title"</span>,
  args: <span style="color: #b0b1a3;">{}</span>,
  <span style="color: #FFA657;">async</span> execute<span style="color: #b0b1a3;">(</span>args, context<span style="color: #b0b1a3;">)</span> <span style="color: #b0b1a3;">{</span>
    <span style="color: #FFA657;">const</span> <span style="color: #97b098;">{</span> sessionID, agent <span style="color: #97b098;">}</span> = context

    <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">sessionDir</span> = <span style="color: #A1D08E;">`${homedir()}/.local/share/opencode/storage/session`</span>

    <span style="color: #FFA657;">try</span> <span style="color: #97b098;">{</span>
      <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">result</span> = execSync<span style="color: #aebed8;">(</span><span style="color: #A1D08E;">`find ${sessionDir} -name "${sessionID}.json" 2&gt;/dev/null | head -1`</span>, <span style="color: #b0b0b3;">{</span> encoding: <span style="color: #A1D08E;">"utf-8"</span> <span style="color: #b0b0b3;">}</span><span style="color: #aebed8;">)</span>

      <span style="color: #FFA657;">if</span> <span style="color: #aebed8;">(</span>!result.trim<span style="color: #b0b0b3;">()</span><span style="color: #aebed8;">)</span> <span style="color: #aebed8;">{</span>
        <span style="color: #FFA657;">throw</span> <span style="color: #FFA657;">new</span> <span style="color: #95a99f;">Error</span><span style="color: #b0b0b3;">(</span><span style="color: #A1D08E;">"Session file not found"</span><span style="color: #b0b0b3;">)</span>
      <span style="color: #aebed8;">}</span>

      <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">sessionFile</span> = result.trim<span style="color: #aebed8;">()</span>
      <span style="color: #FFA657;">const</span> <span style="color: #f4f4ff;">sessionData</span> = JSON.parse<span style="color: #aebed8;">(</span>require<span style="color: #b0b0b3;">(</span><span style="color: #A1D08E;">"fs"</span><span style="color: #b0b0b3;">)</span>.readFileSync<span style="color: #b0b0b3;">(</span>sessionFile, <span style="color: #A1D08E;">"utf-8"</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span>

      <span style="color: #FFA657;">return</span> JSON.stringify<span style="color: #aebed8;">(</span><span style="color: #b0b0b3;">{</span>
        sessionID,
        agent,
        title: sessionData.title || <span style="color: #95a99f;">null</span>,
        directory: sessionData.directory || <span style="color: #95a99f;">null</span>,
        time: sessionData.time || <span style="color: #95a99f;">null</span>,
      <span style="color: #b0b0b3;">}</span>, <span style="color: #95a99f;">null</span>, 2<span style="color: #aebed8;">)</span>
    <span style="color: #97b098;">}</span> <span style="color: #FFA657;">catch</span> <span style="color: #97b098;">(</span>error<span style="color: #97b098;">)</span> <span style="color: #97b098;">{</span>
      <span style="color: #FFA657;">return</span> JSON.stringify<span style="color: #aebed8;">(</span><span style="color: #b0b0b3;">{</span> error: error.message, sessionID, agent <span style="color: #b0b0b3;">}</span>, <span style="color: #95a99f;">null</span>, 2<span style="color: #aebed8;">)</span>
    <span style="color: #97b098;">}</span>
  <span style="color: #b0b1a3;">}</span>,
<span style="color: #93a8c6;">}</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orge63837e" class="outline-3">
<h3 id="orge63837e">Handoff when stucked</h3>
<div class="outline-text-3" id="text-orge63837e">
<p>
SKILL: handoff <a href="https://github.com/mitsuhiko/agent-stuff/blob/main/commands/handoff.md">https://github.com/mitsuhiko/agent-stuff/blob/main/commands/handoff.md</a>
</p>

<p>
æœ‰æ—¶å€™ agent ä¼šå¡ä½ï¼Œé™·å…¥æ­»å¾ªç¯ï¼Œæœæ–­ handoff é‡å¼€ï¼Œä¸ç”¨æµªè´¹æ—¶é—´ã€‚
</p>
</div>
</div>
<div id="outline-container-org36659af" class="outline-3">
<h3 id="org36659af">Maintain memory</h3>
<div class="outline-text-3" id="text-org36659af">
<p>
æˆ‘æŠŠ planning-with-files çš„æ–‡æ¡£å’Œ Handoff çš„æ–‡æ¡£å½“ä½œé¡¹ç›®çš„ memoryï¼Œè®¾è®¡äº†ä¸€ä¸ªç®€å•çš„ SKILL æ¥æ ¹æ®å…³é”®å­—æœç´¢ï¼š
</p>

<p>
ç°åœ¨æœ‰è®¸å¤šé’ˆå¯¹ agent çš„ memory é¡¹ç›®ï¼Œä½†æ˜¯æˆ‘æ„Ÿè§‰è¿™ä¸ªæ¦‚å¿µæœ¬èº«ä¹Ÿæ‰åˆšå‡ºæ¥ï¼Œä»Šå¹´åº”è¯¥æœ‰æ›´æˆç†Ÿçš„å®ç°ã€‚
</p>

<p>
æš‚æ—¶å°±ç”¨è¿™ä¸ªç®€å•æ–¹æ¡ˆè¿‡æ¸¡ä¸€ä¸‹ã€‚
</p>

<div class="org-src-container">
<pre class="src src-nil">---
name: memory-md
description: Memory management system for storing and retrieving conversation history and context.When user ask anything about project's memory, automatically use this skill.
---

Memory management system for storing and retrieving conversation history and context.


## Parse guide

Parse [quest] as follows:

1. **List command**: If [quest] starts with `-l` or `--list`
   - List recent memory files

2. **Search command**: If [quest] starts with `-s` or `--search`
   - All remaining arguments are search keywords (comma-separated or space-separated)
   - Example: `-s apple,banana` or `-s apple banana` â†’ keywords: ["apple", "banana"]

3. **Default search**: If no flags provided, treat entire [quest] as search keywords
   - Example: `authentication jwt` â†’ keywords: ["authentication", "jwt"]

4. **No results**: If no keywords provided in [quest] after parsing
   - Ask user: "What keywords are you searching for?"

## Memory File Location

Memory files are stored in `$HOME/.MemoryMD/` with the following structure:

```
$HOME/.MemoryMD/
â”œâ”€â”€ [project-name]/                     # Project folders
â”‚   â”œâ”€â”€ YYYYMMDD-HHMMSS-[session-title]/  # Session folders
â”‚   â”‚   â”œâ”€â”€ task_plan.md                # Task planning document
â”‚   â”‚   â”œâ”€â”€ findings.md                 # Research findings
â”‚   â”‚   â””â”€â”€ progress.md                 # Progress tracking
â””â”€â”€ handoffs/                           # Handoff summaries
    â””â”€â”€ YYYYMMDD-HHMMSS-[slug].md      # Session handoff files
```

Examples:
- `agent-conf/20250120-143025-implement-auth/` - Session folder
- `handoffs/20250120-143025-fix-issue-42.md` - Handoff file

## Commands

### --list or -l

List the 20 most recent memory folders/files, sorted by timestamp (newest first).

**Bash command:**
```bash
memory_dir="$HOME/.MemoryMD"

# List session folders grouped by project (sorted newest first)
find "$memory_dir" -maxdepth 2 -type d -name "????????-??????-*" | sort -r | head -20 | awk -F/ '{
    project = $(NF-1)
    foldername = $NF
    timestamp = substr(foldername, 1, 15)
    title = substr(foldername, 17)
    if (project != prev_project) {
        if (prev_project != "") print ""
        print "**" project "**"
        prev_project = project
    }
    print "  [" timestamp "] " title
}'

# List handoff files (sorted newest first)
echo ""
echo "Recent handoffs:"
find "$memory_dir/handoffs" -maxdepth 1 -type f -name "*.md" | sort -r | head -20 | while read file; do
    filename=$(basename "$file")
    title=${filename#*-}
    title=${title%.md}
    echo "$title - $filename"
done
```

**Output format:**
```
**agent-conf:**
  [20250120-143025] implement-auth
  [20250119-091530] fix-issue-42

**another-project:**
  [20250118-1530] api-handler

Recent handoffs:
  fix-issue-42 - 20250120-143025-fix-issue-42.md
  implement-auth - 20250119-091530-implement-auth.md
```

### --search or -s

Search memory files for keywords in both Chinese and English.

Use your Glob and Grep tools first.

First perform exact keyword search. If no results found, search for related similar keywords.

If still no results after all searches, ask user: "What keywords are you searching for?"

**Output Examples:**

```md
Search query: [keywords]

## Found in: agent-conf/20250120-143025-implement-auth/task_plan.md
[summary of your findings]

## Found in: agent-conf/20250120-143025-implement-auth/findings.md
[summary of your findings]
```

Bash commands below serve as auxiliary reference:

**Bash command:**
```bash
memory_dir="$HOME/.MemoryMD"

# Search for keywords in all markdown files
rg -i -t md "$keywords" "$memory_dir" --follow

# Alternative: Search with context (2 lines before and after matches)
rg -i -C 2 -t md "$keywords" "$memory_dir" --follow
```

**Options:**
- `-i`: Case-insensitive search
- `-C N`: Show N lines of context before and after matches
- `-t md`: Search only markdown files
- `--follow`: Follow symbolic links
</pre>
</div>
</div>
</div>
<div id="outline-container-orga5abcad" class="outline-3">
<h3 id="orga5abcad">Maintain useful patterns</h3>
<div class="outline-text-3" id="text-orga5abcad">
<p>
SKILL: <a href="https://github.com/affaan-m/everything-claude-code/blob/main/commands/learn.md">https://github.com/affaan-m/everything-claude-code/blob/main/commands/learn.md</a>
</p>

<p>
åœ¨è§£å†³å®é™…çš„ä»£ç é—®é¢˜çš„æ—¶å€™ï¼Œæœ‰è®¸å¤šæ–¹æ¡ˆæ˜¯å¯ä»¥å›ºå®šä¸‹æ¥å¤ç”¨çš„ã€‚
</p>

<p>
æ ¹æ®è¿™ä¸ª SKILLï¼Œæˆ‘è®¾è®¡äº†ä¸€ä¸ª learned skillã€‚è¿™ä¸ª SKILL å®é™…ä¸Šæ˜¯ä¸€ä¸ªç´¢å¼•ï¼Œåœ¨ description éƒ¨åˆ†åŠ ä¸Š learned çš„æè¿°ä¿¡æ¯ã€‚
</p>

<p>
learn skill ä¼šæ ¹æ®å½“å‰ä¼šè¯çš„ session å›ºå®šä¸‹æ¥æœ‰ä»·å€¼çš„ patternï¼Œç”Ÿæˆ skillï¼Œè‡ªåŠ¨æ·»åŠ åˆ° learned skill çš„ description éƒ¨åˆ†ï¼Œè¿™æ · agent åœ¨åŠ è½½çš„æ—¶å€™å°±å¯ä»¥çŸ¥é“æœ‰å“ªäº› learned skill äº†ã€‚
</p>

<p>
ä¸é€‰æ‹©æŠŠ learned skill ç”Ÿæˆå•ç‹¬çš„ skill æ–‡ä»¶å¤¹æ˜¯å› ä¸ºå®ƒä»¬çš„æ™®éæ€§ä¸å¼ºï¼Œä¹Ÿç»å¸¸è¦æ›´æ–°å’Œä¿®æ”¹ï¼Œä¸èƒ½å®Œå…¨å½“ä½œ SKILL æ¥è®¾è®¡ã€‚
</p>

<p>
Learn skillï¼š
</p>

<div class="org-src-container">
<pre class="src src-nil">---
name: learn
description: &gt;
  Extract reusable patterns from sessions and create dynamic skills. Use when you need to save learned patterns, error resolutions, debugging techniques, or project-specific knowledge to ~/.config/opencode/skill/learned/.
  Trigger, User asks to extract learning, save patterns, or run /learn command.
  All learned skills in `~/.config/opencode/skill/learned/` are automatically discoverable
  `~/.config/opencode/skill/learned/SKILL.md` is the index off all learned skills
---

# Learn Skill

Dynamically extract and store reusable patterns as skills.

## Quick Start

When user wants to extract learning from current session:

1. Review session context for extractable patterns
2. Identify the most valuable/reusable insight,list them
3. Ask user for confirmation before creating skill file
4. Create `~/.config/opencode/skill/learned/[skill-name].md` - Use [templates/learned-skill-template.md](templates/learned-skill-template.md) as reference
5. Update `~/.config/opencode/skill/learned/SKILL.md` to include the new skill - Use  [templates/SKILL.md](templates/SKILL.md) as reference
6. Run `ls -1 ~/.config/opencode/skill/learned/*.md 2&gt;/dev/null | grep -v SKILL.md | wc -l`, update the total skills number.

## What to Extract

### 1. Error Resolution Patterns
- What error occurred?
- What was the root cause?
- What fixed it?
- Is this reusable for similar errors?

### 2. Debugging Techniques
- Non-obvious debugging steps
- Tool combinations that worked
- Diagnostic patterns

### 3. Workarounds
- Library quirks
- API limitations
- Version-specific fixes

### 4. Project-Specific Patterns
- Codebase conventions discovered
- Architecture decisions made
- Integration patterns

## Quality Guidelines

### DO Extract:
- Error patterns that occur more than once
- Non-obvious debugging techniques
- Workarounds for library quirks
- Architecture decisions and their rationale
- Integration patterns across services/tools

### DO NOT Extract:
- Trivial fixes (typos, simple syntax errors)
- One-time issues (specific API outages, temporary glitches)
- Obvious solutions (standard library usage without special context)
- Information already well-documented elsewhere

### Tips for Quality Skills
1. **Be Specific**: Narrow trigger conditions = better matching
2. **Include Examples**: Code snippets make patterns actionable
3. **Document Why**: Explain the problem, not just the solution
4. **Keep Focused**: One pattern per skill
5. **Use Descriptive Names**: Names should indicate what the skill solves


## Skill File Format

### Individual Skill Files

Use the template file [templates/learned-skill-template.md](templates/learned-skill-template.md) as the base for all learned skills.

Key sections:
- **Frontmatter**: name and description (critical for skill discovery)
- **Problem**: What specific issue this solves
- **Solution**: Actionable steps to implement
- **Example**: Code snippet if applicable
- **When to Use**: Trigger conditions for activation
- **Related Patterns**: Cross-references to other skills

### SKILL.md

Use the template file [templates/SKILL.md](templates/SKILL.md) as the base for maintaining the learned skills index.

Purpose:
- Provides a categorized listing of all learned skills
- Enables easy browsing and discovery of patterns
- Tracks skill count and update timestamp

Update SKILL.md whenever saving a new skill.

## Extraction Process

### Step 1: Review Session Context

Use `session-info` tool to get session details if needed.

Use `memory-md` skill to find relevant memories.

Look for:
- Repeated error fixes
- Non-obvious solutions
- Workarounds discovered
- Best practices learned

### Step 2: Identify Pattern

Ask yourself:
- Is this reusable? (Will save time in future sessions)
- Is this non-trivial? (Not typos or simple syntax errors)
- Is this generalizable? (Not one-time issues)

Prioritize patterns that:
- Solve common problems
- Apply across multiple projects
- Document non-obvious solutions

### Step 3: Draft Skill

Use the skill file format above.

**Naming Convention:**
- Use kebab-case for skill names
- Make names descriptive but concise
- Example: `async-error-handling-pattern`, `docker-volume-permission-fix`

**Frontmatter:**
```yaml
---
name: [skill-name]
description: Use when [trigger conditions]. Covers [specific problem/solution].
---
```

The description is critical - it's what helps the skill system know when to load this skill.

### Step 4: Validate

Before presenting to user:
- Check that the skill has clear trigger conditions
- Ensure the solution is actionable
- Verify code examples are correct
- Confirm the pattern is truly reusable

### Step 5: Present and Save

Show the user:
1. Pattern name
2. Brief description of what was extracted
3. Why it's valuable

Ask: "Save this pattern to learned skills? (y/n)"

If yes, save to `~/.config/opencode/skill/learned/[skill-name].md`

### Step 6: Update `learned/SKILL.md`

1. Update the description of the new learned skill.Append this part: [name of learned skill 1] - [description of learned skill 1]

example YAML of `learned/SKILL.md`:

```md
---
name: learned
description: &gt;
  learned skill is a collection of learned skill user create.It's a index of all learned skills.
  We have these learned skill below:
  [name of learned skill 1] - [description of learned skill 1]
  [name of learned skill 1] - [description of learned skill 2]
---
```

2. Update the new skill to the index section.

## Common Use Cases

### User runs /learn command
```
User: /learn
```
1. Review session for extractable patterns
2. Present candidate patterns to user
3. Ask which to save
4. Save selected patterns

### User asks to extract specific topic
```
User: Extract what we learned about async error handling
```
1. Search session context for async/error patterns
2. Compile findings
3. Generate skill file
4. Present and save

### User wants to capture architecture decision
```
User: Save the event sourcing pattern we used
```
1. Extract the pattern details
2. Document rationale and trade-offs
3. Create skill with example code
4. Present and save

## Integration with Other Skills

This skill works well with:
- **memory-md**: For accessing related patterns from past sessions
- **skill-creator**: For creating more complex, bundled skills
</pre>
</div>

<p>
Learnd skillï¼š
</p>

<div class="org-src-container">
<pre class="src src-nil">---
name: learned
description: &gt;
  learned skill is a collection of learned skill user create.It's a index of all learned skills.
  We have these learned skill below:
  [name of learned skill 1] - [description of learned skill 1]
  [name of learned skill 1] - [description of learned skill 2]
---

# Learned Skills Index

You can read the skill file to load the skill you need.

Treat these skill file below as `learned skill`'s references.

## Error Patterns
- [skill-1.md](skill-1.md)
- [skill-2.md](skill-2.md)

## Debugging Techniques
- [skill-3.md](skill-3.md)

## Workarounds
- [skill-4.md](skill-4.md)

## Project-Specific
- [skill-5.md](skill-5.md)

# Statistics
Total skills: [count]
Last updated: [date]
</pre>
</div>
</div>
</div>
<div id="outline-container-org3565d34" class="outline-3">
<h3 id="org3565d34">Maintain code quality and style</h3>
<div class="outline-text-3" id="text-org3565d34">
<p>
SKILL: code-simplifier: <a href="https://github.com/anthropics/claude-plugins-official/blob/main/plugins/code-simplifier/agents/code-simplifier.md">https://github.com/anthropics/claude-plugins-official/blob/main/plugins/code-simplifier/agents/code-simplifier.md</a>
</p>

<p>
LLM åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™ï¼Œç‰¹åˆ«æ˜¯å¤§é‡ä»£ç ï¼Œå¤æ‚ä»£ç çš„æ—¶å€™ï¼Œå¾ˆå®¹æ˜“çŠ¯ç—…ï¼Œç¼–å†™é‡å¤æ€§çš„ä»£ç ï¼Œè¿™æ˜¯å› ä¸ºä¸Šä¸‹æ–‡å¤šäº†ï¼Œå‡†ç¡®æ€§ä¸‹é™ã€‚
</p>

<p>
åœ¨æ¯æ¬¡ agent å†™å®Œä»£ç ä¹‹åè¿›è¡Œä»£ç å®¡æŸ¥å’Œä»£ç ä¼˜åŒ–ã€‚
</p>

<p>
åœ¨ prompt ä¸Šï¼Œäº²æµ‹åŠ ä¸Šï¼šè¿™æ˜¯åˆ«äººçš„ä»£ç ï¼Œæ•ˆæœä¼šæ›´å¥½ğŸ¤£ã€‚LLM æ‹é©¬å±çš„æ¦‚ç‡å¤§å¹…ä¸‹é™ã€‚
</p>
</div>
</div>
</div>
<div id="outline-container-orgc2d61a3" class="outline-2">
<h2 id="orgc2d61a3">OpenCode in Emacs</h2>
<div class="outline-text-2" id="text-orgc2d61a3">
<p>
åœ¨ Emacs é‡Œç°åœ¨å’Œ OpenCode äº¤äº’æœ€æ–¹ä¾¿çš„å°±æ˜¯ <a href="https://github.com/xenodium/agent-shell">agent-shell</a> äº†ã€‚
</p>

<p>
åœ¨ç»ˆç«¯é‡Œç”¨ OpenCode æœ€ä¸æ–¹ä¾¿çš„å°±æ˜¯ä¸èƒ½ç›´æ¥é€‰æ‹©æ–‡æœ¬ï¼Œagent-shell è§£å†³äº†è¿™ä¸ªé—®é¢˜:
</p>

<p>
<code>agent-shell-send-dwim</code> ã€ <code>agent-shell-send-file</code> ã€ <code>agent-shell-send-region</code> ã€ <code>agent-shell-insert-file</code> è¿™å‡ ä¸ªåŸç”Ÿçš„æŒ‡ä»¤é…ç½®å¥½å¿«æ·é”®å°± OK äº†ã€‚
</p>

<p>
slash command é€šè¿‡ Emacs çš„è‡ªåŠ¨è¡¥å…¨ï¼ŒåŸºæœ¬æ˜¯æ— æ„Ÿåˆ‡æ¢ã€‚
</p>

<p>
ä¸è¶³çš„åœ°æ–¹å°±æ˜¯ï¼Œagent-shell ä¸ä¼šåˆ—å‡º OpenCode çš„ subagentã€‚
</p>

<p>
æ‰€ä»¥æˆ‘åŠ äº†ä¸€äº›è¡¥ä¸æ¥æ˜¾ç¤º subagentï¼š
</p>

<div class="org-src-container">
<pre class="src src-elisp"><span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">use-package</span> agent-shell
  <span style="color: #79C0FF;">:after</span> evil
  <span style="color: #79C0FF;">:config</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">setq</span> agent-shell-opencode-authentication
        <span style="color: #b0b1a3;">(</span>agent-shell-opencode-make-authentication <span style="color: #79C0FF;">:none</span> t<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>
  <span style="color: #787878;">;; </span><span style="color: #787878;">disable creating transcript file
</span>  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">setq</span> agent-shell-transcript-file-path-function nil<span style="color: #93a8c6;">)</span>

  <span style="color: #787878;">;; </span><span style="color: #787878;">Evil state-specific RET behavior: insert mode = newline, normal mode = send
</span>  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">evil-define-key</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">insert</span> agent-shell-mode-map <span style="color: #b0b1a3;">(</span>kbd <span style="color: #A1D08E;">"RET"</span><span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">#'</span><span style="color: #95a99f;">newline</span><span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">evil-define-key</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">normal</span> agent-shell-mode-map <span style="color: #b0b1a3;">(</span>kbd <span style="color: #A1D08E;">"RET"</span><span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">#'</span><span style="color: #95a99f;">comint-send-input</span><span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">evil-define-key</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">normal</span> agent-shell-mode-map <span style="color: #b0b1a3;">(</span>kbd <span style="color: #A1D08E;">"@"</span><span style="color: #b0b1a3;">)</span> <span style="color: #FFA657;">#'</span><span style="color: #95a99f;">agent-shell-set-session-mode</span><span style="color: #93a8c6;">)</span>

  <span style="color: #787878;">;; </span><span style="color: #787878;">Configure *agent-shell-diff* buffers to start in Emacs state
</span>  <span style="color: #93a8c6;">(</span>add-hook <span style="color: #FFA657;">'</span><span style="color: #95a99f;">diff-mode-hook</span>
            <span style="color: #b0b1a3;">(</span><span style="color: #FFA657;">lambda</span> <span style="color: #97b098;">()</span>
              <span style="color: #97b098;">(</span><span style="color: #FFA657;">when</span> <span style="color: #aebed8;">(</span>string-match-p <span style="color: #A1D08E;">"</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E;">*agent-shell-diff</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E;">*"</span> <span style="color: #b0b0b3;">(</span>buffer-name<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span>
                <span style="color: #aebed8;">(</span>evil-emacs-state<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #787878;">;; </span><span style="color: #787878;">Show subagents in available modes
</span><span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">defun</span> <span style="color: #96a6c8;">agent-shell-opencode--get-subagent-description</span> <span style="color: #93a8c6;">(</span>agent-name<span style="color: #93a8c6;">)</span>
  <span style="color: #787878;">"Get description for subagent AGENT-NAME from its config file."</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">let*</span> <span style="color: #b0b1a3;">(</span><span style="color: #97b098;">(</span>config-file <span style="color: #aebed8;">(</span>expand-file-name <span style="color: #b0b0b3;">(</span>format <span style="color: #A1D08E;">"%s.md"</span> agent-name<span style="color: #b0b0b3;">)</span> <span style="color: #A1D08E;">"~/.config/opencode/agents/"</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
         <span style="color: #97b098;">(</span>description
          <span style="color: #aebed8;">(</span><span style="color: #FFA657;">when</span> <span style="color: #b0b0b3;">(</span>file-exists-p config-file<span style="color: #b0b0b3;">)</span>
            <span style="color: #b0b0b3;">(</span><span style="color: #FFA657;">with-temp-buffer</span>
              <span style="color: #90a890;">(</span>insert-file-contents config-file<span style="color: #90a890;">)</span>
              <span style="color: #90a890;">(</span>goto-char <span style="color: #a2b6da;">(</span>point-min<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>
              <span style="color: #90a890;">(</span><span style="color: #FFA657;">when</span> <span style="color: #a2b6da;">(</span>re-search-forward <span style="color: #A1D08E;">"^description: </span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">(</span><span style="color: #A1D08E;">.*</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">)</span><span style="color: #A1D08E;">$"</span> nil t<span style="color: #a2b6da;">)</span>
                <span style="color: #a2b6da;">(</span>match-string 1<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #FFA657;">or</span> description <span style="color: #A1D08E;">"Subagent"</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">defun</span> <span style="color: #96a6c8;">agent-shell-opencode--list-subagents</span> <span style="color: #93a8c6;">()</span>
  <span style="color: #787878;">"List all subagents using opencode agent list command.
 Returns list of agent alists with :id, :name, :description."</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">let*</span> <span style="color: #b0b1a3;">(</span><span style="color: #97b098;">(</span>output <span style="color: #aebed8;">(</span>shell-command-to-string <span style="color: #A1D08E;">"opencode agent list"</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
         <span style="color: #97b098;">(</span>lines <span style="color: #aebed8;">(</span>split-string output <span style="color: #A1D08E;">"</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">n</span><span style="color: #A1D08E;">"</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
         agents<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #FFA657;">dolist</span> <span style="color: #97b098;">(</span>line lines<span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span><span style="color: #FFA657;">when</span> <span style="color: #aebed8;">(</span>string-match <span style="color: #A1D08E;">"^</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">(</span><span style="color: #A1D08E;">[</span><span style="color: #A1D08E;">^</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">s</span><span style="color: #A1D08E;">]+</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">\</span><span style="color: #A1D08E; font-weight: bold;">)</span><span style="color: #A1D08E;"> (subagent)$"</span> line<span style="color: #aebed8;">)</span>
        <span style="color: #aebed8;">(</span><span style="color: #FFA657;">let*</span> <span style="color: #b0b0b3;">(</span><span style="color: #90a890;">(</span>name <span style="color: #a2b6da;">(</span>match-string 1 line<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>
               <span style="color: #90a890;">(</span>id name<span style="color: #90a890;">)</span>
               <span style="color: #90a890;">(</span>description <span style="color: #a2b6da;">(</span>agent-shell-opencode--get-subagent-description name<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span>
          <span style="color: #b0b0b3;">(</span><span style="color: #FFA657;">push</span> <span style="color: #FFA657;">`</span><span style="color: #90a890;">(</span><span style="color: #a2b6da;">(</span><span style="color: #79C0FF;">:id</span> . ,id<span style="color: #a2b6da;">)</span>
                  <span style="color: #a2b6da;">(</span><span style="color: #79C0FF;">:name</span> . ,name<span style="color: #a2b6da;">)</span>
                  <span style="color: #a2b6da;">(</span><span style="color: #79C0FF;">:description</span> . ,description<span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>
                agents<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span>nreverse agents<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">defun</span> <span style="color: #96a6c8;">agent-shell-opencode--merge-subagents-delayed</span> <span style="color: #93a8c6;">()</span>
  <span style="color: #787878;">"Merge subagents into session modes after delay."</span>
  <span style="color: #93a8c6;">(</span>run-with-timer
   0.5 nil
   <span style="color: #b0b1a3;">(</span><span style="color: #FFA657;">lambda</span> <span style="color: #97b098;">()</span>
     <span style="color: #97b098;">(</span><span style="color: #FFA657;">when-let</span> <span style="color: #aebed8;">(</span><span style="color: #b0b0b3;">(</span>subagents <span style="color: #90a890;">(</span>agent-shell-opencode--list-subagents<span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span>
                <span style="color: #b0b0b3;">(</span><span style="color: #90a890;">(</span>&gt; <span style="color: #a2b6da;">(</span>length subagents<span style="color: #a2b6da;">)</span> 0<span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span>
       <span style="color: #aebed8;">(</span><span style="color: #FFA657;">when-let</span> <span style="color: #b0b0b3;">(</span><span style="color: #90a890;">(</span>session <span style="color: #a2b6da;">(</span>map-elt agent-shell--state <span style="color: #79C0FF;">:session</span><span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>
                  <span style="color: #90a890;">(</span>session-modes <span style="color: #a2b6da;">(</span>map-elt session <span style="color: #79C0FF;">:modes</span><span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span>
         <span style="color: #b0b0b3;">(</span><span style="color: #FFA657;">let*</span> <span style="color: #90a890;">(</span><span style="color: #a2b6da;">(</span>subagent-modes <span style="color: #9cb6ad;">(</span>mapcar <span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">lambda</span> <span style="color: #93a8c6;">(</span>a<span style="color: #93a8c6;">)</span>
                                          <span style="color: #FFA657;">`</span><span style="color: #93a8c6;">(</span><span style="color: #b0b1a3;">(</span><span style="color: #79C0FF;">:id</span> . ,<span style="color: #97b098;">(</span>map-elt a <span style="color: #79C0FF;">:id</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
                                            <span style="color: #b0b1a3;">(</span><span style="color: #79C0FF;">:name</span> . ,<span style="color: #97b098;">(</span>map-elt a <span style="color: #79C0FF;">:name</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
                                            <span style="color: #b0b1a3;">(</span><span style="color: #79C0FF;">:description</span> . ,<span style="color: #97b098;">(</span>map-elt a <span style="color: #79C0FF;">:description</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
                                        subagents<span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                <span style="color: #a2b6da;">(</span>merged-modes <span style="color: #9cb6ad;">(</span>vconcat session-modes subagent-modes<span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>
           <span style="color: #90a890;">(</span>map-put! agent-shell--state <span style="color: #79C0FF;">:session</span>
                     <span style="color: #a2b6da;">(</span>cons <span style="color: #9cb6ad;">(</span>cons <span style="color: #79C0FF;">:modes</span> merged-modes<span style="color: #9cb6ad;">)</span>
                           <span style="color: #9cb6ad;">(</span>assq-delete-all <span style="color: #79C0FF;">:modes</span> session<span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span>
           <span style="color: #90a890;">(</span><span style="color: #FFA657;">when</span> <span style="color: #a2b6da;">(</span>fboundp <span style="color: #FFA657;">'</span><span style="color: #95a99f;">agent-shell--update-fragment</span><span style="color: #a2b6da;">)</span>
             <span style="color: #a2b6da;">(</span>agent-shell--update-fragment
              <span style="color: #79C0FF;">:state</span> agent-shell--state
              <span style="color: #79C0FF;">:block-id</span> <span style="color: #A1D08E;">"available_modes"</span>
              <span style="color: #79C0FF;">:label-left</span> <span style="color: #9cb6ad;">(</span>propertize <span style="color: #A1D08E;">"Available modes"</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">font-lock-face</span> <span style="color: #FFA657;">'</span><span style="color: #95a99f;">font-lock-doc-markup-face</span><span style="color: #9cb6ad;">)</span>
              <span style="color: #79C0FF;">:body</span> <span style="color: #9cb6ad;">(</span>agent-shell--format-available-modes merged-modes<span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #FFA657;">defun</span> <span style="color: #96a6c8;">agent-shell-opencode--around-initiate-session</span> <span style="color: #93a8c6;">(</span>orig-fun <span style="color: #95a99f;">&amp;rest</span> args<span style="color: #93a8c6;">)</span>
  <span style="color: #787878;">"Around advice for agent-shell--initiate-session."</span>
  <span style="color: #93a8c6;">(</span><span style="color: #FFA657;">let*</span> <span style="color: #b0b1a3;">(</span><span style="color: #97b098;">(</span>plist args<span style="color: #97b098;">)</span>
         <span style="color: #97b098;">(</span>on-session-init <span style="color: #aebed8;">(</span>plist-get plist <span style="color: #79C0FF;">:on-session-init</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
         <span style="color: #97b098;">(</span>new-on-session-init
          <span style="color: #aebed8;">(</span><span style="color: #FFA657;">lambda</span> <span style="color: #b0b0b3;">()</span>
            <span style="color: #b0b0b3;">(</span>funcall on-session-init<span style="color: #b0b0b3;">)</span>
            <span style="color: #b0b0b3;">(</span>agent-shell-opencode--merge-subagents-delayed<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span>plist-put plist <span style="color: #79C0FF;">:on-session-init</span> new-on-session-init<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span>apply orig-fun plist<span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span>advice-add <span style="color: #FFA657;">'</span><span style="color: #95a99f;">agent-shell--initiate-session</span> <span style="color: #79C0FF;">:around</span> <span style="color: #FFA657;">#'</span><span style="color: #95a99f;">agent-shell-opencode--around-initiate-session</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org0c83527" class="outline-2">
<h2 id="org0c83527">Bubblewrap Sandbox</h2>
<div class="outline-text-2" id="text-org0c83527">
<p>
Claude å®˜æ–¹åœ¨ Linux é‡Œä¹Ÿæ˜¯ä½¿ç”¨çš„ bubblewrap ä½œä¸º sandboxï¼Œå¹¶åšäº†è®¸å¤šé’ˆå¯¹æ€§çš„ä¼˜åŒ–ã€‚
</p>

<p>
è®© LLM ç”Ÿæˆäº†ä¸€ä¸ª bash è„šæœ¬åœ¨ bubblewrap sandbox é‡Œè¿è¡Œ OpenCodeï¼š
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #787878;">#</span><span style="color: #787878;">!/bin/</span><span style="color: #FFA657;">bash</span><span style="color: #787878;">
</span><span style="color: #787878;"># </span><span style="color: #787878;">opencode bubblewrap sandbox script
</span><span style="color: #787878;"># </span><span style="color: #787878;">https://patrickmccanna.net/a-better-way-to-limit-claude-code-and-other-coding-agents-access-to-secrets/
</span><span style="color: #787878;"># </span><span style="color: #787878;">https://www.luiscardoso.dev/blog/sandboxes-for-ai
</span>
<span style="color: #79C0FF;">set</span> -euo pipefail

<span style="color: #787878;"># </span><span style="color: #787878;">Configuration
</span><span style="color: #f4f4ff;">PROJECT_DIR</span>=<span style="color: #A1D08E;">"$(</span><span style="color: #ff4f58;">pwd</span><span style="color: #A1D08E;">)"</span>
<span style="color: #f4f4ff;">OPENCODE_BIN</span>=<span style="color: #A1D08E;">"$HOME/.npm-global/bin/opencode"</span>
<span style="color: #f4f4ff;">OPENCODE_CONFIG</span>=<span style="color: #A1D08E;">"$HOME/.config/opencode"</span>
<span style="color: #f4f4ff;">NPM_BIN</span>=<span style="color: #A1D08E;">"$HOME/.npm-global"</span>

<span style="color: #787878;"># </span><span style="color: #787878;">Validate paths
</span><span style="color: #FFA657;">if</span> <span style="color: #8c8c8c;">[</span> ! -x <span style="color: #A1D08E;">"$OPENCODE_BIN"</span> <span style="color: #8c8c8c;">]</span>; <span style="color: #FFA657;">then</span>
  <span style="color: #79C0FF;">echo</span> <span style="color: #A1D08E;">"Error: opencode binary not found or not executable: $OPENCODE_BIN"</span>
  <span style="color: #FFA657;">exit</span> 1
<span style="color: #FFA657;">fi</span>

<span style="color: #787878;"># </span><span style="color: #787878;">Check if we need to allow network access (default: yes for opencode's MCP servers)
</span><span style="color: #f4f4ff;">SHARE_NET</span>=<span style="color: #A1D08E;">"--share-net"</span>

<span style="color: #787878;"># </span><span style="color: #787878;">Run opencode in bubblewrap sandbox
</span>bwrap <span style="color: #A1D08E;">\</span>
  --ro-bind /usr /usr <span style="color: #A1D08E;">\</span>
  --ro-bind /lib /lib <span style="color: #A1D08E;">\</span>
  --ro-bind /bin /bin <span style="color: #A1D08E;">\</span>
  --ro-bind /etc/resolv.conf /etc/resolv.conf <span style="color: #A1D08E;">\</span>
  --ro-bind /etc/hosts /etc/hosts <span style="color: #A1D08E;">\</span>
  --ro-bind /etc/ssl /etc/ssl <span style="color: #A1D08E;">\</span>
  --ro-bind /etc/passwd /etc/passwd <span style="color: #A1D08E;">\</span>
  --ro-bind /etc/group /etc/group <span style="color: #A1D08E;">\</span>
  --ro-bind <span style="color: #A1D08E;">"$NPM_BIN"</span> <span style="color: #A1D08E;">"$NPM_BIN"</span> <span style="color: #A1D08E;">\</span>
  $<span style="color: #8c8c8c;">(</span><span style="color: #ff4f58;">for env_file in "$PROJECT_DIR"/.env*; do </span><span style="color: #93a8c6;">[</span><span style="color: #ff4f58;"> -e "$env_file" </span><span style="color: #93a8c6;">]</span><span style="color: #ff4f58;"> &amp;&amp; echo "--ro-bind /dev/null \"$env_file\""; done</span><span style="color: #8c8c8c;">)</span> <span style="color: #A1D08E;">\</span>
  --ro-bind /dev/null <span style="color: #A1D08E;">"$HOME/.aws"</span> <span style="color: #A1D08E;">\</span>
  --ro-bind /dev/null <span style="color: #A1D08E;">"$HOME/.ssh"</span> <span style="color: #A1D08E;">\</span>
  --ro-bind /dev/null <span style="color: #A1D08E;">"$HOME/.gnupg"</span> <span style="color: #A1D08E;">\</span>
  --ro-bind /dev/null <span style="color: #A1D08E;">"$HOME/.config/gcloud"</span> <span style="color: #A1D08E;">\</span>
  --bind <span style="color: #A1D08E;">"$OPENCODE_CONFIG"</span> <span style="color: #A1D08E;">"$OPENCODE_CONFIG"</span> <span style="color: #A1D08E;">\</span>
  --bind <span style="color: #A1D08E;">"$PROJECT_DIR"</span> <span style="color: #A1D08E;">"$PROJECT_DIR"</span> <span style="color: #A1D08E;">\</span>
  --bind <span style="color: #A1D08E;">"$HOME/.npm-global/"</span> <span style="color: #A1D08E;">"$HOME/.npm-global/"</span> <span style="color: #A1D08E;">\</span>
  --bind <span style="color: #A1D08E;">"$HOME/.local/share/opencode"</span> <span style="color: #A1D08E;">"$HOME/.local/share/opencode"</span> <span style="color: #A1D08E;">\</span>
  --bind <span style="color: #A1D08E;">"$HOME/.MemoryMD/"</span> <span style="color: #A1D08E;">"$HOME/.MemoryMD/"</span> <span style="color: #A1D08E;">\</span>
  --bind <span style="color: #A1D08E;">"$HOME/.cache/opencode/"</span> <span style="color: #A1D08E;">"$HOME/.cache/opencode/"</span> <span style="color: #A1D08E;">\</span>
  --tmpfs /tmp <span style="color: #A1D08E;">\</span>
  --proc /proc <span style="color: #A1D08E;">\</span>
  --dev /dev <span style="color: #A1D08E;">\</span>
  $<span style="color: #f4f4ff;">SHARE_NET</span> <span style="color: #A1D08E;">\</span>
  --unshare-pid <span style="color: #A1D08E;">\</span>
  --unshare-ipc <span style="color: #A1D08E;">\</span>
  --unshare-uts <span style="color: #A1D08E;">\</span>
  --die-with-parent <span style="color: #A1D08E;">\</span>
  --new-session <span style="color: #A1D08E;">\</span>
  --chdir <span style="color: #A1D08E;">"$PROJECT_DIR"</span> <span style="color: #A1D08E;">\</span>
  --setenv HOME <span style="color: #A1D08E;">"$HOME"</span> <span style="color: #A1D08E;">\</span>
  --setenv USER <span style="color: #A1D08E;">"$(</span><span style="color: #ff4f58;">whoami</span><span style="color: #A1D08E;">)"</span> <span style="color: #A1D08E;">\</span>
  <span style="color: #A1D08E;">"$OPENCODE_BIN"</span> <span style="color: #A1D08E;">"$@"</span>
</pre>
</div>
</div>
</div>
<div class="taglist"><a href="https://www.vandee.art/blog/tags.html">Tags</a>: <a href="https://www.vandee.art/blog/tag-coding.html">Coding</a> </div></div>
<div id="postamble" class="status"><div id="search-results"></div>
      <footer>
         <p>
            Â© 2022-<script>document.write(new Date().getFullYear())</script> Vandee. All rights reserved.
         </p>
        <div class="social-links"></div>
      </footer>

      <a href="#top" aria-label="go to top" title="Go to Top (Alt + G)"
         class="top-link" id="top-link" accesskey="g">
         <i class="ri-arrow-up-double-line ri-3x"></i>
      </a>

      <script>
        var mybutton = document.getElementById('top-link');
        window.onscroll = function () {
            if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
                mybutton.style.visibility = 'visible';
                mybutton.style.opacity = '1';
            } else {
                mybutton.style.visibility = 'hidden';
                mybutton.style.opacity = '0';
            }
        };
      </script></div>
</body>
</html>
